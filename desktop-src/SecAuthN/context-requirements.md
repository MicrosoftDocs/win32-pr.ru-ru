---
description: Требования к контексту выражаются в виде сочетания битовых флагов, передаваемых в функцию InitializeSecurityContext (General) или AcceptSecurityContext (General).
ms.assetid: 4a44b829-4202-46c0-b17e-04943fa067ab
title: Требования к контексту
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 86af5f71557bdd53229b5c8ed6afc14dc24edb46
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265016"
---
# <a name="context-requirements"></a><span data-ttu-id="ec4e5-103">Требования к контексту</span><span class="sxs-lookup"><span data-stu-id="ec4e5-103">Context Requirements</span></span>

<span data-ttu-id="ec4e5-104">Требования к контексту выражаются в виде сочетания битовых флагов, передаваемых в функцию [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) или [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="ec4e5-104">Context requirements are expressed as a combination of bit flags passed to either the [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) or [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function.</span></span> <span data-ttu-id="ec4e5-105">Эти флаги влияют на [*контекст*](/windows/desktop/SecGloss/c-gly) несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-105">These flags affect the [*context*](/windows/desktop/SecGloss/c-gly) in a number of ways.</span></span> <span data-ttu-id="ec4e5-106">Не все флаги применяются ко всем контекстам.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-106">Not all flags apply to all contexts.</span></span> <span data-ttu-id="ec4e5-107">Некоторые из них действительны только для сервера, другие — только для клиента.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-107">Some are valid only for the server, others only for the client.</span></span>

<span data-ttu-id="ec4e5-108">Вызывающий объект использует параметр *фконтекстрек* в вызове [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) или [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) для указания набора флагов, которые указывают на необходимые возможности.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-108">The caller uses the *fContextReq* parameter of the [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) or [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) call to specify a set of flags that indicate the required capabilities.</span></span> <span data-ttu-id="ec4e5-109">При возврате функции параметр *пфконтекстаттр* указывает атрибуты установленного контекста.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-109">When the function returns, the *pfContextAttr* parameter indicates the attributes of the established context.</span></span> <span data-ttu-id="ec4e5-110">Вызывающий объект определяет, допустимы ли последние атрибуты контекста.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-110">The caller determines whether the final context attributes are acceptable.</span></span>

<span data-ttu-id="ec4e5-111">Флаги, запрошенные или возвращенные [**InitializeSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) , начинаются с префикса ISC.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-111">Flags requested from or returned by [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) are prefixed by ISC.</span></span> <span data-ttu-id="ec4e5-112">, Запрошенные из [**AcceptSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) или возвращенные с помощью, имеют префикс ASC.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-112">Those requested from or returned by [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) are prefixed by ASC.</span></span> <span data-ttu-id="ec4e5-113">Флаги, передаваемые в функцию, включают REQ, а возвращаемые флаги — RET.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-113">Flags passed into a function include REQ, while returned flags include RET.</span></span> <span data-ttu-id="ec4e5-114">Например, флаг запроса для взаимной проверки подлинности, переданный в **InitializeSecurityContext (Общие)** , — это \_ \_ взаимная проверка подлинности ISC req \_ .</span><span class="sxs-lookup"><span data-stu-id="ec4e5-114">For example, a request flag for mutual authentication passed to **InitializeSecurityContext (General)** is ISC\_REQ\_MUTUAL\_AUTH.</span></span> <span data-ttu-id="ec4e5-115">Сервер, запрашивающий взаимную проверку подлинности, передает \_ \_ \_ в **AcceptSecurityContext (Общие)** взаимную аутентификацию ASC.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-115">A server requesting mutual authentication passes ASC\_REQ\_MUTUAL\_AUTH to **AcceptSecurityContext (General)**.</span></span> <span data-ttu-id="ec4e5-116">Если взаимная проверка подлинности достигнута, **InitializeSecurityContext (общая)** возвращает ISC RET взаимную проверку подлинности \_ \_ \_ и **AcceptSecurityContext (General)** возвращает ASC \_ RET \_ взаимной \_ проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-116">If mutual authentication is achieved, **InitializeSecurityContext (General)** returns ISC\_RET\_MUTUAL\_AUTH and **AcceptSecurityContext (General)** returns ASC\_RET\_MUTUAL\_AUTH.</span></span> <span data-ttu-id="ec4e5-117">Если вызывающий объект запрашивает взаимную проверку подлинности, но [*пакет безопасности*](/windows/desktop/SecGloss/s-gly) указывает, что он не может быть выполнен, вызывающий объект должен решить, следует ли отменить контекст или продолжить.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-117">If the caller requests mutual authentication, but the [*security package*](/windows/desktop/SecGloss/s-gly) indicates that it cannot be performed, the caller must decide whether to cancel the context or continue.</span></span>

<span data-ttu-id="ec4e5-118">В следующей таблице описаны различные флаги требований к контексту.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-118">The following table describes the various context requirement flags.</span></span>



| <span data-ttu-id="ec4e5-119">Flag</span><span class="sxs-lookup"><span data-stu-id="ec4e5-119">Flag</span></span>                             | <span data-ttu-id="ec4e5-120">Описание</span><span class="sxs-lookup"><span data-stu-id="ec4e5-120">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|----------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="ec4e5-121">ПОЛУЧИТЬ</span><span class="sxs-lookup"><span data-stu-id="ec4e5-121">DELEGATE</span></span><br/>              | <span data-ttu-id="ec4e5-122">Сервер в транспортном приложении может создавать новые контексты безопасности, имитирующие клиент, который будет приниматься другими серверами в качестве контекстов клиента.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-122">The server in the transport application can build new security contexts impersonating the client that will be accepted by other servers as the client's contexts.</span></span> <span data-ttu-id="ec4e5-123">Делегат работает, только если \_ задана взаимная проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-123">Delegate works only if MUTUAL\_AUTH is set.</span></span> <span data-ttu-id="ec4e5-124">Сейчас ДЕЛЕГАТ поддерживается только [*протоколом Kerberos*](/windows/desktop/SecGloss/k-gly).</span><span class="sxs-lookup"><span data-stu-id="ec4e5-124">DELEGATE is currently supported only by [*Kerberos*](/windows/desktop/SecGloss/k-gly).</span></span> <span data-ttu-id="ec4e5-125">Кроме того, протокол Kerberos делегирует только серверу с флагом, ДОВЕРЕНным \_ для \_ делегирования.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-125">Further, Kerberos will delegate only to a server that has the flag TRUSTED\_FOR\_DELEGATION.</span></span> <span data-ttu-id="ec4e5-126">Не используйте этот флаг для [*ограниченного делегирования*](/windows/desktop/SecGloss/c-gly).</span><span class="sxs-lookup"><span data-stu-id="ec4e5-126">Do not use this flag for [*constrained delegation*](/windows/desktop/SecGloss/c-gly).</span></span><br/> |
| <span data-ttu-id="ec4e5-127">ВЗАИМная \_ Проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="ec4e5-127">MUTUAL\_AUTH</span></span><br/>          | <span data-ttu-id="ec4e5-128">Взаимодействующие стороны должны проверять подлинность своих удостоверений друг с другом.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-128">The communicating parties must authenticate their identities to each other.</span></span> <span data-ttu-id="ec4e5-129">Без ВЗАИМной \_ проверки подлинности клиент проверяет подлинность удостоверения на сервере.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-129">Without MUTUAL\_AUTH, the client authenticates its identity to the server.</span></span> <span data-ttu-id="ec4e5-130">При ВЗАИМной \_ проверке подлинности сервер также должен пройти проверку подлинности на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-130">With MUTUAL\_AUTH, the server also must authenticate its identity to the client.</span></span><br/> <span data-ttu-id="ec4e5-131">При использовании пакета безопасности [*SChannel*](/windows/desktop/SecGloss/s-gly) сервер устанавливает постоянную **\_ \_ взаимную проверку \_ подлинности ASC RET** только в последнем вызове [**AcceptSecurityContext (Negotiate)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext)после успешного завершения сопоставления сертификата.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-131">When using the [*Schannel*](/windows/desktop/SecGloss/s-gly) security package, the server sets the **ASC\_RET\_MUTUAL\_AUTH** constant only in the last call to [**AcceptSecurityContext (Negotiate)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext), after certificate mapping has successfully completed.</span></span><br/>           |
| <span data-ttu-id="ec4e5-132">обнаружение воспроизведения \_</span><span class="sxs-lookup"><span data-stu-id="ec4e5-132">REPLAY\_DETECT</span></span><br/>        | <span data-ttu-id="ec4e5-133">[*Пакет безопасности*](/windows/desktop/SecGloss/s-gly) обнаруживает воспроизводимые пакеты и уведомляет вызывающий объект о том, что пакет был воспроизведен.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-133">The [*security package*](/windows/desktop/SecGloss/s-gly) detects replayed packets and notifies the caller if a packet has been replayed.</span></span> <span data-ttu-id="ec4e5-134">Использование этого флага подразумевает все условия, заданные флагом целостности.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-134">The use of this flag implies all of the conditions specified by the INTEGRITY flag.</span></span><br/>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="ec4e5-135">\_Обнаружение последовательности</span><span class="sxs-lookup"><span data-stu-id="ec4e5-135">SEQUENCE\_DETECT</span></span><br/>      | <span data-ttu-id="ec4e5-136">Контекст должен быть разрешен для определения неупорядоченной доставки пакетов позже через функции поддержки сообщений.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-136">The context must be allowed to detect out-of-order delivery of packets later through the message support functions.</span></span> <span data-ttu-id="ec4e5-137">Использование этого флага подразумевает все условия, заданные флагом целостности.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-137">Use of this flag implies all of the conditions specified by the INTEGRITY flag.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                             |
| <span data-ttu-id="ec4e5-138">ЗАЩИТЕ</span><span class="sxs-lookup"><span data-stu-id="ec4e5-138">CONFIDENTIALITY</span></span><br/>       | <span data-ttu-id="ec4e5-139">Контекст может защищать данные во время передачи с помощью функций [**енкриптмессаже (Общие)**](/windows/win32/api/sspi/nf-sspi-encryptmessage) и [**декриптмессаже (Общие)**](/windows/win32/api/sspi/nf-sspi-decryptmessage) .</span><span class="sxs-lookup"><span data-stu-id="ec4e5-139">The context can protect data while in transit using the [**EncryptMessage (General)**](/windows/win32/api/sspi/nf-sspi-encryptmessage) and [**DecryptMessage (General)**](/windows/win32/api/sspi/nf-sspi-decryptmessage) functions.</span></span> <span data-ttu-id="ec4e5-140">Флаг конфиденциальности не работает, если созданный контекст предназначен для учетной записи гостя.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-140">The CONFIDENTIALITY flag does not work if the generated context is for the Guest account.</span></span><br/>                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="ec4e5-141">ИСПОЛЬЗОВАТЬ \_ сеансовый \_ ключ</span><span class="sxs-lookup"><span data-stu-id="ec4e5-141">USE\_SESSION\_KEY</span></span><br/>     | <span data-ttu-id="ec4e5-142">Необходимо согласовать новый [*ключ сеанса*](/windows/desktop/SecGloss/s-gly) .</span><span class="sxs-lookup"><span data-stu-id="ec4e5-142">A new [*session key*](/windows/desktop/SecGloss/s-gly) must be negotiated.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span data-ttu-id="ec4e5-143">ЗАПРОС учетных данными \_ \_</span><span class="sxs-lookup"><span data-stu-id="ec4e5-143">PROMPT\_FOR\_CREDS</span></span><br/>    | <span data-ttu-id="ec4e5-144">Если клиент является интерактивным пользователем, пакет безопасности должен по возможности запрашивать у пользователя соответствующие [*учетные данные*](/windows/desktop/SecGloss/c-gly).</span><span class="sxs-lookup"><span data-stu-id="ec4e5-144">If the client is an interactive user, the security package must, if possible, prompt the user for the appropriate [*credentials*](/windows/desktop/SecGloss/c-gly).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="ec4e5-145">ИСПОЛЬЗОВАТЬ \_ предоставляемые учетные данные \_</span><span class="sxs-lookup"><span data-stu-id="ec4e5-145">USE\_SUPPLIED\_CREDS</span></span><br/>  | <span data-ttu-id="ec4e5-146">Учетные данные, относящиеся к пакету, доступны во входном буфере.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-146">Package-specific credential information is available in the input buffer.</span></span> <span data-ttu-id="ec4e5-147">Пакет безопасности может использовать эти [*учетные данные*](/windows/desktop/SecGloss/c-gly) для проверки подлинности подключения.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-147">The security package can use these [*credentials*](/windows/desktop/SecGloss/c-gly) to authenticate the connection.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="ec4e5-148">Сохранить \_ предоставляемые учетные данные \_</span><span class="sxs-lookup"><span data-stu-id="ec4e5-148">SAVE\_SUPPLIED\_CREDS</span></span><br/> | <span data-ttu-id="ec4e5-149">Указанные учетные данные должны кэшироваться дополнительными учетными данными.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-149">The supplied credentials should be cached with the supplemental credentials.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="ec4e5-150">ВЫДЕЛЕНИЕ \_ памяти</span><span class="sxs-lookup"><span data-stu-id="ec4e5-150">ALLOCATE\_MEMORY</span></span><br/>      | <span data-ttu-id="ec4e5-151">[*Пакет безопасности*](/windows/desktop/SecGloss/s-gly) должен выделить память.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-151">The [*security package*](/windows/desktop/SecGloss/s-gly) must allocate memory.</span></span> <span data-ttu-id="ec4e5-152">Вызывающий объект должен в конечном итоге вызвать функцию [**фриконтекстбуффер**](/windows/desktop/api/Sspi/nf-sspi-freecontextbuffer) , чтобы освободить память, выделенную пакетом безопасности.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-152">The caller must eventually call the [**FreeContextBuffer**](/windows/desktop/api/Sspi/nf-sspi-freecontextbuffer) function to free memory allocated by the security package.</span></span><br/>                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="ec4e5-153">ИСПОЛЬЗОВАТЬ \_ \_ стиль DCE</span><span class="sxs-lookup"><span data-stu-id="ec4e5-153">USE\_DCE\_STYLE</span></span><br/>       | <span data-ttu-id="ec4e5-154">Вызывающий объект принимает [*транзакцию*](/windows/desktop/SecGloss/t-gly)с тремя обрезками.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-154">The caller expects a three-leg authentication [*transaction*](/windows/desktop/SecGloss/t-gly).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="ec4e5-155">ДАТАГРАММЫ</span><span class="sxs-lookup"><span data-stu-id="ec4e5-155">DATAGRAM</span></span><br/>              | <span data-ttu-id="ec4e5-156">Необходимо использовать семантику [*датаграммы*](/windows/desktop/SecGloss/d-gly) .</span><span class="sxs-lookup"><span data-stu-id="ec4e5-156">[*Datagram*](/windows/desktop/SecGloss/d-gly) semantics must be used.</span></span> <span data-ttu-id="ec4e5-157">Дополнительные сведения см. в разделе о [контекстах датаграмм](datagram-contexts.md).</span><span class="sxs-lookup"><span data-stu-id="ec4e5-157">For more information, see [Datagram Contexts](datagram-contexts.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="ec4e5-158">CONNECTION</span><span class="sxs-lookup"><span data-stu-id="ec4e5-158">CONNECTION</span></span><br/>            | <span data-ttu-id="ec4e5-159">Необходимо использовать семантику соединения.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-159">Connection semantics must be used.</span></span> <span data-ttu-id="ec4e5-160">Дополнительные сведения см. в разделе [контексты, ориентированные на соединение](connection-oriented-contexts.md).</span><span class="sxs-lookup"><span data-stu-id="ec4e5-160">For more information, see [Connection-Oriented Contexts](connection-oriented-contexts.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="ec4e5-161">Поток</span><span class="sxs-lookup"><span data-stu-id="ec4e5-161">STREAM</span></span><br/>                | <span data-ttu-id="ec4e5-162">Необходимо использовать семантику потока.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-162">Stream semantics must be used.</span></span> <span data-ttu-id="ec4e5-163">Дополнительные сведения см. в разделе [потоковые контексты](stream-contexts.md).</span><span class="sxs-lookup"><span data-stu-id="ec4e5-163">For more information, see [Stream Contexts](stream-contexts.md).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="ec4e5-164">РАСШИРЕНная \_ Ошибка</span><span class="sxs-lookup"><span data-stu-id="ec4e5-164">EXTENDED\_ERROR</span></span><br/>       | <span data-ttu-id="ec4e5-165">При сбое контекста необходимо создать сообщения об ошибке для однорангового узла.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-165">Error reply messages for the peer must be generated if the context fails.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="ec4e5-166">КОНТРОЛЯ</span><span class="sxs-lookup"><span data-stu-id="ec4e5-166">INTEGRITY</span></span><br/>             | <span data-ttu-id="ec4e5-167">Целостность буфера может быть проверена, но не включена последовательность или обнаружение ответов.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-167">Buffer integrity can be verified but no sequencing or reply detection is enabled.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| <span data-ttu-id="ec4e5-168">БЕЗ \_ целостности</span><span class="sxs-lookup"><span data-stu-id="ec4e5-168">NO\_INTEGRITY</span></span><br/>         | <span data-ttu-id="ec4e5-169">Требование **целостности** игнорируется.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-169">The **INTEGRITY** requirement is ignored.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="ec4e5-170">УКАЗЫВАЕТСЯ</span><span class="sxs-lookup"><span data-stu-id="ec4e5-170">IDENTIFY</span></span><br/>              | <span data-ttu-id="ec4e5-171">Когда сервер олицетворяет контекст, для которого установлен этот флаг, олицетворение дает чрезвычайно ограниченный доступ.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-171">When a server impersonates a context that has this flag set, that impersonation yields extremely limited access.</span></span> <span data-ttu-id="ec4e5-172">Олицетворение с помощью набора IDENTIFY используется для проверки удостоверения клиента.</span><span class="sxs-lookup"><span data-stu-id="ec4e5-172">Impersonation with IDENTIFY set is used to verify the client's identity.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                       |



 

 

