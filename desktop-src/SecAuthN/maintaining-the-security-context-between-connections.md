---
description: Чтобы уменьшить трафик контроллера домена и повысить производительность, клиентская часть Microsoft Digest кэширует сведения, полученные после успешной проверки подлинности на сервере.
ms.assetid: cd928266-889a-494c-a94b-4ea7b1dcc241
title: Поддержание контекста безопасности между соединениями
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aeb450dde789f17f46397cb56fe74b94adcf8ea6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104347145"
---
# <a name="maintaining-the-security-context-between-connections"></a><span data-ttu-id="a58fc-103">Поддержание контекста безопасности между соединениями</span><span class="sxs-lookup"><span data-stu-id="a58fc-103">Maintaining the Security Context Between Connections</span></span>

<span data-ttu-id="a58fc-104">Чтобы уменьшить трафик контроллера домена и повысить производительность, клиентская часть Microsoft Digest кэширует сведения, полученные после успешной проверки подлинности на сервере.</span><span class="sxs-lookup"><span data-stu-id="a58fc-104">To reduce domain controller traffic and improve performance, the client-side of Microsoft Digest caches information received after successful authentication with a server.</span></span> <span data-ttu-id="a58fc-105">Клиентским приложениям необходимо кэшировать только те маркеры, которые были установлены в [*контексте безопасности*](../secgloss/s-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="a58fc-105">Client applications need only cache the handle to the [*security context*](../secgloss/s-gly.md) that has been established.</span></span> <span data-ttu-id="a58fc-106">В следующей таблице описаны сведения, кэшированные пакетом безопасности.</span><span class="sxs-lookup"><span data-stu-id="a58fc-106">The following table describes information cached by the security package.</span></span>



| <span data-ttu-id="a58fc-107">Сведения</span><span class="sxs-lookup"><span data-stu-id="a58fc-107">Information</span></span>                                                       | <span data-ttu-id="a58fc-108">Описание</span><span class="sxs-lookup"><span data-stu-id="a58fc-108">Description</span></span>                                                                                                                                         |
|-------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a58fc-109">Имя сервера</span><span class="sxs-lookup"><span data-stu-id="a58fc-109">Server name</span></span>                                                       | <span data-ttu-id="a58fc-110">Сервер, успешно создавший контекст безопасности для пользователя.</span><span class="sxs-lookup"><span data-stu-id="a58fc-110">The server that has successfully created a security context for the user.</span></span>                                                                           |
| <span data-ttu-id="a58fc-111">Область или домен</span><span class="sxs-lookup"><span data-stu-id="a58fc-111">Realm/Domain</span></span>                                                      | <span data-ttu-id="a58fc-112">Имя домена, используемое для успешной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a58fc-112">The domain name used in the successful authentication.</span></span>                                                                                              |
| [<span data-ttu-id="a58fc-113">*Требуем*</span><span class="sxs-lookup"><span data-stu-id="a58fc-113">*Nonce*</span></span>](../secgloss/n-gly.md) | <span data-ttu-id="a58fc-114">Элемент Server nonce, связанный с успешной проверкой подлинности.</span><span class="sxs-lookup"><span data-stu-id="a58fc-114">A server nonce that is associated with the successful authentication.</span></span>                                                                               |
| <span data-ttu-id="a58fc-115">Число nonce</span><span class="sxs-lookup"><span data-stu-id="a58fc-115">Nonce count</span></span>                                                       | <span data-ttu-id="a58fc-116">Количество раз, когда клиент включил nonce в запросы к серверу.</span><span class="sxs-lookup"><span data-stu-id="a58fc-116">The number of times the client has included the nonce in requests to the server.</span></span> <span data-ttu-id="a58fc-117">Используется для обнаружения воспроизведения.</span><span class="sxs-lookup"><span data-stu-id="a58fc-117">This is used for replay-detection.</span></span>                                 |
| <span data-ttu-id="a58fc-118">Непрозрачное значение</span><span class="sxs-lookup"><span data-stu-id="a58fc-118">Opaque value</span></span>                                                      | <span data-ttu-id="a58fc-119">Значение, возвращаемое для непрозрачной директивы после успешной проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="a58fc-119">The value returned for the opaque directive after a successful authentication.</span></span> <span data-ttu-id="a58fc-120">Это значение содержит ссылку на контекст безопасности пользователя.</span><span class="sxs-lookup"><span data-stu-id="a58fc-120">This value contains a reference to the security context of the user.</span></span> |



 

<span data-ttu-id="a58fc-121">Когда клиент отправляет сообщение на сервер, сервер должен определить, имеет ли клиент существующий контекст безопасности.</span><span class="sxs-lookup"><span data-stu-id="a58fc-121">When a client sends a message to a server, the server must determine whether the client has an existing security context.</span></span> <span data-ttu-id="a58fc-122">Для этого сервер передает каждый клиентский запрос функции [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="a58fc-122">To do this, the server passes each client request to the [**AcceptSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function.</span></span> <span data-ttu-id="a58fc-123">Эта функция извлекает значение непрозрачной директивы из запроса, если оно есть, и использует его для поиска контекста безопасности клиента.</span><span class="sxs-lookup"><span data-stu-id="a58fc-123">This function extracts the value of the opaque directive from the request, if present, and uses it to look up the client's security context.</span></span> <span data-ttu-id="a58fc-124">Если контекст безопасности найден, то на сервер возвращается маркер контекста.</span><span class="sxs-lookup"><span data-stu-id="a58fc-124">If the security context is found, the handle of the context is returned to the server.</span></span> <span data-ttu-id="a58fc-125">Связанные сведения см. в разделе [Проверка подлинности последующих запросов](authenticating-subsequent-requests-using-microsoft-digest.md).</span><span class="sxs-lookup"><span data-stu-id="a58fc-125">For related information, see [Authenticating Subsequent Requests](authenticating-subsequent-requests-using-microsoft-digest.md).</span></span>

<span data-ttu-id="a58fc-126">Как средство обнаружения атак с подменой и воспроизведением, клиент вызывает функцию [**макесигнатуре**](/windows/desktop/api/Sspi/nf-sspi-makesignature) , которая использует контекст безопасности для подписания сообщения.</span><span class="sxs-lookup"><span data-stu-id="a58fc-126">As a means of detecting spoofing and replay attacks, the client calls the [**MakeSignature**](/windows/desktop/api/Sspi/nf-sspi-makesignature) function which uses a security context to sign a message.</span></span> <span data-ttu-id="a58fc-127">Когда сообщения защищаются с помощью функции **макесигнатуре** , сервер использует функцию [**VerifySignature**](/windows/desktop/api/Sspi/nf-sspi-verifysignature) с кэшированным контекстом, чтобы проверить происхождение и [*целостность*](../secgloss/i-gly.md)сообщения.</span><span class="sxs-lookup"><span data-stu-id="a58fc-127">When messages are protected using the **MakeSignature** function, the server uses the [**VerifySignature**](/windows/desktop/api/Sspi/nf-sspi-verifysignature) function with the cached context to verify the message's origin and [*integrity*](../secgloss/i-gly.md).</span></span> <span data-ttu-id="a58fc-128">Дополнительные сведения см. в разделе [Защита сообщений](protecting-messages-using-microsoft-digest.md).</span><span class="sxs-lookup"><span data-stu-id="a58fc-128">For more information, see [Protecting Messages](protecting-messages-using-microsoft-digest.md).</span></span>

 

 
