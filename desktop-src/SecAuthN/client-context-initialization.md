---
description: Инициализация контекста клиента
ms.assetid: 0c8aad3e-e726-49ce-8fc9-94dbd60cc5cb
title: Инициализация контекста клиента
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 615ce5c157371f1ebfec685d6227bd11a1d76531
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104155910"
---
# <a name="client-context-initialization"></a><span data-ttu-id="ae2ed-103">Инициализация контекста клиента</span><span class="sxs-lookup"><span data-stu-id="ae2ed-103">Client Context Initialization</span></span>

<span data-ttu-id="ae2ed-104">Чтобы установить безопасное соединение, клиент получает исходящий обработчик [*учетных данных*](/windows/desktop/SecGloss/c-gly) перед отправкой на сервер запроса проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-104">To establish a secure connection, the client acquires an outbound [*credentials*](/windows/desktop/SecGloss/c-gly) handle before sending an authentication request to the server.</span></span> <span data-ttu-id="ae2ed-105">Сервер создает для клиента контекст безопасности из запроса проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-105">The server creates a security context for the client from the authentication request.</span></span> <span data-ttu-id="ae2ed-106">В настройке проверки подлинности участвуют две функции SSPI на стороне клиента:</span><span class="sxs-lookup"><span data-stu-id="ae2ed-106">There are two client-side SSPI functions involved in authentication setup:</span></span>

-   <span data-ttu-id="ae2ed-107">[**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) получает ссылку на ранее полученные [*учетные данные*](/windows/desktop/SecGloss/c-gly)для входа.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-107">[**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) obtains a reference to previously obtained logon [*credentials*](/windows/desktop/SecGloss/c-gly).</span></span>
-   <span data-ttu-id="ae2ed-108">[**InitializeSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) создает исходные маркеры безопасности запроса проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-108">[**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) creates the initial authentication request security tokens.</span></span>

<span data-ttu-id="ae2ed-109">Код для этого процесса можно увидеть в функции **женклиентконтекст** в [использовании SSPI с клиентом сокетов Windows](using-sspi-with-a-windows-sockets-client.md).</span><span class="sxs-lookup"><span data-stu-id="ae2ed-109">Code for this process can be seen in the **GenClientContext** function in [Using SSPI with a Windows Sockets Client](using-sspi-with-a-windows-sockets-client.md).</span></span>

<span data-ttu-id="ae2ed-110">Если клиентская программа должна использовать учетные данные в дополнение к собственным учетным данным, таким как имя пользователя, имя домена и пароль, он предоставляет их в вызове [**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) с использованием структуры [**\_ \_ \_ удостоверения WinNT auth**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) с указанием дополнительных учетных данных.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-110">If a client program needs to use credentials in addition to its own logon credentials, such as a different user name, domain name, and password, it provides them in the [**AcquireCredentialsHandle**](/windows/win32/api/sspi/nf-sspi-acquirecredentialshandlea) call with a [**SEC\_WINNT\_AUTH\_IDENTITY**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) structure specifying the additional credentials.</span></span> <span data-ttu-id="ae2ed-111">Дополнительные сведения о функциях учетных данных см. в разделе [Управление учетными](authentication-functions.md)данными.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-111">For more information on credentials functions, see [Credential Management](authentication-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="ae2ed-112">Элемент **flags** в структуре [**\_ \_ \_ идентификаторов проверки подлинности в секунду**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) может иметь значение \_ WinNT \_ AUTH \_ Identity ANSI, \_ Если строки в структуре являются асЦи или OEM.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-112">The **Flags** member of the [**SEC\_WINNT\_AUTH\_IDENTITY**](/windows/win32/api/sspi/ns-sspi-sec_winnt_auth_identity_a) structure can be set to SEC\_WINNT\_AUTH\_IDENTITY\_ANSI when strings in the structure are ASCI or OEM.</span></span> <span data-ttu-id="ae2ed-113">Строки ANSI можно использовать с членом **flags** в структуре **\_ \_ \_ удостоверений WinNT auth** с установленным параметром в сек \_ . WinNT Authentication \_ Identity, \_ \_ если они сначала преобразуются в [*Юникод*](/windows/desktop/SecGloss/u-gly) с помощью функции [**MultiByteToWideChar**](/windows/desktop/api/stringapiset/nf-stringapiset-multibytetowidechar) .</span><span class="sxs-lookup"><span data-stu-id="ae2ed-113">ANSI strings can be used with the **Flags** member of the **SEC\_WINNT\_AUTH\_IDENTITY** structure set to SEC\_WINNT\_AUTH\_IDENTITY\_UNICODE if they are first converted to [*Unicode*](/windows/desktop/SecGloss/u-gly) by using the [**MultiByteToWideChar**](/windows/desktop/api/stringapiset/nf-stringapiset-multibytetowidechar) function.</span></span>

 

<span data-ttu-id="ae2ed-114">Чтобы инициировать первую часть проверки подлинности, клиент вызывает [**InitializeSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) , чтобы получить исходный маркер безопасности, отправляемый на сервер в сообщении запроса на подключение.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-114">To initiate the first leg of the authentication, the client calls [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) to obtain an initial security token to be sent in a connection request message to the server.</span></span>

<span data-ttu-id="ae2ed-115">Клиент использует сведения о маркере безопасности, полученные в дескрипторе выходного буфера, для создания сообщения, отправляемого на сервер.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-115">The client uses the security token information received in the output buffer descriptor to generate a message to send to the server.</span></span> <span data-ttu-id="ae2ed-116">Создание сообщения с точки зрения размещения различных буферов и т. д. является частью [*протокола приложения*](/windows/desktop/SecGloss/a-gly) и должно быть понято обеим сторонам.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-116">The construction of the message, in terms of placement of various buffers and so forth, is part of the [*application protocol*](/windows/desktop/SecGloss/a-gly) and must be understood by both parties.</span></span>

<span data-ttu-id="ae2ed-117">Клиент проверяет состояние возврата из [**InitializeSecurityContext (Общие)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) , чтобы определить, будет ли проверка подлинности завершена в одном вызове.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-117">The client checks the return status from [**InitializeSecurityContext (General)**](/windows/win32/api/sspi/nf-sspi-initializesecuritycontexta) to see if authentication will complete in a single call.</span></span> <span data-ttu-id="ae2ed-118">Состояние возврата в СЕКУНДах \_ , по- \_ прежнему \_ требуется, указывает, что протокол безопасности требует нескольких сообщений проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ae2ed-118">A return status of SEC\_I\_CONTINUE\_NEEDED indicates that the security protocol requires multiple authentication messages.</span></span> <span data-ttu-id="ae2ed-119">Дополнительные сведения о контекстных функциях см. в разделе [Управление контекстами](authentication-functions.md).</span><span class="sxs-lookup"><span data-stu-id="ae2ed-119">For more information on context functions, see [Context Management](authentication-functions.md).</span></span>

 

 
