---
description: Windows-запрос/ответ (NTLM) — это протокол проверки подлинности, используемый в сетях, которые включают в себя системы, работающие под управлением операционной системы Windows и изолированных систем.
ms.assetid: 35a38858-d36f-45c9-95f4-2541a182f5ac
title: Microsoft NTLM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9723f24d5913adefe70d4e238de0591790a34bfd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104541175"
---
# <a name="microsoft-ntlm"></a><span data-ttu-id="c53ba-103">Microsoft NTLM</span><span class="sxs-lookup"><span data-stu-id="c53ba-103">Microsoft NTLM</span></span>

<span data-ttu-id="c53ba-104">Windows-запрос/ответ (NTLM) — это протокол проверки подлинности, используемый в сетях, которые включают в себя системы, работающие под управлением операционной системы Windows и изолированных систем.</span><span class="sxs-lookup"><span data-stu-id="c53ba-104">Windows Challenge/Response (NTLM) is the authentication protocol used on networks that include systems running the Windows operating system and on stand-alone systems.</span></span>

<span data-ttu-id="c53ba-105">[*Пакет безопасности*](../secgloss/s-gly.md) Microsoft [*Kerberos*](../secgloss/k-gly.md) повышает безопасность, чем NTLM, для систем в сети.</span><span class="sxs-lookup"><span data-stu-id="c53ba-105">The Microsoft [*Kerberos*](../secgloss/k-gly.md) [*security package*](../secgloss/s-gly.md) adds greater security than NTLM to systems on a network.</span></span> <span data-ttu-id="c53ba-106">Несмотря на то, что Microsoft *Kerberos* является выбранным протоколом, NTLM по-прежнему поддерживается.</span><span class="sxs-lookup"><span data-stu-id="c53ba-106">Although Microsoft *Kerberos* is the protocol of choice, NTLM is still supported.</span></span> <span data-ttu-id="c53ba-107">NTLM также необходимо использовать для проверки подлинности входа в автономных системах.</span><span class="sxs-lookup"><span data-stu-id="c53ba-107">NTLM must also be used for logon authentication on stand-alone systems.</span></span> <span data-ttu-id="c53ba-108">Дополнительные сведения о протоколе Kerberos см. в разделе [Microsoft Kerberos](microsoft-kerberos.md).</span><span class="sxs-lookup"><span data-stu-id="c53ba-108">For more information about Kerberos, see [Microsoft Kerberos](microsoft-kerberos.md).</span></span>

<span data-ttu-id="c53ba-109">Учетные данные NTLM основываются на данных, полученных в процессе интерактивного входа в систему, и содержат имя домена, имя пользователя и односторонний [*хэш*](../secgloss/h-gly.md) пароля пользователя.</span><span class="sxs-lookup"><span data-stu-id="c53ba-109">NTLM credentials are based on data obtained during the interactive logon process and consist of a domain name, a user name, and a one-way [*hash*](../secgloss/h-gly.md) of the user's password.</span></span> <span data-ttu-id="c53ba-110">NTLM использует зашифрованный протокол запроса/ответа для проверки подлинности пользователя без отправки пароля пользователя по сети.</span><span class="sxs-lookup"><span data-stu-id="c53ba-110">NTLM uses an encrypted challenge/response protocol to authenticate a user without sending the user's password over the wire.</span></span> <span data-ttu-id="c53ba-111">Вместо этого система, запрашивающая проверку подлинности, должна выполнить вычисление, которое подтверждает, что у него есть доступ к защищенным учетным данным NTLM.</span><span class="sxs-lookup"><span data-stu-id="c53ba-111">Instead, the system requesting authentication must perform a calculation that proves it has access to the secured NTLM credentials.</span></span>

<span data-ttu-id="c53ba-112">Интерактивная проверка подлинности NTLM в сети обычно включает две системы: клиентскую систему, где пользователь запрашивает проверку подлинности, и контроллер домена, где хранятся сведения, связанные с паролем пользователя.</span><span class="sxs-lookup"><span data-stu-id="c53ba-112">Interactive NTLM authentication over a network typically involves two systems: a client system, where the user is requesting authentication, and a domain controller, where information related to the user's password is kept.</span></span> <span data-ttu-id="c53ba-113">Неинтерактивная проверка подлинности, которая может потребоваться, чтобы позволить уже вошедшему пользователю доступ к ресурсу, такому как серверное приложение, обычно включает три системы: Клиент, сервер и контроллер домена, выполняющие вычисления проверки подлинности от имени сервера.</span><span class="sxs-lookup"><span data-stu-id="c53ba-113">Noninteractive authentication, which may be required to permit an already logged-on user to access a resource such as a server application, typically involves three systems: a client, a server, and a domain controller that does the authentication calculations on behalf of the server.</span></span>

<span data-ttu-id="c53ba-114">Следующие шаги представляют собой структуру неинтерактивной проверки подлинности NTLM.</span><span class="sxs-lookup"><span data-stu-id="c53ba-114">The following steps present an outline of NTLM noninteractive authentication.</span></span> <span data-ttu-id="c53ba-115">На первом шаге предоставляются учетные данные NTLM пользователя, которые выполняются только в рамках процесса интерактивной проверки подлинности (Logon).</span><span class="sxs-lookup"><span data-stu-id="c53ba-115">The first step provides the user's NTLM credentials and occurs only as part of the interactive authentication (logon) process.</span></span>

1.  <span data-ttu-id="c53ba-116">(Только Интерактивная проверка подлинности) Пользователь обращается к клиентскому компьютеру и предоставляет имя домена, имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="c53ba-116">(Interactive authentication only) A user accesses a client computer and provides a domain name, user name, and password.</span></span> <span data-ttu-id="c53ba-117">Клиент вычислит криптографический [*хэш*](../secgloss/h-gly.md) пароля и отклоняет Фактический пароль.</span><span class="sxs-lookup"><span data-stu-id="c53ba-117">The client computes a cryptographic [*hash*](../secgloss/h-gly.md) of the password and discards the actual password.</span></span>
2.  <span data-ttu-id="c53ba-118">Клиент отправляет имя пользователя на сервер (в [*виде обычного текста*](../secgloss/p-gly.md)).</span><span class="sxs-lookup"><span data-stu-id="c53ba-118">The client sends the user name to the server (in [*plaintext*](../secgloss/p-gly.md)).</span></span>
3.  <span data-ttu-id="c53ba-119">Сервер создает 16-байтовое случайное число, называемое *запросом* или [*nonce*](../secgloss/n-gly.md), и отправляет его клиенту.</span><span class="sxs-lookup"><span data-stu-id="c53ba-119">The server generates a 16-byte random number, called a *challenge* or [*nonce*](../secgloss/n-gly.md), and sends it to the client.</span></span>
4.  <span data-ttu-id="c53ba-120">Клиент шифрует эту задачу с помощью хэша пароля пользователя и возвращает результат на сервер.</span><span class="sxs-lookup"><span data-stu-id="c53ba-120">The client encrypts this challenge with the hash of the user's password and returns the result to the server.</span></span> <span data-ttu-id="c53ba-121">Это называется *ответом*.</span><span class="sxs-lookup"><span data-stu-id="c53ba-121">This is called the *response*.</span></span>
5.  <span data-ttu-id="c53ba-122">Сервер отправляет на контроллер домена следующие три элемента:</span><span class="sxs-lookup"><span data-stu-id="c53ba-122">The server sends the following three items to the domain controller:</span></span>

    -   <span data-ttu-id="c53ba-123">Имя пользователя</span><span class="sxs-lookup"><span data-stu-id="c53ba-123">User name</span></span>
    -   <span data-ttu-id="c53ba-124">Запрос, отправленный клиенту</span><span class="sxs-lookup"><span data-stu-id="c53ba-124">Challenge sent to the client</span></span>
    -   <span data-ttu-id="c53ba-125">Ответ, полученный от клиента</span><span class="sxs-lookup"><span data-stu-id="c53ba-125">Response received from the client</span></span>

6.  <span data-ttu-id="c53ba-126">Контроллер домена использует имя пользователя для получения хэша пароля пользователя из базы данных диспетчера учетных записей безопасности.</span><span class="sxs-lookup"><span data-stu-id="c53ba-126">The domain controller uses the user name to retrieve the hash of the user's password from the Security Account Manager database.</span></span> <span data-ttu-id="c53ba-127">Он использует этот хэш пароля для шифрования запроса.</span><span class="sxs-lookup"><span data-stu-id="c53ba-127">It uses this password hash to encrypt the challenge.</span></span>
7.  <span data-ttu-id="c53ba-128">Контроллер домена сравнивает зашифрованный запрос, который он вычислит (на шаге 6), с ответом, вычисленным клиентом (на шаге 4).</span><span class="sxs-lookup"><span data-stu-id="c53ba-128">The domain controller compares the encrypted challenge it computed (in step 6) to the response computed by the client (in step 4).</span></span> <span data-ttu-id="c53ba-129">Если они идентичны, проверка подлинности прошла успешно.</span><span class="sxs-lookup"><span data-stu-id="c53ba-129">If they are identical, authentication is successful.</span></span>

<span data-ttu-id="c53ba-130">Приложение не должно напрямую получать доступ к [*пакету безопасности*](../secgloss/s-gly.md) NTLM; Вместо этого он должен использовать пакет безопасности [*Negotiate*](../secgloss/n-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="c53ba-130">Your application should not access the NTLM [*security package*](../secgloss/s-gly.md) directly; instead, it should use the [*Negotiate*](../secgloss/n-gly.md) security package.</span></span> <span data-ttu-id="c53ba-131">Согласование позволяет приложению использовать преимущества более сложных [*протоколов безопасности*](../secgloss/s-gly.md) , если они поддерживаются системами, участвующими в проверке подлинности.</span><span class="sxs-lookup"><span data-stu-id="c53ba-131">Negotiate allows your application to take advantage of more advanced [*security protocols*](../secgloss/s-gly.md) if they are supported by the systems involved in the authentication.</span></span> <span data-ttu-id="c53ba-132">Сейчас пакет безопасности Negotiate выбирает между [*Kerberos*](../secgloss/k-gly.md) и NTLM.</span><span class="sxs-lookup"><span data-stu-id="c53ba-132">Currently, the Negotiate security package selects between [*Kerberos*](../secgloss/k-gly.md) and NTLM.</span></span> <span data-ttu-id="c53ba-133">Согласование выбирает Kerberos, если не может использоваться одной из систем, участвующих в проверке подлинности.</span><span class="sxs-lookup"><span data-stu-id="c53ba-133">Negotiate selects Kerberos unless it cannot be used by one of the systems involved in the authentication.</span></span>

 

 
