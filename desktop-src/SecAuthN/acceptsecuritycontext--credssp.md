---
description: Позволяет серверному компоненту транспортного приложения устанавливать контекст безопасности между сервером и удаленным клиентом.
ms.assetid: a53f733e-b646-4431-b021-a2c446308849
title: Функция AcceptSecurityContext (CredSSP)
ms.topic: article
ms.date: 07/25/2019
ms.openlocfilehash: 681e03ea15729cc8726d63551e8b7b0a2b39ecac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105719530"
---
# <a name="acceptsecuritycontext-credssp-function"></a><span data-ttu-id="7e0de-103">Функция AcceptSecurityContext (CredSSP)</span><span class="sxs-lookup"><span data-stu-id="7e0de-103">AcceptSecurityContext (CredSSP) function</span></span>

<span data-ttu-id="7e0de-104">Функция **AcceptSecurityContext (CredSSP)** позволяет компоненту сервера транспортного приложения устанавливать контекст безопасности между сервером и удаленным клиентом.</span><span class="sxs-lookup"><span data-stu-id="7e0de-104">The **AcceptSecurityContext (CredSSP)** function lets the server component of a transport application establish a security context between the server and a remote client.</span></span> <span data-ttu-id="7e0de-105">Удаленный клиент вызывает функцию [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) для запуска процесса установки контекста безопасности.</span><span class="sxs-lookup"><span data-stu-id="7e0de-105">The remote client calls the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function to start the process of establishing a security context.</span></span> <span data-ttu-id="7e0de-106">Серверу может потребоваться один или несколько маркеров ответа от удаленного клиента для завершения установки контекста безопасности.</span><span class="sxs-lookup"><span data-stu-id="7e0de-106">The server can require one or more reply tokens from the remote client to complete establishing the security context.</span></span>

## <a name="syntax"></a><span data-ttu-id="7e0de-107">Синтаксис</span><span class="sxs-lookup"><span data-stu-id="7e0de-107">Syntax</span></span>

```C++
SECURITY_STATUS SEC_ENTRY AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        unsigned long  fContextReq,
  _In_        unsigned long  TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       unsigned long  *pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```

## <a name="parameters"></a><span data-ttu-id="7e0de-108">Параметры</span><span class="sxs-lookup"><span data-stu-id="7e0de-108">Parameters</span></span>

<span data-ttu-id="7e0de-109">*фкредентиал* \[ в необязательное\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-109">*phCredential* \[in, optional\]</span></span>

<span data-ttu-id="7e0de-110">Маркер учетных данных сервера.</span><span class="sxs-lookup"><span data-stu-id="7e0de-110">A handle to the server credentials.</span></span> <span data-ttu-id="7e0de-111">Чтобы получить этот обработчик, сервер вызывает функцию [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) с \_ \_ \_ установленным флагом SECPKG CRED Inbound или SECPKG CRED \_ .</span><span class="sxs-lookup"><span data-stu-id="7e0de-111">To retrieve this handle, the server calls the [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set.</span></span>

<span data-ttu-id="7e0de-112">*фконтекст* \[ в необязательное\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-112">*phContext* \[in, optional\]</span></span>

<span data-ttu-id="7e0de-113">Указатель на структуру [кткссандле](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="7e0de-113">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="7e0de-114">При первом вызове метода **AcceptSecurityContext (CredSSP)** этот указатель имеет **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="7e0de-114">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer is **NULL**.</span></span> <span data-ttu-id="7e0de-115">При последующих вызовах *фконтекст* указывает частично сформированный контекст, возвращенный в параметре *фневконтекст* при первом вызове.</span><span class="sxs-lookup"><span data-stu-id="7e0de-115">On subsequent calls, *phContext* specifies the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="7e0de-116">*пинпут* \[ в необязательное\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-116">*pInput* \[in, optional\]</span></span>

<span data-ttu-id="7e0de-117">Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) , созданную при вызове клиента в [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="7e0de-117">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="7e0de-118">Структура содержит дескриптор входного буфера.</span><span class="sxs-lookup"><span data-stu-id="7e0de-118">The structure contains the input buffer descriptor.</span></span>

<span data-ttu-id="7e0de-119">Первый буфер должен иметь тип **\_ Token pvbuffer** и содержать маркер безопасности, полученный от клиента.</span><span class="sxs-lookup"><span data-stu-id="7e0de-119">The first buffer must be of type **SECBUFFER\_TOKEN** and contain the security token received from the client.</span></span> <span data-ttu-id="7e0de-120">Второй буфер должен иметь тип **pvbuffer \_ Empty**.</span><span class="sxs-lookup"><span data-stu-id="7e0de-120">The second buffer should be of type **SECBUFFER\_EMPTY**.</span></span>

<span data-ttu-id="7e0de-121">*фконтекстрек* \[ окне\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-121">*fContextReq* \[in\]</span></span>

<span data-ttu-id="7e0de-122">Битовые флаги, указывающие атрибуты, необходимые серверу для установки контекста.</span><span class="sxs-lookup"><span data-stu-id="7e0de-122">-Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="7e0de-123">Битовые флаги можно комбинировать с помощью операций побитового **или** .</span><span class="sxs-lookup"><span data-stu-id="7e0de-123">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="7e0de-124">Этот параметр может принимать одно или несколько следующих значений.</span><span class="sxs-lookup"><span data-stu-id="7e0de-124">This parameter can be one or more of the following values.</span></span>

| <span data-ttu-id="7e0de-125">Значение</span><span class="sxs-lookup"><span data-stu-id="7e0de-125">Value</span></span>                          | <span data-ttu-id="7e0de-126">Значение</span><span class="sxs-lookup"><span data-stu-id="7e0de-126">Meaning</span></span>                                                                                                                                                                                                        |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7e0de-127">**по УБЫВАНИЮ \_ требований \_ выделить \_ память**</span><span class="sxs-lookup"><span data-stu-id="7e0de-127">**ASC\_REQ\_ALLOCATE\_MEMORY**</span></span> | <span data-ttu-id="7e0de-128">Поставщик поддержки безопасности учетных данных (CredSSP) будет выделять выходные буферы.</span><span class="sxs-lookup"><span data-stu-id="7e0de-128">Credential Security Support Provider (CredSSP) will allocate output buffers.</span></span> <span data-ttu-id="7e0de-129">Завершив использование выходных буферов, освободите их, вызвав функцию [**фриконтекстбуффер**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="7e0de-129">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span> |
| <span data-ttu-id="7e0de-130">**\_Подключение ASC req \_**</span><span class="sxs-lookup"><span data-stu-id="7e0de-130">**ASC\_REQ\_CONNECTION**</span></span>       | <span data-ttu-id="7e0de-131">Контекст безопасности не будет работать с сообщениями форматирования.</span><span class="sxs-lookup"><span data-stu-id="7e0de-131">The security context will not handle formatting messages.</span></span>                                                                                                                                                      |
| <span data-ttu-id="7e0de-132">**\_ДЕЛЕГАТ ASC req \_**</span><span class="sxs-lookup"><span data-stu-id="7e0de-132">**ASC\_REQ\_DELEGATE**</span></span>         | <span data-ttu-id="7e0de-133">Серверу разрешено олицетворять клиента.</span><span class="sxs-lookup"><span data-stu-id="7e0de-133">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="7e0de-134">Игнорировать этот флаг для ограниченного делегирования.</span><span class="sxs-lookup"><span data-stu-id="7e0de-134">Ignore this flag for constrained delegation.</span></span>                                                         |
| <span data-ttu-id="7e0de-135">**\_ \_ Расширенная ошибка по убыванию требований \_**</span><span class="sxs-lookup"><span data-stu-id="7e0de-135">**ASC\_REQ\_EXTENDED\_ERROR**</span></span>  | <span data-ttu-id="7e0de-136">При возникновении ошибок удаленная сторона будет уведомлена.</span><span class="sxs-lookup"><span data-stu-id="7e0de-136">When errors occur, the remote party will be notified.</span></span>                                                                                                                                                          |
| <span data-ttu-id="7e0de-137">**Обнаружение повторного \_ воспроизведения требований ASC \_ \_**</span><span class="sxs-lookup"><span data-stu-id="7e0de-137">**ASC\_REQ\_REPLAY\_DETECT**</span></span>   | <span data-ttu-id="7e0de-138">Обнаружение воспроизводимых пакетов.</span><span class="sxs-lookup"><span data-stu-id="7e0de-138">Detect replayed packets.</span></span>                                                                                                                                                                                       |
| <span data-ttu-id="7e0de-139">**\_ \_ Обнаружение последовательности "ASC req" \_**</span><span class="sxs-lookup"><span data-stu-id="7e0de-139">**ASC\_REQ\_SEQUENCE\_DETECT**</span></span> | <span data-ttu-id="7e0de-140">Обнаружение сообщений, полученных за пределами последовательности.</span><span class="sxs-lookup"><span data-stu-id="7e0de-140">Detect messages received out of sequence.</span></span>                                                                                                                                                                      |
| <span data-ttu-id="7e0de-141">**\_поток требований \_ ASC**</span><span class="sxs-lookup"><span data-stu-id="7e0de-141">**ASC\_REQ\_STREAM**</span></span>           | <span data-ttu-id="7e0de-142">Поддерживать соединение с потоковой ориентацией.</span><span class="sxs-lookup"><span data-stu-id="7e0de-142">Support a stream-oriented connection.</span></span>                                                                                                                                                                          |

<span data-ttu-id="7e0de-143">Возможные флаги атрибутов и их значения см. в разделе [требования к контексту](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="7e0de-143">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="7e0de-144">Флаги, используемые для этого параметра, имеют префикс ASC \_ req, например, ASC \_ req \_ Delegate.</span><span class="sxs-lookup"><span data-stu-id="7e0de-144">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="7e0de-145">Запрошенные атрибуты могут не поддерживаться клиентом.</span><span class="sxs-lookup"><span data-stu-id="7e0de-145">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="7e0de-146">Дополнительные сведения см. в описании параметра *пфконтекстаттр* .</span><span class="sxs-lookup"><span data-stu-id="7e0de-146">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="7e0de-147">*Таржетдатареп* \[ окне\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-147">*TargetDataRep* \[in\]</span></span>

<span data-ttu-id="7e0de-148">Представление данных, например порядок байтов, на целевом объекте.</span><span class="sxs-lookup"><span data-stu-id="7e0de-148">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="7e0de-149">Этот параметр может быть либо **\_ собственными \_ Дреп** , либо **безопасностью \_ сети \_ дреп**.</span><span class="sxs-lookup"><span data-stu-id="7e0de-149">This parameter can be either **SECURITY\_NATIVE\_DREP** or **SECURITY\_NETWORK\_DREP**.</span></span>

<span data-ttu-id="7e0de-150">*фневконтекст* \[ в, out, необязательно\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-150">*phNewContext* \[in, out, optional\]</span></span>

<span data-ttu-id="7e0de-151">Указатель на структуру [кткссандле](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="7e0de-151">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="7e0de-152">При первом вызове метода **AcceptSecurityContext (CredSSP)** этот указатель получает новый обработчик контекста.</span><span class="sxs-lookup"><span data-stu-id="7e0de-152">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="7e0de-153">При последующих вызовах *фневконтекст* может совпадать с маркером, указанным в параметре *фконтекст* .</span><span class="sxs-lookup"><span data-stu-id="7e0de-153">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="7e0de-154">*паутпут* \[ в, out, необязательно\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-154">*pOutput* \[in, out, optional\]</span></span>

<span data-ttu-id="7e0de-155">Указатель на структуру [**секбуффердеск**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) , содержащую дескриптор выходного буфера.</span><span class="sxs-lookup"><span data-stu-id="7e0de-155">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="7e0de-156">Этот буфер отправляется клиенту для ввода в дополнительные вызовы [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="7e0de-156">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="7e0de-157">Выходной буфер может быть создан, даже если функция возвращает значение в СЕКУНДах \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="7e0de-157">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="7e0de-158">Любой созданный буфер должен быть отправлен обратно клиентскому приложению.</span><span class="sxs-lookup"><span data-stu-id="7e0de-158">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="7e0de-159">На выходе этот буфер получает маркер для контекста безопасности.</span><span class="sxs-lookup"><span data-stu-id="7e0de-159">On output, this buffer receives a token for the security context.</span></span> <span data-ttu-id="7e0de-160">Маркер должен быть отправлен клиенту.</span><span class="sxs-lookup"><span data-stu-id="7e0de-160">The token must be sent to the client.</span></span> <span data-ttu-id="7e0de-161">Функция также может возвращать буфер типа PVBUFFER " \_ дополнительный".</span><span class="sxs-lookup"><span data-stu-id="7e0de-161">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span>

<span data-ttu-id="7e0de-162">*пфконтекстаттр* \[ заполняет\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-162">*pfContextAttr* \[out\]</span></span>

<span data-ttu-id="7e0de-163">Указатель на набор битовых флагов, указывающих атрибуты установленного контекста.</span><span class="sxs-lookup"><span data-stu-id="7e0de-163">A pointer to a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="7e0de-164">Описание различных атрибутов см. в разделе [требования к контексту](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="7e0de-164">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="7e0de-165">Флаги, используемые для этого параметра, имеют префикс ASC \_ RET, например, ASC \_ RET \_ Delegate.</span><span class="sxs-lookup"><span data-stu-id="7e0de-165">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="7e0de-166">Не проверяйте атрибуты, связанные с безопасностью, до тех пор, пока завершающий вызов функции не вернется успешно.</span><span class="sxs-lookup"><span data-stu-id="7e0de-166">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="7e0de-167">Флаги атрибутов, не связанные с безопасностью, такие как \_ \_ флаг ASC \_ , выделенная память, можно проверить перед окончательным возвратом.</span><span class="sxs-lookup"><span data-stu-id="7e0de-167">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

<span data-ttu-id="7e0de-168">*птсекспири* \[ out, необязательно\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-168">*ptsExpiry* \[out, optional\]</span></span>

<span data-ttu-id="7e0de-169">Указатель на структуру [**метки времени**](timestamp.md) , которая получает время окончания срока действия контекста.</span><span class="sxs-lookup"><span data-stu-id="7e0de-169">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="7e0de-170">Рекомендуется, чтобы пакет безопасности всегда возвращал это значение в местное время.</span><span class="sxs-lookup"><span data-stu-id="7e0de-170">We recommend that the security package always return this value in local time.</span></span>

> [!Note]  
> <span data-ttu-id="7e0de-171">До последнего вызова процесса проверки подлинности время истечения срока действия контекста может быть неправильным, поскольку на последующих этапах согласования будут предоставлены дополнительные сведения.</span><span class="sxs-lookup"><span data-stu-id="7e0de-171">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="7e0de-172">Таким образом, *птстиместамп* должен иметь **значение NULL** до последнего вызова функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-172">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

## <a name="return-value"></a><span data-ttu-id="7e0de-173">Возвращаемое значение</span><span class="sxs-lookup"><span data-stu-id="7e0de-173">Return value</span></span>

<span data-ttu-id="7e0de-174">Эта функция возвращает одно из следующих значений.</span><span class="sxs-lookup"><span data-stu-id="7e0de-174">This function returns one of the following values.</span></span>

| <span data-ttu-id="7e0de-175">Возвращаемый код и значение</span><span class="sxs-lookup"><span data-stu-id="7e0de-175">Return code/value</span></span>                                   | <span data-ttu-id="7e0de-176">Описание</span><span class="sxs-lookup"><span data-stu-id="7e0de-176">Description</span></span>                                                                                                                                                                 |
|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7e0de-177">SEC_E_INCOMPLETE_MESSAGE</span><span class="sxs-lookup"><span data-stu-id="7e0de-177">SEC_E_INCOMPLETE_MESSAGE</span></span> <br/> <span data-ttu-id="7e0de-178">0x80090318L</span><span class="sxs-lookup"><span data-stu-id="7e0de-178">0x80090318L</span></span>          | <span data-ttu-id="7e0de-179">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="7e0de-179">The function succeeded.</span></span> <span data-ttu-id="7e0de-180">Данные во входном буфере неполны.</span><span class="sxs-lookup"><span data-stu-id="7e0de-180">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="7e0de-181">Приложение должно считывать дополнительные данные из клиента и повторно вызывать [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="7e0de-181">The application must read additional data from the client and call [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) again.</span></span> |
| <span data-ttu-id="7e0de-182">SEC_E_INSUFFICIENT_MEMORY</span><span class="sxs-lookup"><span data-stu-id="7e0de-182">SEC_E_INSUFFICIENT_MEMORY</span></span> <br/> <span data-ttu-id="7e0de-183">0x80090300L</span><span class="sxs-lookup"><span data-stu-id="7e0de-183">0x80090300L</span></span>         | <span data-ttu-id="7e0de-184">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-184">The function failed.</span></span> <span data-ttu-id="7e0de-185">Недостаточно доступной памяти для завершения запрошенного действия.</span><span class="sxs-lookup"><span data-stu-id="7e0de-185">There is not enough memory available to complete the requested action.</span></span>                                                                                 |
| <span data-ttu-id="7e0de-186">SEC_E_INTERNAL_ERROR</span><span class="sxs-lookup"><span data-stu-id="7e0de-186">SEC_E_INTERNAL_ERROR</span></span> <br/> <span data-ttu-id="7e0de-187">0x80090304L</span><span class="sxs-lookup"><span data-stu-id="7e0de-187">0x80090304L</span></span>              | <span data-ttu-id="7e0de-188">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-188">The function failed.</span></span> <span data-ttu-id="7e0de-189">Произошла ошибка, которая не сопоставлена с кодом ошибки SSPI.</span><span class="sxs-lookup"><span data-stu-id="7e0de-189">An error occurred that did not map to an SSPI error code.</span></span>                                                                                              |
| <span data-ttu-id="7e0de-190">SEC_E_INVALID_HANDLE</span><span class="sxs-lookup"><span data-stu-id="7e0de-190">SEC_E_INVALID_HANDLE</span></span> <br/> <span data-ttu-id="7e0de-191">0x80100003L</span><span class="sxs-lookup"><span data-stu-id="7e0de-191">0x80100003L</span></span>              | <span data-ttu-id="7e0de-192">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-192">The function failed.</span></span> <span data-ttu-id="7e0de-193">В функцию передан недопустимый маркер.</span><span class="sxs-lookup"><span data-stu-id="7e0de-193">The handle passed to the function is not valid.</span></span>                                                                                                        |
| <span data-ttu-id="7e0de-194">SEC_E_INVALID_TOKEN</span><span class="sxs-lookup"><span data-stu-id="7e0de-194">SEC_E_INVALID_TOKEN</span></span> <br/> <span data-ttu-id="7e0de-195">0x80090308L</span><span class="sxs-lookup"><span data-stu-id="7e0de-195">0x80090308L</span></span>               | <span data-ttu-id="7e0de-196">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-196">The function failed.</span></span> <span data-ttu-id="7e0de-197">В функцию передан недопустимый токен.</span><span class="sxs-lookup"><span data-stu-id="7e0de-197">The token passed to the function is not valid.</span></span>                                                                                                         |
| <span data-ttu-id="7e0de-198">SEC_E_LOGON_DENIED</span><span class="sxs-lookup"><span data-stu-id="7e0de-198">SEC_E_LOGON_DENIED</span></span> <br/> <span data-ttu-id="7e0de-199">0x8009030CL</span><span class="sxs-lookup"><span data-stu-id="7e0de-199">0x8009030CL</span></span>                | <span data-ttu-id="7e0de-200">Ошибка входа в систему.</span><span class="sxs-lookup"><span data-stu-id="7e0de-200">The logon failed.</span></span>                                                                                                                                                           |
| <span data-ttu-id="7e0de-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span><span class="sxs-lookup"><span data-stu-id="7e0de-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span></span> <br/> <span data-ttu-id="7e0de-202">0x80090311L</span><span class="sxs-lookup"><span data-stu-id="7e0de-202">0x80090311L</span></span> | <span data-ttu-id="7e0de-203">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-203">The function failed.</span></span> <span data-ttu-id="7e0de-204">Не удалось связаться с центром сертификации для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="7e0de-204">No authority could be contacted for authentication.</span></span> <span data-ttu-id="7e0de-205">Это может быть вызвано следующими причинами.</span><span class="sxs-lookup"><span data-stu-id="7e0de-205">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="7e0de-206">Неверное доменное имя субъекта проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="7e0de-206">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="7e0de-207">Домен недоступен.</span><span class="sxs-lookup"><span data-stu-id="7e0de-207">The domain is unavailable.</span></span></li><li><span data-ttu-id="7e0de-208">Не удалось установить отношение доверия.</span><span class="sxs-lookup"><span data-stu-id="7e0de-208">The trust relationship has failed.</span></span> |
| <span data-ttu-id="7e0de-209">SEC_E_NO_CREDENTIALS</span><span class="sxs-lookup"><span data-stu-id="7e0de-209">SEC_E_NO_CREDENTIALS</span></span> <br/><span data-ttu-id="7e0de-210">0x8009030EL</span><span class="sxs-lookup"><span data-stu-id="7e0de-210">0x8009030EL</span></span>               | <span data-ttu-id="7e0de-211">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-211">The function failed.</span></span> <span data-ttu-id="7e0de-212">Недопустимый обработчик учетных данных, указанный в параметре *фкредентиал* .</span><span class="sxs-lookup"><span data-stu-id="7e0de-212">The credentials handle specified in the *phCredential* parameter is not valid.</span></span>                            |
| <span data-ttu-id="7e0de-213">SEC_E_OK</span><span class="sxs-lookup"><span data-stu-id="7e0de-213">SEC_E_OK</span></span> <br/> <span data-ttu-id="7e0de-214">0x00000000</span><span class="sxs-lookup"><span data-stu-id="7e0de-214">0x00000000L</span></span>                          | <span data-ttu-id="7e0de-215">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="7e0de-215">The function succeeded.</span></span> <span data-ttu-id="7e0de-216">Был принят контекст безопасности, полученный от клиента.</span><span class="sxs-lookup"><span data-stu-id="7e0de-216">The security context received from the client was accepted.</span></span> <span data-ttu-id="7e0de-217">Если функция создала выходной токен, маркер должен быть отправлен клиентскому процессу.</span><span class="sxs-lookup"><span data-stu-id="7e0de-217">If the function generated an output token, the token must be sent to the client process.</span></span> |
| <span data-ttu-id="7e0de-218">SEC_E_UNSUPPORTED_FUNCTION</span><span class="sxs-lookup"><span data-stu-id="7e0de-218">SEC_E_UNSUPPORTED_FUNCTION</span></span> <br/> <span data-ttu-id="7e0de-219">0x80090302L</span><span class="sxs-lookup"><span data-stu-id="7e0de-219">0x80090302L</span></span>        | <span data-ttu-id="7e0de-220">Ошибка при выполнении функции.</span><span class="sxs-lookup"><span data-stu-id="7e0de-220">The function failed.</span></span> <span data-ttu-id="7e0de-221">Параметр *фконтекстрек* указал недопустимый флаг атрибута контекста (ASC_REQ_DELEGATE или ASC_REQ_PROMPT_FOR_CREDS).</span><span class="sxs-lookup"><span data-stu-id="7e0de-221">The *fContextReq* parameter specified a context attribute flag (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) that was not valid.</span></span>                       |
| <span data-ttu-id="7e0de-222">SEC_I_COMPLETE_AND_CONTINUE</span><span class="sxs-lookup"><span data-stu-id="7e0de-222">SEC_I_COMPLETE_AND_CONTINUE</span></span> <br/> <span data-ttu-id="7e0de-223">0x00090314L</span><span class="sxs-lookup"><span data-stu-id="7e0de-223">0x00090314L</span></span>       | <span data-ttu-id="7e0de-224">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="7e0de-224">The function succeeded.</span></span> <span data-ttu-id="7e0de-225">Сервер должен вызвать [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) и передать выходной токен клиенту.</span><span class="sxs-lookup"><span data-stu-id="7e0de-225">The server must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="7e0de-226">После этого сервер должен дождаться возврата токена от клиента перед выполнением другого вызова [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="7e0de-226">The server must then wait for a return token from the client before making another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span> |
| <span data-ttu-id="7e0de-227">SEC_I_COMPLETE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="7e0de-227">SEC_I_COMPLETE_NEEDED</span></span> <br/> <span data-ttu-id="7e0de-228">0x00090313L</span><span class="sxs-lookup"><span data-stu-id="7e0de-228">0x00090313L</span></span>             | <span data-ttu-id="7e0de-229">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="7e0de-229">The function succeeded.</span></span> <span data-ttu-id="7e0de-230">Сервер должен завершить создание сообщения от клиента перед вызовом [ **CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span><span class="sxs-lookup"><span data-stu-id="7e0de-230">The server must finish building the message from the client before calling [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span></span>                             |
| <span data-ttu-id="7e0de-231">SEC_I_CONTINUE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="7e0de-231">SEC_I_CONTINUE_NEEDED</span></span> <br/> <span data-ttu-id="7e0de-232">0x00090312L</span><span class="sxs-lookup"><span data-stu-id="7e0de-232">0x00090312L</span></span>             | <span data-ttu-id="7e0de-233">Функция выполнена успешно.</span><span class="sxs-lookup"><span data-stu-id="7e0de-233">The function succeeded.</span></span> <span data-ttu-id="7e0de-234">Сервер должен отправить выходной токен клиенту и дождаться возвращенного маркера.</span><span class="sxs-lookup"><span data-stu-id="7e0de-234">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="7e0de-235">Возвращаемый токен должен передаваться в *пинпут* для другого вызова [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="7e0de-235">The returned token should be passed in *pInput* for another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span>


## <a name="remarks"></a><span data-ttu-id="7e0de-236">Комментарии</span><span class="sxs-lookup"><span data-stu-id="7e0de-236">Remarks</span></span>

<span data-ttu-id="7e0de-237">Функция **AcceptSecurityContext (CredSSP)** — это серверный аналог функции [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="7e0de-237">The **AcceptSecurityContext (CredSSP)** function is the server counterpart to the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function.</span></span>

<span data-ttu-id="7e0de-238">Когда сервер получает запрос от клиента, он использует параметр *фконтекстрек* , чтобы указать, что он требует для сеанса.</span><span class="sxs-lookup"><span data-stu-id="7e0de-238">When the server receives a request from a client, it uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="7e0de-239">Таким образом, сервер может потребовать, чтобы клиенты могли использовать конфиденциальный сеанс или сессию с проверкой [*целостности*](../secgloss/i-gly.md). Он может отклонять клиенты, которые не могут удовлетворить это требование.</span><span class="sxs-lookup"><span data-stu-id="7e0de-239">In this fashion, a server can require that clients be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session; it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="7e0de-240">Кроме того, серверу может потребоваться ничего. любой клиент, который требуется или может предоставить клиенту, возвращается в параметре *пфконтекстаттр* .</span><span class="sxs-lookup"><span data-stu-id="7e0de-240">Alternatively, a server can require nothing; whatever the client requires or can provide is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="7e0de-241">Параметры *фконтекстрек* и *пфконтекстаттр* представляют собой битовую маску, представляющую различные атрибуты контекста.</span><span class="sxs-lookup"><span data-stu-id="7e0de-241">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="7e0de-242">Описание различных атрибутов см. в разделе [требования к контексту](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="7e0de-242">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="7e0de-243">Хотя параметр *пфконтекстаттр* допустим при любом успешном возвращении, следует проанализировать флаги, относящиеся к аспектам безопасности контекста, только в окончательном успешном возвращении.</span><span class="sxs-lookup"><span data-stu-id="7e0de-243">While the *pfContextAttr* parameter is valid on any successful return, you should examine the flags pertaining to security aspects of the context only on the final successful return.</span></span> <span data-ttu-id="7e0de-244">Промежуточные возвраты могут задавать, например, \_ флаг « \_ Выделенная память ISC» \_ .</span><span class="sxs-lookup"><span data-stu-id="7e0de-244">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="7e0de-245">Вызывающий объект отвечает за определение того, достаточно ли атрибутов последнего контекста.</span><span class="sxs-lookup"><span data-stu-id="7e0de-245">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="7e0de-246">Например, если запрос шифрования (шифрование) был запрошен, но его не удалось установить, некоторые приложения могут немедленно завершить подключение.</span><span class="sxs-lookup"><span data-stu-id="7e0de-246">For example, if confidentiality (encryption) was requested but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="7e0de-247">Если невозможно установить контекст безопасности, сервер должен освободить частично созданный контекст, вызвав функцию [**делетесекуритиконтекст**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="7e0de-247">If the security context cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="7e0de-248">Сведения о том, когда следует вызывать функцию **делетесекуритиконтекст** , см. в разделе **делетесекуритиконтекст**.</span><span class="sxs-lookup"><span data-stu-id="7e0de-248">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="7e0de-249">После установки контекста безопасности серверное приложение может использовать функцию [**куерисекуритиконтексттокен**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) для получения маркера учетной записи пользователя, которой сопоставлен сертификат клиента.</span><span class="sxs-lookup"><span data-stu-id="7e0de-249">After the security context has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="7e0de-250">Кроме того, сервер может использовать функцию [**имперсонатесекуритиконтекст**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) для олицетворения пользователя.</span><span class="sxs-lookup"><span data-stu-id="7e0de-250">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="7e0de-251">Требования</span><span class="sxs-lookup"><span data-stu-id="7e0de-251">Requirements</span></span>

| <span data-ttu-id="7e0de-252">Требование</span><span class="sxs-lookup"><span data-stu-id="7e0de-252">Requirement</span></span> | <span data-ttu-id="7e0de-253">Значение</span><span class="sxs-lookup"><span data-stu-id="7e0de-253">Value</span></span> |
|--------------------------|-------------------------------------------|
| <span data-ttu-id="7e0de-254">Минимальная версия клиента</span><span class="sxs-lookup"><span data-stu-id="7e0de-254">Minimum supported client</span></span> | <span data-ttu-id="7e0de-255">Только для \[ классических приложений Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-255">Windows�Vista \[desktop apps only\]</span></span>       |
| <span data-ttu-id="7e0de-256">Минимальная версия сервера</span><span class="sxs-lookup"><span data-stu-id="7e0de-256">Minimum supported server</span></span> | <span data-ttu-id="7e0de-257">\[Только для настольных приложений Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="7e0de-257">Windows Server�2008 \[desktop apps only\]</span></span> |
| <span data-ttu-id="7e0de-258">Header</span><span class="sxs-lookup"><span data-stu-id="7e0de-258">Header</span></span>                   | <span data-ttu-id="7e0de-259">SSPI. h (включая Security. h)</span><span class="sxs-lookup"><span data-stu-id="7e0de-259">Sspi.h (include Security.h)</span></span>               |
| <span data-ttu-id="7e0de-260">Библиотека</span><span class="sxs-lookup"><span data-stu-id="7e0de-260">Library</span></span>                  | <span data-ttu-id="7e0de-261">Secur32. lib</span><span class="sxs-lookup"><span data-stu-id="7e0de-261">Secur32.lib</span></span>                               |
| <span data-ttu-id="7e0de-262">DLL</span><span class="sxs-lookup"><span data-stu-id="7e0de-262">DLL</span></span>                      | <span data-ttu-id="7e0de-263">Secur32.dll</span><span class="sxs-lookup"><span data-stu-id="7e0de-263">Secur32.dll</span></span>                               |

## <a name="see-also"></a><span data-ttu-id="7e0de-264">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="7e0de-264">See also</span></span>

- [<span data-ttu-id="7e0de-265">Функции SSPI</span><span class="sxs-lookup"><span data-stu-id="7e0de-265">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="7e0de-266">**делетесекуритиконтекст**</span><span class="sxs-lookup"><span data-stu-id="7e0de-266">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
- [<span data-ttu-id="7e0de-267">**InitializeSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="7e0de-267">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)
