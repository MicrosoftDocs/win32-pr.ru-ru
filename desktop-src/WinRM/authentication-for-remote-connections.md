---
title: Проверка подлинности для удаленных подключений
description: Служба удаленного управления Windows обеспечивает безопасность связи между компьютерами за счет поддержки нескольких стандартных методов проверки подлинности и шифрования сообщений.
ms.assetid: 97a13b07-ae7a-4d2f-8841-77a22c91b204
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
topic_type:
- kbArticle
api_name: ''
api_type: ''
api_location: ''
ms.openlocfilehash: 0e9aa125f2ccf5d8c224eee645a6dba1ec2fd96e
ms.sourcegitcommit: 25c6d442ab55cbf0e065398a006b1d409349fffd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/27/2020
ms.locfileid: "104069707"
---
# <a name="authentication-for-remote-connections"></a><span data-ttu-id="ccbd9-103">Проверка подлинности для удаленных подключений</span><span class="sxs-lookup"><span data-stu-id="ccbd9-103">Authentication for Remote Connections</span></span>

<span data-ttu-id="ccbd9-104">Служба удаленного управления Windows обеспечивает безопасность связи между компьютерами за счет поддержки нескольких стандартных методов проверки подлинности и шифрования сообщений.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-104">Windows Remote Management maintains security for communication between computers by supporting several standard methods of authentication and message encryption.</span></span>

## <a name="default-group-access"></a><span data-ttu-id="ccbd9-105">Доступ к группе по умолчанию</span><span class="sxs-lookup"><span data-stu-id="ccbd9-105">Default Group Access</span></span>

<span data-ttu-id="ccbd9-106">Во время установки WinRM создает локальную группу **винрмремотевмиусерс \_ \_**.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-106">During setup, WinRM creates the local group **WinRMRemoteWMIUsers\_\_**.</span></span> <span data-ttu-id="ccbd9-107">Затем служба WinRM запрещает удаленный доступ любому пользователю, который не является членом локальной группы администрирования или группы **винрмремотевмиусерс \_ \_** .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-107">WinRM then restricts remote access to any user that is not a member of either the local administration group or the **WinRMRemoteWMIUsers\_\_** group.</span></span> <span data-ttu-id="ccbd9-108">Вы можете добавить локального пользователя, пользователя домена или группы домена в **винрмремотевмиусерс \_ \_** , введя **net localgroup винрмремотевмиусерс \_ \_ /Add <domain> \\ <username>** в командной строке.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-108">You can add a local user, domain user, or domain group to **WinRMRemoteWMIUsers\_\_** by typing **net localgroup WinRMRemoteWMIUsers\_\_ /add <domain>\\<username>** at the command prompt.</span></span> <span data-ttu-id="ccbd9-109">При необходимости можно использовать групповая политика, чтобы добавить пользователя в группу.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-109">Optionally, you can use the Group Policy to add a user to the group.</span></span>

## <a name="default-authentication-settings"></a><span data-ttu-id="ccbd9-110">Параметры проверки подлинности по умолчанию</span><span class="sxs-lookup"><span data-stu-id="ccbd9-110">Default Authentication Settings</span></span>

<span data-ttu-id="ccbd9-111">Учетные данные, имя пользователя и пароль по умолчанию являются учетными данными для учетной записи пользователя, выполнившего вход в систему, которая выполняет скрипт.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-111">The default credentials, user name, and password, are the credentials for the logged-on user account that runs the script.</span></span>

<span data-ttu-id="ccbd9-112">**Переход к другой учетной записи на удаленном компьютере**</span><span class="sxs-lookup"><span data-stu-id="ccbd9-112">**To change to another account on a remote computer**</span></span>

1.  <span data-ttu-id="ccbd9-113">Укажите учетные данные в объекте [**ConnectionOptions**](connectionoptions.md) или [**ивсманконнектионоптионс**](/windows/desktop/api/WSManDisp/nn-wsmandisp-iwsmanconnectionoptions) и укажите их в вызове [**CreateSession**](wsman-createsession.md) .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-113">Specify the credentials in a [**ConnectionOptions**](connectionoptions.md) or [**IWSManConnectionOptions**](/windows/desktop/api/WSManDisp/nn-wsmandisp-iwsmanconnectionoptions) object and supply that to the [**CreateSession**](wsman-createsession.md) call.</span></span>
2.  <span data-ttu-id="ccbd9-114">Задайте **всманфлагкредусернамепассворд** в параметре *flags* в вызове [**CreateSession**](wsman-createsession.md) .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-114">Set the **WSManFlagCredUserNamePassword** in the *flags* parameter in the [**CreateSession**](wsman-createsession.md) call.</span></span>

<span data-ttu-id="ccbd9-115">Следующий список содержит список действий, выполняемых при запуске скрипта или приложения с учетными данными по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-115">The following list contains a list of what occurs when a script or application runs under the default credentials:</span></span>

-   <span data-ttu-id="ccbd9-116">[*Kerberos*](windows-remote-management-glossary.md) является методом проверки подлинности по умолчанию, если клиент находится в домене, а удаленная строка назначения не является одним из следующих: localhost, 127.0.0.1 или \[ :: 1 \] .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-116">[*Kerberos*](windows-remote-management-glossary.md) is the default method of authentication when the client is in a domain and the remote destination string is not one of the following: localhost, 127.0.0.1, or \[::1\].</span></span>
-   <span data-ttu-id="ccbd9-117">[*Negotiate*](windows-remote-management-glossary.md) является методом по умолчанию, если клиент находится не в домене, но удаленная строка назначения имеет одно из следующих значений: localhost, 127.0.0.1 или \[ :: 1 \] .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-117">[*Negotiate*](windows-remote-management-glossary.md) is the default method when the client is not in a domain, but the remote destination string is one of the following: localhost, 127.0.0.1, or \[::1\].</span></span>

<span data-ttu-id="ccbd9-118">Если указать явные учетные данные для объекта [**ConnectionOptions**](connectionoptions.md) , то метод Negotiate является методом по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-118">If you supply explicit credentials with a [**ConnectionOptions**](connectionoptions.md) object, Negotiate is the default method.</span></span> <span data-ttu-id="ccbd9-119">Проверка подлинности согласования определяет, является ли текущий метод проверки подлинности Kerberos или NTLM в зависимости от того, находятся ли компьютеры в домене или рабочей группе.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-119">Negotiate authentication determines whether the ongoing authentication method is Kerberos or NTLM, depending on whether the computers are in a domain or workgroup.</span></span> <span data-ttu-id="ccbd9-120">При подключении к удаленному целевому компьютеру с помощью локальной учетной записи учетной записи следует присвоить префикс имени компьютера.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-120">If connecting to a remote target computer using a local account, then the account should be prefixed with the computer name.</span></span> <span data-ttu-id="ccbd9-121">Например, myComputer \\ myUsername.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-121">For example, myComputer\\myUsername.</span></span>

<span data-ttu-id="ccbd9-122">При указании метода Negotiate, дайджеста или обычной проверки подлинности и невозможности предоставить объект [**ConnectionOptions**](connectionoptions.md) , вы получите сообщение об ошибке, показывающее, что требуются явные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-122">If you specify Negotiate, Digest, or Basic authentication and fail to supply a [**ConnectionOptions**](connectionoptions.md) object, then you will receive an error indicating that explicit credentials are required.</span></span> <span data-ttu-id="ccbd9-123">Если протокол HTTPS не является транспортом, Целевой Удаленный компьютер должен быть настроен в списке доверенных узлов.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-123">If HTTPS is not the transport, then the target remote computer must be configured in the list of trusted host computers.</span></span>

<span data-ttu-id="ccbd9-124">Дополнительные сведения о типах проверки подлинности, включенных в параметрах конфигурации по умолчанию, см. в разделе [Установка и настройка для служба удаленного управления Windows](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="ccbd9-124">For more information about the authentication types that are enabled in the default configuration settings, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

## <a name="basic-authentication"></a><span data-ttu-id="ccbd9-125">Обычная проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="ccbd9-125">Basic Authentication</span></span>

<span data-ttu-id="ccbd9-126">Чтобы явно установить [*обычную*](windows-remote-management-glossary.md) проверку подлинности в вызове [**WSMan. CreateSession**](wsman-createsession.md), установите флаги **всманфлагусебасик** и **всманфлагкредусернамепассворд** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-126">To explicitly establish [*Basic*](windows-remote-management-glossary.md) authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseBasic** and **WSManFlagCredUserNamePassword** flags in the *flags* parameter.</span></span> <span data-ttu-id="ccbd9-127">Обычная проверка подлинности отключена в параметрах конфигурации по умолчанию для клиента WinRM и сервера WinRM.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-127">Basic authentication is disabled in the default configuration settings for both the WinRM client and the WinRM server.</span></span>

## <a name="digest-authentication"></a><span data-ttu-id="ccbd9-128">Дайджест-проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="ccbd9-128">Digest Authentication</span></span>

<span data-ttu-id="ccbd9-129">Чтобы явно установить [*дайджест*](windows-remote-management-glossary.md) -проверку подлинности в вызове [**WSMan. CreateSession**](wsman-createsession.md), установите флаг **всманфлагуседижест** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-129">To explicitly establish [*Digest*](windows-remote-management-glossary.md) authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseDigest** flag in the *flags* parameter.</span></span> <span data-ttu-id="ccbd9-130">Дайджест не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-130">Digest is not supported.</span></span> <span data-ttu-id="ccbd9-131">Его нельзя настроить для компонента сервера WinRM.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-131">It cannot be configured, for the WinRM server component.</span></span>

## <a name="negotiate-authentication"></a><span data-ttu-id="ccbd9-132">Согласование проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="ccbd9-132">Negotiate Authentication</span></span>

<span data-ttu-id="ccbd9-133">Чтобы явно установить проверку подлинности [*согласования*](windows-remote-management-glossary.md) , также известную как встроенная проверка подлинности Windows, в вызове [**WSMan. CreateSession**](wsman-createsession.md)установите флаг **всманфлагусенеготиате** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-133">To explicitly establish [*Negotiate*](windows-remote-management-glossary.md) authentication, also known as Windows Integrated Authentication, in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseNegotiate** flag in the *flags* parameter.</span></span>

<span data-ttu-id="ccbd9-134">[Управление учетными записями пользователей (UAC)](https://support.microsoft.com/help/922708/how-to-use-user-account-control-uac-in-windows-vista) влияет на доступ к службе WinRM.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-134">[User Account Control (UAC)](https://support.microsoft.com/help/922708/how-to-use-user-account-control-uac-in-windows-vista) affects access to the WinRM service.</span></span> <span data-ttu-id="ccbd9-135">Если в Рабочей группе используется проверка подлинности Negotiate, доступ к службе может получить только встроенная учетная запись администратора.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-135">When Negotiate authentication is used in a workgroup, only the built-in Administrator account can access the service.</span></span> <span data-ttu-id="ccbd9-136">Чтобы разрешить всем учетным записям в группе "Администраторы" доступ к службе, задайте следующее значение реестра:</span><span class="sxs-lookup"><span data-stu-id="ccbd9-136">To allow all accounts in the Administrators group to access the service, set the following registry value:</span></span>

<span data-ttu-id="ccbd9-137">**HKey \_ \_** \\ **Программное обеспечение** локального компьютера \\ политики **Microsoft** \\ **Windows** \\ **CurrentVersion** \\ **Политика** для \\ **системного** параметра \\ = 1</span><span class="sxs-lookup"><span data-stu-id="ccbd9-137">**HKEY\_LOCAL\_MACHINE**\\**SOFTWARE**\\**Microsoft**\\**Windows**\\**CurrentVersion**\\**Policies**\\**System**\\**LocalAccountTokenFilterPolicy** = 1</span></span>

## <a name="kerberos-authentication"></a><span data-ttu-id="ccbd9-138">Проверка подлинности Kerberos</span><span class="sxs-lookup"><span data-stu-id="ccbd9-138">Kerberos Authentication</span></span>

<span data-ttu-id="ccbd9-139">Чтобы явно установить проверку подлинности [*Kerberos*](windows-remote-management-glossary.md) в вызове [**WSMan. CreateSession**](wsman-createsession.md), установите флаг **всманфлагусекерберос** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-139">To explicitly establish [*Kerberos*](windows-remote-management-glossary.md) authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseKerberos** flag in the *flags* parameter.</span></span> <span data-ttu-id="ccbd9-140">Как клиент, так и серверные компьютеры должны быть присоединены к домену.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-140">Both the client and the server computers must be joined to a domain.</span></span> <span data-ttu-id="ccbd9-141">При использовании Kerberos в качестве метода проверки подлинности нельзя использовать IP-адрес в вызове [**WSMan. CreateSession**](wsman-createsession.md) или [**Ивсман:: CreateSession**](/windows/desktop/api/WSManDisp/nf-wsmandisp-iwsman-createsession).</span><span class="sxs-lookup"><span data-stu-id="ccbd9-141">If you use Kerberos as the authentication method, you cannot use an IP address in the call to [**WSMan.CreateSession**](wsman-createsession.md) or [**IWSMan::CreateSession**](/windows/desktop/api/WSManDisp/nf-wsmandisp-iwsman-createsession).</span></span>

## <a name="client-certificate-based-authentication"></a><span data-ttu-id="ccbd9-142">Проверка подлинности на основе сертификата клиента</span><span class="sxs-lookup"><span data-stu-id="ccbd9-142">Client Certificate-based Authentication</span></span>

<span data-ttu-id="ccbd9-143">Чтобы установить проверку подлинности на основе сертификата клиента в вызове [**WSMan. CreateSession**](wsman-createsession.md), установите флаг **всманфлагусеклиентцертификате** в параметре *flags* .</span><span class="sxs-lookup"><span data-stu-id="ccbd9-143">To establish client certificate-based authentication in the call to [**WSMan.CreateSession**](wsman-createsession.md), set the **WSManFlagUseClientCertificate** flag in the *flags* parameter.</span></span>

<span data-ttu-id="ccbd9-144">Сначала необходимо включить проверку подлинности на основе сертификата как для клиента, так и для службы с помощью программы командной строки WinRM.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-144">You must first enable certificate authentication on both the client and service by using the Winrm command line tool.</span></span> <span data-ttu-id="ccbd9-145">Дополнительные сведения см. в разделе [Включение параметров проверки подлинности](#enabling-or-disabling-authentication-options).</span><span class="sxs-lookup"><span data-stu-id="ccbd9-145">For more information, see [Enabling Authentication Options](#enabling-or-disabling-authentication-options).</span></span> <span data-ttu-id="ccbd9-146">Кроме того, необходимо создать запись в таблице CertMapping на компьютере сервера WinRM.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-146">You must also create an entry in the CertMapping table on the WinRM server computer.</span></span> <span data-ttu-id="ccbd9-147">Это устанавливает сопоставление между одним или несколькими сертификатами и локальной учетной записью.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-147">This establishes a mapping between one or more certificates and a local account.</span></span> <span data-ttu-id="ccbd9-148">После того как сертификат будет использован для проверки подлинности и авторизации, для операций, выполняемых службой WinRM, используется соответствующая локальная учетная запись.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-148">After the certificate has been used for authentication and authorization, the corresponding local account is used for operations performed by the WinRM service.</span></span>

<span data-ttu-id="ccbd9-149">Сопоставление можно создать для определенного URI ресурса.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-149">The mapping can be created for a specific resource URI.</span></span> <span data-ttu-id="ccbd9-150">Чтобы получить дополнительные сведения, включая создание записи таблицы CertMapping, введите **WinRM Help CertMapping** в командной строке.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-150">To learn more, including how to create a CertMapping table entry, type **winrm help certmapping** at the command prompt.</span></span>

> [!Note]  
> <span data-ttu-id="ccbd9-151">Максимальный размер сертификата, используемого WinRM в этом контексте, — 16 КБ.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-151">The maximum size certificate usable by WinRM in this context is 16KB.</span></span>

 

## <a name="enabling-or-disabling-authentication-options"></a><span data-ttu-id="ccbd9-152">Включение или отключение параметров проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="ccbd9-152">Enabling or Disabling Authentication Options</span></span>

<span data-ttu-id="ccbd9-153">Параметр проверки подлинности по умолчанию при установке системы — Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-153">The default authentication option at system installation is Kerberos.</span></span> <span data-ttu-id="ccbd9-154">Дополнительные сведения см. в разделе [Установка и настройка для служба удаленного управления Windows](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="ccbd9-154">For more information, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

<span data-ttu-id="ccbd9-155">Если для сценария или приложения требуется конкретный метод проверки подлинности, который не включен, необходимо изменить конфигурацию, чтобы включить такой тип проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-155">If your script or application requires a specific authentication method that is not enabled, you must change the configuration to enable this type of authentication.</span></span> <span data-ttu-id="ccbd9-156">Это изменение можно выполнить с помощью средства командной строки **WinRM** или групповая политика для **объекта Служба удаленного управления Windows групповая политика**.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-156">This change can be made using the **Winrm** command-line tool or through Group Policy for the **Windows Remote Management Group Policy Object**.</span></span> <span data-ttu-id="ccbd9-157">Вы также можете отключить определенные методы проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-157">You may also choose to disable certain methods of authentication.</span></span>

<span data-ttu-id="ccbd9-158">**Включение или отключение проверки подлинности с помощью средства WinRM**</span><span class="sxs-lookup"><span data-stu-id="ccbd9-158">**To enable or disable authentication with the Winrm tool**</span></span>

1.  <span data-ttu-id="ccbd9-159">Чтобы задать конфигурацию для клиента WinRM, используйте команду **WinRM Set** и укажите клиент.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-159">To set the configuration for the WinRM client, use the **Winrm Set** command and specify the client.</span></span> <span data-ttu-id="ccbd9-160">Например, следующая команда отключает дайджест-проверку подлинности для клиента.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-160">For example, the following command disables digest authentication for the client.</span></span>

    <span data-ttu-id="ccbd9-161">**WinRM set winrm/config/Client/auth @ {Digest = "false"}**</span><span class="sxs-lookup"><span data-stu-id="ccbd9-161">**winrm set winrm/config/client/auth @{Digest="false"}**</span></span>

2.  <span data-ttu-id="ccbd9-162">Чтобы задать конфигурацию для сервера WinRM, используйте команду **WinRM Set** и укажите службу.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-162">To set the configuration for the WinRM server, use the **Winrm Set** command and specify the service.</span></span> <span data-ttu-id="ccbd9-163">Например, следующая команда включает проверку подлинности Kerberos для службы.</span><span class="sxs-lookup"><span data-stu-id="ccbd9-163">For example, the following command enables Kerberos authentication for the service.</span></span>

    <span data-ttu-id="ccbd9-164">**WinRM set winrm/config/Service/auth @ {Kerberos = "true"}**</span><span class="sxs-lookup"><span data-stu-id="ccbd9-164">**winrm set winrm/config/service/auth @{Kerberos="true"}**</span></span>

## <a name="related-topics"></a><span data-ttu-id="ccbd9-165">См. также</span><span class="sxs-lookup"><span data-stu-id="ccbd9-165">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ccbd9-166">О служба удаленного управления Windows</span><span class="sxs-lookup"><span data-stu-id="ccbd9-166">About Windows Remote Management</span></span>](about-windows-remote-management.md)
</dt> <dt>

[<span data-ttu-id="ccbd9-167">**WSMan. CreateSession**</span><span class="sxs-lookup"><span data-stu-id="ccbd9-167">**WSMan.CreateSession**</span></span>](wsman-createsession.md)
</dt> <dt>

[<span data-ttu-id="ccbd9-168">Использование служба удаленного управления Windows</span><span class="sxs-lookup"><span data-stu-id="ccbd9-168">Using Windows Remote Management</span></span>](using-windows-remote-management.md)
</dt> </dl>

 

 




