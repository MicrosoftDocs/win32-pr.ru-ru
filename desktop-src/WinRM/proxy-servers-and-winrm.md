---
title: Прокси-серверы и WinRM
description: Служба удаленного управления Windows (WinRM) использует протоколы HTTP и HTTPS для отправки сообщений между клиентскими и серверными компьютерами. Как правило, клиент WinRM отправляет сообщения непосредственно на сервер WinRM. Клиенты WinRM также можно настроить для использования прокси-сервера.
ms.assetid: f8137b3a-7704-4b21-a923-6e2692e18d90
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e07bbfebb4c8f0eb9e77a8942d54677b55c60006
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103791700"
---
# <a name="proxy-servers-and-winrm"></a><span data-ttu-id="1fa31-105">Прокси-серверы и WinRM</span><span class="sxs-lookup"><span data-stu-id="1fa31-105">Proxy Servers and WinRM</span></span>

<span data-ttu-id="1fa31-106">Служба удаленного управления Windows (WinRM) использует протоколы HTTP и HTTPS для отправки сообщений между клиентскими и серверными компьютерами.</span><span class="sxs-lookup"><span data-stu-id="1fa31-106">Windows Remote Management (WinRM) uses HTTP and HTTPS to send messages between the client and server computers.</span></span> <span data-ttu-id="1fa31-107">Как правило, клиент WinRM отправляет сообщения непосредственно на сервер WinRM.</span><span class="sxs-lookup"><span data-stu-id="1fa31-107">In general, the WinRM client sends messages directly to the WinRM server.</span></span> <span data-ttu-id="1fa31-108">Клиенты WinRM также можно настроить для использования прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="1fa31-108">WinRM clients can be also configured to use a proxy server.</span></span>

<span data-ttu-id="1fa31-109">Дополнительные сведения см. в следующих разделах.</span><span class="sxs-lookup"><span data-stu-id="1fa31-109">For more information, see the following sections:</span></span>

-   [<span data-ttu-id="1fa31-110">Настройка прокси-сервера для WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="1fa31-110">Configuring a Proxy Server for WinRM 2.0</span></span>](#configuring-a-proxy-server-for-winrm-20)
    -   [<span data-ttu-id="1fa31-111">Прокси-подключения на основе HTTPS</span><span class="sxs-lookup"><span data-stu-id="1fa31-111">HTTPS-Based Proxy Connections</span></span>](#https-based-proxy-connections)
    -   [<span data-ttu-id="1fa31-112">Прокси-подключения на основе HTTP</span><span class="sxs-lookup"><span data-stu-id="1fa31-112">HTTP-Based Proxy Connections</span></span>](#http-based-proxy-connections)
-   [<span data-ttu-id="1fa31-113">Настройка прокси-сервера для WinRM 1,1 и более ранних версий</span><span class="sxs-lookup"><span data-stu-id="1fa31-113">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>](#configuring-a-proxy-server-for-winrm-11-and-earlier)

## <a name="configuring-a-proxy-server-for-winrm-20"></a><span data-ttu-id="1fa31-114">Настройка прокси-сервера для WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="1fa31-114">Configuring a Proxy Server for WinRM 2.0</span></span>

<span data-ttu-id="1fa31-115">WinRM 2,0 поддерживает широкий спектр конфигураций прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="1fa31-115">WinRM 2.0 supports a wide range of proxy configurations.</span></span> <span data-ttu-id="1fa31-116">Например, WinRM поддерживает прокси-серверы для транспортов HTTP и HTTPS, а для прокси-серверов с проверкой подлинности и без проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="1fa31-116">For example, WinRM supports proxies for HTTP and HTTPS transports and for authenticated and unauthenticated proxy servers.</span></span>

### <a name="https-based-proxy-connections"></a><span data-ttu-id="1fa31-117">HTTPS-Based прокси-подключений</span><span class="sxs-lookup"><span data-stu-id="1fa31-117">HTTPS-Based Proxy Connections</span></span>

<span data-ttu-id="1fa31-118">Для повышения безопасности и сходства на основе подключений в качестве транспортного механизма должен использоваться протокол HTTPS.</span><span class="sxs-lookup"><span data-stu-id="1fa31-118">For better security and connection-based affinity, HTTPS should be used as the transport mechanism.</span></span>

<span data-ttu-id="1fa31-119">Если прокси-сервер требует проверки подлинности, клиенты и серверы WinRM должны использовать протокол HTTPS.</span><span class="sxs-lookup"><span data-stu-id="1fa31-119">If the proxy server requires authentication, the WinRM clients and servers must use HTTPS.</span></span>

> [!Note]  
> <span data-ttu-id="1fa31-120">Проверка подлинности на прокси-сервере не зависит от проверки подлинности на целевом сервере.</span><span class="sxs-lookup"><span data-stu-id="1fa31-120">Authentication to the proxy server is independent from the authentication to the destination server.</span></span>

 

### <a name="http-based-proxy-connections"></a><span data-ttu-id="1fa31-121">HTTP-Based прокси-подключений</span><span class="sxs-lookup"><span data-stu-id="1fa31-121">HTTP-Based Proxy Connections</span></span>

<span data-ttu-id="1fa31-122">Если проверка подлинности прокси-сервера не требуется, для транспорта можно использовать протоколы HTTP или HTTPs.</span><span class="sxs-lookup"><span data-stu-id="1fa31-122">If no proxy server authentication is required, either HTTP or HTTPs can be used for transport.</span></span> <span data-ttu-id="1fa31-123">Однако подключения на основе HTTP от клиента WinRM к серверу WinRM через прокси-сервер могут быть проблематичными.</span><span class="sxs-lookup"><span data-stu-id="1fa31-123">However, HTTP-based connections from a WinRM client to a WinRM server through a proxy server can be problematic.</span></span>

<span data-ttu-id="1fa31-124">При использовании подключений на основе HTTP могут возникать следующие проблемы.</span><span class="sxs-lookup"><span data-stu-id="1fa31-124">The following issues might be encountered when using HTTP-based connections:</span></span>

-   <span data-ttu-id="1fa31-125">Прокси-сервер не поддерживает проверку подлинности на основе подключений, что может привести к сбою проверки подлинности на целевом сервере с ошибкой отказа в доступе.</span><span class="sxs-lookup"><span data-stu-id="1fa31-125">The proxy server does not support connection-based authentication, which can cause the authentication against the destination server to fail with an access denied error.</span></span>
-   <span data-ttu-id="1fa31-126">Для подключения к целевому серверу и прокси-серверу требуется более одного набора учетных данных.</span><span class="sxs-lookup"><span data-stu-id="1fa31-126">More than one set of credentials is needed to connect to the destination server and to the proxy server.</span></span>
-   <span data-ttu-id="1fa31-127">Прокси-серверы на основе HTTP могут не поддерживать возможность обслуживания связанных клиентских и серверных подключений.</span><span class="sxs-lookup"><span data-stu-id="1fa31-127">HTTP-based proxy servers might not support the ability to maintain the associated client-based and server-based connections.</span></span> <span data-ttu-id="1fa31-128">Если прокси-сервер не поддерживает строгое связывание клиента с сервером и поддерживает подключение по протоколу TCP/IP, клиенты, не прошедшие проверку подлинности, могут получить доступ к данным.</span><span class="sxs-lookup"><span data-stu-id="1fa31-128">If the proxy does not strongly link a client to a server and maintain the TCP/IP connection, unauthenticated clients might gain access to data.</span></span> <span data-ttu-id="1fa31-129">Кроме того, отсутствие сходства соединений может привести к сбою проверки подлинности на сервере.</span><span class="sxs-lookup"><span data-stu-id="1fa31-129">Also, the lack of connection affinity might cause the authentication to fail against the server.</span></span>

<span data-ttu-id="1fa31-130">Если в качестве транспорта должен использоваться протокол HTTP, прокси-сервер должен поддерживать следующую конфигурацию для получения лучшего ответа WinRM и предотвращения отказа в доступе для клиентов WinRM:</span><span class="sxs-lookup"><span data-stu-id="1fa31-130">If HTTP must be used as the transport, the proxy server should support the following configuration to achieve a better WinRM response and to prevent access denied failures for WinRM clients:</span></span>

-   <span data-ttu-id="1fa31-131">Поддержка HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="1fa31-131">Support for HTTP/1.1.</span></span> <span data-ttu-id="1fa31-132">Протокол HTTP/1.1 является более строгим в сопоставлении сходства соединений между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="1fa31-132">HTTP/1.1 is more stringent in mapping connection affinity between client and server.</span></span>
-   <span data-ttu-id="1fa31-133">Проверка подлинности на основе подключений для согласования, Kerberos и CredSSP.</span><span class="sxs-lookup"><span data-stu-id="1fa31-133">Connection-based authentication for Negotiate, Kerberos, and CredSSP authentication.</span></span>

    <span data-ttu-id="1fa31-134">Для проверки подлинности запроса требуется несколько обращений между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="1fa31-134">Authentication of a request requires multiple round-trips between the client and server.</span></span> <span data-ttu-id="1fa31-135">Большинство случаев согласования для проверки подлинности завершается после того, как сервер проверки подлинности (WinRM) отправляет ответ клиенту, который не является ответом 401 (несанкционированный).</span><span class="sxs-lookup"><span data-stu-id="1fa31-135">Most negotiation for authentication is complete after the authenticating (WinRM) server sends a response to the client that is not a 401 response (Unauthorized).</span></span> <span data-ttu-id="1fa31-136">Если сервер WinRM возвращает ответ клиенту, который не является ответом 401, прокси не должен закрывать подключение.</span><span class="sxs-lookup"><span data-stu-id="1fa31-136">If the WinRM server returns a response to the client that is not a 401 response, the proxy should not close the connection.</span></span>

    <span data-ttu-id="1fa31-137">Перед отправкой фактических данных пакетов можно отправлять несколько пар "запрос-ответ" между клиентом и сервером.</span><span class="sxs-lookup"><span data-stu-id="1fa31-137">Multiple request/response pairs can be sent between client and server before the actual packet data is sent.</span></span> <span data-ttu-id="1fa31-138">WinRM 2,0 использует схемы проверки подлинности Negotiate и Kerberos с шифрованием, что позволяет добавлять дополнительные циклы обработки.</span><span class="sxs-lookup"><span data-stu-id="1fa31-138">WinRM 2.0 uses the Negotiate and Kerberos authentication schemes with encryption, which can add extra round-trips.</span></span> <span data-ttu-id="1fa31-139">Данные не могут быть отправлены на сервер до завершения проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="1fa31-139">Data cannot be sent to the server until the authentication is complete.</span></span>

    <span data-ttu-id="1fa31-140">Сервер WinRM возвращает ответ уровня 200, указывающий на завершение проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="1fa31-140">The WinRM server returns a 200-level response that indicates that the authentication is complete.</span></span> <span data-ttu-id="1fa31-141">Прокси-серверы на основе HTTP могут завершить сопоставление проверки подлинности на основе подключений и закрыть подключение TCP/IP после получения ответа уровня 200 от сервера WinRM.</span><span class="sxs-lookup"><span data-stu-id="1fa31-141">HTTP-based proxy servers might end the connection-based authentication affinity and close the TCP/IP connection after receiving the 200-level response from the WinRM server.</span></span> <span data-ttu-id="1fa31-142">Окончательное обмен данными между клиентом и сервером не включает исходный пакет запроса.</span><span class="sxs-lookup"><span data-stu-id="1fa31-142">The final round-trip from client to server does not include the original request packet.</span></span> <span data-ttu-id="1fa31-143">Если прокси-сервер закрывает подключение, сервер попытается повторно пройти проверку подлинности клиента, а запрос клиента может никогда не отправляться на сервер.</span><span class="sxs-lookup"><span data-stu-id="1fa31-143">If the proxy server closes the connection, the server will attempt to re-authenticate the client and the client request might never be sent to the server.</span></span> <span data-ttu-id="1fa31-144">Если сходство на основе соединения не сохраняется, проверка подлинности на целевом сервере может завершиться ошибкой с ошибкой доступа.</span><span class="sxs-lookup"><span data-stu-id="1fa31-144">If the connection-based affinity is not maintained, authentication against the destination server can fail with an access denied error.</span></span>

-   <span data-ttu-id="1fa31-145">Сохраняемость подключения.</span><span class="sxs-lookup"><span data-stu-id="1fa31-145">Connection persistence.</span></span> <span data-ttu-id="1fa31-146">Подключение TCP/IP клиента к прокси-серверу должно продолжать сопоставляться с одним и тем же подключением TCP/IP от прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="1fa31-146">The client TCP/IP connection to the proxy should continue to map to the same TCP/IP connection from the proxy to the server.</span></span> <span data-ttu-id="1fa31-147">Поддержание этого соединения позволяет достичь более высокого уровня производительности.</span><span class="sxs-lookup"><span data-stu-id="1fa31-147">Maintaining this connection helps to achieve a higher level of performance.</span></span> <span data-ttu-id="1fa31-148">Если соединение не поддерживается, каждый запрос должен пройти повторную проверку подлинности, что может повлиять на производительность.</span><span class="sxs-lookup"><span data-stu-id="1fa31-148">If the connection is not maintained, every request must be re-authenticated, which might affect performance.</span></span>

### <a name="encryption-and-winrm-20"></a><span data-ttu-id="1fa31-149">Шифрование и WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="1fa31-149">Encryption and WinRM 2.0</span></span>

<span data-ttu-id="1fa31-150">WinRM 2,0 поддерживает шифрование по протоколу HTTP с помощью схем проверки подлинности Negotiate, Kerberos и CredSSP.</span><span class="sxs-lookup"><span data-stu-id="1fa31-150">WinRM 2.0 supports encryption over HTTP by using the Negotiate, Kerberos, and CredSSP authentication schemes.</span></span> <span data-ttu-id="1fa31-151">Если сервер WinRM поддерживает протокол HTTP и доступен через прокси, сервер WinRM должен обеспечивать шифрование и запрещать незашифрованный сетевой трафик.</span><span class="sxs-lookup"><span data-stu-id="1fa31-151">If a WinRM server supports HTTP and is accessed through a proxy, the WinRM server must enforce encryption and not allow unencrypted network traffic.</span></span>

<span data-ttu-id="1fa31-152">При отсутствии каких-либо ситуаций незашифрованные HTTP-запросы отправляются через прокси сервера.</span><span class="sxs-lookup"><span data-stu-id="1fa31-152">Under no circumstances should unencrypted HTTP requests be sent through proxy servers.</span></span> <span data-ttu-id="1fa31-153">Если данные должны пройти через прокси-сервер перед отправкой на целевой сервер, очень важны следующие вопросы безопасности.</span><span class="sxs-lookup"><span data-stu-id="1fa31-153">When data must pass through a proxy server before being sent to the destination server, the following security issues are very important:</span></span>

-   <span data-ttu-id="1fa31-154">Возможно, что вредоносный прокси-сервер может проверить каждую пару "запрос-ответ", включая учетные данные.</span><span class="sxs-lookup"><span data-stu-id="1fa31-154">It is possible that a malicious proxy server could examine every request/response pair, including credentials.</span></span>
-   <span data-ttu-id="1fa31-155">Если подключения TCP/IP не имеют строгого сопоставления между клиентом WinRM и прокси-сервером и между прокси-сервером и сервером назначения, несанкционированный клиент может подключиться к целевому серверу, используя то же подключение, прошедшее проверку подлинности, с прокси-сервера на целевой сервер.</span><span class="sxs-lookup"><span data-stu-id="1fa31-155">If the TCP/IP connections are not strongly mapped between both the WinRM client and the proxy server and between the proxy server and the destination server, an unauthorized client could connect to the destination server by using the same authenticated connection from the proxy server to the destination server.</span></span> <span data-ttu-id="1fa31-156">Целевой сервер может разрешать доступ клиента без проверки подлинности к данным.</span><span class="sxs-lookup"><span data-stu-id="1fa31-156">The destination server might allow the unauthenticated client access to data.</span></span> <span data-ttu-id="1fa31-157">Если шифрование применяется, целевой сервер отправляет сообщение об отказе в доступе клиенту, не прошедшему проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="1fa31-157">If encryption is enforced, the destination server sends an access denied message to the unauthenticated client.</span></span>

<span data-ttu-id="1fa31-158">Использование шифрования снижает опасность этих потенциальных проблем безопасности.</span><span class="sxs-lookup"><span data-stu-id="1fa31-158">Using encryption would mitigate these potential security issues.</span></span>

## <a name="configuring-a-proxy-server-for-winrm-11-and-earlier"></a><span data-ttu-id="1fa31-159">Настройка прокси-сервера для WinRM 1,1 и более ранних версий</span><span class="sxs-lookup"><span data-stu-id="1fa31-159">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>

<span data-ttu-id="1fa31-160">Если прокси-сервер необходим для доступа к серверу WinRM, клиент WinRM использует конфигурацию прокси-сервера служб HTTP Windows (WinHTTP).</span><span class="sxs-lookup"><span data-stu-id="1fa31-160">If a proxy is required to reach the WinRM server, the WinRM client relies on the Windows HTTP services (WinHTTP) proxy configuration.</span></span> <span data-ttu-id="1fa31-161">По умолчанию служба WinHTTP не настроена для использования прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="1fa31-161">By default, WinHTTP is not configured to use a proxy server.</span></span> <span data-ttu-id="1fa31-162">Конфигурацию прокси-сервера WinHTTP можно изменить с помощью [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) или служебных программ командной строки [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) .</span><span class="sxs-lookup"><span data-stu-id="1fa31-162">WinHTTP proxy configuration can be changed by using the [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) or [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) command-line utilities.</span></span>

<span data-ttu-id="1fa31-163">**WinRM 1,1 и более ранних версий:** Служба WinRM не использует параметры прокси-сервера Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="1fa31-163">**WinRM 1.1 and Earlier:** WinRM does not use the Internet Explorer proxy settings.</span></span>

 

 