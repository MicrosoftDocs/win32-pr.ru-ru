---
description: При создании собственных параллельных сборок следуйте указаниям по созданию параллельных сборок и автору любой библиотеки DLL, включаемой в сборку в соответствии с рекомендациями по созданию библиотеки DLL для параллельной сборки.
ms.assetid: 0e98bbcd-7e23-4a33-b0fa-1f936d0ef96b
title: Создание хранилища состояний для параллельных сборок
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eee388cf680ee3a186a225ca7e3bde8b6eae625d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103814769"
---
# <a name="authoring-state-storage-for-side-by-side-assemblies"></a><span data-ttu-id="58ea2-103">Создание хранилища состояний для параллельных сборок</span><span class="sxs-lookup"><span data-stu-id="58ea2-103">Authoring State Storage for Side-by-side Assemblies</span></span>

<span data-ttu-id="58ea2-104">При создании собственных параллельных сборок следуйте [указаниям по созданию параллельных сборок](guidelines-for-creating-side-by-side-assemblies.md) и автору любой библиотеки DLL, включаемой в сборку в соответствии с рекомендациями по [созданию библиотеки DLL для параллельной сборки](authoring-a-dll-for-a-side-by-side-assembly.md).</span><span class="sxs-lookup"><span data-stu-id="58ea2-104">When creating your own side-by-side assemblies, follow the [Guidelines for Creating Side-by-side Assemblies](guidelines-for-creating-side-by-side-assemblies.md) and author any DLL to be included in the assembly according to the guidelines in [Authoring a DLL for a Side-by-Side Assembly](authoring-a-dll-for-a-side-by-side-assembly.md).</span></span>

<span data-ttu-id="58ea2-105">Следуйте приведенным ниже рекомендациям по хранению состояния.</span><span class="sxs-lookup"><span data-stu-id="58ea2-105">Adhere to the following guidelines for the storage of the state:</span></span>

-   <span data-ttu-id="58ea2-106">Для хранения состояния разработки необходимо использовать прямую и обратную совместимость.</span><span class="sxs-lookup"><span data-stu-id="58ea2-106">Design state storage to be forward and backward compatible.</span></span> <span data-ttu-id="58ea2-107">Необходимо, чтобы версии использовались в любом порядке: например, v1, 3, 2.</span><span class="sxs-lookup"><span data-stu-id="58ea2-107">Expect the versions to be used in any order: for example, v1, then v3, then v2.</span></span>
-   <span data-ttu-id="58ea2-108">Инициализируйте и задайте параметры по умолчанию для сборки в коде сборки.</span><span class="sxs-lookup"><span data-stu-id="58ea2-108">Initialize and set the default settings for the assembly in the assembly code.</span></span> <span data-ttu-id="58ea2-109">Не сохраняйте параметры по умолчанию в реестре.</span><span class="sxs-lookup"><span data-stu-id="58ea2-109">Do not save the defaults settings in the registry.</span></span>
-   <span data-ttu-id="58ea2-110">Параметры реестра должны быть написаны на основе отдельных версий, чтобы изолировать несколько версий сборок, которые могут выполняться одновременно.</span><span class="sxs-lookup"><span data-stu-id="58ea2-110">Registry settings must be written on an individual-version basis to isolate multiple assembly versions that may be run at the same time.</span></span> <span data-ttu-id="58ea2-111">Разрабатывайте параллельную сборку, чтобы правильно хранить и обработать состояние сборки во время параллельного предоставления общего доступа.</span><span class="sxs-lookup"><span data-stu-id="58ea2-111">Design your side-by-side assembly to correctly store and handle the state of the assembly during side-by-side sharing scenarios.</span></span>
-   <span data-ttu-id="58ea2-112">Сборки часто хранят сведения о состоянии в разделах реестра.</span><span class="sxs-lookup"><span data-stu-id="58ea2-112">Assemblies commonly store state information in registry keys.</span></span> <span data-ttu-id="58ea2-113">Создайте набор файлов заголовков и вспомогательных функций, чтобы обеспечить простой способ создания разделов реестра, содержащих состояние сборки.</span><span class="sxs-lookup"><span data-stu-id="58ea2-113">Author a set of header files and helper functions to provide an easy way to version registry keys containing the assembly state.</span></span>
-   <span data-ttu-id="58ea2-114">Все сведения о состоянии сборки, сохраненные в реестре, должны быть изолированы от других версий сборки.</span><span class="sxs-lookup"><span data-stu-id="58ea2-114">Any assembly state information saved in the registry must be isolated from other versions of the assembly.</span></span> <span data-ttu-id="58ea2-115">Параметры состояния, хранящиеся в реестре, должны быть сохранены в разделах реестра отдельных версий.</span><span class="sxs-lookup"><span data-stu-id="58ea2-115">State settings stored in the registry must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="58ea2-116">Это необходимо в разделах реестра HKLM и HKCU.</span><span class="sxs-lookup"><span data-stu-id="58ea2-116">This is required in both the HKLM and HKCU parts of the registry.</span></span> <span data-ttu-id="58ea2-117">Например, сохраните параметры состояния HKCU для сборки версии XXXX в следующем разделе реестра:</span><span class="sxs-lookup"><span data-stu-id="58ea2-117">For example, store HKCU state settings for assembly version XXXX under the following registry key:</span></span>

    <span data-ttu-id="58ea2-118">**HKCU** \\ **MyCompany** \\ **MyComponent** \\ **Версионкскскскс**</span><span class="sxs-lookup"><span data-stu-id="58ea2-118">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXXX**</span></span>

-   <span data-ttu-id="58ea2-119">Все сведения о состоянии, хранящиеся в реестре общими сборками, должны сохраняться в разделах реестра отдельных версий.</span><span class="sxs-lookup"><span data-stu-id="58ea2-119">Any state information stored in the registry by shared assemblies must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="58ea2-120">Например, параметр состояния с именем Енаблесуперкулфеатуре может иметь значение **true** или **false**.</span><span class="sxs-lookup"><span data-stu-id="58ea2-120">For example, a state setting called EnableSuperCoolFeature might have a value of **TRUE** or **FALSE**.</span></span> <span data-ttu-id="58ea2-121">Сохраните значение для [*общей параллельной сборки*](s-sbscs-gly.md) следующим образом:</span><span class="sxs-lookup"><span data-stu-id="58ea2-121">Store the value for a [*shared side-by-side assembly*](s-sbscs-gly.md) as follows:</span></span>

    <span data-ttu-id="58ea2-122">**HKey \_ CurrentUser** \\ **Software** \\ **MyCompany** \\ **MyComponent** \\ **Version 01.01** \\ **енаблесуперкулфеатуре = true**</span><span class="sxs-lookup"><span data-stu-id="58ea2-122">**HKEY\_CurrentUser**\\**Software**\\**MyCompany**\\**MyComponent**\\**Version01.01**\\**EnableSuperCoolFeature = TRUE**</span></span>

-   <span data-ttu-id="58ea2-123">Все сведения о состоянии, хранящиеся в реестре закрытыми сборками, должны сохраняться в отдельных разделах реестра.</span><span class="sxs-lookup"><span data-stu-id="58ea2-123">Any state information stored in the registry by private assemblies must be saved in individual application sections of the registry.</span></span> <span data-ttu-id="58ea2-124">Это позволяет изолировать параметры состояния сборки с приложением.</span><span class="sxs-lookup"><span data-stu-id="58ea2-124">This isolates the assembly's state settings to the application.</span></span> <span data-ttu-id="58ea2-125">Для настройки виртуального корня можно использовать функцию [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) .</span><span class="sxs-lookup"><span data-stu-id="58ea2-125">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="58ea2-126">Например, если версия сборки КСКСИИ является закрытой сборкой "Сомеаппликатион", вызов **GetModuleFileName** возвращает "сомеаппликатион", а все параметры частного состояния для сборки должны быть записаны в следующем разделе:</span><span class="sxs-lookup"><span data-stu-id="58ea2-126">For example, if assembly version XXYY is a private assembly of "SomeApplication," a call to **GetModuleFileName** returns "SomeApplication" and any private state settings for the assembly should be written under the following key:</span></span>

    <span data-ttu-id="58ea2-127">**HKCU** \\ **MyCompany** \\ **MyComponent** \\ **Версионксксии** \\ **Сомеаппликатион**</span><span class="sxs-lookup"><span data-stu-id="58ea2-127">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXYY**\\**SomeApplication**</span></span>

-   <span data-ttu-id="58ea2-128">Создайте параметры общего состояния, хранящиеся в реестре Private, в контексте сборки, которая выполняется.</span><span class="sxs-lookup"><span data-stu-id="58ea2-128">Make shared state settings stored in the registry private to the assembly context that runs.</span></span> <span data-ttu-id="58ea2-129">Для настройки виртуального корня можно использовать функцию [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) .</span><span class="sxs-lookup"><span data-stu-id="58ea2-129">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="58ea2-130">Это необходимо сделать для ветвей HKLM и HKCU.</span><span class="sxs-lookup"><span data-stu-id="58ea2-130">This should be done for HKLM and HKCU branches.</span></span>
-   <span data-ttu-id="58ea2-131">В идеале следует применять модель сохраняемости, в которой приложение сохраняет состояние и не изменяет реестр.</span><span class="sxs-lookup"><span data-stu-id="58ea2-131">Ideally, you should adopt a persistence model in which the application persists the state and does not alter the registry.</span></span> <span data-ttu-id="58ea2-132">Приложению не нужно напрямую касаться записей реестра компонента.</span><span class="sxs-lookup"><span data-stu-id="58ea2-132">An application should not need to directly touch the component's registry entries.</span></span> <span data-ttu-id="58ea2-133">Вместо этого сборка должна предоставлять функции API, которые сохраняют или восстанавливают параметры, совместимые с параллельно.</span><span class="sxs-lookup"><span data-stu-id="58ea2-133">Instead, the assembly should offer API functions that save or restore settings that are side-by-side compatible.</span></span>
-   <span data-ttu-id="58ea2-134">Сборки могут сохранять параметры состояния в хранилищах вне реестра, чтобы обеспечить взаимодействие сборки с глобальным состоянием.</span><span class="sxs-lookup"><span data-stu-id="58ea2-134">Assemblies may save state settings in stores outside the registry to enable the assembly to interact with the global state.</span></span> <span data-ttu-id="58ea2-135">Параллельные сборки могут использовать следующие параллельно совместимые хранилища:</span><span class="sxs-lookup"><span data-stu-id="58ea2-135">Side-by-side assemblies may use the following side-by-side compatible stores:</span></span>
    -   <span data-ttu-id="58ea2-136">Защищенное хранилище (*PStore*)</span><span class="sxs-lookup"><span data-stu-id="58ea2-136">A protected store (*pstore*)</span></span>
    -   <span data-ttu-id="58ea2-137">Кэш WinInet</span><span class="sxs-lookup"><span data-stu-id="58ea2-137">A WinInet cache</span></span>
    -   <span data-ttu-id="58ea2-138">Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="58ea2-138">A Microsoft SQL Server</span></span>

 

 
