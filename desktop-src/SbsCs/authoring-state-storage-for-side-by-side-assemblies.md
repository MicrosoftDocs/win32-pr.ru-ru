---
description: При создании собственных параллельных сборок следуйте указаниям по созданию параллельных сборок и автору любой библиотеки DLL, включаемой в сборку в соответствии с рекомендациями по созданию библиотеки DLL для параллельной сборки.
ms.assetid: 0e98bbcd-7e23-4a33-b0fa-1f936d0ef96b
title: Создание хранилища состояний для параллельных сборок
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eee388cf680ee3a186a225ca7e3bde8b6eae625d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103814769"
---
# <a name="authoring-state-storage-for-side-by-side-assemblies"></a>Создание хранилища состояний для параллельных сборок

При создании собственных параллельных сборок следуйте [указаниям по созданию параллельных сборок](guidelines-for-creating-side-by-side-assemblies.md) и автору любой библиотеки DLL, включаемой в сборку в соответствии с рекомендациями по [созданию библиотеки DLL для параллельной сборки](authoring-a-dll-for-a-side-by-side-assembly.md).

Следуйте приведенным ниже рекомендациям по хранению состояния.

-   Для хранения состояния разработки необходимо использовать прямую и обратную совместимость. Необходимо, чтобы версии использовались в любом порядке: например, v1, 3, 2.
-   Инициализируйте и задайте параметры по умолчанию для сборки в коде сборки. Не сохраняйте параметры по умолчанию в реестре.
-   Параметры реестра должны быть написаны на основе отдельных версий, чтобы изолировать несколько версий сборок, которые могут выполняться одновременно. Разрабатывайте параллельную сборку, чтобы правильно хранить и обработать состояние сборки во время параллельного предоставления общего доступа.
-   Сборки часто хранят сведения о состоянии в разделах реестра. Создайте набор файлов заголовков и вспомогательных функций, чтобы обеспечить простой способ создания разделов реестра, содержащих состояние сборки.
-   Все сведения о состоянии сборки, сохраненные в реестре, должны быть изолированы от других версий сборки. Параметры состояния, хранящиеся в реестре, должны быть сохранены в разделах реестра отдельных версий. Это необходимо в разделах реестра HKLM и HKCU. Например, сохраните параметры состояния HKCU для сборки версии XXXX в следующем разделе реестра:

    **HKCU** \\ **MyCompany** \\ **MyComponent** \\ **Версионкскскскс**

-   Все сведения о состоянии, хранящиеся в реестре общими сборками, должны сохраняться в разделах реестра отдельных версий. Например, параметр состояния с именем Енаблесуперкулфеатуре может иметь значение **true** или **false**. Сохраните значение для [*общей параллельной сборки*](s-sbscs-gly.md) следующим образом:

    **HKey \_ CurrentUser** \\ **Software** \\ **MyCompany** \\ **MyComponent** \\ **Version 01.01** \\ **енаблесуперкулфеатуре = true**

-   Все сведения о состоянии, хранящиеся в реестре закрытыми сборками, должны сохраняться в отдельных разделах реестра. Это позволяет изолировать параметры состояния сборки с приложением. Для настройки виртуального корня можно использовать функцию [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) . Например, если версия сборки КСКСИИ является закрытой сборкой "Сомеаппликатион", вызов **GetModuleFileName** возвращает "сомеаппликатион", а все параметры частного состояния для сборки должны быть записаны в следующем разделе:

    **HKCU** \\ **MyCompany** \\ **MyComponent** \\ **Версионксксии** \\ **Сомеаппликатион**

-   Создайте параметры общего состояния, хранящиеся в реестре Private, в контексте сборки, которая выполняется. Для настройки виртуального корня можно использовать функцию [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) . Это необходимо сделать для ветвей HKLM и HKCU.
-   В идеале следует применять модель сохраняемости, в которой приложение сохраняет состояние и не изменяет реестр. Приложению не нужно напрямую касаться записей реестра компонента. Вместо этого сборка должна предоставлять функции API, которые сохраняют или восстанавливают параметры, совместимые с параллельно.
-   Сборки могут сохранять параметры состояния в хранилищах вне реестра, чтобы обеспечить взаимодействие сборки с глобальным состоянием. Параллельные сборки могут использовать следующие параллельно совместимые хранилища:
    -   Защищенное хранилище (*PStore*)
    -   Кэш WinInet
    -   Microsoft SQL Server

 

 
