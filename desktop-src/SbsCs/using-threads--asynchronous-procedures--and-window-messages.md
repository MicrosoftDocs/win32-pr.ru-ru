---
description: Контексты активации видимы во всем процессе.
ms.assetid: 6eda00d5-9dac-4267-bf61-b481814201f8
title: Потоки, асинхронные процедуры и сообщения окна
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e615eb9795ba32bcf4bd227a4933e890e9b89055
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103897097"
---
# <a name="using-threads-asynchronous-procedures-and-window-messages"></a><span data-ttu-id="957a9-103">Использование потоков, асинхронных процедур и оконных сообщений</span><span class="sxs-lookup"><span data-stu-id="957a9-103">Using Threads, Asynchronous Procedures, and Window Messages</span></span>

<span data-ttu-id="957a9-104">Контексты активации видимы во всем процессе.</span><span class="sxs-lookup"><span data-stu-id="957a9-104">Activation contexts are visible throughout the entire process.</span></span> <span data-ttu-id="957a9-105">Стеки контекста активации, однако, относятся к одному потоку, и два потока в одном процессе могут иметь разные стеки активации.</span><span class="sxs-lookup"><span data-stu-id="957a9-105">The activation context stacks are however per-thread, and two threads in the same process can have different activation stacks.</span></span> <span data-ttu-id="957a9-106">[**CreateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createthread) автоматически помещает текущий контекст активации в начало стека активации нового потока.</span><span class="sxs-lookup"><span data-stu-id="957a9-106">[**CreateThread**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createthread) automatically puts the current activation context at the top of the new thread's activation stack.</span></span> <span data-ttu-id="957a9-107">Это может способствовать обновлению существующего кода для использования параллельных компонентов, поскольку новый поток может выполняться немедленно в текущем контексте активации.</span><span class="sxs-lookup"><span data-stu-id="957a9-107">This can facilitate upgrading existing code to use side-by-side components because the new thread can run immediately in the current activation context.</span></span>

<span data-ttu-id="957a9-108">Асинхронные вызовы процедур, обратные вызовы портов завершения и любые другие обратные вызовы других потоков автоматически получают контекст активации источника.</span><span class="sxs-lookup"><span data-stu-id="957a9-108">Asynchronous procedure calls, completion port callbacks, and any other callbacks on other threads automatically get the activation context of the source.</span></span> <span data-ttu-id="957a9-109">При вызове обратного вызова очищается стек активации.</span><span class="sxs-lookup"><span data-stu-id="957a9-109">When the callback is called, the activation stack is cleaned up.</span></span> <span data-ttu-id="957a9-110">Это означает, что приложение может использовать асинхронные вызовы процедур и обратные вызовы без явной активации каких-либо контекстов, так как управление контекста будет выполняться базовой инфраструктурой.</span><span class="sxs-lookup"><span data-stu-id="957a9-110">This means that your application can use asynchronous procedure calls and callbacks without explicitly activating any contexts because context management will be done by the underlying side-by-side infrastructure.</span></span> <span data-ttu-id="957a9-111">Чтобы сделать другие контексты активными во время обратного вызова или нового потока, приложение может выполнить собственное управление контекста.</span><span class="sxs-lookup"><span data-stu-id="957a9-111">To make other contexts active during a callback or new thread, your application can do its own context management.</span></span> <span data-ttu-id="957a9-112">В этом случае программа должна использовать правильную последовательность контекста активации и функции деактивировать функции.</span><span class="sxs-lookup"><span data-stu-id="957a9-112">In this case your program must use the proper sequence of activation context activate functions and deactivate functions.</span></span>

<span data-ttu-id="957a9-113">Контексты активации являются независимыми от потоков.</span><span class="sxs-lookup"><span data-stu-id="957a9-113">Activation contexts are thread-neutral.</span></span> <span data-ttu-id="957a9-114">При активации контекста изменяется только стек текущего потока, и нельзя активировать контекст между потоками.</span><span class="sxs-lookup"><span data-stu-id="957a9-114">Activating a context only changes the current thread's stack, and you cannot activate a context across threads.</span></span> <span data-ttu-id="957a9-115">Потоку A не удается принудительно применить контекст к потоку B. Функции API контекста активации также поддерживают потоки.</span><span class="sxs-lookup"><span data-stu-id="957a9-115">Thread A cannot force a context onto thread B. The functions of the activation context API are also threading-aware.</span></span>

<span data-ttu-id="957a9-116">При использовании [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) или [**сообщения**](/windows/win32/api/winuser/nf-winuser-postmessagea) для отправки окна в другую процедуру окна в процессе текущий контекст активации активируется до передачи сообщения целевой процедуре.</span><span class="sxs-lookup"><span data-stu-id="957a9-116">When you use [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) or [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) to send a window message to another window procedure in your process, the current activation context is activated before the message is passed on to the target procedure.</span></span> <span data-ttu-id="957a9-117">Текущий контекст активации поступает вместе с сообщением.</span><span class="sxs-lookup"><span data-stu-id="957a9-117">The current activation context goes along with the message.</span></span> <span data-ttu-id="957a9-118">Это гарантирует, что сообщения, ссылающиеся на объекты COM, имена DLL или другие параллельные ресурсы, сохраняют свои данные о контексте.</span><span class="sxs-lookup"><span data-stu-id="957a9-118">This ensures that messages that refer to COM objects, DLL names, or other side-by-side resources retain their correct context information.</span></span>

 

 
