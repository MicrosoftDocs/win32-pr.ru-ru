---
description: При создании собственных параллельных сборок следуйте рекомендациям по созданию параллельных сборок.
ms.assetid: e5fc3bae-0646-4418-a8f7-369856f03cd5
title: Создание библиотек DLL для параллельных сборок
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: aa15f3876c60ce55be00d60d8f417eb0c2cbf6ec
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104265026"
---
# <a name="authoring-dlls-for-side-by-side-assemblies"></a><span data-ttu-id="a8e44-103">Создание библиотек DLL для параллельных сборок</span><span class="sxs-lookup"><span data-stu-id="a8e44-103">Authoring DLLs for Side-by-side Assemblies</span></span>

<span data-ttu-id="a8e44-104">При создании собственных параллельных сборок следуйте [рекомендациям по созданию параллельных сборок](guidelines-for-creating-side-by-side-assemblies.md) и создайте все библиотеки DLL, используемые в сборке, в соответствии со следующими рекомендациями.</span><span class="sxs-lookup"><span data-stu-id="a8e44-104">When creating your own side-by-side assemblies, follow the [Guidelines for Creating Side-by-side Assemblies](guidelines-for-creating-side-by-side-assemblies.md) and author any DLLs used in the assembly according to the following guidelines:</span></span>

-   <span data-ttu-id="a8e44-105">Библиотеки DLL должны быть спроектированы таким образом, чтобы несколько версий могли выполняться одновременно и в одном процессе, не мешая друг другу.</span><span class="sxs-lookup"><span data-stu-id="a8e44-105">Your DLLs should be designed so that multiple versions can run at the same time and in the same process without interfering with each other.</span></span> <span data-ttu-id="a8e44-106">Например, многие приложения размещают несколько подключаемых модулей, каждая из которых требует наличия отдельной версии одного компонента.</span><span class="sxs-lookup"><span data-stu-id="a8e44-106">For example, many applications host multiple plug-ins that each require a different version of one component.</span></span> <span data-ttu-id="a8e44-107">Разработчику параллельной сборки необходимо разработать и протестировать, чтобы обеспечить правильную работу нескольких версий компонента при одновременном запуске в одном процессе.</span><span class="sxs-lookup"><span data-stu-id="a8e44-107">The developer the side-by-side assembly needs to design and test to ensure that multiple versions of the component work correctly when run at the same time in the same process.</span></span>

-   <span data-ttu-id="a8e44-108">Если вы планируете предоставить компонент в качестве общего компонента в системах, предшествующих Windows XP, необходимо продолжить установку компонента в этих системах в качестве общего компонента с одним экземпляром.</span><span class="sxs-lookup"><span data-stu-id="a8e44-108">If you plan to provide your component as a shared component on systems earlier than Windows XP, you need to continue to install the component on these systems as a single-instance shared component.</span></span> <span data-ttu-id="a8e44-109">В этом случае необходимо обеспечить обратную совместимость компонента.</span><span class="sxs-lookup"><span data-stu-id="a8e44-109">In this case, you need to ensure your component is backward compatible.</span></span>

-   <span data-ttu-id="a8e44-110">Оцените использование объектов, если в системе выполняется несколько версий сборки.</span><span class="sxs-lookup"><span data-stu-id="a8e44-110">Evaluate the use of objects when more than one version of your assembly is run on the system.</span></span> <span data-ttu-id="a8e44-111">Определите, требуются ли для разных версий сборки отдельные структуры данных, такие как размещенные в памяти файлы, именованные каналы, зарегистрированные сообщения Windows и классы, Общая память, семафоры, мьютексы и драйверы оборудования.</span><span class="sxs-lookup"><span data-stu-id="a8e44-111">Determine whether different versions of the assembly require separate data structures, such as memory-mapped files, named pipes, registered Windows messages and classes, shared memory, semaphores, mutexes, and hardware drivers.</span></span> <span data-ttu-id="a8e44-112">Все структуры данных, используемые в версиях сборок, должны быть обратно совместимыми.</span><span class="sxs-lookup"><span data-stu-id="a8e44-112">Any data structures used across assembly versions must be backward-compatible.</span></span> <span data-ttu-id="a8e44-113">Определите, какие структуры данных можно использовать в разных версиях, и какие структуры данных должны быть частными для версии.</span><span class="sxs-lookup"><span data-stu-id="a8e44-113">Decide which data structures can be used across versions, and which data structures must be private to a version.</span></span> <span data-ttu-id="a8e44-114">Определите, требуются ли для общих структур данных отдельные объекты синхронизации, такие как семафоры и мьютексы.</span><span class="sxs-lookup"><span data-stu-id="a8e44-114">Determine whether shared data structures require separate synchronization objects, such as semaphores and mutexes.</span></span>

-   <span data-ttu-id="a8e44-115">Некоторые объекты, такие как классы окон и атомы, уникально именуются для каждого процесса.</span><span class="sxs-lookup"><span data-stu-id="a8e44-115">Some objects, such as window classes and Atoms, are uniquely named for each process.</span></span> <span data-ttu-id="a8e44-116">Объекты, такие как классы окон, должны иметь версию для каждой сборки, использующей манифест.</span><span class="sxs-lookup"><span data-stu-id="a8e44-116">Objects such as window classes should be versioned for each assembly using the manifest.</span></span> <span data-ttu-id="a8e44-117">Для таких объектов, как атомы, используйте идентификаторы, зависящие от версии, если не планируется совместное использование в разных версиях.</span><span class="sxs-lookup"><span data-stu-id="a8e44-117">For objects such as Atoms, use version-specific identifiers unless you plan to share across versions.</span></span> <span data-ttu-id="a8e44-118">Если используются идентификаторы, зависящие от версии, используйте номер версии из четырех частей.</span><span class="sxs-lookup"><span data-stu-id="a8e44-118">If you use version-specific identifiers, use the four-part versioning number.</span></span>

-   <span data-ttu-id="a8e44-119">Не включайте самостоятельно регистрируемый код в любую библиотеку DLL.</span><span class="sxs-lookup"><span data-stu-id="a8e44-119">Include no self-registering code in any DLL.</span></span> <span data-ttu-id="a8e44-120">Библиотека DLL в параллельной сборке не может быть самостоятельной регистрацией.</span><span class="sxs-lookup"><span data-stu-id="a8e44-120">A DLL in a side-by-side assembly cannot be self-registering.</span></span>

-   <span data-ttu-id="a8e44-121">Определите все имена, зависящие от версии, в библиотеке DLL с помощью \# инструкций define.</span><span class="sxs-lookup"><span data-stu-id="a8e44-121">Define all version-specific names in your DLL with \#define statements.</span></span> <span data-ttu-id="a8e44-122">Это позволяет изменять все разделы реестра из одного расположения.</span><span class="sxs-lookup"><span data-stu-id="a8e44-122">This enables all registry keys to be changed from one location.</span></span> <span data-ttu-id="a8e44-123">При освобождении новой версии сборки необходимо только изменить эту \# инструкцию define.</span><span class="sxs-lookup"><span data-stu-id="a8e44-123">When you release a new version of your assembly, you only need to change this \#define statement.</span></span> <span data-ttu-id="a8e44-124">Пример:</span><span class="sxs-lookup"><span data-stu-id="a8e44-124">For example:</span></span>

    `#define MyRegistryKey "MyAssembly1.0.0.0"`

-   <span data-ttu-id="a8e44-125">Храните все неустойчивые данные во временном каталоге.</span><span class="sxs-lookup"><span data-stu-id="a8e44-125">Store any nonpersistent data in the Temp directory.</span></span>

-   <span data-ttu-id="a8e44-126">Не помещайте пользовательские данные в глобальные расположения.</span><span class="sxs-lookup"><span data-stu-id="a8e44-126">Do not put user data into global locations.</span></span> <span data-ttu-id="a8e44-127">Данные приложений следует размещать отдельно от данных пользователя.</span><span class="sxs-lookup"><span data-stu-id="a8e44-127">Keep application data separate from user data.</span></span>

-   <span data-ttu-id="a8e44-128">Назначить всем общим файлам версию файла, которая зависит от имени приложения.</span><span class="sxs-lookup"><span data-stu-id="a8e44-128">Assign all shared files a file version that depends upon the application's name.</span></span>

-   <span data-ttu-id="a8e44-129">Назначьте всем сообщениям и структурам данных, используемым в процессах, версию, чтобы предотвратить непреднамеренное совместное использование между процессами.</span><span class="sxs-lookup"><span data-stu-id="a8e44-129">Assign all messages and data structures used across processes a version to prevent unintentional cross-process sharing.</span></span>

-   <span data-ttu-id="a8e44-130">Библиотека DLL не должна зависеть от общего доступа между версиями, которые могут не существовать, например разделами общей памяти, которые не являются общими для разных версий сборки.</span><span class="sxs-lookup"><span data-stu-id="a8e44-130">Your DLL should not depend upon sharing across versions that may not exist, such as shared memory sections that are not shared across different versions of your assembly.</span></span>

-   <span data-ttu-id="a8e44-131">При добавлении новых функций, которые не соответствуют контракту совместимости двоичного интерфейса исходной библиотеки DLL, необходимо назначить новый CLSID, ProgId и имя файла.</span><span class="sxs-lookup"><span data-stu-id="a8e44-131">If you add new functionality that does not follow the binary interface compatibility contract of the original DLL, you must assign a new CLSID, ProgId, and file name.</span></span> <span data-ttu-id="a8e44-132">Для использования этого идентификатора CLSID, ProgId и имени файла потребуется использовать будущие версии параллельной сборки.</span><span class="sxs-lookup"><span data-stu-id="a8e44-132">Future versions of your side-by-side assembly is then required to use this CLSID, ProgId, and file name.</span></span> <span data-ttu-id="a8e44-133">Это предотвращает конфликт, если непараллельная версия библиотеки DLL зарегистрирована в параллельной версии.</span><span class="sxs-lookup"><span data-stu-id="a8e44-133">This prevents a conflict when a version of the DLL that is not side-by-side is registered over a side-by-side version.</span></span>

-   <span data-ttu-id="a8e44-134">Если вы повторно использовали тот же идентификатор CLSID или ProgId, проверьте, чтобы обеспечить обратную совместимость сборки.</span><span class="sxs-lookup"><span data-stu-id="a8e44-134">If you reuse the same CLSID or ProgId, test to ensure that the assembly is backward compatible.</span></span>

-   <span data-ttu-id="a8e44-135">Инициализируйте и задайте параметры по умолчанию для сборки в коде сборки.</span><span class="sxs-lookup"><span data-stu-id="a8e44-135">Initialize and set the default settings for the assembly in the assembly code.</span></span> <span data-ttu-id="a8e44-136">Не сохраняйте параметры по умолчанию в реестре.</span><span class="sxs-lookup"><span data-stu-id="a8e44-136">Do not save the defaults settings in the registry.</span></span>

-   <span data-ttu-id="a8e44-137">Назначение версий для всех структур данных.</span><span class="sxs-lookup"><span data-stu-id="a8e44-137">Assign versions to all data structures.</span></span>

-   <span data-ttu-id="a8e44-138">Библиотека DLL должна хранить состояние параллельной сборки, как описано в разделе [Создание хранилища состояний для параллельных сборок](authoring-state-storage-for-side-by-side-assemblies.md).</span><span class="sxs-lookup"><span data-stu-id="a8e44-138">Your DLL should store the state of the side-by-side assembly as described in [Authoring State Storage for Side-by-Side Assemblies](authoring-state-storage-for-side-by-side-assemblies.md).</span></span>

 

 



