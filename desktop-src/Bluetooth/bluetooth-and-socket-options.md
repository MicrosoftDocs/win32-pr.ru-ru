---
title: Параметры Bluetooth и сокета
description: Bluetooth для Windows поддерживает следующие параметры сокета.
ms.assetid: e2e305c2-e749-4566-8e24-c07a7a29c612
keywords:
- Параметры Bluetooth и сокета Bluetooth
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 84040a98c3dae1fec292e4f0a7086f11d1ee546c
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987599"
---
# <a name="bluetooth-and-socket-options"></a><span data-ttu-id="58ae6-104">Параметры Bluetooth и сокета</span><span class="sxs-lookup"><span data-stu-id="58ae6-104">Bluetooth and Socket Options</span></span>

<span data-ttu-id="58ae6-105">Bluetooth для Windows поддерживает следующие параметры сокета.</span><span class="sxs-lookup"><span data-stu-id="58ae6-105">Bluetooth for Windows supports the following socket options.</span></span> <span data-ttu-id="58ae6-106">Параметры сокета задаются и запрашиваются с помощью функций [**сетсоккопт**](/windows/desktop/api/winsock/nf-winsock-setsockopt) и [**жетсоккопт**](/windows/desktop/api/winsock/nf-winsock-getsockopt) соответственно.</span><span class="sxs-lookup"><span data-stu-id="58ae6-106">Socket options are set and queried using the [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) and [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) functions, respectively.</span></span> <span data-ttu-id="58ae6-107">С функцией **сетсоккопт** можно использовать все перечисленные ниже параметры, но для использования с функцией **жетсоккопт** доступен только параметр **so \_ БС \_ MTU** .</span><span class="sxs-lookup"><span data-stu-id="58ae6-107">All of the following options can be used with the **setsockopt** function, but only the **SO\_BTH\_MTU** option is available for use with the **getsockopt** function.</span></span>

<span data-ttu-id="58ae6-108">Для работы с параметрами сокета Bluetooth требуются следующие параметры:</span><span class="sxs-lookup"><span data-stu-id="58ae6-108">The following settings are required for working with Bluetooth socket options:</span></span>

-   <span data-ttu-id="58ae6-109">Параметр *s* должен быть сокетом Bluetooth.</span><span class="sxs-lookup"><span data-stu-id="58ae6-109">The *s* parameter must be a Bluetooth socket.</span></span>
-   <span data-ttu-id="58ae6-110">Параметр *Level* должен быть **Sol \_ RFCOMM**.</span><span class="sxs-lookup"><span data-stu-id="58ae6-110">The *level* parameter must be **SOL\_RFCOMM**.</span></span>

## <a name="so_bth_authenticate"></a><span data-ttu-id="58ae6-111">Итак \_ , \_ Проверка подлинности БС</span><span class="sxs-lookup"><span data-stu-id="58ae6-111">SO\_BTH\_AUTHENTICATE</span></span>

<span data-ttu-id="58ae6-112">Для отключенных сокетов, **\_ БС \_** проверка подлинности указывает, что для успешного выполнения операции [**подключения**](/windows/desktop/api/winsock2/nf-winsock2-connect) или [**приема**](/windows/desktop/api/winsock2/nf-winsock2-accept) требуется проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="58ae6-112">For disconnected sockets, the **SO\_BTH\_AUTHENTICATE** specifies that authentication is required for a [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) or [**accept**](/windows/desktop/api/winsock2/nf-winsock2-accept) operation to complete successfully.</span></span> <span data-ttu-id="58ae6-113">Установка этого параметра сокета активно инициирует проверку подлинности во время установки соединения, если два устройства Bluetooth ранее не прошли проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="58ae6-113">Setting this socket option actively initiates authentication during connection establishment, if the two Bluetooth devices were not previously authenticated.</span></span> <span data-ttu-id="58ae6-114">Пользовательский интерфейс для обмена ключами при необходимости предоставляется операционной системой за пределами контекста приложения.</span><span class="sxs-lookup"><span data-stu-id="58ae6-114">The user interface for passkey exchange, if necessary, is provided by the operating system outside the application context.</span></span>

<span data-ttu-id="58ae6-115">Для исходящих подключений, требующих проверки подлинности, операция [**подключения**](/windows/desktop/api/winsock2/nf-winsock2-connect) завершается сбоем с **всаеакцес** , если проверка подлинности не прошла успешно.</span><span class="sxs-lookup"><span data-stu-id="58ae6-115">For outgoing connections that require authentication, the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) operation fails with **WSAEACCES** if authentication is not successful.</span></span> <span data-ttu-id="58ae6-116">В ответ приложение может предложить пользователю выполнить проверку подлинности двух устройств Bluetooth перед подключением.</span><span class="sxs-lookup"><span data-stu-id="58ae6-116">In response, the application may prompt the user to authenticate the two Bluetooth devices before connection.</span></span>

<span data-ttu-id="58ae6-117">Для входящих соединений соединение отклоняется, если не удается установить проверку подлинности и возвращает ошибку **всаехостдовн** .</span><span class="sxs-lookup"><span data-stu-id="58ae6-117">For incoming connections, the connection is rejected if authentication cannot be established and returns a **WSAEHOSTDOWN** error.</span></span> <span data-ttu-id="58ae6-118">Дополнительные сведения о проверке подлинности устройств Bluetooth см. в разделе [**блуетусаусентикатедевице**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span><span class="sxs-lookup"><span data-stu-id="58ae6-118">For more information about authenticating Bluetooth devices, see [**BluetoothAuthenticateDevice**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span></span>

<span data-ttu-id="58ae6-119">Для БС параметра сокета **\_ \_ проверки подлинности** *ОПТВАЛ* является указателем на ulong баусентикате и должно иметь **значение true**. *оптлен* эквивалентен "sizeof (ulong)".</span><span class="sxs-lookup"><span data-stu-id="58ae6-119">For the **SO\_BTH\_AUTHENTICATE** socket option, *optval* is a pointer to ULONG bAuthenticate and must be **TRUE**; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

<span data-ttu-id="58ae6-120">**Windows XP с пакетом обновления 2 (SP2): \_ БС \_** Authentication запускает проверку подлинности для подключенных сокетов и принудительно выполняет проверку подлинности при подключении для неподключенных сокетов.</span><span class="sxs-lookup"><span data-stu-id="58ae6-120">**Windows XP with SP2:  SO\_BTH\_AUTHENTICATE** starts authentication for connected sockets, and forces authentication upon connection for unconnected sockets.</span></span> <span data-ttu-id="58ae6-121">Для входящих подключений соединение отклоняется, если не удается выполнить проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="58ae6-121">For incoming connections, the connection is rejected if authentication cannot be performed.</span></span>

## <a name="so_bth_encrypt"></a><span data-ttu-id="58ae6-122">Итак, \_ БС \_ Encrypt</span><span class="sxs-lookup"><span data-stu-id="58ae6-122">SO\_BTH\_ENCRYPT</span></span>

<span data-ttu-id="58ae6-123">В случае неподключенных сокетов для установления соединения параметр сокета **\_ БС \_ Encrypting** обеспечивает принудительное шифрование.</span><span class="sxs-lookup"><span data-stu-id="58ae6-123">On unconnected sockets, the **SO\_BTH\_ENCRYPT** socket option enforces encryption to establish a connection.</span></span> <span data-ttu-id="58ae6-124">Шифрование доступно только для проверенных соединений.</span><span class="sxs-lookup"><span data-stu-id="58ae6-124">Encryption is only available for authenticated connections.</span></span> <span data-ttu-id="58ae6-125">Для входящих подключений подключение, для которого не удается установить шифрование, автоматически отклоняется, и в качестве ошибки возвращается **всаехостдовн** .</span><span class="sxs-lookup"><span data-stu-id="58ae6-125">For incoming connections, a connection for which encryption cannot be established is automatically rejected and returns **WSAEHOSTDOWN** as the error.</span></span> <span data-ttu-id="58ae6-126">Для исходящих подключений функция [**Connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) завершается с **всаеакцес** , если не удается установить шифрование.</span><span class="sxs-lookup"><span data-stu-id="58ae6-126">For outgoing connections, the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect) function fails with **WSAEACCES** if encryption cannot be established.</span></span> <span data-ttu-id="58ae6-127">В ответ приложение может предложить пользователю выполнить проверку подлинности двух устройств Bluetooth перед подключением.</span><span class="sxs-lookup"><span data-stu-id="58ae6-127">In response, the application may prompt the user to authenticate the two Bluetooth devices before connection.</span></span> <span data-ttu-id="58ae6-128">Дополнительные сведения о проверке подлинности устройств Bluetooth см. в разделе [**блуетусаусентикатедевице**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span><span class="sxs-lookup"><span data-stu-id="58ae6-128">For more information about authenticating Bluetooth devices, see [**BluetoothAuthenticateDevice**](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice).</span></span>

<span data-ttu-id="58ae6-129">Для \_ БС \_ -шифрования параметра Socket *оптвал* является указателем на ulong **Бенкрипт** и должно иметь **значение true**. *оптлен* эквивалентно sizeof (ulong).</span><span class="sxs-lookup"><span data-stu-id="58ae6-129">For the SO\_BTH\_ENCRYPT socket option, *optval* is a pointer to ULONG **bEncrypt** and must be **TRUE**; *optlen* is equivalent to sizeof(ULONG).</span></span>

<span data-ttu-id="58ae6-130">**Windows XP с пакетом обновления 2 (SP2):** Для сокета, который подключен и прошел проверку подлинности, **\_ БС \_ Encrypt** начинает шифрование.</span><span class="sxs-lookup"><span data-stu-id="58ae6-130">**Windows XP with SP2:** For a socket that is connected and authenticated, **SO\_BTH\_ENCRYPT** starts encryption.</span></span>

## <a name="so_bth_mtu"></a><span data-ttu-id="58ae6-131">Итак, \_ БС \_ MTU</span><span class="sxs-lookup"><span data-stu-id="58ae6-131">SO\_BTH\_MTU</span></span>

<span data-ttu-id="58ae6-132">Таким образом, параметр Socket **\_ БС \_ MTU** является дополнительным параметром, который используется в основном для проверки.</span><span class="sxs-lookup"><span data-stu-id="58ae6-132">The **SO\_BTH\_MTU** socket option is an advanced option used primarily for validation.</span></span> <span data-ttu-id="58ae6-133">**Таким образом, параметр \_ БС \_ MTU** получает или задает значение по умолчанию MTU RFCOMM (максимальная единица передачи) для согласования соединения со значением, отличным от значения по умолчанию для протокола RFCOMM.</span><span class="sxs-lookup"><span data-stu-id="58ae6-133">The **SO\_BTH\_MTU** option obtains or sets default RFCOMM MTU (maximum transmission unit) for connection negotiation to a value different than the RFCOMM protocol-default value.</span></span>

<span data-ttu-id="58ae6-134">Поскольку RFCOMM MTU зависит от базового L2CAP MTU, а также от минимальных и максимальных значений протоколов и приложений, значение по умолчанию для **\_ БС \_ MTU** — это только отправная точка для согласования с удаленным одноранговым узлом, а окончательно согласованный MTU, скорее всего, будет отличаться от значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="58ae6-134">Because RFCOMM MTU is affected by the underlying L2CAP MTU, and protocol and application minimums and maximums, the default value for **SO\_BTH\_MTU** is only a starting point for negotiation with the remote peer, and the final negotiated MTU is likely to vary from the default.</span></span> <span data-ttu-id="58ae6-135">Установка значения **\_ \_ MTU БС** может негативно сказаться на пропускной способности, и поэтому любые изменения должны выполняться с учетом базового протокола Bluetooth.</span><span class="sxs-lookup"><span data-stu-id="58ae6-135">Setting the **SO\_BTH\_MTU** value may negatively affect throughput, and as such, any modification should be performed with knowledge of the underlying Bluetooth protocol.</span></span>

<span data-ttu-id="58ae6-136">Таким образом, параметр сокета **\_ БС \_ MTU** может быть выполнен на подключенных сокетах, но не действует, если согласование уже завершено.</span><span class="sxs-lookup"><span data-stu-id="58ae6-136">The **SO\_BTH\_MTU** socket option can be performed on connected sockets, but has no effect if the negotiation has already completed.</span></span> <span data-ttu-id="58ae6-137">Его установка на сокете прослушивания (сервер) не действует.</span><span class="sxs-lookup"><span data-stu-id="58ae6-137">Setting it on the listening (server) socket has no effect.</span></span>

<span data-ttu-id="58ae6-138">Количество данных, которое приложение может отправить или получить в одном вызове сокета, не зависит от значения MTU; MTU влияет только на то, как базовый поставщик услуг Windows Sockets обрабатывает пакеты для транспорта.</span><span class="sxs-lookup"><span data-stu-id="58ae6-138">The amount of data that an application can send or receive in a single socket call is not affected by the MTU; MTU only affects how the underlying Windows Sockets service provider segments packets for transport.</span></span> <span data-ttu-id="58ae6-139">Предложенные значения MTU и MTU в конечном итоге должны быть между **RFCOMM \_ min \_ MTU** и **RFCOMM \_ Max \_ MTU**, как определено в файле заголовка Ws2bth. h.</span><span class="sxs-lookup"><span data-stu-id="58ae6-139">Both the proposed MTU and the MTU ultimately negotiated must be between **RFCOMM\_MIN\_MTU** and **RFCOMM\_MAX\_MTU**, as defined in the Ws2bth.h header file.</span></span>

<span data-ttu-id="58ae6-140">Для БС параметра сокета **\_ \_ MTU** *ОПТВАЛ* — это указатель на ulong MTU; *оптлен* эквивалентен "sizeof (ulong)".</span><span class="sxs-lookup"><span data-stu-id="58ae6-140">For the **SO\_BTH\_MTU** socket option, *optval* is a pointer to ULONG mtu; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

## <a name="so_bth_mtu_max"></a><span data-ttu-id="58ae6-141">Итак, \_ БС \_ MTU \_ Max</span><span class="sxs-lookup"><span data-stu-id="58ae6-141">SO\_BTH\_MTU\_MAX</span></span>

<span data-ttu-id="58ae6-142">Таким образом, параметр Socket **\_ БС \_ MTU \_ Max** является дополнительным параметром, который используется в основном для проверки.</span><span class="sxs-lookup"><span data-stu-id="58ae6-142">The **SO\_BTH\_MTU\_MAX** socket option is an advanced option used primarily for validation.</span></span> <span data-ttu-id="58ae6-143">Таким образом, параметр Socket **\_ БС \_ MTU \_ Max** устанавливает максимальное значение MTU RFCOMM (максимальная единица передачи) для согласования соединения.</span><span class="sxs-lookup"><span data-stu-id="58ae6-143">The **SO\_BTH\_MTU\_MAX** socket option sets the maximum RFCOMM MTU (maximum transmission unit) for connection negotiation.</span></span> <span data-ttu-id="58ae6-144">Подключения с RFCOMM MTU, равным или превышающим это значение, завершаются [](/windows/desktop/api/winsock2/nf-winsock2-connect)сбоем во время / процесса [**принятия**](/windows/desktop/api/winsock2/nf-winsock2-accept) подключения.</span><span class="sxs-lookup"><span data-stu-id="58ae6-144">Connections with an RFCOMM MTU equal to or greater than this value fail during the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect)/[**accept**](/windows/desktop/api/winsock2/nf-winsock2-accept) process.</span></span> <span data-ttu-id="58ae6-145">Если этот параметр сокета разрешен для подключенного сокета, он не действует, если согласование завершено.</span><span class="sxs-lookup"><span data-stu-id="58ae6-145">While setting this socket option is allowed for a connected socket, it has no effect if the negotiation has completed.</span></span> <span data-ttu-id="58ae6-146">Установка этого параметра сокета на сокете прослушивания распространяет значение для всех входящих подключений.</span><span class="sxs-lookup"><span data-stu-id="58ae6-146">Setting this socket option on a listening socket propagates the value for all incoming connections.</span></span> <span data-ttu-id="58ae6-147">Максимальное значение MTU должно быть между **RFCOMM \_ min \_ MTU** и **RFCOMM \_ Max \_ MTU**, как определено в файле заголовка Ws2bth. h.</span><span class="sxs-lookup"><span data-stu-id="58ae6-147">The MAX MTU value must be between **RFCOMM\_MIN\_MTU** and **RFCOMM\_MAX\_MTU**, as defined in the Ws2bth.h header file.</span></span>

<span data-ttu-id="58ae6-148">Для параметра **\_ БС \_ MTU \_ Max** Socket *оптвал* является указателем на Max \_ MTU. *оптлен* эквивалентен "sizeof (ulong)".</span><span class="sxs-lookup"><span data-stu-id="58ae6-148">For the **SO\_BTH\_MTU\_MAX** socket option, *optval* is a pointer to ULONG max\_mtu; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

## <a name="so_bth_mtu_min"></a><span data-ttu-id="58ae6-149">так что \_ БС \_ MTU \_ мин</span><span class="sxs-lookup"><span data-stu-id="58ae6-149">SO\_BTH\_MTU\_MIN</span></span>

<span data-ttu-id="58ae6-150">Параметр **\_ БС \_ \_ мин min** Socket является дополнительным параметром, который используется в основном для проверки.</span><span class="sxs-lookup"><span data-stu-id="58ae6-150">The **SO\_BTH\_MTU\_MIN** socket option is an advanced option used primarily for validation.</span></span> <span data-ttu-id="58ae6-151">Параметр **\_ БС \_ MTU \_ min** Socket устанавливает минимальное значение MTU RFCOMM (максимальная единица передачи) для согласования соединения.</span><span class="sxs-lookup"><span data-stu-id="58ae6-151">The **SO\_BTH\_MTU\_MIN** socket option sets the minimum RFCOMM MTU (maximum transmission unit) for connection negotiation.</span></span> <span data-ttu-id="58ae6-152">При [**подключении**](/windows/desktop/api/winsock2/nf-winsock2-connect)с параметром MTU RFCOMM меньше этого значения происходит сбой в процессе / [**принятия**](/windows/desktop/api/winsock2/nf-winsock2-accept) подключения.</span><span class="sxs-lookup"><span data-stu-id="58ae6-152">Connections with an RFCOMM MTU smaller than this value fail during the [**connect**](/windows/desktop/api/winsock2/nf-winsock2-connect)/[**accept**](/windows/desktop/api/winsock2/nf-winsock2-accept) process.</span></span> <span data-ttu-id="58ae6-153">Если этот параметр сокета разрешен для подключенного сокета, он не действует, если согласование завершено.</span><span class="sxs-lookup"><span data-stu-id="58ae6-153">While setting this socket option is allowed for a connected socket, it has no effect if the negotiation has completed.</span></span> <span data-ttu-id="58ae6-154">Установка этого параметра сокета на сокете прослушивания распространяет значение для всех входящих подключений.</span><span class="sxs-lookup"><span data-stu-id="58ae6-154">Setting this socket option on a listening socket propagates the value for all incoming connections.</span></span>

<span data-ttu-id="58ae6-155">Только сокет прослушивания может изменить MTU вниз, поэтому, если значение, предложенное сокетом соединения, меньше, чем значение, заданное для параметра **\_ БС \_ MTU \_ min** на сокете прослушивания, подключение отклоняется.</span><span class="sxs-lookup"><span data-stu-id="58ae6-155">Only a listening socket can revise the MTU downward, therefore if the value proposed by the connecting socket is less than the value set for **SO\_BTH\_MTU\_MIN** on the listening socket, the connection is refused.</span></span> <span data-ttu-id="58ae6-156">Минимальное значение MTU должно быть между **RFCOMM \_ min \_ MTU** и **RFCOMM \_ Max \_ MTU**, как определено в файле заголовка Ws2bth. h.</span><span class="sxs-lookup"><span data-stu-id="58ae6-156">The minimum MTU must be between **RFCOMM\_MIN\_MTU** and **RFCOMM\_MAX\_MTU**, as defined in the Ws2bth.h header file.</span></span>

<span data-ttu-id="58ae6-157">Для \_ \_ параметра БС \_ мин min Socket, *оптвал* является указателем на ulong min \_ MTU; *оптлен* эквивалентен "sizeof (ulong)".</span><span class="sxs-lookup"><span data-stu-id="58ae6-157">For the SO\_BTH\_MTU\_MIN socket option, *optval* is a pointer to ULONG min\_mtu; *optlen* is equivalent to "sizeof(ULONG)".</span></span>

## <a name="related-topics"></a><span data-ttu-id="58ae6-158">См. также</span><span class="sxs-lookup"><span data-stu-id="58ae6-158">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="58ae6-159">Сокеты Windows</span><span class="sxs-lookup"><span data-stu-id="58ae6-159">Windows Sockets</span></span>](/windows/desktop/WinSock/windows-sockets-start-page-2)
</dt> <dt>

[<span data-ttu-id="58ae6-160">**жетсоккопт**</span><span class="sxs-lookup"><span data-stu-id="58ae6-160">**getsockopt**</span></span>](/windows/desktop/api/winsock/nf-winsock-getsockopt)
</dt> <dt>

[<span data-ttu-id="58ae6-161">**сетсоккопт**</span><span class="sxs-lookup"><span data-stu-id="58ae6-161">**setsockopt**</span></span>](/windows/desktop/api/winsock/nf-winsock-setsockopt)
</dt> <dt>

[<span data-ttu-id="58ae6-162">**блуетусаусентикатедевице**</span><span class="sxs-lookup"><span data-stu-id="58ae6-162">**BluetoothAuthenticateDevice**</span></span>](/windows/desktop/api/BluetoothAPIs/nf-bluetoothapis-bluetoothauthenticatedevice)
</dt> <dt>

[<span data-ttu-id="58ae6-163">**соединиться**</span><span class="sxs-lookup"><span data-stu-id="58ae6-163">**connect**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-connect)
</dt> <dt>

[<span data-ttu-id="58ae6-164">**гласит**</span><span class="sxs-lookup"><span data-stu-id="58ae6-164">**accept**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-accept)
</dt> </dl>

 

 