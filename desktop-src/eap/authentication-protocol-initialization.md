---
title: Инициализация протокола проверки подлинности
description: Безопасное подключение EAP инициализируется между клиентом и сервером аналогичным образом для клиентов RAS и Wireless (802.1 X).
ms.assetid: 1cd5bfc9-2ba3-477c-9bbb-73578a5623c2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 856bd173ef617fb272460f874fa1d2087322c8b4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2020
ms.locfileid: "104412870"
---
# <a name="authentication-protocol-initialization"></a><span data-ttu-id="4577e-103">Инициализация протокола проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="4577e-103">Authentication Protocol Initialization</span></span>

<span data-ttu-id="4577e-104">Безопасное подключение EAP инициализируется между клиентом и сервером аналогичным образом для клиентов RAS и Wireless (802.1 X).</span><span class="sxs-lookup"><span data-stu-id="4577e-104">The EAP secured connection is initialized between the client and server in similar ways for RAS and wireless (802.1X) clients.</span></span>

## <a name="client"></a><span data-ttu-id="4577e-105">Клиент</span><span class="sxs-lookup"><span data-stu-id="4577e-105">Client</span></span>

<span data-ttu-id="4577e-106">Когда клиент пытается установить соединение, служба проверки подлинности получает [сведения об удостоверении](obtaining-identity-information.md) для пользователя.</span><span class="sxs-lookup"><span data-stu-id="4577e-106">When the client attempts to establish the connection, the authentication service obtains [identity information](obtaining-identity-information.md) for the user.</span></span> <span data-ttu-id="4577e-107">Если в реестре для этого протокола проверки подлинности указано значение **\_ \_ \_ \_ намедлг EAP** Call Call Invoke, а для этого параметра установлено значение 0, то служба проверки подлинности вызывает [**расеапжетидентити**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity).</span><span class="sxs-lookup"><span data-stu-id="4577e-107">If the **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** value is present in the registry for this authentication protocol and this value is set to zero, the authentication service calls [**RasEapGetIdentity**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapgetidentity).</span></span> <span data-ttu-id="4577e-108">Эта функция обычно отображает пользовательский интерфейс, который позволяет сведениям об удостоверениях иметь тип, характерный для протокола проверки подлинности. Например, сертификат или числовой идентификатор.</span><span class="sxs-lookup"><span data-stu-id="4577e-108">This function typically displays a user interface that allows the identity information to be of a type specific to the authentication protocol; for example, a certificate or numeric ID.</span></span> <span data-ttu-id="4577e-109">Если **параметр \_ RAS \_ EAP \_ Invoke \_ намедлг** отсутствует или имеет значение 1, то служба проверки подлинности отображает стандартное диалоговое окно системного имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="4577e-109">If **RAS\_EAP\_VALUENAME\_INVOKE\_NAMEDLG** is not present, or is set to one, the authentication service displays the standard system user-name dialog.</span></span>

<span data-ttu-id="4577e-110">Когда служба проверки подлинности получает сведения об удостоверении для пользователя, она вызывает реализацию [**расеапбегин**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85))протокола проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="4577e-110">Once the authentication service has obtained the identity information for the user, it calls the authentication protocol's implementation of [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="4577e-111">Этот вызов позволяет протоколу проверки подлинности выделять и инициализировать рабочий буфер, который служба передает при последующих вызовах [**расеапмакемессаже**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) и [**расеапенд**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="4577e-111">This call allows the authentication protocol to allocate and initialize a work buffer that the service passes on subsequent calls to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) and [**RasEapEnd**](/previous-versions/windows/desktop/legacy/aa363521(v=vs.85)).</span></span> <span data-ttu-id="4577e-112">Рабочий буфер непрозрачен для службы и никогда не обращается к содержимому буфера работ.</span><span class="sxs-lookup"><span data-stu-id="4577e-112">The work buffer is opaque to the service and never accesses the contents of the work buffer.</span></span> <span data-ttu-id="4577e-113">Если протокол проверки подлинности создает отдельный рабочий буфер для каждого сеанса EAP, Рабочий буфер является сеансом и потокобезопасным.</span><span class="sxs-lookup"><span data-stu-id="4577e-113">If the authentication protocol creates a distinct work buffer for each EAP session, then the work buffer is session and thread safe.</span></span> <span data-ttu-id="4577e-114">Так как протокол проверки подлинности выделяет память для рабочего буфера, протокол проверки подлинности также должен освободить эту память с помощью функции [**расеапфримемори**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) .</span><span class="sxs-lookup"><span data-stu-id="4577e-114">Because the authentication protocol allocates the memory for the work buffer, the authentication protocol should also free this memory using the [**RasEapFreeMemory**](/previous-versions/windows/desktop/api/Raseapif/nf-raseapif-raseapfreememory) function.</span></span>

<span data-ttu-id="4577e-115">В вызове [**расеапбегин**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85))служба также передает [**\_ \_ входную структуру PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) , содержащую указатели на сведения о конфигурации соединения, и сведения об удостоверении для пользователя.</span><span class="sxs-lookup"><span data-stu-id="4577e-115">In the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)), the service also passes a [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure that contains pointers to the configuration information for the connection, and the identity information for the user.</span></span> <span data-ttu-id="4577e-116">Служба всегда передает значение для члена **Псзидентити** **PPP \_ EAP \_ input**.</span><span class="sxs-lookup"><span data-stu-id="4577e-116">The service always passes in a value for the **pszIdentity** member of **PPP\_EAP\_INPUT**.</span></span> <span data-ttu-id="4577e-117">Однако член **псзпассворд** [**\_ \_ входа PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) может иметь **значение NULL**.</span><span class="sxs-lookup"><span data-stu-id="4577e-117">However, the **pszPassword** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) may be **NULL**.</span></span>

<span data-ttu-id="4577e-118">В [**\_ \_ входной структуре PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) член **фаусентикатор** указывает, вызывается ли протокол проверки подлинности (на клиенте) или как средство проверки подлинности (на сервере).</span><span class="sxs-lookup"><span data-stu-id="4577e-118">Within the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure, the **fAuthenticator** member indicates whether the authentication protocol is being invoked to be authenticated (on the client) or as the authenticator (on the server).</span></span>

## <a name="server"></a><span data-ttu-id="4577e-119">Сервер</span><span class="sxs-lookup"><span data-stu-id="4577e-119">Server</span></span>

<span data-ttu-id="4577e-120">На сервере член **бинитиалид** [**\_ \_ входа PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) указывает идентификатор, используемый сервером для первого пакета EAP.</span><span class="sxs-lookup"><span data-stu-id="4577e-120">On the server, the **bInitialID** member of [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) specifies the ID that the server uses for the first EAP packet.</span></span> <span data-ttu-id="4577e-121">Сервер увеличивает этот идентификатор для последующих пакетов.</span><span class="sxs-lookup"><span data-stu-id="4577e-121">The server increments this ID for subsequent packets.</span></span>

<span data-ttu-id="4577e-122">Кроме того, на сервере указатель **пусераттрибутес** в [**\_ \_ входных данных протокола PPP EAP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) указывает на массив атрибутов типа [**\_ \_ атрибута \_ проверки подлинности RAS**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type) .</span><span class="sxs-lookup"><span data-stu-id="4577e-122">Also on the server, the **pUserAttributes** pointer in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) points to an array of attributes of the [**RAS\_AUTH\_ATTRIBUTE\_TYPE**](/windows/win32/api/raseapif/ne-raseapif-ras_auth_attribute_type) type.</span></span> <span data-ttu-id="4577e-123">Это атрибуты пользователя, полученные от клиента.</span><span class="sxs-lookup"><span data-stu-id="4577e-123">These are attributes for the user that were obtained from the client.</span></span>

<span data-ttu-id="4577e-124">Если вызов [**расеапбегин**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) возвращает любое значение, кроме **ошибки No \_ Error**, то сеанс отключается.</span><span class="sxs-lookup"><span data-stu-id="4577e-124">If the [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)) call returns any value other than **NO\_ERROR**, the session is disconnected.</span></span> <span data-ttu-id="4577e-125">Возвращенная ошибка заносится в журнал (на сервере) или отображается пользователю (на клиенте).</span><span class="sxs-lookup"><span data-stu-id="4577e-125">The returned error is logged (on the server), or displayed to the user (on the client).</span></span>

 

 