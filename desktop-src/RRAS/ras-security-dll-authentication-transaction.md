---
title: Транзакция проверки подлинности DLL безопасности RAS
description: Сервер удаленного доступа Windows NT/Windows 2000 вызывает функцию Рассекуритидиалогбегин библиотеки безопасности, чтобы начать проверку подлинности удаленного пользователя.
ms.assetid: e6549812-d906-4163-b9c8-86f8f1cb1ad3
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 109f6ad5cd3d7b76e30db099a478ffaf562feb32
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "104533428"
---
# <a name="ras-security-dll-authentication-transaction"></a><span data-ttu-id="24170-103">Транзакция проверки подлинности DLL безопасности RAS</span><span class="sxs-lookup"><span data-stu-id="24170-103">RAS Security DLL Authentication Transaction</span></span>

<span data-ttu-id="24170-104">Сервер удаленного доступа Windows NT/Windows 2000 вызывает функцию [**РАССЕКУРИТИДИАЛОГБЕГИН**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogbegin) библиотеки безопасности, чтобы начать проверку подлинности удаленного пользователя.</span><span class="sxs-lookup"><span data-stu-id="24170-104">Windows NT/Windows 2000 RAS server calls the security DLL's [**RasSecurityDialogBegin**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogbegin) function to begin an authentication of a remote user.</span></span> <span data-ttu-id="24170-105">Сервер RAS заблокирован и не может принимать другие вызовы, пока **рассекуритидиалогбегин** не вернет.</span><span class="sxs-lookup"><span data-stu-id="24170-105">The RAS server is blocked and cannot accept any other calls until **RasSecurityDialogBegin** returns.</span></span> <span data-ttu-id="24170-106">По этой причине **рассекуритидиалогбегин** должен скопировать входные параметры, создать поток для выполнения проверки подлинности и вернуть их как можно быстрее.</span><span class="sxs-lookup"><span data-stu-id="24170-106">For this reason, **RasSecurityDialogBegin** should copy the input parameters, create a thread to perform the authentication, and return as quickly as possible.</span></span>

<span data-ttu-id="24170-107">Поток, созданный БИБЛИОТЕКой безопасности, использует функции [**рассекуритидиалогсенд**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) и [**рассекуритидиалогрецеиве**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) для взаимодействия с удаленным компьютером.</span><span class="sxs-lookup"><span data-stu-id="24170-107">The thread created by the security DLL uses the [**RasSecurityDialogSend**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) and [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) functions to communicate with the remote computer.</span></span> <span data-ttu-id="24170-108">Эти функции недоступны для статического импорта из любой библиотеки.</span><span class="sxs-lookup"><span data-stu-id="24170-108">These functions are not available for static import from any library.</span></span> <span data-ttu-id="24170-109">Вместо этого библиотека безопасности должна использовать функции [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) и [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) для динамической привязки к этим функциям в RASMAN.DLL.</span><span class="sxs-lookup"><span data-stu-id="24170-109">Instead, the security DLL must use the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) and [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) functions to dynamically link to these functions in RASMAN.DLL.</span></span>

<span data-ttu-id="24170-110">Во время транзакции проверки подлинности Диспетчер подключений RAS на удаленном компьютере отображает окно терминала.</span><span class="sxs-lookup"><span data-stu-id="24170-110">During an authentication transaction, the RAS connection manager on the remote computer displays a terminal window.</span></span> <span data-ttu-id="24170-111">Поток библиотеки DLL безопасности вызывает [**рассекуритидиалогсенд**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) для отправки сообщения, отображаемого в окне терминала.</span><span class="sxs-lookup"><span data-stu-id="24170-111">The thread of the security DLL calls [**RasSecurityDialogSend**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogsend) to send a message to display in the terminal window.</span></span> <span data-ttu-id="24170-112">Затем поток вызывает [**рассекуритидиалогрецеиве**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) для получения входных данных, которые типы удаленных пользователей находятся в окне терминала.</span><span class="sxs-lookup"><span data-stu-id="24170-112">The thread then calls [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) to receive the input that the remote user types in the terminal window.</span></span> <span data-ttu-id="24170-113">Поток может выполнять любое количество вызовов **рассекуритидиалогсенд** с каждым вызовом, за которым следует вызов **рассекуритидиалогрецеиве** .</span><span class="sxs-lookup"><span data-stu-id="24170-113">The thread can make any number of **RasSecurityDialogSend** calls, with each call followed by a **RasSecurityDialogReceive** call.</span></span> <span data-ttu-id="24170-114">После каждого вызова **рассекуритидиалогрецеиве** поток должен вызвать одну из функций ожидания, например [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject), чтобы дождаться завершения асинхронных операций Send и Receive.</span><span class="sxs-lookup"><span data-stu-id="24170-114">After each call to **RasSecurityDialogReceive**, the thread must call one of the wait functions, such as [**WaitForSingleObject**](/windows/win32/api/synchapi/nf-synchapi-waitforsingleobject), to wait for the asynchronous send and receive operations to be completed.</span></span> <span data-ttu-id="24170-115">Сервер RAS сигнализирует объекту события о завершении операции получения или по истечении необязательного интервала времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="24170-115">The RAS server signals an event object when the receive operation has been completed or when an optional time-out interval has elapsed.</span></span>

<span data-ttu-id="24170-116">Когда поток завершил проверку подлинности удаленного пользователя, он вызывает функцию [**рассекуритидиалогкомплете**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogcomplete) .</span><span class="sxs-lookup"><span data-stu-id="24170-116">When the thread has finished authenticating the remote user, it calls the [**RasSecurityDialogComplete**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogcomplete) function.</span></span> <span data-ttu-id="24170-117">Этот вызов передает структуру [**\_ сообщений безопасности**](/windows/desktop/api/Rasshost/ns-rasshost-security_message) , содержащую результаты транзакции проверки подлинности, на сервер удаленного доступа.</span><span class="sxs-lookup"><span data-stu-id="24170-117">This call passes a [**SECURITY\_MESSAGE**](/windows/desktop/api/Rasshost/ns-rasshost-security_message) structure containing the results of the authentication transaction to the RAS server.</span></span> <span data-ttu-id="24170-118">Затем сервер RAS выполняет последовательность очистки, которая включает вызов функции [**рассекуритидиаложенд**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogend) библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="24170-118">The RAS server then performs a cleanup sequence that includes a call to the DLL's [**RasSecurityDialogEnd**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogend) function.</span></span> <span data-ttu-id="24170-119">Это дает библиотеке DLL безопасности возможность выполнить необходимую очистку.</span><span class="sxs-lookup"><span data-stu-id="24170-119">This gives the security DLL an opportunity to perform any necessary cleanup.</span></span>

<span data-ttu-id="24170-120">Библиотека безопасности может вызывать функцию [**рассекуритидиалогжетинфо**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialoggetinfo) для получения сведений о порте, связанном с транзакцией проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="24170-120">The security DLL can call the [**RasSecurityDialogGetInfo**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialoggetinfo) function to retrieve information about the port associated with an authentication transaction.</span></span> <span data-ttu-id="24170-121">**Рассекуритидиалогжетинфо** заполняет структуру [**\_ \_ сведений о безопасности RAS**](/windows/desktop/api/Rasshost/ns-rasshost-ras_security_info) , которая указывает состояние последнего вызова [**рассекуритидиалогрецеиве**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) для порта.</span><span class="sxs-lookup"><span data-stu-id="24170-121">**RasSecurityDialogGetInfo** fills in a [**RAS\_SECURITY\_INFO**](/windows/desktop/api/Rasshost/ns-rasshost-ras_security_info) structure that indicates the state of the last [**RasSecurityDialogReceive**](/windows/desktop/api/Rasshost/nf-rasshost-rassecuritydialogreceive) call for the port.</span></span>

 

 