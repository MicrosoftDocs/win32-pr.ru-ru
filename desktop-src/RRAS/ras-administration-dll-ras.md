---
title: Библиотека DLL администрирования RAS
description: Библиотека DLL экспортирует функции, которые сервер удаленного доступа вызывает каждый раз, когда пользователь пытается подключиться или отключиться.
ms.assetid: 014ab85d-8924-4c7a-89ed-f83e75318ca6
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f0908032e0916f0937e964408b1551d3f1515dea
ms.sourcegitcommit: cba7f424a292fd7f3a8518947b9466439b455419
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/23/2019
ms.locfileid: "104335667"
---
# <a name="ras-administration-dll"></a><span data-ttu-id="c827e-103">Библиотека DLL администрирования RAS</span><span class="sxs-lookup"><span data-stu-id="c827e-103">RAS administration DLL</span></span>

<span data-ttu-id="c827e-104">Библиотека DLL экспортирует функции, которые сервер удаленного доступа вызывает каждый раз, когда пользователь пытается подключиться или отключиться.</span><span class="sxs-lookup"><span data-stu-id="c827e-104">The DLL exports functions that the RAS server calls whenever a user tries to connect or disconnect.</span></span> <span data-ttu-id="c827e-105">Библиотеку DLL можно использовать для выполнения следующих административных функций:</span><span class="sxs-lookup"><span data-stu-id="c827e-105">You can use the DLL to perform the following administrative functions:</span></span>

-   <span data-ttu-id="c827e-106">Решите, следует ли разрешить пользователю подключаться к серверу.</span><span class="sxs-lookup"><span data-stu-id="c827e-106">Decide whether to allow a user to connect to the server.</span></span> <span data-ttu-id="c827e-107">Это может обеспечить проверку безопасности в дополнение к стандартной проверке подлинности пользователя службы удаленного доступа.</span><span class="sxs-lookup"><span data-stu-id="c827e-107">This can provide a security check in addition to the standard RAS user authentication.</span></span>
-   <span data-ttu-id="c827e-108">Запишите время, когда каждый пользователь подключается к серверу и отключается от него.</span><span class="sxs-lookup"><span data-stu-id="c827e-108">Record the time that each user connects to and disconnects from the server.</span></span> <span data-ttu-id="c827e-109">Это может быть полезно для выставления счетов или проведения аудита.</span><span class="sxs-lookup"><span data-stu-id="c827e-109">This can be useful for billing or auditing purposes.</span></span>
-   <span data-ttu-id="c827e-110">Назначьте IP-адрес каждому пользователю.</span><span class="sxs-lookup"><span data-stu-id="c827e-110">Assign an IP address to each user.</span></span> <span data-ttu-id="c827e-111">Это может быть полезно в целях обеспечения безопасности при сопоставлении подключения пользователя к определенному компьютеру.</span><span class="sxs-lookup"><span data-stu-id="c827e-111">This can be useful for security purposes to map a user's connection to a specific computer.</span></span>

<span data-ttu-id="c827e-112">При разработке библиотеки DLL администрирования сервера удаленного доступа реализуйте следующие функции.</span><span class="sxs-lookup"><span data-stu-id="c827e-112">Implement the following functions when developing a RAS server administration DLL.</span></span>

-   [<span data-ttu-id="c827e-113">**расадминакцептневконнектион**</span><span class="sxs-lookup"><span data-stu-id="c827e-113">**RasAdminAcceptNewConnection**</span></span>](rasadminacceptnewconnection.md)
-   [<span data-ttu-id="c827e-114">**расадминконнектионхангупнотификатион**</span><span class="sxs-lookup"><span data-stu-id="c827e-114">**RasAdminConnectionHangupNotification**</span></span>](rasadminconnectionhangupnotification.md)
-   [<span data-ttu-id="c827e-115">**расадминжетипаддрессфорусер**</span><span class="sxs-lookup"><span data-stu-id="c827e-115">**RasAdminGetIpAddressForUser**</span></span>](rasadmingetipaddressforuser.md)
-   [<span data-ttu-id="c827e-116">**расадминрелеасеипаддресс**</span><span class="sxs-lookup"><span data-stu-id="c827e-116">**RasAdminReleaseIpAddress**</span></span>](rasadminreleaseipaddress.md)

<span data-ttu-id="c827e-117">Библиотека DLL администрирования RAS должна реализовывать и экспортировать все описанные выше функции.</span><span class="sxs-lookup"><span data-stu-id="c827e-117">A RAS administration DLL must implement and export all of the above functions.</span></span> <span data-ttu-id="c827e-118">Если какая бы то ни было функция не реализована, служба удаленного доступа не сможет запуститься.</span><span class="sxs-lookup"><span data-stu-id="c827e-118">If any of the functions are not implemented, the remote access service will fail to start.</span></span>

<span data-ttu-id="c827e-119">Функции [**расадминакцептневконнектион**](rasadminacceptnewconnection.md) и [**расадминконнектионхангупнотификатион**](rasadminconnectionhangupnotification.md) позволяют библиотеке DLL выполнять аудит подключений пользователей к серверу.</span><span class="sxs-lookup"><span data-stu-id="c827e-119">The [**RasAdminAcceptNewConnection**](rasadminacceptnewconnection.md) and [**RasAdminConnectionHangupNotification**](rasadminconnectionhangupnotification.md) functions enable the DLL to audit user connections to the server.</span></span> <span data-ttu-id="c827e-120">Сервер удаленного доступа Windows NT/Windows 2000 вызывает функцию **расадминакцептневконнектион** каждый раз, когда пользователь пытается подключиться.</span><span class="sxs-lookup"><span data-stu-id="c827e-120">A Windows NT/Windows 2000 RAS server calls the **RasAdminAcceptNewConnection** function whenever a user tries to connect.</span></span> <span data-ttu-id="c827e-121">Функция может препятствовать подключению пользователя.</span><span class="sxs-lookup"><span data-stu-id="c827e-121">The function can prevent the user from connecting.</span></span> <span data-ttu-id="c827e-122">Можно также использовать функцию, чтобы создать запись в журнале для выставления счетов или аудита.</span><span class="sxs-lookup"><span data-stu-id="c827e-122">You can also use the function to generate an entry in a log for billing or auditing.</span></span> <span data-ttu-id="c827e-123">Когда пользователь отключается, сервер удаленного доступа вызывает функцию **расадминконнектионхангупнотификатион** , которая может регистрировать время отключения пользователя.</span><span class="sxs-lookup"><span data-stu-id="c827e-123">When the user disconnects, the RAS server calls the **RasAdminConnectionHangupNotification** function, which can log the time at which the user disconnected.</span></span>

<span data-ttu-id="c827e-124">После того как сервер удаленного доступа пройдет проверку подлинности вызывающего объекта, он вызывает функцию [**расадминжетипаддрессфорусер**](rasadmingetipaddressforuser.md) для получения IP-адреса для удаленного клиента.</span><span class="sxs-lookup"><span data-stu-id="c827e-124">After the RAS server has authenticated a caller, it calls the [**RasAdminGetIpAddressForUser**](rasadmingetipaddressforuser.md) function to get an IP address for the remote client.</span></span> <span data-ttu-id="c827e-125">Эта функция может использоваться библиотекой DLL для предоставления альтернативной схемы для сопоставления IP-адреса с пользователем удаленного доступа.</span><span class="sxs-lookup"><span data-stu-id="c827e-125">The DLL can use this function to provide an alternate scheme for mapping an IP address to a dial-in user.</span></span> <span data-ttu-id="c827e-126">Если **расадминжетипаддрессфорусер** не реализован, сервер удаленного доступа подключает удаленного пользователя к IP-адресу, выбранному из статического пула IP-адресов или по выбранному сервером протокола динамической настройки узлов (DHCP).</span><span class="sxs-lookup"><span data-stu-id="c827e-126">If **RasAdminGetIpAddressForUser** is not implemented, a RAS server connects a remote user to an IP address selected from a static pool of IP addresses, or one selected by a Dynamic Host Configuration Protocol (DHCP) server.</span></span> <span data-ttu-id="c827e-127">Функция **расадминжетипаддрессфорусер** позволяет библиотеке DLL переопределить этот IP-адрес по умолчанию и указать конкретный IP-адрес для каждого пользователя.</span><span class="sxs-lookup"><span data-stu-id="c827e-127">The **RasAdminGetIpAddressForUser** function allows the DLL to override this default IP address and specify a particular IP address for each user.</span></span> <span data-ttu-id="c827e-128">Функция **расадминжетипаддрессфорусер** может установить флаг, который заставляет службу RAS вызывать функцию [**расадминрелеасеипаддресс**](rasadminreleaseipaddress.md) при отключении пользователя.</span><span class="sxs-lookup"><span data-stu-id="c827e-128">The **RasAdminGetIpAddressForUser** function can set a flag that causes RAS to call the [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) function when the user disconnects.</span></span> <span data-ttu-id="c827e-129">Библиотека DLL может использовать [**расадминрелеасеипаддресс**](rasadminreleaseipaddress.md) , чтобы обновить свою карту "пользователь-IP-адрес".</span><span class="sxs-lookup"><span data-stu-id="c827e-129">The DLL can use [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) to update its user-to-IP-address map.</span></span>

<span data-ttu-id="c827e-130">Служба RAS сериализует вызовы в библиотеку DLL администрирования.</span><span class="sxs-lookup"><span data-stu-id="c827e-130">RAS serializes calls into the administration DLL.</span></span> <span data-ttu-id="c827e-131">Вызов одной из функций DLL для данного клиента RAS никогда не будет зависеть от вызова этой функции для другого клиента RAS; Начальный вызов гарантированно завершится до того, как служба RAS вызовет функцию для другого клиента.</span><span class="sxs-lookup"><span data-stu-id="c827e-131">A call into one of the DLL's functions for a given RAS client will never be preempted by a call to that function for a different RAS client; the initial call is guaranteed to be complete before RAS calls the function for the other client.</span></span> <span data-ttu-id="c827e-132">Более того, сериализация распространяется на определенные группы функций.</span><span class="sxs-lookup"><span data-stu-id="c827e-132">Furthermore, serialization extends to certain groups of functions.</span></span> <span data-ttu-id="c827e-133">Функции IP-адреса сериализуются как группа. вызов либо в [**расадминжетипаддрессфорусер**](rasadmingetipaddressforuser.md) , либо в [**расадминрелеасеипаддресс**](rasadminreleaseipaddress.md) будет блокировать вызовы до тех пор, пока не завершится начальный вызов.</span><span class="sxs-lookup"><span data-stu-id="c827e-133">The IP address functions are serialized as a group; a call into either [**RasAdminGetIpAddressForUser**](rasadmingetipaddressforuser.md) or [**RasAdminReleaseIpAddress**](rasadminreleaseipaddress.md) will block calls into both until the initial call is complete.</span></span> <span data-ttu-id="c827e-134">[**Расадминакцептневконнектион**](rasadminacceptnewconnection.md) и [**расадминконнектионхангупнотификатион**](rasadminconnectionhangupnotification.md) также сериализуются как группа.</span><span class="sxs-lookup"><span data-stu-id="c827e-134">[**RasAdminAcceptNewConnection**](rasadminacceptnewconnection.md) and [**RasAdminConnectionHangupNotification**](rasadminconnectionhangupnotification.md) are also serialized as a group.</span></span>

<span data-ttu-id="c827e-135">Служба RAS выполняет функции назначения IP-адресов в одном процессе и выполняет функции для подключения и отсоединения уведомлений в другом процессе.</span><span class="sxs-lookup"><span data-stu-id="c827e-135">RAS executes the functions for assigning IP addresses in one process and executes the functions for connection and disconnection notifications in another process.</span></span> <span data-ttu-id="c827e-136">Следовательно, Библиотека DLL не должна зависеть от общих данных между двумя наборами функций.</span><span class="sxs-lookup"><span data-stu-id="c827e-136">Consequently, the DLL should not depend on shared data between the two sets of functions.</span></span>

<span data-ttu-id="c827e-137">Сервер RAS регистрирует ошибку в журнале системных событий, если возникает ошибка при попытке загрузить библиотеку DLL администрирования RAS или вызов одной из функций библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="c827e-137">The RAS server logs an error in the system event log if an error occurs when it tries to load a RAS administration DLL or when calling one of the DLL's functions.</span></span> <span data-ttu-id="c827e-138">Это может произойти, например, если в библиотеке DLL указано неверное имя экспортированной функции или если она не включала имя функции в DEF-файл.</span><span class="sxs-lookup"><span data-stu-id="c827e-138">This can happen, for example, if the DLL specified the wrong name for an exported function, or if it did not include the function name in the .def file.</span></span> <span data-ttu-id="c827e-139">Запись в журнале событий указывает причину сбоя.</span><span class="sxs-lookup"><span data-stu-id="c827e-139">The entry in the event log indicates the reason for the failure.</span></span>

<span data-ttu-id="c827e-140">**Windows 2000 Server и более поздние версии:** Библиотеки администрирования RAS, реализующие этот интерфейс функции, больше не работают.</span><span class="sxs-lookup"><span data-stu-id="c827e-140">**Windows 2000 Server and later:** RAS administration DLLs that implement this function interface no longer work.</span></span> <span data-ttu-id="c827e-141">Вместо этого используйте интерфейс функции Мпрадмин, предоставляемый в более поздних версиях Windows.</span><span class="sxs-lookup"><span data-stu-id="c827e-141">Instead, use the MprAdmin function interface provided with the more recent versions of Windows.</span></span> <span data-ttu-id="c827e-142">Дополнительные сведения см. в [справочнике по администрированию службы RAS](remote-access-service-administration-reference.md) в документации по МАРШРУТИЗАЦИИ и RAS.</span><span class="sxs-lookup"><span data-stu-id="c827e-142">For more information, see the [RAS Administration Reference](remote-access-service-administration-reference.md) in the Routing and RAS documentation.</span></span>

 

 




