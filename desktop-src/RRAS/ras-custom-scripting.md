---
title: Пользовательские сценарии службы RAS
description: Разработчики могут создать пользовательский сценарий DLL, который находится на клиентском компьютере удаленного доступа. Эта библиотека DLL может взаимодействовать с сервером в процессе установления соединения.
ms.assetid: c27b8b02-6018-4441-a355-1fb890b9001c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c625f020d9dafcb352c5f1b382014f9dba189330
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "103987618"
---
# <a name="ras-custom-scripting"></a><span data-ttu-id="ce399-104">Пользовательские сценарии службы RAS</span><span class="sxs-lookup"><span data-stu-id="ce399-104">RAS Custom Scripting</span></span>

<span data-ttu-id="ce399-105">Разработчики могут создать пользовательский сценарий DLL, который находится на клиентском компьютере удаленного доступа.</span><span class="sxs-lookup"><span data-stu-id="ce399-105">Developers can create a custom-scripting DLL that resides on a RAS client computer.</span></span> <span data-ttu-id="ce399-106">Эта библиотека DLL может взаимодействовать с сервером в процессе установления соединения.</span><span class="sxs-lookup"><span data-stu-id="ce399-106">This DLL can communicate with the server during the process of establishing a connection.</span></span>

<span data-ttu-id="ce399-107">**Windows NT:** Пользовательские скрипты недоступны.</span><span class="sxs-lookup"><span data-stu-id="ce399-107">**Windows NT:** Custom scripting is not available.</span></span>

## <a name="setting-up-the-dll"></a><span data-ttu-id="ce399-108">Настройка библиотеки DLL</span><span class="sxs-lookup"><span data-stu-id="ce399-108">Setting up the DLL</span></span>

<span data-ttu-id="ce399-109">Чтобы настроить библиотеку DLL, создайте значение с именем **кустомскриптдллпас** в следующем разделе реестра:</span><span class="sxs-lookup"><span data-stu-id="ce399-109">To set up the DLL, create a value with the name **CustomScriptDllPath** under the following registry key:</span></span>

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Services
            Rasman
               Parameters
```

<span data-ttu-id="ce399-110">Это значение должно иметь тип **reg \_ expand \_ SZ**.</span><span class="sxs-lookup"><span data-stu-id="ce399-110">This value should be of type **REG\_EXPAND\_SZ**.</span></span> <span data-ttu-id="ce399-111">Значение должно содержать путь к DLL-библиотеке пользовательского скрипта.</span><span class="sxs-lookup"><span data-stu-id="ce399-111">The value should contain the path to the custom-scripting DLL.</span></span> <span data-ttu-id="ce399-112">Для каждого клиентского компьютера службы удаленного доступа поддерживается только одна библиотека DLL пользовательского сценария.</span><span class="sxs-lookup"><span data-stu-id="ce399-112">Only one custom-scripting DLL is supported for each RAS client computer.</span></span>

## <a name="interaction-between-the-server-ras-and-the-custom-scripting-dll"></a><span data-ttu-id="ce399-113">Взаимодействие между сервером, службой RAS и библиотекой Custom-Scripting DLL</span><span class="sxs-lookup"><span data-stu-id="ce399-113">Interaction Between the Server, RAS, and the Custom-Scripting DLL</span></span>

<span data-ttu-id="ce399-114">Библиотека DLL пользовательского скрипта должна экспортировать одну точку входа: [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span><span class="sxs-lookup"><span data-stu-id="ce399-114">The custom scripting DLL should export a single entry point: [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span></span> <span data-ttu-id="ce399-115">Служба RAS вызывает эту функцию во время \_ интерактивного состояния процесса подключения раскс.</span><span class="sxs-lookup"><span data-stu-id="ce399-115">RAS calls this function during the RASCS\_Interactive state of the connection process.</span></span> <span data-ttu-id="ce399-116">\_Интерактивное состояние раскс — это приостановленное состояние, которое позволяет пользователю взаимодействовать с пользовательским интерфейсом, представленным библиотекой DLL пользовательского скрипта.</span><span class="sxs-lookup"><span data-stu-id="ce399-116">The RASCS\_Interactive state is a paused state, which allows the user to interact with a user interface presented by the custom-scripting DLL.</span></span> <span data-ttu-id="ce399-117">Дополнительные сведения о состояниях подключения см. в разделе [**расконнстате**](/previous-versions/windows/desktop/legacy/aa376727(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="ce399-117">See [**RASCONNSTATE**](/previous-versions/windows/desktop/legacy/aa376727(v=vs.85)) for more information about connection states.</span></span>

<span data-ttu-id="ce399-118">Служба RAS перейдет в качестве параметров функции [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) :</span><span class="sxs-lookup"><span data-stu-id="ce399-118">RAS will pass as parameters to the [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) function:</span></span>

-   <span data-ttu-id="ce399-119">Маркер порта на клиентском компьютере, используемый для соединения.</span><span class="sxs-lookup"><span data-stu-id="ce399-119">A handle to the port on the client computer that is being used for the connection.</span></span>
-   <span data-ttu-id="ce399-120">Строки, которые указывают телефонную книгу и запись для подключения.</span><span class="sxs-lookup"><span data-stu-id="ce399-120">Strings that identify the phone book and entry for the connection.</span></span>
-   <span data-ttu-id="ce399-121">Служба RAS также передает в окно обработчик, чтобы разрешить библиотеке DLL предоставлять пользовательский интерфейс.</span><span class="sxs-lookup"><span data-stu-id="ce399-121">RAS also passes in a handle to a window to enable the DLL to present a user interface.</span></span>
-   <span data-ttu-id="ce399-122">Набор указателей функций, которые библиотека DLL может использовать для взаимодействия с сервером.</span><span class="sxs-lookup"><span data-stu-id="ce399-122">A set of function pointers that the DLL can use to communicate with the server.</span></span>

<span data-ttu-id="ce399-123">Дополнительные сведения об этих параметрах см. в разделе [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) .</span><span class="sxs-lookup"><span data-stu-id="ce399-123">See [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) for more information about these parameters.</span></span>

<span data-ttu-id="ce399-124">Служба RAS передает указатель на структуру [**раскустомскриптекстенсионс**](/previous-versions/windows/desktop/legacy/aa376738(v=vs.85)) в качестве последнего параметра в [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span><span class="sxs-lookup"><span data-stu-id="ce399-124">RAS passes a pointer to a [**RASCUSTOMSCRIPTEXTENSIONS**](/previous-versions/windows/desktop/legacy/aa376738(v=vs.85)) structure as the last parameter to [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn).</span></span> <span data-ttu-id="ce399-125">Эта структура содержит указатель на функцию типа [**пфнрассеткоммсеттингс**](/windows/desktop/api/Ras/nc-ras-pfnrassetcommsettings).</span><span class="sxs-lookup"><span data-stu-id="ce399-125">This structure contains a pointer to a function of type [**PFNRASSETCOMMSETTINGS**](/windows/desktop/api/Ras/nc-ras-pfnrassetcommsettings).</span></span> <span data-ttu-id="ce399-126">Библиотека DLL пользовательского скрипта вызывает эту функцию для изменения параметров связи порта, используемого соединением.</span><span class="sxs-lookup"><span data-stu-id="ce399-126">The custom-scripting DLL calls this function to modify the communication settings on the port being used by the connection.</span></span>

<span data-ttu-id="ce399-127">Служба RAS устраняет взаимодействие между сервером и библиотекой DLL пользовательских сценариев.</span><span class="sxs-lookup"><span data-stu-id="ce399-127">RAS mediates the interaction between the server and the custom-scripting DLL.</span></span> <span data-ttu-id="ce399-128">Как правило, сервер инициирует диалоговое окно.</span><span class="sxs-lookup"><span data-stu-id="ce399-128">Typically, the server initiates the dialog.</span></span> <span data-ttu-id="ce399-129">Например, сервер может запросить имя пользователя и пароль пользователя.</span><span class="sxs-lookup"><span data-stu-id="ce399-129">For example, the server may request the user name and password of the user.</span></span>

<span data-ttu-id="ce399-130">Если для установления соединения используется пользовательский сценарий, сервер не должен работать под управлением Windows NT 4,0 или Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="ce399-130">When using custom-scripting to establish a connection, the server need not be running Windows NT 4.0 or Windows 2000.</span></span>

## <a name="custom-scripting-user-interface-must-support-idcancel"></a><span data-ttu-id="ce399-131">Пользовательский интерфейс сценариев должен поддерживать ИДКАНЦЕЛ</span><span class="sxs-lookup"><span data-stu-id="ce399-131">Custom Scripting User Interface Must Support IDCANCEL</span></span>

<span data-ttu-id="ce399-132">Если пользовательский номеронабиратель отображает пользовательский интерфейс, Пользовательский интерфейс должен поддерживать \_ Командные сообщения WM, где ловорд (*wParam*) равняется идканцел.</span><span class="sxs-lookup"><span data-stu-id="ce399-132">If the custom dialer displays a user interface, the user interface must support WM\_COMMAND messages where LOWORD(*wParam*) equals IDCANCEL.</span></span>

## <a name="configuring-the-connection"></a><span data-ttu-id="ce399-133">Настройка подключения</span><span class="sxs-lookup"><span data-stu-id="ce399-133">Configuring the Connection</span></span>

<span data-ttu-id="ce399-134">Точка входа [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) может быть вызвана из [**Расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) или в Windows XP из команды [**rasdial**](/windows/desktop/api/Ras/nf-ras-rasdiala).</span><span class="sxs-lookup"><span data-stu-id="ce399-134">The [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) entry point can be invoked from [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) or, on Windows XP, from [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala).</span></span>

<span data-ttu-id="ce399-135">Чтобы вызвать [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) из [**расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga), установите параметр расео \_ CustomScript в записи телефонной книги для подключения.</span><span class="sxs-lookup"><span data-stu-id="ce399-135">To invoke [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) from [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga), set the RASEO\_CustomScript option in the phone-book entry for the connection.</span></span> <span data-ttu-id="ce399-136">Описание параметров записи телефонной книги см. в разделе **двфоптионс** элемента [**расентри**](/previous-versions/windows/desktop/legacy/aa377274(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="ce399-136">See the **dwfOptions** member of [**RASENTRY**](/previous-versions/windows/desktop/legacy/aa377274(v=vs.85)) for a description of phone-book entry options.</span></span> <span data-ttu-id="ce399-137">Используйте функции [**расжетентрипропертиес**](/windows/desktop/api/Ras/nf-ras-rasgetentrypropertiesa) и [**рассетентрипропертиес**](/windows/desktop/api/Ras/nf-ras-rassetentrypropertiesa) для установки этого параметра программным способом.</span><span class="sxs-lookup"><span data-stu-id="ce399-137">Use the [**RasGetEntryProperties**](/windows/desktop/api/Ras/nf-ras-rasgetentrypropertiesa) and [**RasSetEntryProperties**](/windows/desktop/api/Ras/nf-ras-rassetentrypropertiesa) functions to set this option programmatically.</span></span>

<span data-ttu-id="ce399-138">**Windows XP:** Чтобы вызвать [**раскустомскриптексекуте**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) из [**rasdial**](/windows/desktop/api/Ras/nf-ras-rasdiala), в вызове **rasdial** должна быть указана структура [**расдиалекстенсионс**](/previous-versions/windows/desktop/legacy/aa377029(v=vs.85)) , а в этой структуре должен быть указан \_ флаг рдеопт усекустомскриптинг.</span><span class="sxs-lookup"><span data-stu-id="ce399-138">**Windows XP:** To invoke [**RasCustomScriptExecute**](/windows/desktop/api/Ras/nc-ras-rascustomscriptexecutefn) from [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala), the call to **RasDial** must specify a [**RASDIALEXTENSIONS**](/previous-versions/windows/desktop/legacy/aa377029(v=vs.85)) structure, and this structure must specify the RDEOPT\_UseCustomScripting flag.</span></span> <span data-ttu-id="ce399-139">Кроме того, запись телефонной книги для подключения должна указывать \_ параметр расео CustomScript, как описано в предыдущем абзаце.</span><span class="sxs-lookup"><span data-stu-id="ce399-139">In addition, the phone-book entry for the connection must specify the RASEO\_CustomScript option as described in the preceding paragraph.</span></span>

## <a name="invoking-the-custom-scripting-dll"></a><span data-ttu-id="ce399-140">Вызов библиотеки DLL пользовательских скриптов</span><span class="sxs-lookup"><span data-stu-id="ce399-140">Invoking the Custom Scripting DLL</span></span>

<span data-ttu-id="ce399-141">Если пользователь активирует подключение для записи телефонной книги, в которой \_ установлен расео CustomScript, служба RAS вызывает библиотеку DLL пользовательского сценария.</span><span class="sxs-lookup"><span data-stu-id="ce399-141">If the user activates a connection for a phone-book entry that has RASEO\_CustomScript set, RAS invokes the custom-scripting DLL.</span></span> <span data-ttu-id="ce399-142">В этом сценарии служба RAS вызывает библиотеку DLL пользовательского скрипта из [**расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga).</span><span class="sxs-lookup"><span data-stu-id="ce399-142">In this scenario, RAS invokes the custom-scripting DLL from [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga).</span></span>

<span data-ttu-id="ce399-143">Для программного вызова библиотеки DLL пользовательского сценария установите соединение с помощью функции [**расдиалдлг**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) .</span><span class="sxs-lookup"><span data-stu-id="ce399-143">To invoke the custom-scripting DLL programmatically, establish the connection using the [**RasDialDlg**](/windows/desktop/api/Rasdlg/nf-rasdlg-rasdialdlga) function.</span></span> <span data-ttu-id="ce399-144">В Windows XP функция [**rasdial**](/windows/desktop/api/Ras/nf-ras-rasdiala) также вызывает библиотеку DLL пользовательского сценария.</span><span class="sxs-lookup"><span data-stu-id="ce399-144">On Windows XP, the [**RasDial**](/windows/desktop/api/Ras/nf-ras-rasdiala) function also invokes the custom-scripting DLL.</span></span>

 

 