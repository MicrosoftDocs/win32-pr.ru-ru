---
title: Функция Ртмаддрауте (RTM. h)
description: Функция Ртмаддрауте добавляет запись маршрута или обновляет существующую запись маршрута.
ms.assetid: 09a9b57d-f10b-40b7-a3c1-2e0613f29431
keywords:
- RAS функции Ртмаддрауте
topic_type:
- apiref
api_name:
- RtmAddRoute
api_location:
- Rtm.dll
api_type:
- DllExport
ms.topic: reference
ms.date: 05/31/2018
ms.openlocfilehash: d36b96e94ba2803664e3ff4c4fce6f4f95317c33ce5ab9ccd755c95c8d23fa21
ms.sourcegitcommit: e6600f550f79bddfe58bd4696ac50dd52cb03d7e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "120035934"
---
# <a name="rtmaddroute-function"></a>Функция Ртмаддрауте

\[этот api был заменен api [диспетчера таблиц маршрутизации версии 2](about-routing-table-manager-version-2.md) и не будет доступен за пределами Windows Server 2003. Приложения должны использовать API диспетчера таблиц маршрутизации версии 2.\]

Функция **ртмаддрауте** добавляет запись маршрута или обновляет существующую запись маршрута.

## <a name="syntax"></a>Синтаксис


```C++
DWORD RtmAddRoute(
  _In_  HANDLE ClientHandle,
  _In_  PVOID  Route,
  _In_  DWORD  TimeToLive,
  _Out_ DWORD  Flags,
  _Out_ PVOID  CurBestRoute,
  _Out_ PVOID  PrevBestRoute
);
```



## <a name="parameters"></a>Параметры

<dl> <dt>

*Клиенсандле* \[ окне\]
</dt> <dd>

Маркер, идентифицирующий клиента, и, следовательно, протокол маршрутизации, который добавил или обновил маршрут. Получите этот обработчик путем вызова [**ртмрегистерклиент**](rtmregisterclient.md).

</dd> <dt>

*Маршрут* \[ окне\]
</dt> <dd>

Указатель на структуру, относящуюся к конкретному семейству протоколов, которая указывает новый или обновленный маршрут. Диспетчер таблиц маршрутизации использует следующие поля для обновления таблицы маршрутизации.



| Значение                                                                                                                                                                                                                                 | Значение                                                                                                                                                                                                                                                                                                                                                                                                   |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="RR_Network"></span><span id="rr_network"></span><span id="RR_NETWORK"></span><dl> <dt>**RR, \_ сеть**</dt> </dl>                                                     | Указывает номер сети назначения.<br/>                                                                                                                                                                                                                                                                                                                                                      |
| <span id="RR_InterfaceID"></span><span id="rr_interfaceid"></span><span id="RR_INTERFACEID"></span><dl> <dt>**RR \_ InterfaceID**</dt> </dl>                                     | Указывает индекс интерфейса, через который был получен маршрут.<br/>                                                                                                                                                                                                                                                                                                                     |
| <span id="RR_NextHopAddress"></span><span id="rr_nexthopaddress"></span><span id="RR_NEXTHOPADDRESS"></span><dl> <dt>**RR \_ некссопаддресс**</dt> </dl>                         | Указывает адрес маршрутизатора следующего прыжка.<br/>                                                                                                                                                                                                                                                                                                                                                  |
| <span id="RR_FamilySpecificData"></span><span id="rr_familyspecificdata"></span><span id="RR_FAMILYSPECIFICDATA"></span><dl> <dt>**RR \_ фамилиспеЦификдата**</dt> </dl>         | Указывает данные, относящиеся к семейству протоколов. Хотя данные являются прозрачными для диспетчера таблиц маршрутизации, они рассматриваются при сравнении маршрутов, чтобы определить, изменились ли сведения о маршруте. Данные также используются для задания значений метрик, которые не зависят от протокола маршрутизации. Следовательно, эти данные используются для определения наилучшего маршрута для целевой сети.<br/> |
| <span id="RR_ProtocolSpecificData"></span><span id="rr_protocolspecificdata"></span><span id="RR_PROTOCOLSPECIFICDATA"></span><dl> <dt>**RR \_ протоколспеЦификдата**</dt> </dl> | Указывает данные, относящиеся к протоколу маршрутизации, который предоставляет маршрут.<br/>                                                                                                                                                                                                                                                                                                              |
| <span id="RR_TimeStamp"></span><span id="rr_timestamp"></span><span id="RR_TIMESTAMP"></span><dl> <dt>**\_Метка времени RR**</dt> </dl>                                             | Указывает текущее системное время. Это поле задается диспетчером таблиц маршрутизации.<br/>                                                                                                                                                                                                                                                                                                             |



 

</dd> <dt>

*TimeToLive* \[ окне\]
</dt> <dd>

Указывает количество секунд, в течение которых указанный маршрут должен храниться в таблице маршрутизации. Если этот параметр имеет значение INFINITE, маршрут сохраняется до тех пор, пока он не будет явно удален. Текущее ограничение для *TimeToLive* — 2147483 сек (24 + дн.).

</dd> <dt>

*Флаги* \[ заполняет\]
</dt> <dd>

Указатель на переменную **типа DWORD** . Значение этой переменной задается диспетчером таблиц маршрутизации. Значение указывает тип изменения и сведения, возвращенные в предоставленных буферах. Этот параметр является одним из следующих.



| Флаги                                                                                                                                                                      | Значение                                                                                                                                                                                                                                                                                                    |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="RTM_NO_CHANGE"></span><span id="rtm_no_change"></span><dl> <dt>**RTM — \_ нет \_ изменений**</dt> </dl>             | Добавление или обновление либо не изменило какие-либо существенные параметры маршрута, либо запись маршрута не является лучшим маршрутом между записями для целевой сети.<br/>                                                                                                          |
| <span id="RTM_ROUTE_ADDED"></span><span id="rtm_route_added"></span><dl> <dt>**\_добавлен маршрут \_ RTM**</dt> </dl>       | Маршрут был добавлен для целевой сети. Параметр *курбестрауте* указывает на сведения для добавленного маршрута.<br/>                                                                                                                                                                    |
| <span id="RTM_ROUTE_CHANGED"></span><span id="rtm_route_changed"></span><dl> <dt>**\_маршрут RTM \_ изменен**</dt> </dl> | По крайней мере один из значимых параметров был изменен для лучшего маршрута к целевой сети. Значимые параметры: <br/> Идентификатор протокола<br/> Индекс интерфейса<br/> Адрес следующего прыжка<br/> Данные, относящиеся к семейству протоколов (включая метрики маршрута)<br/> |



 

Параметр *превбестрауте* указывает на сведения о маршруте, которые были перед изменением. Параметр *курбестрауте* указывает на текущие сведения о маршруте (то есть после изменения).

</dd> <dt>

*Курбестрауте* \[ заполняет\]
</dt> <dd>

Указатель на структуру, которая получает текущие сведения о наилучшем маршруте, если таковые имеются. Тип структуры зависит от семейства протоколов, например IP или IPX.

Это необязательный параметр. Если вызывающий объект задает для этого параметра **значение NULL** , текущие сведения о наилучшем маршруте не возвращаются.

</dd> <dt>

*Превбестрауте* \[ заполняет\]
</dt> <dd>

Указатель на структуру, которая получает предыдущие сведения о наилучшем маршруте, если таковые имеются. Тип структуры зависит от семейства протоколов, например IP или IPX.

Это необязательный параметр. Если вызывающий объект задает **значение NULL** для этого параметра, предыдущие сведения о наилучшем маршруте не возвращаются.

</dd> </dl>

## <a name="return-value"></a>Возвращаемое значение

Возвращаемое значение является одним из следующих кодов.



| Значение                                                                                                       | Описание                                                             |
|-------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
| <dl> <dt>**БЕЗ \_ ошибок**</dt> </dl>                    | Маршрут был успешно добавлен или обновлен.<br/>                 |
| <dl> <dt>**Ошибка \_ недопустимого \_ маркера**</dt> </dl>       | Параметр "Handle" клиента не является допустимым маркером.<br/>           |
| <dl> <dt>**Ошибка \_ недопустимого \_ параметра**</dt> </dl>    | Структура маршрута содержит недопустимый параметр.<br/>           |
| <dl> <dt>**\_нет \_ системных \_ ресурсов**</dt> </dl> | Недостаточно ресурсов для выполнения операции.<br/> |
| <dl> <dt>**Ошибка \_ не \_ хватает \_ памяти**</dt> </dl>   | Недостаточно памяти для выделения записи маршрута.<br/>    |



 

## <a name="remarks"></a>Remarks

Функция создает сообщение об изменении маршрута, если в результате этой операции был изменен оптимальный маршрут к целевой сети. Тем не менее сообщение маршрута-Change не отправляется клиенту, который выполняет этот вызов. Вместо этого соответствующая информация возвращается этой функцией непосредственно этому клиенту с помощью параметров *flags*, *курбестрауте* и *превбестрауте* .

## <a name="requirements"></a>Requirements (Требования)



| Требование | Значение |
|-------------------------------------|------------------------------------------------------------------------------------|
| Минимальная версия клиента<br/> | Ни одна версия не поддерживается<br/>                                                          |
| Минимальная версия сервера<br/> | Windows 2000 Server \[только классические приложения\]<br/>                               |
| Поддержка конца сервера<br/>    | Windows Server 2003<br/>                                                     |
| Заголовок<br/>                   | <dl> <dt>RTM. h</dt> </dl>   |
| Библиотека<br/>                  | <dl> <dt>RTM. lib</dt> </dl> |
| DLL<br/>                      | <dl> <dt>Rtm.dll</dt> </dl> |



## <a name="see-also"></a>См. также

<dl> <dt>

[Справочник по диспетчеру таблиц маршрутизации версии 1](routing-table-manager-version-1-reference.md)
</dt> <dt>

[Функции диспетчера таблиц маршрутизации версии 1](routing-table-manager-version-1-functions.md)
</dt> <dt>

[**ртмделетерауте**](rtmdeleteroute.md)
</dt> <dt>

[**ртмдекуеуераутечанжемессаже**](rtmdequeueroutechangemessage.md)
</dt> </dl>

 

 





