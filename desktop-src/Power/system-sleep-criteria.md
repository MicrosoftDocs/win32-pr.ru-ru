---
description: При условии, что система определяет активность пользователя или приложения, она не будет переходить в спящий режим.
ms.assetid: 83c9394a-1813-405a-802a-0623e5de50d3
title: Критерии спящего режима системы
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b90950b980ec1e0fa06171d7a57d76b410534f96
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103813777"
---
# <a name="system-sleep-criteria"></a><span data-ttu-id="00cfb-103">Критерии спящего режима системы</span><span class="sxs-lookup"><span data-stu-id="00cfb-103">System Sleep Criteria</span></span>

<span data-ttu-id="00cfb-104">При условии, что система определяет активность пользователя или приложения, она не будет переходить в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="00cfb-104">As long as the system determines that there is user or application activity, it will not enter sleep.</span></span> <span data-ttu-id="00cfb-105">Система может обнаруживать определенные действия, такие как ввод данных пользователем или сетевая связь.</span><span class="sxs-lookup"><span data-stu-id="00cfb-105">The system can detect certain activities, such as user input or network communications.</span></span> <span data-ttu-id="00cfb-106">Однако существуют и другие действия, которые система не может обнаружить.</span><span class="sxs-lookup"><span data-stu-id="00cfb-106">However, there are other activities that the system cannot detect.</span></span> <span data-ttu-id="00cfb-107">Например, приложение презентации требует отображения экрана.</span><span class="sxs-lookup"><span data-stu-id="00cfb-107">For example, a presentation application requires the screen for display.</span></span> <span data-ttu-id="00cfb-108">Однако может показаться, что приложение бездействует во время презентации, что приводит к выключению экрана.</span><span class="sxs-lookup"><span data-stu-id="00cfb-108">However, it may appear that the application is idle during the presentation, causing the system to turn off the display.</span></span>

<span data-ttu-id="00cfb-109">Чтобы уведомить систему о том, что приложение занято, используйте функцию [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate) .</span><span class="sxs-lookup"><span data-stu-id="00cfb-109">To notify the system that your application is busy, use the [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate) function.</span></span> <span data-ttu-id="00cfb-110">Эта функция предотвращает переход системы в спящий режим или отключение дисплея во время работы приложения.</span><span class="sxs-lookup"><span data-stu-id="00cfb-110">This function prevents the system from entering sleep or turning off the display while the application is running.</span></span>

<span data-ttu-id="00cfb-111">Приложения для представления и мультимедиа должны вызывать функцию [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate) с параметром ES, чтобы система могла убедиться в том, что не следует переводить устройство отображения в спящий режим. **\_ \_**</span><span class="sxs-lookup"><span data-stu-id="00cfb-111">Presentation and multimedia applications must call the [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate) function with **ES\_DISPLAY\_REQUIRED** so that the system will know that it should not put the display device to sleep.</span></span> <span data-ttu-id="00cfb-112">Приложения обработки событий, такие как средства для управления входящими факсами, должны вызывать **SetThreadExecutionState** с **\_ системой ES \_**, обрабатывать событие, а затем очищать флаг, чтобы система могла вернуться в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="00cfb-112">Event-handling applications, such as tools for managing incoming faxes, must call **SetThreadExecutionState** with **ES\_SYSTEM\_REQUIRED**, handle the event, and then clear the flag so the system can return to sleep.</span></span> <span data-ttu-id="00cfb-113">Обратите внимание, что большинству приложений для повышения производительности не требуется использовать **SetThreadExecutionState** , так как система может обычно определять действия путем ввода данных пользователем.</span><span class="sxs-lookup"><span data-stu-id="00cfb-113">Note that most productivity applications do not need to use **SetThreadExecutionState** because the system can usually determine activity by user input.</span></span>

<span data-ttu-id="00cfb-114">Чтобы сохранить время с момента последнего ввода данных пользователем, система использует таймер простоя экрана и таймер простоя системы.</span><span class="sxs-lookup"><span data-stu-id="00cfb-114">To maintain the time since the last user input, the system uses a display idle timer and a system idle timer.</span></span> <span data-ttu-id="00cfb-115">Система сравнивает неактивные таймеры со значениями, настроенными в схеме управления питанием.</span><span class="sxs-lookup"><span data-stu-id="00cfb-115">The system compares the idle timers to the values configured in the power plan.</span></span> <span data-ttu-id="00cfb-116">Если значение таймера "Отображение" в режиме простоя больше, чем значение времени ожидания, и ни один из потоков не запросил отображение, вызвав [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate) с параметром " **\_ Показать не \_ требуется**", система выключает экран.</span><span class="sxs-lookup"><span data-stu-id="00cfb-116">If the display idle timer value is greater than the display time-out value, and no threads have requested the display by calling [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate) with **ES\_DISPLAY\_REQUIRED**, the system powers off the display.</span></span> <span data-ttu-id="00cfb-117">Аналогично, если таймер простоя системы превышает значение времени ожидания системы, а приложения не запрашивают систему путем вызова **SetThreadExecutionState** с помощью **\_ системы ES \_**, система переходит в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="00cfb-117">Similarly, if the system idle timer is greater than the system time-out value and no applications have requested the system by calling **SetThreadExecutionState** with **ES\_SYSTEM\_REQUIRED**, the system enters sleep.</span></span>

<span data-ttu-id="00cfb-118">Система поддерживает число приложений с именем [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate).</span><span class="sxs-lookup"><span data-stu-id="00cfb-118">The system maintains a count of applications that have called [**SetThreadExecutionState**](/windows/desktop/api/Winbase/nf-winbase-setthreadexecutionstate).</span></span> <span data-ttu-id="00cfb-119">Система отслеживает каждый поток, который вызывает **SetThreadExecutionState** , и соответствующим образом корректирует счетчик.</span><span class="sxs-lookup"><span data-stu-id="00cfb-119">The system tracks each thread that calls **SetThreadExecutionState** and adjusts the counter accordingly.</span></span> <span data-ttu-id="00cfb-120">Если этот счетчик достигнет нуля и входные данные не были введены пользователем, система переходит в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="00cfb-120">If this counter reaches zero and there has not been any user input, the system enters sleep.</span></span>

<span data-ttu-id="00cfb-121">Если уровень питания низкий, приложение может запросить вмешательство пользователя или запросить, что система приостанавливает работу.</span><span class="sxs-lookup"><span data-stu-id="00cfb-121">If power is low, an application can request user intervention or request that the system suspend itself.</span></span> <span data-ttu-id="00cfb-122">Можно приостановить работу системы с помощью функции [**сетсуспендстате**](/windows/desktop/api/PowrProf/nf-powrprof-setsuspendstate) .</span><span class="sxs-lookup"><span data-stu-id="00cfb-122">You can suspend system operation by using the [**SetSuspendState**](/windows/desktop/api/PowrProf/nf-powrprof-setsuspendstate) function.</span></span>

<span data-ttu-id="00cfb-123">Если система автоматически пробуждается ([ПБТ \_ апмресумеаутоматик](pbt-apmresumeautomatic.md)), ни один из таймеров не важен.</span><span class="sxs-lookup"><span data-stu-id="00cfb-123">If the system wakes automatically ([PBT\_APMRESUMEAUTOMATIC](pbt-apmresumeautomatic.md)), none of the timers are relevant.</span></span> <span data-ttu-id="00cfb-124">Дополнительные сведения см. в разделе [системные события пробуждения](system-wake-up-events.md).</span><span class="sxs-lookup"><span data-stu-id="00cfb-124">For more information, see [System Wake-up Events](system-wake-up-events.md).</span></span>

## <a name="entering-sleep"></a><span data-ttu-id="00cfb-125">Переход в спящий режим</span><span class="sxs-lookup"><span data-stu-id="00cfb-125">Entering Sleep</span></span>

<span data-ttu-id="00cfb-126">Когда система переходит в спящий режим, она автоматически сохраняет состояние всей системы и всех приложений.</span><span class="sxs-lookup"><span data-stu-id="00cfb-126">When the system enters sleep, it will automatically preserve the state of the entire system and all applications.</span></span> <span data-ttu-id="00cfb-127">Поэтому большинству приложений не нужно предпринимать никаких специальных действий.</span><span class="sxs-lookup"><span data-stu-id="00cfb-127">Therefore, most applications do not need to take any special action.</span></span> <span data-ttu-id="00cfb-128">Приложения, которым необходимо выполнять определенные действия до того, как системные переходы могут зарегистрироваться для включения событий питания.</span><span class="sxs-lookup"><span data-stu-id="00cfb-128">Applications that need to perform specific actions before the system transitions can register for power events.</span></span>

<span data-ttu-id="00cfb-129">Когда система отправляет событие [ПБТ \_ апмсуспенд](pbt-apmsuspend.md) , у каждого приложения есть две секунды для выполнения необходимых действий до того, как система начнет переход в спящий режим.</span><span class="sxs-lookup"><span data-stu-id="00cfb-129">When the system sends a [PBT\_APMSUSPEND](pbt-apmsuspend.md) event, each application has two seconds to perform any necessary actions before the system starts the transition to sleep.</span></span> <span data-ttu-id="00cfb-130">Приложения должны ограничить действия, которые они принимают в ответ на это событие, чтобы убедиться, что они завершают все операции за отведенное время.</span><span class="sxs-lookup"><span data-stu-id="00cfb-130">Applications must limit what action they take in response to this event to ensure that they complete all operations in the time allotted.</span></span>

## <a name="related-topics"></a><span data-ttu-id="00cfb-131">См. также</span><span class="sxs-lookup"><span data-stu-id="00cfb-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="00cfb-132">Сведения об управлении питанием</span><span class="sxs-lookup"><span data-stu-id="00cfb-132">About Power Management</span></span>](about-power-management.md)
</dt> <dt>

[<span data-ttu-id="00cfb-133">События пробуждения системы</span><span class="sxs-lookup"><span data-stu-id="00cfb-133">System Wake-up Events</span></span>](system-wake-up-events.md)
</dt> </dl>

 

 



