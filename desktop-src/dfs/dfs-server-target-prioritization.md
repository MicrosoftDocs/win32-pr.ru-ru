---
title: Приоритетность целевого сервера DFS
description: Приоритетность целевого сервера DFS — это функция, доступная в Microsoft Windows Server 2003 с пакетом обновления 1 (SP1) и более поздних операционных системах.
ms.assetid: 0aacebf7-49cc-4287-a5c4-0d25a416d227
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3e784a540a67f624ca5b8075009cd862c6063427
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104262757"
---
# <a name="dfs-server-target-prioritization"></a><span data-ttu-id="f35e8-103">Приоритетность целевого сервера DFS</span><span class="sxs-lookup"><span data-stu-id="f35e8-103">DFS Server Target Prioritization</span></span>

<span data-ttu-id="f35e8-104">Приоритетность целевого сервера DFS — это функция, доступная в Microsoft Windows Server 2003 с пакетом обновления 1 (SP1) и более поздних операционных системах.</span><span class="sxs-lookup"><span data-stu-id="f35e8-104">DFS Server Target Prioritization is a feature available in Microsoft Windows Server 2003 with Service Pack 1 (SP1) and later operating systems.</span></span> <span data-ttu-id="f35e8-105">Эта функция позволяет серверам DFS использовать преимущества доступных Active Directory сведения о стоимости сайта для определения приоритетов целевых объектов в ссылках клиентов.</span><span class="sxs-lookup"><span data-stu-id="f35e8-105">This feature enables DFS servers to take advantage of available Active Directory site-cost information to prioritize the targets in client referrals.</span></span>

<span data-ttu-id="f35e8-106">До Windows Server 2003 с пакетом обновления 1 (SP1) целевые объекты были сгруппированы в два набора: одну группу, содержащую все целевые объекты на одном сайте с клиентом. и другая группа для всех остальных целевых объектов.</span><span class="sxs-lookup"><span data-stu-id="f35e8-106">Before Windows Server 2003 with SP1, targets were grouped into two sets: one group for containing all targets in the same site as the client; and another group for all other targets.</span></span> <span data-ttu-id="f35e8-107">Эти целевые объекты, использующие тот же сайт, что и клиент, называются "внутри сайта", и если стоимость сайта включена, им назначается определенное значение стоимости, соответствующее общему сайту, с меньшими затратами на сайт выше.</span><span class="sxs-lookup"><span data-stu-id="f35e8-107">Those targets sharing the same site as the client are called "in-site", and if site-costing is enabled, they are assigned a specific cost value relative to the site overall, with lower site costs preferred over higher ones.</span></span>

<span data-ttu-id="f35e8-108">Благодаря доступности данных о затратах на сайт, целевые объекты сервера можно назначать приоритету для более эффективных стратегий отработки отказа сервера DFS.</span><span class="sxs-lookup"><span data-stu-id="f35e8-108">With the availability of this site-costing data, server targets can be prioritized for more effective DFS server failover strategies.</span></span> <span data-ttu-id="f35e8-109">В прошлом этот детализированный уровень детализации был недоступен, и администраторам пришлось прибегнуть к искусственным средствам (например, фиктивным сайтам в AD) для поддержки даже простых требований, таких как обозначение конкретных серверов в качестве резервного или дополнительного сервера в случае сбоя основного сервера DFS.</span><span class="sxs-lookup"><span data-stu-id="f35e8-109">In the past, this granular level of detail was not available, and administrators had to resort to artificial means (such as dummy sites in AD) to support even simple requirements like the designation of specific servers as a "backup" or "secondary" server in the case where a "primary" DFS server fails.</span></span> <span data-ttu-id="f35e8-110">Теперь с дополнительными сведениями, предоставляемыми по стоимости сайта, можно реализовать многоуровневые стратегии отработки отказа.</span><span class="sxs-lookup"><span data-stu-id="f35e8-110">Now, with the additional detail provided by site-costing, multi-level failover strategies are possible.</span></span>

<span data-ttu-id="f35e8-111">В следующем обсуждении предполагается, что стоимость сайта включена.</span><span class="sxs-lookup"><span data-stu-id="f35e8-111">The following discussion assumes that site-costing is enabled.</span></span>

## <a name="target-prioritization"></a><span data-ttu-id="f35e8-112">Целевое определение приоритетов</span><span class="sxs-lookup"><span data-stu-id="f35e8-112">Target Prioritization</span></span>

<span data-ttu-id="f35e8-113">Приоритет целевого объекта — это конкретное упорядочение с точки зрения администрирования, классификация и ранжирование серверов внутри сайта с точки зрения явных предпочтений на основе стоимости сайта с клиента DFS.</span><span class="sxs-lookup"><span data-stu-id="f35e8-113">Target priority is a specific ordering from an administrative perspective, classifying and ranking in-site servers in terms of explicit preference based on their site cost from a DFS client.</span></span> <span data-ttu-id="f35e8-114">Глобальный приоритет не зависит от стоимости сайта.</span><span class="sxs-lookup"><span data-stu-id="f35e8-114">Global priority is independent of the site-cost.</span></span> <span data-ttu-id="f35e8-115">Обратите внимание, что классы глобальных приоритетов не обязательно указывают наиболее оптимальные целевые объекты с точки зрения клиента DFS, но отражают важность или отсутствие важности конкретных целевых объектов с точки зрения администратора сайта.</span><span class="sxs-lookup"><span data-stu-id="f35e8-115">Note that global priority classes do not necessarily indicate the most optimal targets from a DFS client's perspective, but instead reflect the importance, or lack of importance, of specific targets from a site administrator's perspective.</span></span>

<span data-ttu-id="f35e8-116">Приоритет целевого сервера делится на две категории значений: приоритетный класс и ранг приоритета.</span><span class="sxs-lookup"><span data-stu-id="f35e8-116">Server target priority is divided into two value categories: priority class and priority rank.</span></span> <span data-ttu-id="f35e8-117">Классы приоритета делятся на два уровня: локальные и глобальные.</span><span class="sxs-lookup"><span data-stu-id="f35e8-117">Priority classes are divided into two levels: local and global.</span></span> <span data-ttu-id="f35e8-118">В этих классах существует грубое упорядочивание целевых объектов на основе стоимости сайта, сгруппированной как высокий, нормальный и низкий приоритет.</span><span class="sxs-lookup"><span data-stu-id="f35e8-118">Within these classes there is a rough ordering of targets based on site cost, grouped as high, normal, and low priority.</span></span> <span data-ttu-id="f35e8-119">Результатом является пять классов приоритета в порядке от самого высокого до самого низкого приоритета следующим образом:</span><span class="sxs-lookup"><span data-stu-id="f35e8-119">The result is five priority classes, in order from highest to lowest priority as follows:</span></span>

- <span data-ttu-id="f35e8-120">Глобальный высокий приоритет</span><span class="sxs-lookup"><span data-stu-id="f35e8-120">Global high priority</span></span>
- <span data-ttu-id="f35e8-121">Сайт-стоимость с высоким приоритетом</span><span class="sxs-lookup"><span data-stu-id="f35e8-121">Site-cost high priority</span></span>
- <span data-ttu-id="f35e8-122">Сайт-затраты на нормальный приоритет</span><span class="sxs-lookup"><span data-stu-id="f35e8-122">Site-cost normal priority</span></span>
- <span data-ttu-id="f35e8-123">Сайт-стоимость с низким приоритетом</span><span class="sxs-lookup"><span data-stu-id="f35e8-123">Site-cost low priority</span></span>
- <span data-ttu-id="f35e8-124">Глобальный низкий приоритет</span><span class="sxs-lookup"><span data-stu-id="f35e8-124">Global low priority</span></span>

<span data-ttu-id="f35e8-125">Классы стоимости сайта можно рассматривать как подразделы "глобальный приоритет".</span><span class="sxs-lookup"><span data-stu-id="f35e8-125">The site-cost classes can be considered as subdivisions of "global normal priority".</span></span> <span data-ttu-id="f35e8-126">Ранг приоритета — это простое целочисленное ранжирование на основе порядковых значений: 0, 1, 2 и @ @, где 0 — наибольшее значение, а все последующие значения, указывающие на уменьшение ранга.</span><span class="sxs-lookup"><span data-stu-id="f35e8-126">Priority rank is a simple integer ranking based on ordinal values: 0, 1, 2, and onward, with 0 being the highest value and all subsequent values indicating decreasing rank.</span></span>

<span data-ttu-id="f35e8-127">Глобальные высокие и низкие приоритеты не учитывают значения стоимости сайта.</span><span class="sxs-lookup"><span data-stu-id="f35e8-127">The global high and low priorities do not consider site-cost values.</span></span> <span data-ttu-id="f35e8-128">Целевые объекты с глобально высоким приоритетом получают приоритет над всеми другими целевыми объектами, а целевые объекты с глобальным низким приоритетом получают наименьший уровень предпочтения.</span><span class="sxs-lookup"><span data-stu-id="f35e8-128">Targets with a global high priority receive preference over all other targets, and targets with a global low priority receive the least preference.</span></span>

<span data-ttu-id="f35e8-129">При упорядочении ссылки полный процесс выполняет следующие действия.</span><span class="sxs-lookup"><span data-stu-id="f35e8-129">In ordering a referral, the complete process has the following steps:</span></span>

1. <span data-ttu-id="f35e8-130">Определяются наборы глобальных высоких и младших целевых объектов, а также оставшиеся "глобальные обычные" целевые объекты.</span><span class="sxs-lookup"><span data-stu-id="f35e8-130">The sets of global high and low targets are identified, along with the remaining "global normal" targets.</span></span>
2. <span data-ttu-id="f35e8-131">Если задан параметр "сайт", все целевые объекты, находящиеся за пределами сайта клиента, будут удалены.</span><span class="sxs-lookup"><span data-stu-id="f35e8-131">If the "INSITE" option is set, all targets outside of the client's site are removed.</span></span> <span data-ttu-id="f35e8-132">Параметр "сайт" не применяется к глобальным высоким и низким приоритетам.</span><span class="sxs-lookup"><span data-stu-id="f35e8-132">The "INSITE" option is not applied to the global high and low priority sets.</span></span>
3. <span data-ttu-id="f35e8-133">В каждом из этих трех наборов целевые объекты упорядочиваются с помощью механизма "AD — затраты на сайт", используя как локальные, так и полные ресурсы.</span><span class="sxs-lookup"><span data-stu-id="f35e8-133">Within each of these three sets, the targets are ordered using the AD site-cost mechanism, using either local or full site costing.</span></span> <span data-ttu-id="f35e8-134">Результатом являются наборы целевых объектов равной стоимости сайта.</span><span class="sxs-lookup"><span data-stu-id="f35e8-134">The result is sets of targets of equal site cost.</span></span>
4. <span data-ttu-id="f35e8-135">В наборах "глобальных обычных" целевых объектов равных затратах на сайт целевым объектам назначается класс приоритета с высоким, нормальным и низким приоритетным рангом.</span><span class="sxs-lookup"><span data-stu-id="f35e8-135">Within the sets of "global normal" targets of equal site cost, targets are assigned a priority class from the site-cost high, normal, and low priority rankings.</span></span>
5. <span data-ttu-id="f35e8-136">В наборах целевых объектов с равными затратами и приоритетами сайтов целевые объекты теперь упорядочиваются по рангу приоритета, а 0 — с наибольшим рангом.</span><span class="sxs-lookup"><span data-stu-id="f35e8-136">Within the sets of targets of equal site cost and priority class, targets are now ordered by priority rank, with 0 being the highest rank.</span></span>
6. <span data-ttu-id="f35e8-137">В наборах целевых объектов равной стоимости сайта, приоритетного класса и ранга приоритета целевые объекты случайным образом перемещаются в случайном порядке для балансировки нагрузки.</span><span class="sxs-lookup"><span data-stu-id="f35e8-137">Within the sets of targets of equal site cost, priority class, and priority rank, targets are randomly shuffled for load balancing.</span></span>

<span data-ttu-id="f35e8-138">В графическом виде набор целевых объектов упорядочивается, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="f35e8-138">Graphically, a set of targets are ordered as seen below:</span></span>

- <span data-ttu-id="f35e8-139">целевые объекты глобального приоритета класса</span><span class="sxs-lookup"><span data-stu-id="f35e8-139">global high priority class targets</span></span> 
- <span data-ttu-id="f35e8-140">целевые объекты класса с высоким приоритетом стоимости сайта с ценой сайта = 0</span><span class="sxs-lookup"><span data-stu-id="f35e8-140">site-cost high priority class targets with site cost = 0</span></span>
- <span data-ttu-id="f35e8-141">Обычная с ценой сайта = 0</span><span class="sxs-lookup"><span data-stu-id="f35e8-141">normal with site cost = 0</span></span>
- <span data-ttu-id="f35e8-142">низкая с ценой сайта = 0</span><span class="sxs-lookup"><span data-stu-id="f35e8-142">low with site cost = 0</span></span>
- <span data-ttu-id="f35e8-143">целевые объекты класса с высоким приоритетом стоимости сайта с ценой сайта = 1</span><span class="sxs-lookup"><span data-stu-id="f35e8-143">site-cost high priority class targets with site cost = 1</span></span>
- <span data-ttu-id="f35e8-144">Обычная с ценой сайта = 1</span><span class="sxs-lookup"><span data-stu-id="f35e8-144">normal with site cost = 1</span></span>
- <span data-ttu-id="f35e8-145">низкая с ценой сайта = 1</span><span class="sxs-lookup"><span data-stu-id="f35e8-145">low with site cost = 1</span></span>
- <span data-ttu-id="f35e8-146">И многое другое</span><span class="sxs-lookup"><span data-stu-id="f35e8-146">and so on</span></span>
- <span data-ttu-id="f35e8-147">целевые объекты глобального класса с низким приоритетом</span><span class="sxs-lookup"><span data-stu-id="f35e8-147">global low priority class targets</span></span>

<span data-ttu-id="f35e8-148">В каждом из этих наборов целевые объекты сортируются в соответствии с рангом приоритета.</span><span class="sxs-lookup"><span data-stu-id="f35e8-148">Within each of these sets, targets are sorted according to priority rank.</span></span> <span data-ttu-id="f35e8-149">Наибольший ранг равен нулю, при этом каждое последующее целочисленное значение (1, 2 и т. д.) указывает на более низкий ранг.</span><span class="sxs-lookup"><span data-stu-id="f35e8-149">The highest rank is zero, with each subsequent integer value (1, 2, and so on) indicating an increasingly lower rank.</span></span>

<span data-ttu-id="f35e8-150">Приоритет целевого объекта задается для определенного целевого объекта ссылки (или корня) в пространстве имен DFS.</span><span class="sxs-lookup"><span data-stu-id="f35e8-150">Target priority is set on a specific target of a link (or root) in a DFS namespace.</span></span> <span data-ttu-id="f35e8-151">Приоритет целевого объекта для одной ссылки не влияет на порядок других ссылок, если этот целевой путь используется несколько раз.</span><span class="sxs-lookup"><span data-stu-id="f35e8-151">A target's priority for one link does not influence the ordering of other links if that same target path is used multiple times.</span></span> <span data-ttu-id="f35e8-152">Например, если две ссылки имеют \\ \\ share1 сервера в \\ качестве целевого объекта, приоритет \\ \\ share1 сервера устанавливается \\ отдельно для обеих ссылок.</span><span class="sxs-lookup"><span data-stu-id="f35e8-152">For example, if two links have \\\\server\\share1 as a target, the priority of \\\\server\\share1 is set separately for both links.</span></span>

<span data-ttu-id="f35e8-153">Приоритет по умолчанию для всех связей — это обычная приоритетная стоимость сайта с рангом 0.</span><span class="sxs-lookup"><span data-stu-id="f35e8-153">The default priority for all links is the site-cost normal priority with a rank of 0.</span></span> <span data-ttu-id="f35e8-154">Приоритет целевого объекта не влияет на порядок ссылок, если он не используется, и все существующие ссылки упорядочиваются по мере их получения.</span><span class="sxs-lookup"><span data-stu-id="f35e8-154">Target priority does not affect the ordering of referrals unless it is used, and all existing links are ordered as they are received.</span></span>

<span data-ttu-id="f35e8-155">Ссылочный ответ от сервера DFS состоит из наборов целей, упорядоченных, как указано выше, с каждым неглобальным набором целей, содержащим цели тех же затрат на сайт, класс приоритета и ранг приоритета.</span><span class="sxs-lookup"><span data-stu-id="f35e8-155">The referral response from a DFS server consists of target sets ordered as indicated above, with each non-global target set containing targets of the same site cost, priority class, and priority rank.</span></span> <span data-ttu-id="f35e8-156">Целевые объекты в каждом наборе упорядочиваются случайным образом.</span><span class="sxs-lookup"><span data-stu-id="f35e8-156">Targets within each set are ordered randomly.</span></span> <span data-ttu-id="f35e8-157">Клиенты DFS, получающие ссылку, начинаются с первого целевого объекта первого набора и пропускают список до тех пор, пока не будет найден доступная цель для данного корня или ссылки DFS.</span><span class="sxs-lookup"><span data-stu-id="f35e8-157">DFS clients that receive the referral start with the first target of the first set, and continue through the list until an available target for a given DFS root or link is found.</span></span>

<span data-ttu-id="f35e8-158">Конкретная реализация этого компонента API представлена в следующих справочных разделах:</span><span class="sxs-lookup"><span data-stu-id="f35e8-158">For the specific API implementation of this feature, please see the following reference topics:</span></span>

<span data-ttu-id="f35e8-159">[**DFS_INFO_6**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_6) 
 [**DFS_INFO_104**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_104) 
 [**DFS_INFO_106**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_106) 
 [**DFS_TARGET_PRIORITY**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_target_priority) 
 [**DFS_TARGET_PRIORITY_CLASS**](/windows/win32/api/lmdfs/ne-lmdfs-dfs_target_priority_class~r1)</span><span class="sxs-lookup"><span data-stu-id="f35e8-159">[**DFS_INFO_6**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_6)
[**DFS_INFO_104**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_104)
[**DFS_INFO_106**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_info_106)
[**DFS_TARGET_PRIORITY**](/windows/desktop/api/lmdfs/ns-lmdfs-dfs_target_priority)
[**DFS_TARGET_PRIORITY_CLASS**](/windows/win32/api/lmdfs/ne-lmdfs-dfs_target_priority_class~r1)</span></span>
