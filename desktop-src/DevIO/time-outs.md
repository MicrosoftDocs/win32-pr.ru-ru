---
description: В отношении ресурса связи имеется связанный набор параметров времени ожидания, влияющих на поведение операций чтения и записи.
ms.assetid: 271d4c68-1f6d-4483-a9a1-703220de761f
title: Время ожидания
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6db31fafc0f4d98832f1fb7fa5d22b32cba33d73
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103807402"
---
# <a name="time-outs"></a><span data-ttu-id="067e7-103">Время ожидания</span><span class="sxs-lookup"><span data-stu-id="067e7-103">Time-Outs</span></span>

<span data-ttu-id="067e7-104">В отношении ресурса связи имеется связанный набор параметров времени ожидания, влияющих на поведение операций чтения и записи.</span><span class="sxs-lookup"><span data-stu-id="067e7-104">A handle to a communications resource has an associated set of time-out parameters that affect the behavior of read and write operations.</span></span> <span data-ttu-id="067e7-105">Время ожидания может привести к завершению операции [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**реадфиликс**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile)или [**вритефиликс**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) по истечении интервала времени ожидания, даже если указанное число символов не было считано или записано.</span><span class="sxs-lookup"><span data-stu-id="067e7-105">Time-outs can cause a [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), or [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) operation to conclude when a time-out interval elapses, even though the specified number of characters have not been read or written.</span></span> <span data-ttu-id="067e7-106">Она не считается ошибкой, когда время ожидания возникает во время операции чтения или записи (т. е. возвращаемое значение функции чтения или записи указывает на успешное выполнение).</span><span class="sxs-lookup"><span data-stu-id="067e7-106">It is not treated as an error when a time-out occurs during a read or write operation (that is, the read or write function's return value indicates success).</span></span> <span data-ttu-id="067e7-107">Число байтов, фактически считанных или записанных, передается функцией **ReadFile** или **WriteFile** (или с помощью функции [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) или [**филеиокомплетионраутине**](/windows/desktop/api/minwinbase/nc-minwinbase-lpoverlapped_completion_routine) , если операция ввода-вывода выполнялась в качестве перекрывающейся операции).</span><span class="sxs-lookup"><span data-stu-id="067e7-107">The count of bytes actually read or written is reported by **ReadFile** or **WriteFile** (or by the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**FileIOCompletionRoutine**](/windows/desktop/api/minwinbase/nc-minwinbase-lpoverlapped_completion_routine) function, if the I/O was performed as an overlapped operation).</span></span>

<span data-ttu-id="067e7-108">Когда приложение открывает ресурс связи, система устанавливает значения времени ожидания ресурса в значения, действующие при последнем использовании ресурса.</span><span class="sxs-lookup"><span data-stu-id="067e7-108">When an application opens a communications resource, the system sets the resource's time-out values to the values in effect when the resource was last used.</span></span> <span data-ttu-id="067e7-109">Если ресурс связи никогда не открывался, система устанавливает для значений времени ожидания какое-либо значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="067e7-109">If the communications resource has never been opened, the system sets the time-out values to some default value.</span></span> <span data-ttu-id="067e7-110">В любом случае приложение должно всегда определять текущие значения времени ожидания после открытия ресурса, а затем явно задавать их в соответствии с требованиями.</span><span class="sxs-lookup"><span data-stu-id="067e7-110">In either case, an application should always determine the current time-out values after opening the resource, and then explicitly set them to meet its requirements.</span></span> <span data-ttu-id="067e7-111">Чтобы определить текущие значения времени ожидания для ресурса связи, используйте функцию [**жеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) .</span><span class="sxs-lookup"><span data-stu-id="067e7-111">To determine the current time-out values of a communications resource, use the [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) function.</span></span> <span data-ttu-id="067e7-112">Чтобы изменить значения времени ожидания, используйте функцию [**сеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) .</span><span class="sxs-lookup"><span data-stu-id="067e7-112">To change the time-out values, use the [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) function.</span></span>

<span data-ttu-id="067e7-113">Параметры времени ожидания включаются двумя типами времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="067e7-113">Two types of time-outs are enabled by the time-out parameters.</span></span> <span data-ttu-id="067e7-114">Время ожидания в интервале возникает, когда время между получением любого из двух символов превышает заданное число миллисекунд.</span><span class="sxs-lookup"><span data-stu-id="067e7-114">An interval time-out occurs when the time between the receipt of any two characters exceeds a specified number of milliseconds.</span></span> <span data-ttu-id="067e7-115">Отсчет времени начинается при получении первого символа и перезапуска при получении каждого нового символа.</span><span class="sxs-lookup"><span data-stu-id="067e7-115">Timing starts when the first character is received and is restarted when each new character is received.</span></span> <span data-ttu-id="067e7-116">Общее время ожидания происходит, когда общее количество времени, потребляемое операцией чтения, превышает вычисленное число миллисекунд.</span><span class="sxs-lookup"><span data-stu-id="067e7-116">A total time-out occurs when the total amount of time consumed by a read operation exceeds a calculated number of milliseconds.</span></span> <span data-ttu-id="067e7-117">Время начинается сразу после начала операции ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="067e7-117">Timing starts immediately when the I/O operation begins.</span></span> <span data-ttu-id="067e7-118">Операции записи поддерживают только общие тайм-ауты.</span><span class="sxs-lookup"><span data-stu-id="067e7-118">Write operations support only total time-outs.</span></span> <span data-ttu-id="067e7-119">Операции чтения поддерживают как интервал, так и общее время ожидания, которые можно использовать отдельно или совместно.</span><span class="sxs-lookup"><span data-stu-id="067e7-119">Read operations support both interval and total time-outs, which can be used separately or combined.</span></span>

<span data-ttu-id="067e7-120">Время (в миллисекундах) общего периода ожидания для операции чтения или записи вычисляется с использованием значений множителя и константы из структуры [**коммтимеаутс**](/windows/desktop/api/Winbase/ns-winbase-commtimeouts) , указанной в функции [**жеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) или [**сеткоммтимеаутс**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) .</span><span class="sxs-lookup"><span data-stu-id="067e7-120">The time, in milliseconds, of the total time-out period for a read or write operation is calculated by using the multiplier and constant values from the [**COMMTIMEOUTS**](/windows/desktop/api/Winbase/ns-winbase-commtimeouts) structure specified in the [**GetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-getcommtimeouts) or [**SetCommTimeouts**](/windows/desktop/api/Winbase/nf-winbase-setcommtimeouts) function.</span></span> <span data-ttu-id="067e7-121">Используется следующая формула:</span><span class="sxs-lookup"><span data-stu-id="067e7-121">The following formula is used:</span></span>


```C++
Timeout = (MULTIPLIER * number_of_bytes) + CONSTANT
```



<span data-ttu-id="067e7-122">Использование как множителя, так и константы позволяет изменять общее время ожидания в зависимости от объема запрашиваемых данных.</span><span class="sxs-lookup"><span data-stu-id="067e7-122">Using both a multiplier and a constant enables the total time-out period to vary, depending on the amount of data being requested.</span></span> <span data-ttu-id="067e7-123">Приложение может использовать только константу, установив множитель равным нулю, или использовать только множитель, установив константу в ноль.</span><span class="sxs-lookup"><span data-stu-id="067e7-123">An application can use only the constant by setting the multiplier to zero, or use only the multiplier by setting the constant to zero.</span></span> <span data-ttu-id="067e7-124">Если константа и множитель равны нулю, общее время ожидания не используется.</span><span class="sxs-lookup"><span data-stu-id="067e7-124">If both the constant and multiplier are zero, total time-out is not used.</span></span>

<span data-ttu-id="067e7-125">Если все параметры времени ожидания чтения равны нулю, то время ожидания чтения не используется, а операция чтения не завершается до тех пор, пока не будет считано запрошенное число байтов или не произойдет ошибка.</span><span class="sxs-lookup"><span data-stu-id="067e7-125">If all read time-out parameters are zero, read time-outs are not used, and a read operation is not complete until the requested number of bytes have been read or an error occurs.</span></span> <span data-ttu-id="067e7-126">Аналогично, если все параметры времени ожидания записи равны нулю, операция записи не будет завершена до тех пор, пока не будет записано запрошенное число байтов или не будет возникать ошибка.</span><span class="sxs-lookup"><span data-stu-id="067e7-126">Similarly, if all write time-out parameters are zero, a write operation is not completed until the requested number of bytes have been written or an error occurs.</span></span>

<span data-ttu-id="067e7-127">Если параметр времени ожидания чтения равен значению **максдворд** и оба параметра времени ожидания Read ALL равны нулю, операция чтения выполняется сразу же после чтения всех символов, доступных во входном буфере, даже если он пуст.</span><span class="sxs-lookup"><span data-stu-id="067e7-127">If the read interval time-out parameter is the **MAXDWORD** value and both read total time-out parameters are zero, a read operation is completed immediately after reading whatever characters are available in the input buffer, even if it is empty.</span></span>

<span data-ttu-id="067e7-128">Время интервала принудительное возвращение операции чтения при получении перерыва.</span><span class="sxs-lookup"><span data-stu-id="067e7-128">Interval timing forces a read operation to return when there is a lull in reception.</span></span> <span data-ttu-id="067e7-129">Процесс, использующий интервалы времени ожидания, может задавать довольно короткий интервал, что позволяет быстро реагировать на небольшие, изолированные пакеты одного или нескольких символов, однако при получении данных в стабильном потоке он все равно может получать большие буферы символов с одним вызовом.</span><span class="sxs-lookup"><span data-stu-id="067e7-129">A process using interval time-outs can set a fairly short interval parameter, so it can respond quickly to small, isolated bursts of one or a few characters, yet it can still collect large buffers of characters with a single call when data is received in a steady stream.</span></span>

<span data-ttu-id="067e7-130">Время ожидания для операции записи может быть полезным, если передача блокируется каким-либо потоком управления потоками или при вызове функции [**сеткоммбреак**](/windows/desktop/api/Winbase/nf-winbase-setcommbreak) для приостановки передачи символов.</span><span class="sxs-lookup"><span data-stu-id="067e7-130">Time-outs for a write operation can be useful when transmission is blocked by some kind of flow control or when the [**SetCommBreak**](/windows/desktop/api/Winbase/nf-winbase-setcommbreak) function has been called to suspend character transmission.</span></span>

<span data-ttu-id="067e7-131">В следующей таблице обобщены сведения о поведении операций чтения на основе значений, указанных для параметра общий интервал и время ожидания.</span><span class="sxs-lookup"><span data-stu-id="067e7-131">The following table summarizes the behavior of read operations based on the values specified for total and interval time-outs.</span></span>



| <span data-ttu-id="067e7-132">Итог</span><span class="sxs-lookup"><span data-stu-id="067e7-132">Total</span></span> | <span data-ttu-id="067e7-133">Интервал</span><span class="sxs-lookup"><span data-stu-id="067e7-133">Interval</span></span> | <span data-ttu-id="067e7-134">Поведение</span><span class="sxs-lookup"><span data-stu-id="067e7-134">Behavior</span></span>                                                                                                                                                                                 |
|-------|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="067e7-135">0</span><span class="sxs-lookup"><span data-stu-id="067e7-135">0</span></span>     | <span data-ttu-id="067e7-136">0</span><span class="sxs-lookup"><span data-stu-id="067e7-136">0</span></span>        | <span data-ttu-id="067e7-137">Возвращает, когда буфер полностью заполнен.</span><span class="sxs-lookup"><span data-stu-id="067e7-137">Returns when the buffer is completely filled.</span></span> <span data-ttu-id="067e7-138">Тайм-ауты не используются.</span><span class="sxs-lookup"><span data-stu-id="067e7-138">Time-outs are not used.</span></span>                                                                                                                    |
| <span data-ttu-id="067e7-139">T</span><span class="sxs-lookup"><span data-stu-id="067e7-139">T</span></span>     | <span data-ttu-id="067e7-140">0</span><span class="sxs-lookup"><span data-stu-id="067e7-140">0</span></span>        | <span data-ttu-id="067e7-141">Возвращает, когда буфер полностью заполнен или когда прошло T миллисекунд с начала операции.</span><span class="sxs-lookup"><span data-stu-id="067e7-141">Returns when the buffer is completely filled or when T milliseconds have elapsed since the beginning of the operation.</span></span>                                                                   |
| <span data-ttu-id="067e7-142">0</span><span class="sxs-lookup"><span data-stu-id="067e7-142">0</span></span>     | <span data-ttu-id="067e7-143">Да</span><span class="sxs-lookup"><span data-stu-id="067e7-143">Y</span></span>        | <span data-ttu-id="067e7-144">Возвращает, когда буфер полностью заполняется или прошло Y миллисекунд между получением любого из двух символов.</span><span class="sxs-lookup"><span data-stu-id="067e7-144">Returns when the buffer is completely filled or when Y milliseconds have elapsed between the receipt of any two characters.</span></span> <span data-ttu-id="067e7-145">Время не начинается до получения первого символа.</span><span class="sxs-lookup"><span data-stu-id="067e7-145">Timing does not begin until the first character is received.</span></span> |
| <span data-ttu-id="067e7-146">T</span><span class="sxs-lookup"><span data-stu-id="067e7-146">T</span></span>     | <span data-ttu-id="067e7-147">Да</span><span class="sxs-lookup"><span data-stu-id="067e7-147">Y</span></span>        | <span data-ttu-id="067e7-148">Возвращает, когда буфер полностью заполнен или если выполняется любой из типов времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="067e7-148">Returns when the buffer is completely filled or when either type of time-out occurs.</span></span>                                                                                                     |



 

> [!Note]  
> <span data-ttu-id="067e7-149">Однако это время относится к системе, контролирующей физическое устройство.</span><span class="sxs-lookup"><span data-stu-id="067e7-149">However, that timing is relative to the system controlling the physical device.</span></span> <span data-ttu-id="067e7-150">Для удаленного устройства, например модема, время определяется относительно серверной системы, к которой подключен модем.</span><span class="sxs-lookup"><span data-stu-id="067e7-150">For a remote device such as a modem, the timing is relative to the server system to which the modem is attached.</span></span> <span data-ttu-id="067e7-151">Задержка распространения в сети не включена в множители.</span><span class="sxs-lookup"><span data-stu-id="067e7-151">Any network propagation delay is not factored in.</span></span> <span data-ttu-id="067e7-152">Например, клиентское приложение может указать общее время ожидания, в течение которого вычисляются значения 500 миллисекунд.</span><span class="sxs-lookup"><span data-stu-id="067e7-152">For example, a client application might specify a total time-out that computes to be 500 milliseconds.</span></span> <span data-ttu-id="067e7-153">По истечении 500 миллисекунд на сервере клиенту возвращается ошибка истечения времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="067e7-153">When 500 milliseconds have elapsed at the server, a time-out error is returned to the client.</span></span> <span data-ttu-id="067e7-154">Если задержка распространения по сети составляет 50 миллисекунд, клиент не будет уведомлен о времени ожидания до наступления примерно 50 миллисекунд после истечения времени ожидания.</span><span class="sxs-lookup"><span data-stu-id="067e7-154">If there is a 50 milliseconds network propagation delay, the client will not be notified of the time-out until approximately 50 milliseconds after the time-out actually occurred.</span></span>

 

> [!Note]  
> <span data-ttu-id="067e7-155">Параметры времени ожидания влияют на поведение перекрывающихся операций чтения и записи на коммуникационном устройстве.</span><span class="sxs-lookup"><span data-stu-id="067e7-155">The time-out parameters affect the behavior of overlapped read and write operations on a communications device.</span></span> <span data-ttu-id="067e7-156">При использовании перекрывающихся операций ввода-вывода функция [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**реадфиликс**](/windows/desktop/api/fileapi/nf-fileapi-readfileex)или [**вритефиликс**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) может вернуть до завершения операции.</span><span class="sxs-lookup"><span data-stu-id="067e7-156">With overlapped I/O, the [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex), or [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) function can return before the operation has been completed.</span></span> <span data-ttu-id="067e7-157">Параметры времени ожидания могут определить, когда была выполнена операция.</span><span class="sxs-lookup"><span data-stu-id="067e7-157">The time-out parameters can determine when the operation has been completed.</span></span>

 

 

 
