---
description: Чтобы определить тип события устройства при обработке \_ сообщения WM девицечанже, изучите параметр wParam.
ms.assetid: 17078548-879d-4a11-a268-27d1f30180ab
title: Типы событий устройств
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 35ece6b810ba4d1310638bbfbdcdcaa7f67f79d8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104072445"
---
# <a name="device-event-types"></a><span data-ttu-id="d2fbe-103">Типы событий устройств</span><span class="sxs-lookup"><span data-stu-id="d2fbe-103">Device Event Types</span></span>

<span data-ttu-id="d2fbe-104">Чтобы определить тип события устройства при обработке сообщения [**WM \_ девицечанже**](wm-devicechange.md) , изучите параметр *wParam* .</span><span class="sxs-lookup"><span data-stu-id="d2fbe-104">To determine the device event type when processing a [**WM\_DEVICECHANGE**](wm-devicechange.md) message, examine the *wParam* parameter.</span></span> <span data-ttu-id="d2fbe-105">Значение параметра *wParam* определяет значение данных, относящихся к событию, в параметре *lParam* .</span><span class="sxs-lookup"><span data-stu-id="d2fbe-105">The value of *wParam* determines the meaning of the event-specific data in the *lParam* parameter.</span></span> <span data-ttu-id="d2fbe-106">В общем случае данные, относящиеся к конкретному событию, идентифицируют устройство и предоставляют дополнительные сведения о событии.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-106">In general, the event-specific data identifies the device and provides additional detail about the event.</span></span> <span data-ttu-id="d2fbe-107">Формат этих данных зависит от типа устройства, но первые несколько байтов всегда имеют тот же формат, что и структура [**\_ \_ HDR-вещания для разработки**](/windows/desktop/api/Dbt/ns-dbt-dev_broadcast_hdr) .</span><span class="sxs-lookup"><span data-stu-id="d2fbe-107">The format of this data depends on the device type, but the first few bytes always have the same format as the [**DEV\_BROADCAST\_HDR**](/windows/desktop/api/Dbt/ns-dbt-dev_broadcast_hdr) structure.</span></span> <span data-ttu-id="d2fbe-108">Чтобы определить формат данных, проверьте элемент **дбч \_ типа устройства** .</span><span class="sxs-lookup"><span data-stu-id="d2fbe-108">To determine the format of the data, check the **dbch\_devicetype** member.</span></span>

<span data-ttu-id="d2fbe-109">Система передает событие устройства типа [ДБТ \_ девицеарривал](dbt-devicearrival.md) (то есть сообщение [**WM \_ девицечанже**](wm-devicechange.md) с параметром *wParam* , установленным в ДБТ \_ девицеарривал) всякий раз, когда устройство вставлено и доступно для использования.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-109">The system broadcasts a device event of type [DBT\_DEVICEARRIVAL](dbt-devicearrival.md) (that is, a [**WM\_DEVICECHANGE**](wm-devicechange.md) message with *wParam* set to DBT\_DEVICEARRIVAL) whenever a device has been inserted and is available for use.</span></span> <span data-ttu-id="d2fbe-110">Обычно приложения проверяют тип устройства и начинают использовать устройство немедленно, если оно подходит.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-110">Applications typically check the device type and begin using the device immediately if it is appropriate.</span></span>

<span data-ttu-id="d2fbe-111">Система передает событие [ДБТ \_ девицекуериремове](dbt-devicequeryremove.md) Device, чтобы запросить разрешение на удаление устройства.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-111">The system broadcasts a [DBT\_DEVICEQUERYREMOVE](dbt-devicequeryremove.md) device event to request permission to remove a device.</span></span> <span data-ttu-id="d2fbe-112">Чтобы определить, требуется ли устройство, приложение может отобразить диалоговое окно, предлагающее пользователю ввести инструкции.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-112">To determine whether it needs the device, an application can display a dialog box to prompt the user for instructions.</span></span> <span data-ttu-id="d2fbe-113">Если приложение определяет, что ему требуется устройство, оно может отклонить этот запрос и отменить удаление, возвращая ШИРОКОВЕЩАТЕЛЬный \_ запрос \_ Deny.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-113">If an application determines that it needs the device, it can deny this request and cancel the removal by returning BROADCAST\_QUERY\_DENY.</span></span> <span data-ttu-id="d2fbe-114">Если приложению не требуется устройство, оно должно возвращать **значение true**.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-114">If the application does not need the device, it must return **TRUE**.</span></span> <span data-ttu-id="d2fbe-115">Система немедленно отправляет сообщение [ДБТ \_ девицекуериремовефаилед](dbt-devicequeryremovefailed.md) , если какое-либо приложение или драйвер отменили предыдущий запрос на удаление устройства.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-115">The system immediately sends a [DBT\_DEVICEQUERYREMOVEFAILED](dbt-devicequeryremovefailed.md) message if any application or driver canceled a previous request to remove a device.</span></span>

<span data-ttu-id="d2fbe-116">Система передает событие [ДБТ \_ девицеремовепендинг](dbt-deviceremovepending.md) Device в виде последнего предупреждения перед удалением устройства.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-116">The system broadcasts a [DBT\_DEVICEREMOVEPENDING](dbt-deviceremovepending.md) device event as a last warning before a device is removed.</span></span> <span data-ttu-id="d2fbe-117">На этом этапе приложение не может отменить удаление, поэтому, если оно использует устройство, оно должно подготовиться к его удалению, чтобы предотвратить потери данных.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-117">At this point, the application cannot cancel the removal, so if it is using the device it must prepare for its removal to prevent loss of data.</span></span> <span data-ttu-id="d2fbe-118">Это особенно важно при удалении сетевого подключения.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-118">This is especially important when a network connection is being removed.</span></span> <span data-ttu-id="d2fbe-119">Приложение должно определить, подключены ли к нему какие либо открытые файлы или каналы.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-119">The application must determine whether any of its open files or pipes are on that connection.</span></span> <span data-ttu-id="d2fbe-120">Это можно сделать, сравнив идентификатор сетевого ресурса в данных сообщения, относящихся к конкретному событию, с идентификаторами ресурсов, полученными ранее для файлов и каналов.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-120">It can do this by comparing the network resource identifier in the event-specific data of the message with the resource identifiers previously obtained for the files and pipes.</span></span> <span data-ttu-id="d2fbe-121">Система передает событие устройства [ДБТ \_ девицеремовекомплете](dbt-deviceremovecomplete.md) , когда устройство было удалено и больше не доступно.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-121">The system broadcasts a [DBT\_DEVICEREMOVECOMPLETE](dbt-deviceremovecomplete.md) device event when a device has been removed and is no longer available.</span></span>

<span data-ttu-id="d2fbe-122">Система передает событие [ДБТ \_ куеричанжеконфиг](dbt-querychangeconfig.md) Device, чтобы запросить разрешение на изменение текущей конфигурации (закрепление или Отстыковка).</span><span class="sxs-lookup"><span data-stu-id="d2fbe-122">The system broadcasts a [DBT\_QUERYCHANGECONFIG](dbt-querychangeconfig.md) device event to request permission to change the current configuration (dock or undock).</span></span> <span data-ttu-id="d2fbe-123">Любое приложение может вернуть ШИРОКОВЕЩАТЕЛЬный \_ запрос \_ Deny, чтобы отклонить запрос и отменить изменение.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-123">Any application can return BROADCAST\_QUERY\_DENY to deny the request and cancel the change.</span></span> <span data-ttu-id="d2fbe-124">Если приложение отклоняет запрос, система отправляет сообщение [ДБТ \_ конфигчанжеканцелед](dbt-configchangecanceled.md) .</span><span class="sxs-lookup"><span data-stu-id="d2fbe-124">If an application denies the request, the system sends a [DBT\_CONFIGCHANGECANCELED](dbt-configchangecanceled.md) message.</span></span> <span data-ttu-id="d2fbe-125">Если текущая конфигурация изменилась из-за закрепления или отстыковки, система отправляет сообщение [ДБТ \_ конфигчанжед](dbt-configchanged.md) .</span><span class="sxs-lookup"><span data-stu-id="d2fbe-125">If the current configuration has changed, due to a dock or undock, the system sends a [DBT\_CONFIGCHANGED](dbt-configchanged.md) message.</span></span>

<span data-ttu-id="d2fbe-126">Система передает событие [ДБТ \_ девицетипеспеЦифик](dbt-devicetypespecific.md) Device при возникновении определенного события устройства.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-126">The system broadcasts a [DBT\_DEVICETYPESPECIFIC](dbt-devicetypespecific.md) device event whenever a device-specific event occurs.</span></span>

<span data-ttu-id="d2fbe-127">Драйверы могут создавать собственные типы пользовательских событий.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-127">Drivers can create their own custom event types.</span></span> <span data-ttu-id="d2fbe-128">Пользовательские события отправляются только в приложение, которое зарегистрировано для уведомления о событиях устройства на определенном устройстве и может инициироваться только драйверами режима ядра.</span><span class="sxs-lookup"><span data-stu-id="d2fbe-128">Custom events are sent only to application that have registered for device-event notification on a particular device, and can only be initiated by kernel-mode drivers.</span></span> <span data-ttu-id="d2fbe-129">Дополнительные сведения см. в разделе [ДБТ \_ CUSTOMEVENT](dbt-customevent.md).</span><span class="sxs-lookup"><span data-stu-id="d2fbe-129">For more information, see [DBT\_CUSTOMEVENT](dbt-customevent.md).</span></span>

 

 



