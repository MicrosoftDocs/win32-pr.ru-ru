---
description: Когда функция CreateFile открывает обработчик для ресурса последовательного подключения, система инициализирует и настраивает ресурс в соответствии со значениями, заданными при последнем открытии ресурса.
ms.assetid: a39881d8-32af-4846-a2d3-508f1945b666
title: Изменение параметров ресурсов связи
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8658029470fae9ee2d70ffb1459312c3c4d80ecf
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104072446"
---
# <a name="modification-of-communications-resource-settings"></a><span data-ttu-id="b2496-103">Изменение параметров ресурсов связи</span><span class="sxs-lookup"><span data-stu-id="b2496-103">Modification of Communications Resource Settings</span></span>

<span data-ttu-id="b2496-104">Когда функция [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) открывает обработчик для ресурса последовательного подключения, система инициализирует и настраивает ресурс в соответствии со значениями, заданными при последнем открытии ресурса.</span><span class="sxs-lookup"><span data-stu-id="b2496-104">When the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function opens a handle to a serial communications resource, the system initializes and configures the resource according to the values set up the last time the resource was opened.</span></span> <span data-ttu-id="b2496-105">Сохранение предыдущих параметров позволяет пользователю сохранить параметры, указанные с помощью команды **mode** , при повторном открытии устройства.</span><span class="sxs-lookup"><span data-stu-id="b2496-105">Preserving the previous settings enables the user to retain the settings specified through a **mode** command when the device is reopened.</span></span> <span data-ttu-id="b2496-106">Значения, унаследованные из предыдущей операции открытия, включают параметры конфигурации блока управления устройством (структура [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) ) и значения времени ожидания, используемые в операциях ввода-вывода.</span><span class="sxs-lookup"><span data-stu-id="b2496-106">The values inherited from the previous open operation include the configuration settings of the device control block (a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure) and the time-out values used in I/O operations.</span></span> <span data-ttu-id="b2496-107">Если устройство никогда не открывалось, для него задаются системные значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b2496-107">If the device has never been opened, it is configured with the system defaults.</span></span>

<span data-ttu-id="b2496-108">Чтобы определить начальную конфигурацию ресурса последовательного подключения, процесс вызывает функцию [**жеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) , которая заполняет структуру последовательного порта [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) текущими параметрами конфигурации.</span><span class="sxs-lookup"><span data-stu-id="b2496-108">To determine the initial configuration of a serial communications resource, a process calls the [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) function, which fills in a serial port [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure with the current configuration settings.</span></span> <span data-ttu-id="b2496-109">Чтобы изменить эту конфигурацию, процесс задает структуру **DCB** в вызове функции [**сеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) .</span><span class="sxs-lookup"><span data-stu-id="b2496-109">To modify this configuration, a process specifies a **DCB** structure in a call to the [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function.</span></span>

<span data-ttu-id="b2496-110">Элементы структуры [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) задают такие параметры конфигурации, как скорость передачи данных, число бит на байт и количество останавливаемых битов на байт.</span><span class="sxs-lookup"><span data-stu-id="b2496-110">Members of the [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure specify the configuration settings such as the baud rate, the number of data bits per byte, and the number of stop bits per byte.</span></span> <span data-ttu-id="b2496-111">Другие элементы **DCB** задают специальные символы и обеспечивают проверку четности и управление потоком.</span><span class="sxs-lookup"><span data-stu-id="b2496-111">Other **DCB** members specify special characters and enable parity checking and flow control.</span></span> <span data-ttu-id="b2496-112">Когда процессу необходимо изменить только некоторые из этих параметров конфигурации, сначала необходимо вызвать [**жеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) , чтобы заполнить структуру **DCB** текущей конфигурацией.</span><span class="sxs-lookup"><span data-stu-id="b2496-112">When a process needs to modify only a few of these configuration settings, it should first call [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) to fill in a **DCB** structure with the current configuration.</span></span> <span data-ttu-id="b2496-113">Затем процесс может скорректировать важные значения в структуре **DCB** и перенастроить устройство, вызвав [**сеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) и указав измененную структуру **DCB** .</span><span class="sxs-lookup"><span data-stu-id="b2496-113">Then the process can adjust the important values in the **DCB** structure and reconfigure the device by calling [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) and specifying the modified **DCB** structure.</span></span> <span data-ttu-id="b2496-114">Эта процедура гарантирует, что неизмененные элементы структуры **DCB** содержат соответствующие значения.</span><span class="sxs-lookup"><span data-stu-id="b2496-114">This procedure ensures that the unmodified members of the **DCB** structure contain appropriate values.</span></span> <span data-ttu-id="b2496-115">Например, распространенной ошибкой является настройка устройства с структурой **DCB** , в которой элемент **ксончар** структуры равен элементу **ксоффчар** .</span><span class="sxs-lookup"><span data-stu-id="b2496-115">For example, a common error is to configure a device with a **DCB** structure in which the structure's **XonChar** member is equal to the **XoffChar** member.</span></span>

<span data-ttu-id="b2496-116">Функция [**буилдкоммдкб**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) предоставляет другой способ изменения структуры [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) .</span><span class="sxs-lookup"><span data-stu-id="b2496-116">The [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) function provides another way to modify a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure.</span></span> <span data-ttu-id="b2496-117">**Буилдкоммдкб** использует строку с той же формой, что и аргументы командной строки команды **mode** , для указания скорости передачи, схемы четности, количества останавливаемых бит и числа бит данных.</span><span class="sxs-lookup"><span data-stu-id="b2496-117">**BuildCommDCB** uses a string with the same form as the command-line arguments of the **mode** command to specify the baud rate, parity scheme, number of stop bits, and number of data bits.</span></span> <span data-ttu-id="b2496-118">Остальные элементы [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) не изменяются этой функцией, за исключением того, что для соответствующих членов задано отключение XON/XOFF и аппаратного управления потоком.</span><span class="sxs-lookup"><span data-stu-id="b2496-118">The remaining members of [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) are not changed by this function, except that the appropriate members are set to disable XON/XOFF and hardware flow control.</span></span> <span data-ttu-id="b2496-119">**Буилдкоммдкб** изменяет только структуру **DCB** ; Он не перестраивает устройство.</span><span class="sxs-lookup"><span data-stu-id="b2496-119">**BuildCommDCB** only modifies a **DCB** structure; it does not reconfigure the device.</span></span>

<span data-ttu-id="b2496-120">Процесс может перенастроить ресурс связи с помощью функции [**жеткоммпропертиес**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) , чтобы получить сведения из драйвера устройства о параметрах конфигурации, которые он поддерживает.</span><span class="sxs-lookup"><span data-stu-id="b2496-120">A process can reconfigure a communications resource by using the [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) function to get information from a device driver about the configuration settings that it supports.</span></span> <span data-ttu-id="b2496-121">Процесс может использовать эти сведения, чтобы не указывать конфигурацию, которая не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="b2496-121">The process can use this information to avoid specifying a configuration that is not supported.</span></span>

<span data-ttu-id="b2496-122">Функция [**сеткоммстате**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) перенастраивает ресурс связи, но не влияет на внутренние выходные данные и Входные буферы указанного драйвера.</span><span class="sxs-lookup"><span data-stu-id="b2496-122">The [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function reconfigures the communications resource, but it does not affect the internal output and input buffers of the specified driver.</span></span> <span data-ttu-id="b2496-123">Буферы не записываются, а отложенные операции чтения и записи не прерываются преждевременно.</span><span class="sxs-lookup"><span data-stu-id="b2496-123">The buffers are not flushed, and pending read and write operations are not terminated prematurely.</span></span>

<span data-ttu-id="b2496-124">Процесс повторно инициализирует коммуникационный ресурс с помощью функции [**сетупкомм**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) , которая выполняет следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="b2496-124">A process reinitializes a communications resource by using the [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) function, which performs the following tasks:</span></span>

-   <span data-ttu-id="b2496-125">Прерывает ожидающие операции чтения и записи, даже если они не были завершены.</span><span class="sxs-lookup"><span data-stu-id="b2496-125">Terminates pending read and write operations, even if they have not been completed.</span></span>
-   <span data-ttu-id="b2496-126">Отменяет непрочтенные символы и освобождает внутренние выходные и Входные буферы драйвера, связанного с указанным ресурсом.</span><span class="sxs-lookup"><span data-stu-id="b2496-126">Discards unread characters and frees the internal output and input buffers of the driver associated with the specified resource.</span></span>
-   <span data-ttu-id="b2496-127">Перераспределяет внутренние выходные и Входные буферы.</span><span class="sxs-lookup"><span data-stu-id="b2496-127">Reallocates the internal output and input buffers.</span></span>

<span data-ttu-id="b2496-128">Процесс не требуется для вызова [**сетупкомм**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span><span class="sxs-lookup"><span data-stu-id="b2496-128">A process is not required to call [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span></span> <span data-ttu-id="b2496-129">Если это не так, драйвер ресурса инициализирует устройство с параметрами по умолчанию при первом использовании обработчика ресурса связи.</span><span class="sxs-lookup"><span data-stu-id="b2496-129">If it does not, the resource's driver initializes the device with the default settings the first time that the communications resource handle is used.</span></span>

 

 
