---
description: Защищенное серверное приложение должно проверять права доступа клиентов перед предоставлением клиенту доступа к защищенному закрытому объекту.
ms.assetid: dce4dd10-1d5f-40a3-8a7e-ec708d3123c7
title: Проверка доступа к частным объектам
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c6b7b3d8b2cd933b00be0be9f1f2b077f5c7a2d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991197"
---
# <a name="checking-access-to-private-objects"></a><span data-ttu-id="f1ac0-103">Проверка доступа к частным объектам</span><span class="sxs-lookup"><span data-stu-id="f1ac0-103">Checking Access to Private Objects</span></span>

<span data-ttu-id="f1ac0-104">Защищенное серверное приложение должно проверить права доступа клиента, прежде чем разрешить клиенту доступ к защищенному закрытому объекту.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-104">A protected server application must check a client's access rights before allowing the client to access a protected private object.</span></span> <span data-ttu-id="f1ac0-105">Для этого сервер передает [*маркер олицетворения*](/windows/desktop/SecGloss/i-gly), дескриптор безопасности и набор запрошенных прав доступа для [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck).</span><span class="sxs-lookup"><span data-stu-id="f1ac0-105">To do this, the server passes an [*impersonation token*](/windows/desktop/SecGloss/i-gly), a security descriptor, and a set of requested access rights to [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck).</span></span> <span data-ttu-id="f1ac0-106">[*Записи контроля доступа*](/windows/desktop/SecGloss/a-gly) (ACE) в списке DACL [*дескриптора безопасности*](/windows/desktop/SecGloss/s-gly) указывают права доступа, разрешенные или запрещенные для различных доверенных лиц.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-106">The [*access control entries*](/windows/desktop/SecGloss/a-gly) (ACEs) in the [*security descriptor's*](/windows/desktop/SecGloss/s-gly) DACL specify the access rights allowed or denied to various trustees.</span></span> <span data-ttu-id="f1ac0-107">Функция **AccessCheck** сравнивает доверенное лицо в каждом ACE с доверенными лицами, указанными в токене олицетворения.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-107">The **AccessCheck** function compares the trustee in each ACE to the trustees identified in the impersonation token.</span></span> <span data-ttu-id="f1ac0-108">Описание алгоритма, используемого для предоставления или запрета доступа, см. в статье [Управление доступом к объекту в DACL](how-dacls-control-access-to-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="f1ac0-108">For a description of the algorithm used to grant or deny access, see [How DACLs Control Access to an Object](how-dacls-control-access-to-an-object.md).</span></span>

<span data-ttu-id="f1ac0-109">Функция [**акцессчеккандаудиталарм**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) выполняет аналогичную проверку доступа.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-109">The [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) function performs a similar access check.</span></span> <span data-ttu-id="f1ac0-110">Кроме того, он создает записи аудита в журнале событий безопасности в зависимости от списка SACL в дескрипторе безопасности.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-110">In addition, it generates audit records in the security event log depending on the SACL in the security descriptor.</span></span>

<span data-ttu-id="f1ac0-111">Функции [**акцессчеккбитипе**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytype) и [**Акцессчеккбитипеандаудиталарм**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytypeandauditalarma) похожи на [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) и [**акцессчеккандаудиталарм**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) , за исключением того, что они позволяют проверять доступ к вложенным объектам объекта, таким как наборы свойств или свойства.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-111">The [**AccessCheckByType**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytype) and [**AccessCheckByTypeAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytypeandauditalarma) functions are similar to [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) and [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) except that they allow you to check access to the subobjects of an object, such as property sets or properties.</span></span> <span data-ttu-id="f1ac0-112">Функции [**акцессчеккбитипересултлист**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist) и [**акцессчеккбитипересултлистандаудиталарм**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytyperesultlistandauditalarma) также похожи на **AccessCheck** , за исключением того, что они предоставляют результаты проверки доступа для каждого подобъекта в иерархии свойств и наборов свойств объекта.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-112">The [**AccessCheckByTypeResultList**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheckbytyperesultlist) and [**AccessCheckByTypeResultListAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckbytyperesultlistandauditalarma) functions are also similar to **AccessCheck** except that they provide the access check results for each subobject in a hierarchy of the object's properties and property sets.</span></span> <span data-ttu-id="f1ac0-113">Эти функции используют структуру [**\_ \_ списка типов объектов**](/windows/desktop/api/Winnt/ns-winnt-object_type_list) для описания иерархии объектов, для которых установлен флажок доступ.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-113">These functions use the [**OBJECT\_TYPE\_LIST**](/windows/desktop/api/Winnt/ns-winnt-object_type_list) structure to describe the hierarchy of objects for which access is checked.</span></span> <span data-ttu-id="f1ac0-114">Функции, создающие сообщение аудита, используют тип перечисления тип [**\_ \_ события аудита**](/windows/desktop/api/Winnt/ne-winnt-audit_event_type) , чтобы указать, является ли проверяемый объект объектом службы каталогов.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-114">The functions that generate an audit message use the [**AUDIT\_EVENT\_TYPE**](/windows/desktop/api/Winnt/ne-winnt-audit_event_type) enumeration type to indicate whether the object being checked is a directory service object.</span></span> <span data-ttu-id="f1ac0-115">Дополнительные сведения об иерархии объекта и его подобъектов см. [в разделе ACE для управления доступом к свойствам объекта](aces-to-control-access-to-an-object-s-properties.md).</span><span class="sxs-lookup"><span data-stu-id="f1ac0-115">For more information about the hierarchy of an object and its subobjects, see [ACEs to Control Access to an Object's Properties](aces-to-control-access-to-an-object-s-properties.md).</span></span>

<span data-ttu-id="f1ac0-116">Запрошенные права доступа, передаваемые в функции [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) и [**акцессчеккандаудиталарм**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) , не должны включать [Общие права доступа](generic-access-rights.md).</span><span class="sxs-lookup"><span data-stu-id="f1ac0-116">The requested access rights passed to the [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) and [**AccessCheckAndAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-accesscheckandauditalarma) functions must not include any [generic access rights](generic-access-rights.md).</span></span> <span data-ttu-id="f1ac0-117">Сервер может использовать функцию [**мапженерикмаск**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-mapgenericmask) для преобразования любых общих прав доступа к соответствующим определенным и стандартным правам в соответствии с сопоставлением, указанным в структуре [**универсального \_ сопоставления**](/windows/desktop/api/Winnt/ns-winnt-generic_mapping) .</span><span class="sxs-lookup"><span data-stu-id="f1ac0-117">The server can use the [**MapGenericMask**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-mapgenericmask) function to convert any generic access rights to the corresponding specific and standard rights according to the mapping specified in the [**GENERIC\_MAPPING**](/windows/desktop/api/Winnt/ns-winnt-generic_mapping) structure.</span></span>

<span data-ttu-id="f1ac0-118">Функции [**ареаллакцессесгрантед**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areallaccessesgranted) и [**ареанякцессесгрантед**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areanyaccessesgranted) сравнивают запрошенную [*маску доступа*](/windows/desktop/SecGloss/a-gly) с предоставленной маской доступа.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-118">The [**AreAllAccessesGranted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areallaccessesgranted) and [**AreAnyAccessesGranted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-areanyaccessesgranted) functions compare a requested [*access mask*](/windows/desktop/SecGloss/a-gly) with a granted access mask.</span></span>

<span data-ttu-id="f1ac0-119">Пример кода, в котором используется функция [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) , см. [в разделе Проверка клиентского доступа с помощью ACL в C++](verifying-client-access-with-acls-in-c--.md).</span><span class="sxs-lookup"><span data-stu-id="f1ac0-119">For sample code that uses the [**AccessCheck**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-accesscheck) function, see [Verifying Client Access with ACLs in C++](verifying-client-access-with-acls-in-c--.md).</span></span>

<span data-ttu-id="f1ac0-120">Функция [**конверттоаутоинхеритприватеобжектсекурити**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-converttoautoinheritprivateobjectsecurity) создает и возвращает дескриптор безопасности в формате, который позволяет автоматически распространять наследуемые ACE.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-120">The [**ConvertToAutoInheritPrivateObjectSecurity**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-converttoautoinheritprivateobjectsecurity) function creates and returns a security descriptor in a format that allows the automatic propagation of inheritable ACEs.</span></span> <span data-ttu-id="f1ac0-121">Этот дескриптор безопасности содержит все ACE, унаследованные и неунаследованные в текущем дескрипторе безопасности и в [*автономном*](/windows/desktop/SecGloss/s-gly) формате.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-121">This security descriptor contains all of the ACEs, inherited and noninherited, in the current security descriptor and is in [*self-relative*](/windows/desktop/SecGloss/s-gly) format.</span></span> <span data-ttu-id="f1ac0-122">Функция **конверттоаутоинхеритприватеобжектсекурити** определяет, являются ли элементы ACE унаследованными или ненаследованными путем сравнения всех записей ACE в текущем дескрипторе безопасности со всеми записями ACE в родительском дескрипторе безопасности.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-122">The **ConvertToAutoInheritPrivateObjectSecurity** function determines whether the ACEs are inherited or noninherited by comparing all of the ACEs in the current security descriptor with all of the ACEs in its parent security descriptor.</span></span> <span data-ttu-id="f1ac0-123">Между двумя группами ACE может не быть однозначного соответствия.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-123">There may not be a one-to-one correspondence between the two groups of ACEs.</span></span> <span data-ttu-id="f1ac0-124">Например, ACE, который разрешает разрешение на чтение и запись, может быть эквивалентен двум записям ACE: ACE, который допускает разрешение на чтение, и запись ACE, которая разрешает разрешение на запись.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-124">For instance, an ACE that allows read/write permission can be equivalent to two ACEs: an ACE that allows read permission and an ACE that allows write permission.</span></span> <span data-ttu-id="f1ac0-125">Родительский дескриптор безопасности не может быть указан, если текущий дескриптор безопасности является родительским.</span><span class="sxs-lookup"><span data-stu-id="f1ac0-125">A parent security descriptor may not be supplied when the current security descriptor is the parent.</span></span>

 

 
