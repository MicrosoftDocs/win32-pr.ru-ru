---
description: Когда поток пытается получить доступ к защищаемому объекту, система либо предоставляет, либо запрещает доступ.
ms.assetid: dc98b23e-ce42-4d4a-a285-c0b7b5e2a478
title: Как работает AccessCheck
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 730cc8f63e7d69bf4cb38344f5eda60861d08a9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "104568703"
---
# <a name="how-accesscheck-works"></a><span data-ttu-id="e11f2-103">Как работает AccessCheck</span><span class="sxs-lookup"><span data-stu-id="e11f2-103">How AccessCheck Works</span></span>

<span data-ttu-id="e11f2-104">Когда поток пытается получить доступ к защищаемому объекту, система либо предоставляет, либо запрещает доступ.</span><span class="sxs-lookup"><span data-stu-id="e11f2-104">When a thread tries to access a securable object, the system either grants or denies access.</span></span> <span data-ttu-id="e11f2-105">Если объект не имеет [*списка управления доступом на уровне пользователей*](/windows/desktop/SecGloss/d-gly) (DACL), система предоставляет доступ; в противном случае система ищет [записи контроля доступа](access-control-entries.md) (ACE) в списке DACL объекта, который применяется к потоку.</span><span class="sxs-lookup"><span data-stu-id="e11f2-105">If the object does not have a [*discretionary access control list*](/windows/desktop/SecGloss/d-gly) (DACL), the system grants access; otherwise, the system looks for [Access Control Entries](access-control-entries.md) (ACEs) in the object's DACL that apply to the thread.</span></span> <span data-ttu-id="e11f2-106">Каждый элемент ACE в списке DACL объекта определяет права доступа, разрешенные или запрещенные для [доверенного лица](trustees.md), которое может быть учетной записью пользователя, учетной записью группы или [*сеансом входа в систему*](/windows/desktop/SecGloss/l-gly).</span><span class="sxs-lookup"><span data-stu-id="e11f2-106">Each ACE in the object's DACL specifies the access rights allowed or denied for a [trustee](trustees.md), which can be a user account, a group account, or a [*logon session*](/windows/desktop/SecGloss/l-gly).</span></span>

## <a name="dacls"></a><span data-ttu-id="e11f2-107">DACL</span><span class="sxs-lookup"><span data-stu-id="e11f2-107">DACLs</span></span>

<span data-ttu-id="e11f2-108">Система сравнивает доверенное лицо в каждом ACE с доверенными лицами, определенными в [маркере доступа](access-tokens.md)потока.</span><span class="sxs-lookup"><span data-stu-id="e11f2-108">The system compares the trustee in each ACE to the trustees identified in the thread's [access token](access-tokens.md).</span></span> <span data-ttu-id="e11f2-109">Маркер доступа содержит [*идентификаторы безопасности*](/windows/desktop/SecGloss/s-gly) (SID), которые определяют пользователя и учетные записи групп, к которым принадлежит пользователь.</span><span class="sxs-lookup"><span data-stu-id="e11f2-109">An access token contains [*security identifiers*](/windows/desktop/SecGloss/s-gly) (SIDs) that identify the user and the group accounts to which the user belongs.</span></span> <span data-ttu-id="e11f2-110">Маркер также содержит [*идентификатор безопасности входа в систему*](/windows/desktop/SecGloss/l-gly) , определяющий текущий сеанс входа в систему.</span><span class="sxs-lookup"><span data-stu-id="e11f2-110">A token also contains a [*logon SID*](/windows/desktop/SecGloss/l-gly) that identifies the current logon session.</span></span> <span data-ttu-id="e11f2-111">Во время проверки доступа система не учитывает идентификаторы безопасности групп, которые не включены.</span><span class="sxs-lookup"><span data-stu-id="e11f2-111">During an access check, the system ignores group SIDs that are not enabled.</span></span> <span data-ttu-id="e11f2-112">Дополнительные сведения о включенных, отключенных и запрещенных идентификаторах безопасности см. [в разделе атрибуты SID в маркере доступа](sid-attributes-in-an-access-token.md).</span><span class="sxs-lookup"><span data-stu-id="e11f2-112">For more information on enabled, disabled, and deny-only SIDs, see [SID Attributes in an Access Token](sid-attributes-in-an-access-token.md).</span></span>

<span data-ttu-id="e11f2-113">Как правило, система использует [*основной маркер доступа*](/windows/desktop/SecGloss/p-gly) потока, запрашивающего доступ.</span><span class="sxs-lookup"><span data-stu-id="e11f2-113">Typically, the system uses the [*primary access token*](/windows/desktop/SecGloss/p-gly) of the thread that is requesting access.</span></span> <span data-ttu-id="e11f2-114">Однако если поток олицетворяет другого пользователя, система использует [*токен олицетворения*](/windows/desktop/SecGloss/i-gly)потока.</span><span class="sxs-lookup"><span data-stu-id="e11f2-114">However, if the thread is impersonating another user, the system uses the thread's [*impersonation token*](/windows/desktop/SecGloss/i-gly).</span></span>

<span data-ttu-id="e11f2-115">Система проверяет каждый элемент ACE в последовательности до тех пор, пока не произойдет одно из следующих событий:</span><span class="sxs-lookup"><span data-stu-id="e11f2-115">The system examines each ACE in sequence until one of the following events occurs:</span></span>

-   <span data-ttu-id="e11f2-116">ACE, запрещающий доступ, явно запрещает любой из запрошенных [прав доступа](access-rights-and-access-masks.md) к одному из доверенных лиц, перечисленных в маркере доступа потока.</span><span class="sxs-lookup"><span data-stu-id="e11f2-116">An access-denied ACE explicitly denies any of the requested [access rights](access-rights-and-access-masks.md) to one of the trustees listed in the thread's access token.</span></span>
-   <span data-ttu-id="e11f2-117">Один или несколько записей ACE, разрешенных доступом для доверенных лиц, указанных в маркере доступа потока, явным образом предоставляют все запрошенные права доступа.</span><span class="sxs-lookup"><span data-stu-id="e11f2-117">One or more access-allowed ACEs for trustees listed in the thread's access token explicitly grant all the requested access rights.</span></span>
-   <span data-ttu-id="e11f2-118">Все ACE проверены, и по-прежнему есть по крайней мере одно запрошенное право доступа, которое не было явно разрешено. в этом случае доступ неявно отклоняется.</span><span class="sxs-lookup"><span data-stu-id="e11f2-118">All ACEs have been checked and there is still at least one requested access right that has not been explicitly allowed, in which case, access is implicitly denied.</span></span>

<span data-ttu-id="e11f2-119">На следующем рисунке показано, как DACL объекта может разрешить доступ к одному потоку при запрете доступа к другому.</span><span class="sxs-lookup"><span data-stu-id="e11f2-119">The following illustration shows how an object's DACL can allow access to one thread while denying access to another.</span></span>

![списки DACL, которые предоставляют различные права доступа к разным потокам](images/accctrl1.png)

<span data-ttu-id="e11f2-121">Для потока а система считывает ACE 1 и немедленно запрещает доступ, так как доступ ACE, запрещенный для доступа, применяется к пользователю в маркере доступа потока.</span><span class="sxs-lookup"><span data-stu-id="e11f2-121">For Thread A, the system reads ACE 1 and immediately denies access because the access-denied ACE applies to the user in the thread's access token.</span></span> <span data-ttu-id="e11f2-122">В этом случае система не проверяет ACE 2 и 3.</span><span class="sxs-lookup"><span data-stu-id="e11f2-122">In this case, the system does not check ACEs 2 and 3.</span></span> <span data-ttu-id="e11f2-123">Для потока B элемент управления доступом 1 не применяется, поэтому система переходит к записи ACE 2, которая обеспечивает доступ на запись, и запись ACE 3, которая разрешает доступ для чтения и выполнения.</span><span class="sxs-lookup"><span data-stu-id="e11f2-123">For Thread B, ACE 1 does not apply, so the system proceeds to ACE 2, which allows write access, and ACE 3 which allows read and execute access.</span></span>

<span data-ttu-id="e11f2-124">Поскольку система прекращает проверку ACE, когда запрошенный доступ явно предоставлен или запрещен, важен порядок записей ACE в списке DACL.</span><span class="sxs-lookup"><span data-stu-id="e11f2-124">Because the system stops checking ACEs when the requested access is explicitly granted or denied, the order of ACEs in a DACL is important.</span></span> <span data-ttu-id="e11f2-125">Обратите внимание, что если в этом примере порядок ACE был различным, система, возможно, предоставила доступ к потоку а. Для системных объектов операционная система определяет предпочтительный [порядок записей ACE в списке DACL](order-of-aces-in-a-dacl.md).</span><span class="sxs-lookup"><span data-stu-id="e11f2-125">Note that if the ACE order were different in the example, the system might have granted access to Thread A. For system objects, the operating system defines a preferred [order of ACEs in a DACL](order-of-aces-in-a-dacl.md).</span></span>

 

 
