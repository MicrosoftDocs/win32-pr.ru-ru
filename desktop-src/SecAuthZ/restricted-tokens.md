---
description: Ограниченный маркер — это маркер доступа к основному или олицетворению, который был изменен функцией CreateRestrictedToken.
ms.assetid: 06580ab9-ff58-4aa9-bf88-9536a2e1981d
title: Ограниченные токены
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 53f63402997d9e1304ca75ca117554ce52c3aa727f44b3b8316c28e1ecfcea45
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2021
ms.locfileid: "118912012"
---
# <a name="restricted-tokens"></a>Ограниченные токены

Ограниченный маркер — это [*маркер доступа к*](/windows/desktop/SecGloss/a-gly) [*основному*](/windows/desktop/SecGloss/p-gly) или олицетворению, который был изменен функцией [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) . [*Процесс*](/windows/desktop/SecGloss/p-gly) или поток олицетворения, выполняющийся в [*контексте безопасности*](/windows/desktop/SecGloss/s-gly) ограниченного маркера, ограничен возможностью доступа к защищаемым объектам или выполнения привилегированных операций. Функция **CreateRestrictedToken** может ограничивать токен следующими способами.

-   Удалите [права доступа](privileges.md) из токена.
-   Примените атрибут Deny-only к идентификаторам безопасности в токене, чтобы их нельзя было использовать для доступа к защищенным объектам. Дополнительные сведения об атрибуте Deny-only см. [в разделе атрибуты SID в маркере доступа](sid-attributes-in-an-access-token.md).
-   Укажите список ограничивающих идентификаторов безопасности, которые могут ограничивать доступ к защищаемым объектам.

Система использует список ограниченных идентификаторов безопасности при проверке доступа маркера к защищаемому объекту. Когда ограниченный процесс или поток пытается получить доступ к защищаемому объекту, система выполняет две проверки доступа: один использует идентификаторы SID, включенные в маркер, а другой — с помощью списка ограничивающих идентификаторов безопасности. Доступ предоставляется только в том случае, если обе проверки доступа допускают запрошенные права доступа. Дополнительные сведения о проверках доступа см. [в статье Управление доступом к объекту в DACL](how-dacls-control-access-to-an-object.md).

Можно использовать ограниченный [*первичный токен*](/windows/desktop/SecGloss/p-gly) в вызове функции [**параметр CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) . как правило, процесс, вызывающий **параметр createprocessasuser** , должен SE \_ иметь \_ привилегию имени ассигнпримаритокен, которая обычно удерживается только системным кодом или службами, работающими в учетной записи LocalSystem. Однако если в вызове **параметр CreateProcessAsUser** указана ограниченная версия основного маркера вызывающего, это право не требуется. Это позволяет обычным приложениям создавать ограниченные процессы.

Можно также использовать ограниченный первичный или [*олицетворенный токен*](/windows/desktop/SecGloss/i-gly) в функции [**имперсонателогжедонусер**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) .

Чтобы определить, имеет ли маркер список с ограниченными идентификаторами безопасности, вызовите функцию [**истокенрестриктед**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) .

> [!Note]  
> Приложения, использующие ограниченные маркеры, должны запускать ограниченное приложение на настольных компьютерах, кроме рабочего стола по умолчанию. Это необходимо для предотвращения атак с ограниченным приложением с использованием **SendMessage** или **сообщений** в неограниченных приложениях на рабочем столе по умолчанию. При необходимости переключитесь между настольными системами в целях приложения.

 

 

 
