---
description: Ограниченный маркер — это маркер доступа к основному или олицетворению, который был изменен функцией CreateRestrictedToken.
ms.assetid: 06580ab9-ff58-4aa9-bf88-9536a2e1981d
title: Ограниченные токены
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fee8e6c89915e3edd0a9206f84a0d3d5697a3cb9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104154758"
---
# <a name="restricted-tokens"></a><span data-ttu-id="2043c-103">Ограниченные токены</span><span class="sxs-lookup"><span data-stu-id="2043c-103">Restricted Tokens</span></span>

<span data-ttu-id="2043c-104">Ограниченный маркер — это [*маркер доступа к*](/windows/desktop/SecGloss/a-gly) [*основному*](/windows/desktop/SecGloss/p-gly) или олицетворению, который был изменен функцией [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) .</span><span class="sxs-lookup"><span data-stu-id="2043c-104">A restricted token is a [*primary*](/windows/desktop/SecGloss/p-gly) or impersonation [*access token*](/windows/desktop/SecGloss/a-gly) that has been modified by the [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) function.</span></span> <span data-ttu-id="2043c-105">[*Процесс*](/windows/desktop/SecGloss/p-gly) или поток олицетворения, выполняющийся в [*контексте безопасности*](/windows/desktop/SecGloss/s-gly) ограниченного маркера, ограничен возможностью доступа к защищаемым объектам или выполнения привилегированных операций.</span><span class="sxs-lookup"><span data-stu-id="2043c-105">A [*process*](/windows/desktop/SecGloss/p-gly) or impersonating thread running in the [*security context*](/windows/desktop/SecGloss/s-gly) of a restricted token is restricted in its ability to access securable objects or perform privileged operations.</span></span> <span data-ttu-id="2043c-106">Функция **CreateRestrictedToken** может ограничивать токен следующими способами.</span><span class="sxs-lookup"><span data-stu-id="2043c-106">The **CreateRestrictedToken** function can restrict a token in the following ways:</span></span>

-   <span data-ttu-id="2043c-107">Удалите [права доступа](privileges.md) из токена.</span><span class="sxs-lookup"><span data-stu-id="2043c-107">Remove [privileges](privileges.md) from the token.</span></span>
-   <span data-ttu-id="2043c-108">Примените атрибут Deny-only к идентификаторам безопасности в токене, чтобы их нельзя было использовать для доступа к защищенным объектам.</span><span class="sxs-lookup"><span data-stu-id="2043c-108">Apply the deny-only attribute to SIDs in the token so that they cannot be used to access secured objects.</span></span> <span data-ttu-id="2043c-109">Дополнительные сведения об атрибуте Deny-only см. [в разделе атрибуты SID в маркере доступа](sid-attributes-in-an-access-token.md).</span><span class="sxs-lookup"><span data-stu-id="2043c-109">For more information about the deny-only attribute, see [SID Attributes in an Access Token](sid-attributes-in-an-access-token.md).</span></span>
-   <span data-ttu-id="2043c-110">Укажите список ограничивающих идентификаторов безопасности, которые могут ограничивать доступ к защищаемым объектам.</span><span class="sxs-lookup"><span data-stu-id="2043c-110">Specify a list of restricting SIDs, which can limit access to securable objects.</span></span>

<span data-ttu-id="2043c-111">Система использует список ограниченных идентификаторов безопасности при проверке доступа маркера к защищаемому объекту.</span><span class="sxs-lookup"><span data-stu-id="2043c-111">The system uses the list of restricting SIDs when it checks the token's access to a securable object.</span></span> <span data-ttu-id="2043c-112">Когда ограниченный процесс или поток пытается получить доступ к защищаемому объекту, система выполняет две проверки доступа: один использует идентификаторы SID, включенные в маркер, а другой — с помощью списка ограничивающих идентификаторов безопасности.</span><span class="sxs-lookup"><span data-stu-id="2043c-112">When a restricted process or thread tries to access a securable object, the system performs two access checks: one using the token's enabled SIDs, and another using the list of restricting SIDs.</span></span> <span data-ttu-id="2043c-113">Доступ предоставляется только в том случае, если обе проверки доступа допускают запрошенные права доступа.</span><span class="sxs-lookup"><span data-stu-id="2043c-113">Access is granted only if both access checks allow the requested access rights.</span></span> <span data-ttu-id="2043c-114">Дополнительные сведения о проверках доступа см. [в статье Управление доступом к объекту в DACL](how-dacls-control-access-to-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="2043c-114">For more information about access checks, see [How DACLs Control Access to an Object](how-dacls-control-access-to-an-object.md).</span></span>

<span data-ttu-id="2043c-115">Можно использовать ограниченный [*первичный токен*](/windows/desktop/SecGloss/p-gly) в вызове функции [**параметр CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) .</span><span class="sxs-lookup"><span data-stu-id="2043c-115">You can use a restricted [*primary token*](/windows/desktop/SecGloss/p-gly) in a call to the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function.</span></span> <span data-ttu-id="2043c-116">Как правило, процесс, вызывающий **параметр CreateProcessAsUser** , должен иметь \_ \_ привилегию SE ассигнпримаритокен Name, которая обычно удерживается только системным кодом или службами, работающими в учетной записи LocalSystem.</span><span class="sxs-lookup"><span data-stu-id="2043c-116">Typically, the process that calls **CreateProcessAsUser** must have the SE\_ASSIGNPRIMARYTOKEN\_NAME privilege, which is usually held only by system code or by services running in the LocalSystem account.</span></span> <span data-ttu-id="2043c-117">Однако если в вызове **параметр CreateProcessAsUser** указана ограниченная версия основного маркера вызывающего, это право не требуется.</span><span class="sxs-lookup"><span data-stu-id="2043c-117">However, if the **CreateProcessAsUser** call specifies a restricted version of the caller's primary token, this privilege is not required.</span></span> <span data-ttu-id="2043c-118">Это позволяет обычным приложениям создавать ограниченные процессы.</span><span class="sxs-lookup"><span data-stu-id="2043c-118">This enables ordinary applications to create restricted processes.</span></span>

<span data-ttu-id="2043c-119">Можно также использовать ограниченный первичный или [*олицетворенный токен*](/windows/desktop/SecGloss/i-gly) в функции [**имперсонателогжедонусер**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) .</span><span class="sxs-lookup"><span data-stu-id="2043c-119">You can also use a restricted primary or [*impersonation token*](/windows/desktop/SecGloss/i-gly) in the [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) function.</span></span>

<span data-ttu-id="2043c-120">Чтобы определить, имеет ли маркер список с ограниченными идентификаторами безопасности, вызовите функцию [**истокенрестриктед**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) .</span><span class="sxs-lookup"><span data-stu-id="2043c-120">To determine whether a token has a list of restricting SIDs, call the [**IsTokenRestricted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) function.</span></span>

> [!Note]  
> <span data-ttu-id="2043c-121">Приложения, использующие ограниченные маркеры, должны запускать ограниченное приложение на настольных компьютерах, кроме рабочего стола по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2043c-121">Applications that use restricted tokens should run the restricted application on desktops other than the default desktop.</span></span> <span data-ttu-id="2043c-122">Это необходимо для предотвращения атак с ограниченным приложением с использованием **SendMessage** или **сообщений** в неограниченных приложениях на рабочем столе по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2043c-122">This is necessary to prevent an attack by a restricted application, using **SendMessage** or **PostMessage**, to unrestricted applications on the default desktop.</span></span> <span data-ttu-id="2043c-123">При необходимости переключитесь между настольными системами в целях приложения.</span><span class="sxs-lookup"><span data-stu-id="2043c-123">If necessary, switch between desktops for your application purposes.</span></span>

 

 

 
