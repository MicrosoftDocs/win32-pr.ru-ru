---
description: Маркер доступа — это объект, описывающий контекст безопасности процесса или потока.
ms.assetid: 350159c9-2399-427a-ba44-c897a9664299
title: Маркеры доступа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0993c1f5aebab797ab28e61b36f59507e4d2f1ab
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103910620"
---
# <a name="access-tokens"></a><span data-ttu-id="a384a-103">Маркеры доступа</span><span class="sxs-lookup"><span data-stu-id="a384a-103">Access Tokens</span></span>

<span data-ttu-id="a384a-104">[*Маркер доступа*](/windows/desktop/SecGloss/a-gly) — это объект, описывающий [*контекст безопасности*](/windows/desktop/SecGloss/s-gly) [*процесса*](/windows/desktop/SecGloss/p-gly) или потока.</span><span class="sxs-lookup"><span data-stu-id="a384a-104">An [*access token*](/windows/desktop/SecGloss/a-gly) is an object that describes the [*security context*](/windows/desktop/SecGloss/s-gly) of a [*process*](/windows/desktop/SecGloss/p-gly) or thread.</span></span> <span data-ttu-id="a384a-105">Сведения в маркере включают удостоверение и привилегии учетной записи пользователя, связанной с процессом или потоком.</span><span class="sxs-lookup"><span data-stu-id="a384a-105">The information in a token includes the identity and privileges of the user account associated with the process or thread.</span></span> <span data-ttu-id="a384a-106">Когда пользователь входит в систему, система проверяет пароль пользователя, сравнивая его со сведениями, хранящимися в базе данных безопасности.</span><span class="sxs-lookup"><span data-stu-id="a384a-106">When a user logs on, the system verifies the user's password by comparing it with information stored in a security database.</span></span> <span data-ttu-id="a384a-107">Если пароль [*прошел проверку подлинности*](/windows/desktop/SecGloss/a-gly), система создает маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-107">If the password is [*authenticated*](/windows/desktop/SecGloss/a-gly), the system produces an access token.</span></span> <span data-ttu-id="a384a-108">Каждый процесс, выполняемый от имени этого пользователя, имеет копию этого маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-108">Every process executed on behalf of this user has a copy of this access token.</span></span>

<span data-ttu-id="a384a-109">Система использует маркер доступа для указания пользователя, когда поток взаимодействует с [защищаемым объектом](securable-objects.md) или пытается выполнить системную задачу, требующую привилегий.</span><span class="sxs-lookup"><span data-stu-id="a384a-109">The system uses an access token to identify the user when a thread interacts with a [securable object](securable-objects.md) or tries to perform a system task that requires privileges.</span></span> <span data-ttu-id="a384a-110">Маркеры доступа содержат следующие сведения:</span><span class="sxs-lookup"><span data-stu-id="a384a-110">Access tokens contain the following information:</span></span>

-   <span data-ttu-id="a384a-111">[Идентификатор безопасности](security-identifiers.md) (SID) для учетной записи пользователя</span><span class="sxs-lookup"><span data-stu-id="a384a-111">The [security identifier](security-identifiers.md) (SID) for the user's account</span></span>
-   <span data-ttu-id="a384a-112">Идентификаторы безопасности для групп, членом которых является пользователь</span><span class="sxs-lookup"><span data-stu-id="a384a-112">SIDs for the groups of which the user is a member</span></span>
-   <span data-ttu-id="a384a-113">[*Идентификатор безопасности входа*](/windows/desktop/SecGloss/l-gly) , определяющий текущий [*сеанс входа в систему*](/windows/desktop/SecGloss/l-gly) .</span><span class="sxs-lookup"><span data-stu-id="a384a-113">A [*logon SID*](/windows/desktop/SecGloss/l-gly) that identifies the current [*logon session*](/windows/desktop/SecGloss/l-gly)</span></span>
-   <span data-ttu-id="a384a-114">Список [привилегий](privileges.md) , хранящихся у пользователя или в группах пользователя.</span><span class="sxs-lookup"><span data-stu-id="a384a-114">A list of the [privileges](privileges.md) held by either the user or the user's groups</span></span>
-   <span data-ttu-id="a384a-115">Идентификатор безопасности владельца</span><span class="sxs-lookup"><span data-stu-id="a384a-115">An owner SID</span></span>
-   <span data-ttu-id="a384a-116">Идентификатор безопасности для основной группы</span><span class="sxs-lookup"><span data-stu-id="a384a-116">The SID for the primary group</span></span>
-   <span data-ttu-id="a384a-117">[Список DACL](access-control-lists.md) по умолчанию, используемый системой при создании пользователем защищаемого объекта без указания [*дескриптора безопасности*](/windows/desktop/SecGloss/s-gly)</span><span class="sxs-lookup"><span data-stu-id="a384a-117">The default [DACL](access-control-lists.md) that the system uses when the user creates a securable object without specifying a [*security descriptor*](/windows/desktop/SecGloss/s-gly)</span></span>
-   <span data-ttu-id="a384a-118">Источник маркера доступа</span><span class="sxs-lookup"><span data-stu-id="a384a-118">The source of the access token</span></span>
-   <span data-ttu-id="a384a-119">Является ли маркер [*основным*](/windows/desktop/SecGloss/p-gly) маркером или токеном [олицетворения](client-impersonation.md)</span><span class="sxs-lookup"><span data-stu-id="a384a-119">Whether the token is a [*primary*](/windows/desktop/SecGloss/p-gly) or [impersonation](client-impersonation.md) token</span></span>
-   <span data-ttu-id="a384a-120">Необязательный список с [максимальным идентификатором SID](restricted-tokens.md)</span><span class="sxs-lookup"><span data-stu-id="a384a-120">An optional list of [restricting SIDs](restricted-tokens.md)</span></span>
-   <span data-ttu-id="a384a-121">Текущие уровни олицетворения</span><span class="sxs-lookup"><span data-stu-id="a384a-121">Current impersonation levels</span></span>
-   <span data-ttu-id="a384a-122">Другая статистика</span><span class="sxs-lookup"><span data-stu-id="a384a-122">Other statistics</span></span>

<span data-ttu-id="a384a-123">Каждый процесс имеет [*основной маркер*](/windows/desktop/SecGloss/p-gly) , описывающий [*контекст безопасности*](/windows/desktop/SecGloss/s-gly) учетной записи пользователя, связанной с процессом.</span><span class="sxs-lookup"><span data-stu-id="a384a-123">Every process has a [*primary token*](/windows/desktop/SecGloss/p-gly) that describes the [*security context*](/windows/desktop/SecGloss/s-gly) of the user account associated with the process.</span></span> <span data-ttu-id="a384a-124">По умолчанию система использует основной маркер, когда поток процесса взаимодействует с защищаемым объектом.</span><span class="sxs-lookup"><span data-stu-id="a384a-124">By default, the system uses the primary token when a thread of the process interacts with a securable object.</span></span> <span data-ttu-id="a384a-125">Более того, поток может олицетворять учетную запись клиента.</span><span class="sxs-lookup"><span data-stu-id="a384a-125">Moreover, a thread can impersonate a client account.</span></span> <span data-ttu-id="a384a-126">Олицетворение позволяет потоку взаимодействовать с защищаемыми объектами с помощью контекста безопасности клиента.</span><span class="sxs-lookup"><span data-stu-id="a384a-126">Impersonation allows the thread to interact with securable objects using the client's security context.</span></span> <span data-ttu-id="a384a-127">Поток, выполняющий олицетворение клиента, имеет как основной, так и [*олицетворенный токен*](/windows/desktop/SecGloss/i-gly).</span><span class="sxs-lookup"><span data-stu-id="a384a-127">A thread that is impersonating a client has both a primary token and an [*impersonation token*](/windows/desktop/SecGloss/i-gly).</span></span>

<span data-ttu-id="a384a-128">Используйте функцию [**OpenProcessToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocesstoken) , чтобы получить маркер основного маркера процесса.</span><span class="sxs-lookup"><span data-stu-id="a384a-128">Use the [**OpenProcessToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocesstoken) function to retrieve a handle to the primary token of a process.</span></span> <span data-ttu-id="a384a-129">Используйте функцию [**опенсреадтокен**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) для получения маркера для маркера олицетворения потока.</span><span class="sxs-lookup"><span data-stu-id="a384a-129">Use the [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) function to retrieve a handle to the impersonation token of a thread.</span></span> <span data-ttu-id="a384a-130">Дополнительные сведения см. в разделе [олицетворение](client-impersonation.md).</span><span class="sxs-lookup"><span data-stu-id="a384a-130">For more information, see [Impersonation](client-impersonation.md).</span></span>

<span data-ttu-id="a384a-131">Для управления маркерами доступа можно использовать следующие функции.</span><span class="sxs-lookup"><span data-stu-id="a384a-131">You can use the following functions to manipulate access tokens.</span></span>



| <span data-ttu-id="a384a-132">Функция</span><span class="sxs-lookup"><span data-stu-id="a384a-132">Function</span></span>                                               | <span data-ttu-id="a384a-133">Описание</span><span class="sxs-lookup"><span data-stu-id="a384a-133">Description</span></span>                                                                                                                                                            |
|--------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="a384a-134">**аджусттокенграупс**</span><span class="sxs-lookup"><span data-stu-id="a384a-134">**AdjustTokenGroups**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-adjusttokengroups)         | <span data-ttu-id="a384a-135">Изменяет сведения о группе в маркере доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-135">Changes the group information in an access token.</span></span>                                                                                                                      |
| [<span data-ttu-id="a384a-136">**AdjustTokenPrivileges**</span><span class="sxs-lookup"><span data-stu-id="a384a-136">**AdjustTokenPrivileges**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-adjusttokenprivileges) | <span data-ttu-id="a384a-137">Включает или отключает привилегии в маркере доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-137">Enables or disables the privileges in an access token.</span></span> <span data-ttu-id="a384a-138">Он не предоставляет новые права или не отзывает существующие.</span><span class="sxs-lookup"><span data-stu-id="a384a-138">It does not grant new privileges or revoke existing ones.</span></span>                                                       |
| [<span data-ttu-id="a384a-139">**чекктокенмембершип**</span><span class="sxs-lookup"><span data-stu-id="a384a-139">**CheckTokenMembership**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-checktokenmembership)   | <span data-ttu-id="a384a-140">Определяет, включен ли указанный идентификатор безопасности в указанном маркере доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-140">Determines whether a specified SID is enabled in a specified access token.</span></span>                                                                                             |
| [<span data-ttu-id="a384a-141">**CreateRestrictedToken**</span><span class="sxs-lookup"><span data-stu-id="a384a-141">**CreateRestrictedToken**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) | <span data-ttu-id="a384a-142">Создает новый токен, который является ограниченной версией существующего токена.</span><span class="sxs-lookup"><span data-stu-id="a384a-142">Creates a new token that is a restricted version of an existing token.</span></span> <span data-ttu-id="a384a-143">Маркер ограниченного доступа может иметь отключенные SID, удаленные права и список ограниченных идентификаторов безопасности.</span><span class="sxs-lookup"><span data-stu-id="a384a-143">The restricted token can have disabled SIDs, deleted privileges, and a list of restricted SIDs.</span></span> |
| [<span data-ttu-id="a384a-144">**Сбой duplicatetoken**</span><span class="sxs-lookup"><span data-stu-id="a384a-144">**DuplicateToken**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetoken)               | <span data-ttu-id="a384a-145">Создает новый токен олицетворения, который дублирует существующий токен.</span><span class="sxs-lookup"><span data-stu-id="a384a-145">Creates a new impersonation token that duplicates an existing token.</span></span>                                                                                                   |
| [<span data-ttu-id="a384a-146">**дупликатетокенекс**</span><span class="sxs-lookup"><span data-stu-id="a384a-146">**DuplicateTokenEx**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex)           | <span data-ttu-id="a384a-147">Создает новый основной маркер или маркер олицетворения, который дублирует существующий токен.</span><span class="sxs-lookup"><span data-stu-id="a384a-147">Creates a new primary token or impersonation token that duplicates an existing token.</span></span>                                                                                  |
| [<span data-ttu-id="a384a-148">**GetTokenInformation**</span><span class="sxs-lookup"><span data-stu-id="a384a-148">**GetTokenInformation**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation)     | <span data-ttu-id="a384a-149">Извлекает сведения о токене.</span><span class="sxs-lookup"><span data-stu-id="a384a-149">Retrieves information about a token.</span></span>                                                                                                                                   |
| [<span data-ttu-id="a384a-150">**истокенрестриктед**</span><span class="sxs-lookup"><span data-stu-id="a384a-150">**IsTokenRestricted**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted)         | <span data-ttu-id="a384a-151">Определяет, имеет ли маркер список идентификаторов SID.</span><span class="sxs-lookup"><span data-stu-id="a384a-151">Determines whether a token has a list of restricting SIDs.</span></span>                                                                                                             |
| [<span data-ttu-id="a384a-152">**OpenProcessToken**</span><span class="sxs-lookup"><span data-stu-id="a384a-152">**OpenProcessToken**</span></span>](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocesstoken)           | <span data-ttu-id="a384a-153">Извлекает маркер основного маркера доступа для процесса.</span><span class="sxs-lookup"><span data-stu-id="a384a-153">Retrieves a handle to the primary access token for a process.</span></span>                                                                                                          |
| [<span data-ttu-id="a384a-154">**опенсреадтокен**</span><span class="sxs-lookup"><span data-stu-id="a384a-154">**OpenThreadToken**</span></span>](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken)             | <span data-ttu-id="a384a-155">Возвращает маркер для маркера доступа олицетворения для потока.</span><span class="sxs-lookup"><span data-stu-id="a384a-155">Retrieves a handle to the impersonation access token for a thread.</span></span>                                                                                                     |
| [<span data-ttu-id="a384a-156">**сетсреадтокен**</span><span class="sxs-lookup"><span data-stu-id="a384a-156">**SetThreadToken**</span></span>](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadtoken)               | <span data-ttu-id="a384a-157">Назначает или удаляет маркер олицетворения для потока.</span><span class="sxs-lookup"><span data-stu-id="a384a-157">Assigns or removes an impersonation token for a thread.</span></span>                                                                                                                |
| [<span data-ttu-id="a384a-158">**сеттокенинформатион**</span><span class="sxs-lookup"><span data-stu-id="a384a-158">**SetTokenInformation**</span></span>](/windows/win32/api/securitybaseapi/nf-securitybaseapi-settokeninformation)     | <span data-ttu-id="a384a-159">Изменяет владельца маркера, основную группу или DACL по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a384a-159">Changes a token's owner, primary group, or default DACL.</span></span>                                                                                                               |



 

<span data-ttu-id="a384a-160">Функции маркеров доступа используют следующие структуры для описания частей маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-160">The access token functions use the following structures to describe the parts of an access token.</span></span>



| <span data-ttu-id="a384a-161">Структура</span><span class="sxs-lookup"><span data-stu-id="a384a-161">Structure</span></span>                                            | <span data-ttu-id="a384a-162">Описание</span><span class="sxs-lookup"><span data-stu-id="a384a-162">Description</span></span>                                                                                           |
|------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="a384a-163">**\_элемент управления токеном**</span><span class="sxs-lookup"><span data-stu-id="a384a-163">**TOKEN\_CONTROL**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_control)              | <span data-ttu-id="a384a-164">Сведения, определяющие маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-164">Information that identifies an access token.</span></span>                                                          |
| [<span data-ttu-id="a384a-165">**DACL МАРКЕРа \_ по умолчанию \_**</span><span class="sxs-lookup"><span data-stu-id="a384a-165">**TOKEN\_DEFAULT\_DACL**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_default_dacl)   | <span data-ttu-id="a384a-166">Список DACL по умолчанию, используемый системой в дескрипторах безопасности новых объектов, созданных потоком.</span><span class="sxs-lookup"><span data-stu-id="a384a-166">The default DACL that the system uses in the security descriptors of new objects created by a thread.</span></span> |
| [<span data-ttu-id="a384a-167">**группы ТОКЕНов \_**</span><span class="sxs-lookup"><span data-stu-id="a384a-167">**TOKEN\_GROUPS**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_groups)                | <span data-ttu-id="a384a-168">Указывает идентификаторы безопасности и атрибуты групповых идентификаторов безопасности в маркере доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-168">Specifies the SIDs and attributes of the group SIDs in an access token.</span></span>                               |
| [<span data-ttu-id="a384a-169">**Владелец ТОКЕНа \_**</span><span class="sxs-lookup"><span data-stu-id="a384a-169">**TOKEN\_OWNER**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_owner)                  | <span data-ttu-id="a384a-170">Идентификатор безопасности владельца по умолчанию для дескрипторов безопасности новых объектов.</span><span class="sxs-lookup"><span data-stu-id="a384a-170">The default owner SID for the security descriptors of new objects.</span></span>                                    |
| [<span data-ttu-id="a384a-171">**\_Основная \_ Группа маркера**</span><span class="sxs-lookup"><span data-stu-id="a384a-171">**TOKEN\_PRIMARY\_GROUP**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_primary_group) | <span data-ttu-id="a384a-172">Идентификатор безопасности основной группы по умолчанию для дескрипторов безопасности новых объектов.</span><span class="sxs-lookup"><span data-stu-id="a384a-172">The default primary group SID for the security descriptors of new objects.</span></span>                            |
| [<span data-ttu-id="a384a-173">**\_права доступа маркера**</span><span class="sxs-lookup"><span data-stu-id="a384a-173">**TOKEN\_PRIVILEGES**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_privileges)        | <span data-ttu-id="a384a-174">Привилегии, связанные с маркером доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-174">The privileges associated with an access token.</span></span> <span data-ttu-id="a384a-175">Также определяет, включены ли привилегии.</span><span class="sxs-lookup"><span data-stu-id="a384a-175">Also determines whether the privileges are enabled.</span></span>   |
| [<span data-ttu-id="a384a-176">**Источник ТОКЕНа \_**</span><span class="sxs-lookup"><span data-stu-id="a384a-176">**TOKEN\_SOURCE**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_source)                | <span data-ttu-id="a384a-177">Источник маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-177">The source of an access token.</span></span>                                                                        |
| [<span data-ttu-id="a384a-178">**\_Статистика маркеров**</span><span class="sxs-lookup"><span data-stu-id="a384a-178">**TOKEN\_STATISTICS**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_statistics)        | <span data-ttu-id="a384a-179">Статистика, связанная с маркером доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-179">Statistics associated with an access token.</span></span>                                                           |
| [<span data-ttu-id="a384a-180">**пользователь ТОКЕНа \_**</span><span class="sxs-lookup"><span data-stu-id="a384a-180">**TOKEN\_USER**</span></span>](/windows/desktop/api/Winnt/ns-winnt-token_user)                    | <span data-ttu-id="a384a-181">Идентификатор безопасности пользователя, связанного с маркером доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-181">The SID of the user associated with an access token.</span></span>                                                  |



 

<span data-ttu-id="a384a-182">Функции маркера доступа используют следующие типы перечислений.</span><span class="sxs-lookup"><span data-stu-id="a384a-182">The access token functions use the following enumeration types.</span></span>



| <span data-ttu-id="a384a-183">Тип перечисления</span><span class="sxs-lookup"><span data-stu-id="a384a-183">Enumeration type</span></span>                                             | <span data-ttu-id="a384a-184">Что определяет</span><span class="sxs-lookup"><span data-stu-id="a384a-184">Specifies</span></span>                                                                       |
|--------------------------------------------------------------|---------------------------------------------------------------------------------|
| [<span data-ttu-id="a384a-185">**\_класс сведений о токене \_**</span><span class="sxs-lookup"><span data-stu-id="a384a-185">**TOKEN\_INFORMATION\_CLASS**</span></span>](/windows/desktop/api/Winnt/ne-winnt-token_information_class) | <span data-ttu-id="a384a-186">Определяет тип сведений, которые задаются или извлекаются из маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="a384a-186">Identifies the type of information being set or retrieved from an access token.</span></span> |
| [<span data-ttu-id="a384a-187">**Тип ТОКЕНа \_**</span><span class="sxs-lookup"><span data-stu-id="a384a-187">**TOKEN\_TYPE**</span></span>](/windows/desktop/api/Winnt/ne-winnt-token_type)                            | <span data-ttu-id="a384a-188">Определяет маркер доступа как основной токен или маркер олицетворения.</span><span class="sxs-lookup"><span data-stu-id="a384a-188">Identifies an access token as a primary or impersonation token.</span></span>                 |



 

 

 
