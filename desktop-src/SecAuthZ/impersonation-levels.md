---
description: '\_ \_ Перечисление уровня олицетворения определяет четыре уровня олицетворения, определяющие операции, которые сервер может выполнять в контексте клиентов.'
ms.assetid: ae152dbf-44f0-417f-a85e-09bf60dcfcb0
title: Уровни олицетворения (авторизация)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b91654f42a86e5c47069197bed084df56f5445dd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105664307"
---
# <a name="impersonation-levels-authorization"></a><span data-ttu-id="60c9d-103">Уровни олицетворения (авторизация)</span><span class="sxs-lookup"><span data-stu-id="60c9d-103">Impersonation Levels (Authorization)</span></span>

<span data-ttu-id="60c9d-104">Перечисление [**\_ \_ уровня олицетворения**](/windows/desktop/api/Winnt/ne-winnt-security_impersonation_level) определяет четыре уровня олицетворения, определяющие операции, которые сервер может выполнять в контексте клиента.</span><span class="sxs-lookup"><span data-stu-id="60c9d-104">The [**SECURITY\_IMPERSONATION\_LEVEL**](/windows/desktop/api/Winnt/ne-winnt-security_impersonation_level) enumeration defines four impersonation levels that determine the operations a server can perform in the client's context.</span></span>



| <span data-ttu-id="60c9d-105">Уровень олицетворения</span><span class="sxs-lookup"><span data-stu-id="60c9d-105">Impersonation level</span></span>    | <span data-ttu-id="60c9d-106">Описание</span><span class="sxs-lookup"><span data-stu-id="60c9d-106">Description</span></span>                                                                                      |
|------------------------|--------------------------------------------------------------------------------------------------|
| <span data-ttu-id="60c9d-107">секуритянонимаус</span><span class="sxs-lookup"><span data-stu-id="60c9d-107">SecurityAnonymous</span></span>      | <span data-ttu-id="60c9d-108">Серверу не удается олицетворить или опознать клиента.</span><span class="sxs-lookup"><span data-stu-id="60c9d-108">The server cannot impersonate or identify the client.</span></span>                                            |
| <span data-ttu-id="60c9d-109">SecurityIdentification</span><span class="sxs-lookup"><span data-stu-id="60c9d-109">SecurityIdentification</span></span> | <span data-ttu-id="60c9d-110">Сервер может получить удостоверение и привилегии клиента, но не может олицетворять клиента.</span><span class="sxs-lookup"><span data-stu-id="60c9d-110">The server can get the identity and privileges of the client, but cannot impersonate the client.</span></span> |
| <span data-ttu-id="60c9d-111">секуритимперсонатион</span><span class="sxs-lookup"><span data-stu-id="60c9d-111">SecurityImpersonation</span></span>  | <span data-ttu-id="60c9d-112">Сервер может олицетворять контекст безопасности клиента в локальной системе.</span><span class="sxs-lookup"><span data-stu-id="60c9d-112">The server can impersonate the client's security context on the local system.</span></span>                    |
| <span data-ttu-id="60c9d-113">секуритиделегатион</span><span class="sxs-lookup"><span data-stu-id="60c9d-113">SecurityDelegation</span></span>     | <span data-ttu-id="60c9d-114">Сервер может олицетворять контекст безопасности клиента в удаленных системах.</span><span class="sxs-lookup"><span data-stu-id="60c9d-114">The server can impersonate the client's security context on remote systems.</span></span>                      |



 

<span data-ttu-id="60c9d-115">Клиент с именованным каналом, RPC или сеансом DDE может управлять уровнем олицетворения.</span><span class="sxs-lookup"><span data-stu-id="60c9d-115">The client of a named pipe, RPC, or DDE connection can control the impersonation level.</span></span> <span data-ttu-id="60c9d-116">Например, клиент именованного канала может вызвать функцию [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , чтобы открыть маркер для именованного канала и указать уровень олицетворения сервера.</span><span class="sxs-lookup"><span data-stu-id="60c9d-116">For example, a named pipe client can call the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function to open a handle to a named pipe and specify the server's impersonation level.</span></span>

<span data-ttu-id="60c9d-117">Если именованный канал, RPC или сеанс DDE является удаленным, флаги, передаваемые в [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) для установки уровня олицетворения, игнорируются.</span><span class="sxs-lookup"><span data-stu-id="60c9d-117">When the named pipe, RPC, or DDE connection is remote, the flags passed to [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) to set the impersonation level are ignored.</span></span> <span data-ttu-id="60c9d-118">В этом случае уровень олицетворения клиента определяется уровнями олицетворения, включенными сервером, который задается флагом на учетной записи сервера в службе каталогов.</span><span class="sxs-lookup"><span data-stu-id="60c9d-118">In this case, the impersonation level of the client is determined by the impersonation levels enabled by the server, which is set by a flag on the server's account in the directory service.</span></span> <span data-ttu-id="60c9d-119">Например, если на сервере разрешено делегирование, то уровень олицетворения клиента также будет настроен на делегирование, даже если флаги, передаваемые в **CreateFile** , указывают уровень олицетворения идентификации.</span><span class="sxs-lookup"><span data-stu-id="60c9d-119">For example, if the server is enabled for delegation, the client's impersonation level will also be set to delegation even if the flags passed to **CreateFile** specify the identification impersonation level.</span></span>

<span data-ttu-id="60c9d-120">Клиенты DDE используют функцию [**ддесеткуалитйофсервице**](/windows/win32/api/dde/nf-dde-ddesetqualityofservice) со структурой [**\_ качества \_ \_ службы безопасности**](/windows/desktop/api/Winnt/ns-winnt-security_quality_of_service) для указания уровня олицетворения.</span><span class="sxs-lookup"><span data-stu-id="60c9d-120">DDE clients use the [**DdeSetQualityOfService**](/windows/win32/api/dde/nf-dde-ddesetqualityofservice) function with the [**SECURITY\_QUALITY\_OF\_SERVICE**](/windows/desktop/api/Winnt/ns-winnt-security_quality_of_service) structure to specify the impersonation level.</span></span> <span data-ttu-id="60c9d-121">По умолчанию для именованных каналов, RPC и серверов DDE используется уровень Секуритимперсонатион.</span><span class="sxs-lookup"><span data-stu-id="60c9d-121">The SecurityImpersonation level is the default for named pipe, RPC, and DDE servers.</span></span> <span data-ttu-id="60c9d-122">Функции [**имперсонатеселф**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateself), [**сбой duplicatetoken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetoken)и [**дупликатетокенекс**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) позволяют вызывающей стороне указать уровень олицетворения.</span><span class="sxs-lookup"><span data-stu-id="60c9d-122">The [**ImpersonateSelf**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateself), [**DuplicateToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetoken), and [**DuplicateTokenEx**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-duplicatetokenex) functions allow the caller to specify an impersonation level.</span></span> <span data-ttu-id="60c9d-123">Используйте функцию [**GetTokenInformation**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation) для получения уровня олицетворения [*маркера доступа*](/windows/desktop/SecGloss/a-gly).</span><span class="sxs-lookup"><span data-stu-id="60c9d-123">Use the [**GetTokenInformation**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-gettokeninformation) function to retrieve the impersonation level of an [*access token*](/windows/desktop/SecGloss/a-gly).</span></span>

<span data-ttu-id="60c9d-124">На уровне Секуритимперсонатион большая часть действий потока выполняется в контексте безопасности [*токена олицетворения*](/windows/desktop/SecGloss/i-gly) потока, а не в [*первичном маркере*](/windows/desktop/SecGloss/p-gly) [*процесса*](/windows/desktop/SecGloss/p-gly) , владеющего потоком.</span><span class="sxs-lookup"><span data-stu-id="60c9d-124">At the SecurityImpersonation level, most of the thread's actions occur in the security context of the thread's [*impersonation token*](/windows/desktop/SecGloss/i-gly) rather than in the [*primary token*](/windows/desktop/SecGloss/p-gly) of the [*process*](/windows/desktop/SecGloss/p-gly) that owns the thread.</span></span> <span data-ttu-id="60c9d-125">Например, если олицетворенный поток открывает [защищаемый объект](securable-objects.md), система использует токен олицетворения для проверки доступа к потоку.</span><span class="sxs-lookup"><span data-stu-id="60c9d-125">For example, if an impersonating thread opens a [securable object](securable-objects.md), the system uses the impersonation token to check the thread's access.</span></span> <span data-ttu-id="60c9d-126">Аналогично, если олицетворенный поток создает новый объект, например путем вызова функции [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) , владельцем нового объекта является владелец по умолчанию от [*маркера доступа*](/windows/desktop/SecGloss/a-gly)клиента.</span><span class="sxs-lookup"><span data-stu-id="60c9d-126">Similarly, if an impersonating thread creates a new object, for example by calling the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function, the owner of the new object is the default owner from the client's [*access token*](/windows/desktop/SecGloss/a-gly).</span></span>

<span data-ttu-id="60c9d-127">Однако система использует основной маркер процесса, а не маркер олицетворения вызывающего потока в следующих ситуациях:</span><span class="sxs-lookup"><span data-stu-id="60c9d-127">However, the system uses the primary token of the process rather than the impersonation token of the calling thread in the following situations:</span></span>

-   <span data-ttu-id="60c9d-128">Если олицетворенный поток вызывает функцию [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) , новый процесс всегда наследует основной маркер процесса.</span><span class="sxs-lookup"><span data-stu-id="60c9d-128">If an impersonating thread calls the [**CreateProcess**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa) function, the new process always inherits the primary token of the process.</span></span>
-   <span data-ttu-id="60c9d-129">Для функций, которым требуется привилегия SE с \_ \_ именем TCB, например функция [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) , система всегда проверяет наличие привилегии в первичном маркере процесса.</span><span class="sxs-lookup"><span data-stu-id="60c9d-129">For functions that require the SE\_TCB\_NAME privilege, such as the [**LogonUser**](/windows/desktop/api/winbase/nf-winbase-logonusera) function, the system always checks for the privilege in the primary token of the process.</span></span>
-   <span data-ttu-id="60c9d-130">Для функций, которым требуется \_ привилегия разрешения \_ имен аудита SE, например функция [**обжектопенаудиталарм**](/windows/desktop/api/Winbase/nf-winbase-objectopenauditalarma) , система всегда проверяет наличие привилегии в первичном маркере процесса.</span><span class="sxs-lookup"><span data-stu-id="60c9d-130">For functions that require the SE\_AUDIT\_NAME privilege, such as the [**ObjectOpenAuditAlarm**](/windows/desktop/api/Winbase/nf-winbase-objectopenauditalarma) function, the system always checks for the privilege in the primary token of the process.</span></span>
-   <span data-ttu-id="60c9d-131">При вызове функции [**опенсреадтокен**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) поток может указать, использует ли функция маркер олицетворения или первичный токен, чтобы определить, предоставлять ли запрошенный доступ.</span><span class="sxs-lookup"><span data-stu-id="60c9d-131">In a call to the [**OpenThreadToken**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthreadtoken) function, a thread can specify whether the function uses the impersonation token or the primary token to determine whether to grant the requested access.</span></span>

 

 
