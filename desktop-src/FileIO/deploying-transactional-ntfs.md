---
description: Управление кэшированием в транзакционной NTFS.
ms.assetid: 0fd272ee-cf5f-4ba9-b8aa-ff0016f51d4b
title: Развертывание транзакционной NTFS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bd7c44e0ad3b83854e56d18171072a7cb4615d5c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103991542"
---
# <a name="deploying-transactional-ntfs"></a><span data-ttu-id="c8753-103">Развертывание транзакционной NTFS</span><span class="sxs-lookup"><span data-stu-id="c8753-103">Deploying Transactional NTFS</span></span>

<span data-ttu-id="c8753-104">Транзакционная NTFS (TxF), как и большинство механизмов транзакций, зависит от правильного упорядочения операций записи данных.</span><span class="sxs-lookup"><span data-stu-id="c8753-104">Transactional NTFS (TxF), like most transaction mechanisms, depends upon correct ordering of data writes.</span></span> <span data-ttu-id="c8753-105">Обеспечение надлежащего порядка записи требует явного управления кэшированием данных.</span><span class="sxs-lookup"><span data-stu-id="c8753-105">Ensuring proper write ordering requires explicit control of data caching.</span></span> <span data-ttu-id="c8753-106">Для удовлетворения этого требования TxF требует, чтобы дисковые накопители применялись к механизмам управления кэшированием, которые являются частью стандартизированных интерфейсов дисков, таких как SCSI, SATA и ATA.</span><span class="sxs-lookup"><span data-stu-id="c8753-106">To meet this requirement, TxF requires that disk drives implement the caching control mechanisms that are part of standardized drive interfaces such as SCSI, SATA, and ATA.</span></span>

<span data-ttu-id="c8753-107">Механизм управления кэшированием, используемый TxF, — это флаг, известный как функция принудительного доступа к блоку (Фуа).</span><span class="sxs-lookup"><span data-stu-id="c8753-107">The caching control mechanism used by TxF is a flag known as the Force Unit Access (FUA) function.</span></span> <span data-ttu-id="c8753-108">Этот флаг указывает, что диск должен записывать данные в стабильное хранилище мультимедиа до завершения передачи сигнала.</span><span class="sxs-lookup"><span data-stu-id="c8753-108">This flag specifies that the drive should write the data to stable media storage before signaling complete.</span></span> <span data-ttu-id="c8753-109">В некоторых критических точках транзакции TxF должен выдать Фуа, чтобы гарантировать, что некоторые данные элемента управления, необходимые для успешного отката транзакции, не теряются в случае сбоя питания.</span><span class="sxs-lookup"><span data-stu-id="c8753-109">At certain critical points within a transaction, TxF needs to issue an FUA to ensure that some control data necessary to successfully rollback a transaction is not lost if a power failure occurs.</span></span>

<span data-ttu-id="c8753-110">Диски серверного класса (SCSI и волоконный канал) обычно поддерживают флаг Фуа.</span><span class="sxs-lookup"><span data-stu-id="c8753-110">Server-class disk drives (SCSI and Fiber Channel) generally support the FUA flag.</span></span> <span data-ttu-id="c8753-111">Начиная с Vista, Windows поддерживает флаг Фуа только для дисков SCSI и волоконного канала.</span><span class="sxs-lookup"><span data-stu-id="c8753-111">Starting in Vista, Windows supports the FUA flag only for SCSI and Fiber Channel disks.</span></span>

<span data-ttu-id="c8753-112">На жестких дисках (ATA/SATA/USB) система TxF имеет период уязвимости, в ходе которой сбой питания может привести к тому, что система TxF не сможет правильно выполнить откат транзакции, тем самым оставляя данные в несогласованном состоянии, пока не отключен кэш записи диска.</span><span class="sxs-lookup"><span data-stu-id="c8753-112">On commodity drives (ATA/SATA/USB), TxF has periods of vulnerability during which a drive power failure can result in TxF being unable to correctly rollback the transaction, thus leaving data in an inconsistent state unless the drive's write cache is disabled.</span></span>

<span data-ttu-id="c8753-113">Некоторые адаптеры шины (HBA) и контроллеры хранилища (например, системы RAID) имеют встроенные кэши с зарезервированным аккумулятором.</span><span class="sxs-lookup"><span data-stu-id="c8753-113">Some Host Bus Adapters (HBAs) and storage controllers (for example, RAID systems) have built-in battery-backed caches.</span></span> <span data-ttu-id="c8753-114">Так как эти устройства сохраняют кэшированные данные в случае сбоя питания, все подключенные к ним диски не должны учитывать флаг Фуа.</span><span class="sxs-lookup"><span data-stu-id="c8753-114">Because these devices preserve cached data if a power fault occurs, any disks connected to them are not required to honor the FUA flag.</span></span> <span data-ttu-id="c8753-115">Кроме того, для диска, источник питания которого защищен с помощью бесперебойного питания (ИБП), не нужно учитывать флаг Фуа.</span><span class="sxs-lookup"><span data-stu-id="c8753-115">Further, a disk whose power supply is protected by an uninterruptable power supply (UPS) does not need to honor the FUA flag.</span></span> <span data-ttu-id="c8753-116">Это связано с тем, что ИБП будут поддерживать мощность, достаточную для очистки кэша на диске.</span><span class="sxs-lookup"><span data-stu-id="c8753-116">This is because the UPS will maintain power long enough for the disk to flush its cache to the media.</span></span>

<span data-ttu-id="c8753-117">Отключение кэша записи диска устраняет необходимость использовать диск для использования флага Фуа.</span><span class="sxs-lookup"><span data-stu-id="c8753-117">Disabling a drive's write cache eliminates the requirement for the drive to honor the FUA flag.</span></span> <span data-ttu-id="c8753-118">Можно отключить кэширование записи на диск, выполнив на диске код управления [**\_ \_ \_ \_ сведениями о кэше**](/windows/desktop/api/WinIoCtl/ni-winioctl-ioctl_disk_set_cache_information) на диске IOCTL.</span><span class="sxs-lookup"><span data-stu-id="c8753-118">You can disable a disk's write caching by issuing the [**IOCTL\_DISK\_SET\_CACHE\_INFORMATION**](/windows/desktop/api/WinIoCtl/ni-winioctl-ioctl_disk_set_cache_information) control code to the disk.</span></span> <span data-ttu-id="c8753-119">Состояние кэша записи (ON/OFF) будет сохраняться при перезагрузке системы.</span><span class="sxs-lookup"><span data-stu-id="c8753-119">The state of the write cache (on/off) will be preserved across system reboots.</span></span> <span data-ttu-id="c8753-120">Выдача этого управляющего кода приведет к очень значительным последствиям для всех операций ввода-вывода, выданных этому диску, что, скорее всего, станет заметным снижением производительности.</span><span class="sxs-lookup"><span data-stu-id="c8753-120">Issuing this control code will have very significant performance consequences for all I/O issued to that disk, which will most likely be a noticeable performance degradation.</span></span> <span data-ttu-id="c8753-121">Использование этого кода элемента управления следует тщательно рассматривать перед развертыванием.</span><span class="sxs-lookup"><span data-stu-id="c8753-121">Use of this control code should be carefully considered prior to deployment.</span></span>

> [!Note]  
> <span data-ttu-id="c8753-122">Чтобы система TxF была в состоянии обеспечить единообразную защиту целостности данных за счет ошибок электропитания, в системе должен соответствовать хотя бы один из следующих критериев.</span><span class="sxs-lookup"><span data-stu-id="c8753-122">For TxF to be capable of consistently protecting your data's integrity through power faults, the system must satisfy at least one of the following criteria:</span></span>
>
> -   <span data-ttu-id="c8753-123">Используйте диски серверного класса (SCSI, оптоволоконный канал).</span><span class="sxs-lookup"><span data-stu-id="c8753-123">Use server-class disks (SCSI, Fiber Channel).</span></span>
> -   <span data-ttu-id="c8753-124">Убедитесь, что диски подключены к адаптеру шины HBA с резервным питанием.</span><span class="sxs-lookup"><span data-stu-id="c8753-124">Make sure the disks are connected to a battery-backed caching HBA.</span></span>
> -   <span data-ttu-id="c8753-125">В качестве устройства хранения используйте контроллер хранилища (например, RAID-систему).</span><span class="sxs-lookup"><span data-stu-id="c8753-125">Use a storage controller (for example, RAID system) as the storage device.</span></span>
> -   <span data-ttu-id="c8753-126">Убедитесь, что питание диска защищено ИБП.</span><span class="sxs-lookup"><span data-stu-id="c8753-126">Ensure power to the disk is protected by a UPS.</span></span>
> -   <span data-ttu-id="c8753-127">Убедитесь, что функция кэширования записи на диск отключена.</span><span class="sxs-lookup"><span data-stu-id="c8753-127">Ensure that the disk's write caching feature is disabled.</span></span>

 

 

 



