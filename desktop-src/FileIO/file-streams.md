---
description: В файловой системе NTFS потоки содержат данные, которые записываются в файл и предоставляют дополнительные сведения о файле, чем атрибуты и свойства.
ms.assetid: 41dda6f1-a6d1-4e76-94f3-a72f9e491bee
title: Файловые потоки (локальные файловые системы)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a934a51225a886e3d5a7de4d9e1e91900fab460
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "103812521"
---
# <a name="file-streams-local-file-systems"></a><span data-ttu-id="12744-103">Файловые потоки (локальные файловые системы)</span><span class="sxs-lookup"><span data-stu-id="12744-103">File Streams (Local File Systems)</span></span>

<span data-ttu-id="12744-104">Поток — это последовательность байтов.</span><span class="sxs-lookup"><span data-stu-id="12744-104">A stream is a sequence of bytes.</span></span> <span data-ttu-id="12744-105">В файловой системе NTFS потоки содержат данные, которые записываются в файл и предоставляют дополнительные сведения о файле, чем атрибуты и свойства.</span><span class="sxs-lookup"><span data-stu-id="12744-105">In the NTFS file system, streams contain the data that is written to a file, and that gives more information about a file than attributes and properties.</span></span> <span data-ttu-id="12744-106">Например, можно создать поток, содержащий ключевые слова поиска, или удостоверение учетной записи пользователя, которая создает файл.</span><span class="sxs-lookup"><span data-stu-id="12744-106">For example, you can create a stream that contains search keywords, or the identity of the user account that creates a file.</span></span>

<span data-ttu-id="12744-107">Каждый поток, связанный с файлом, имеет свой собственный размер выделения, фактический размер и допустимую длину данных:</span><span class="sxs-lookup"><span data-stu-id="12744-107">Each stream that is associated with a file has its own allocation size, actual size, and valid data length:</span></span>

-   <span data-ttu-id="12744-108">Размер выделения — это объем места на диске, зарезервированный для потока.</span><span class="sxs-lookup"><span data-stu-id="12744-108">The allocation size is the amount of disk space that is reserved for a stream.</span></span>
-   <span data-ttu-id="12744-109">Фактический размер — это число байтов, используемых вызывающим объектом.</span><span class="sxs-lookup"><span data-stu-id="12744-109">The actual size is the number of bytes that are being used by a caller.</span></span>
-   <span data-ttu-id="12744-110">Допустимая длина данных (ВДЛ) — это число байтов, инициализированных из размера выделения для потока.</span><span class="sxs-lookup"><span data-stu-id="12744-110">The valid data length (VDL) is the number of bytes that are initialized from the allocation size for the stream.</span></span>

<span data-ttu-id="12744-111">Каждый поток также сохраняет свое собственное состояние для сжатия, шифрования и разреженности.</span><span class="sxs-lookup"><span data-stu-id="12744-111">Each stream also maintains its own state for compression, encryption, and sparseness.</span></span> <span data-ttu-id="12744-112">Атрибут **\_ \_ разреженного \_ файла атрибута** file задается в элементе **двфилеаттрибутес** структуры [**\_ \_ данных Win32 Find**](/windows/desktop/api/MinWinBase/ns-minwinbase-win32_find_dataa) , возвращаемой функциями [**FindFirstFile**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfilea), [**финдфирстфиликс**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfileexa)и [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) , если любой из потоков когда-либо был разреженным.</span><span class="sxs-lookup"><span data-stu-id="12744-112">The **FILE\_ATTRIBUTE\_SPARSE\_FILE** attribute on the file is set in the **dwFileAttributes** member of the [**WIN32\_FIND\_DATA**](/windows/desktop/api/MinWinBase/ns-minwinbase-win32_find_dataa) structure returned from the [**FindFirstFile**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfilea), [**FindFirstFileEx**](/windows/desktop/api/FileAPI/nf-fileapi-findfirstfileexa), and [**FindNextFile**](/windows/desktop/api/FileAPI/nf-fileapi-findnextfilea) functions if any of the streams have ever been sparse.</span></span> <span data-ttu-id="12744-113">[**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa), [**сбой getfileattributesex**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesexa), [**жетфилеаттрибутестрансактед**](/windows/desktop/api/WinBase/nf-winbase-getfileattributestransacteda), [**жетфилеинформатионбихандле**](/windows/desktop/api/FileAPI/nf-fileapi-getfileinformationbyhandle)и [**жетфилеинформатионбихандликс**](/windows/desktop/api/WinBase/nf-winbase-getfileinformationbyhandleex) возвращают разреженное состояние потока данных по умолчанию, если поток не указан.</span><span class="sxs-lookup"><span data-stu-id="12744-113">[**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa), [**GetFileAttributesEx**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesexa), [**GetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-getfileattributestransacteda), [**GetFileInformationByHandle**](/windows/desktop/api/FileAPI/nf-fileapi-getfileinformationbyhandle), and [**GetFileInformationByHandleEx**](/windows/desktop/api/WinBase/nf-winbase-getfileinformationbyhandleex) return the sparse state of the default data stream if no stream is specified.</span></span>

<span data-ttu-id="12744-114">Нет файлов со временем, связанных с потоком.</span><span class="sxs-lookup"><span data-stu-id="12744-114">There are no file times associated with a stream.</span></span> <span data-ttu-id="12744-115">Время файла для файла обновляется при обновлении любого потока в файле.</span><span class="sxs-lookup"><span data-stu-id="12744-115">The file times for a file are updated when any stream in a file is updated.</span></span>

<span data-ttu-id="12744-116">Для каждого потока поддерживается оппортунистическая блокировка.</span><span class="sxs-lookup"><span data-stu-id="12744-116">Opportunistic locks are maintained per stream.</span></span> <span data-ttu-id="12744-117">Режимы совместного использования также поддерживаются для каждого потока.</span><span class="sxs-lookup"><span data-stu-id="12744-117">Sharing modes are also maintained per stream.</span></span> <span data-ttu-id="12744-118">Когда для файла запрашивается доступ на удаление, операционная система проверяет доступ на удаление всех открытых потоков в файле.</span><span class="sxs-lookup"><span data-stu-id="12744-118">When delete access is requested on a file, the operating system checks for delete access on all open streams in a file.</span></span> <span data-ttu-id="12744-119">Если другой процесс открыл поток без разрешения на **\_ \_ удаление файлового ресурса** , открыть его для удаления доступа нельзя.</span><span class="sxs-lookup"><span data-stu-id="12744-119">If another process has opened a stream without the **FILE\_SHARE\_DELETE** permission, you cannot open the file for delete access.</span></span>

<span data-ttu-id="12744-120">Если копируемый файл содержит поток данных и используется перенаправитель сети, то файл можно скопировать только в том случае, если у клиента есть разрешение на чтение и чтение атрибутов.</span><span class="sxs-lookup"><span data-stu-id="12744-120">If a file being copied has a data stream and the network redirector is used, the file can only be copied if the client has both the read permission and the read attributes permission.</span></span>

## <a name="naming-conventions-for-streams"></a><span data-ttu-id="12744-121">Соглашения об именовании для потоков</span><span class="sxs-lookup"><span data-stu-id="12744-121">Naming Conventions for Streams</span></span>

<span data-ttu-id="12744-122">При указании из командной строки оболочки Windows полное имя потока — «*filename*:*Stream Name*:*Stream Type*», как показано в следующем примере: «myfile. dat: stream1: $Data».</span><span class="sxs-lookup"><span data-stu-id="12744-122">When specified from the Windows shell command line, the full name of a stream is "*filename*:*stream name*:*stream type*", as in the following example: "myfile.dat:stream1:$DATA".</span></span>

<span data-ttu-id="12744-123">Все символы, допустимые для имени файла, также являются допустимыми для имени потока, включая пробелы.</span><span class="sxs-lookup"><span data-stu-id="12744-123">Any characters that are legal for a file name are also legal for the stream name, including spaces.</span></span> <span data-ttu-id="12744-124">Дополнительные сведения см. [в разделе Присвоение имени файлу](naming-a-file.md).</span><span class="sxs-lookup"><span data-stu-id="12744-124">For more information, see [Naming a File](naming-a-file.md).</span></span> <span data-ttu-id="12744-125">Тип потока (также называемый кодом типа атрибута) является внутренним для файловой системы NTFS.</span><span class="sxs-lookup"><span data-stu-id="12744-125">The stream type (also called an attribute type code) is internal to the NTFS file system.</span></span> <span data-ttu-id="12744-126">Поэтому пользователи не могут создавать новые типы потоков, но могут открывать существующие типы файловой системы NTFS.</span><span class="sxs-lookup"><span data-stu-id="12744-126">Users therefore can't create new stream types, but they can open existing NTFS file system types.</span></span> <span data-ttu-id="12744-127">Значения спецификатора типа потока всегда начинаются с символа доллара ($).</span><span class="sxs-lookup"><span data-stu-id="12744-127">Stream type specifier values always start with the dollar sign ($) symbol.</span></span> <span data-ttu-id="12744-128">Список типов потоков см. ниже.</span><span class="sxs-lookup"><span data-stu-id="12744-128">See below for a list of stream types.</span></span>

<span data-ttu-id="12744-129">По умолчанию поток данных не имеет имени.</span><span class="sxs-lookup"><span data-stu-id="12744-129">By default, the default data stream is unnamed.</span></span> <span data-ttu-id="12744-130">Чтобы полностью указать поток данных по умолчанию, используйте "*filename*:: $Data", где $Data является типом потока.</span><span class="sxs-lookup"><span data-stu-id="12744-130">To fully specify the default data stream, use "*filename*::$DATA", where $DATA is the stream type.</span></span> <span data-ttu-id="12744-131">Это эквивалентно "*filename*".</span><span class="sxs-lookup"><span data-stu-id="12744-131">This is the equivalent of "*filename*".</span></span> <span data-ttu-id="12744-132">В файле можно создать именованный поток, используя [соглашения об именовании файлов](naming-a-file.md).</span><span class="sxs-lookup"><span data-stu-id="12744-132">You can create a named stream in the file using the [file naming conventions](naming-a-file.md).</span></span> <span data-ttu-id="12744-133">Обратите внимание, что "$DATA" является допустимым именем потока.</span><span class="sxs-lookup"><span data-stu-id="12744-133">Note that "$DATA" is a legal stream name.</span></span> <span data-ttu-id="12744-134">Например, полное имя потока с именем "$DATA" для файла "*Sample*" будет иметь вид "*Sample*: $data: $Data".</span><span class="sxs-lookup"><span data-stu-id="12744-134">For example, the full name of a stream named "$DATA" on a file named "*sample*" would be "*sample*:$DATA:$DATA".</span></span> <span data-ttu-id="12744-135">Если вы создали поток с именем "Bar" для того же файла, его полное имя будет иметь вид "*Пример*: линейчатая диаграмма: $Data".</span><span class="sxs-lookup"><span data-stu-id="12744-135">If you created a stream named "bar" on the same file its full name would be "*sample*:bar:$DATA".</span></span>

<span data-ttu-id="12744-136">При создании и работе с файлами, имеющими имена из одного символа, добавляйте к имени файла с точкой, за которой следует обратная косая черта (. \) или используйте полное имя пути.</span><span class="sxs-lookup"><span data-stu-id="12744-136">When creating and working with files that have one-character names, prefix the file name with period followed by a backslash (.\) or use a fully qualified path name.</span></span> <span data-ttu-id="12744-137">Причиной этого является то, что Windows обрабатывает имена файлов одного символа как буквы диска.</span><span class="sxs-lookup"><span data-stu-id="12744-137">The reason to do this is that Windows treats one-character file names as drive letters.</span></span> <span data-ttu-id="12744-138">Если буква диска указана с помощью относительного пути, двоеточие отделяет букву диска от пути.</span><span class="sxs-lookup"><span data-stu-id="12744-138">When a drive letter is specified with a relative path, a colon separates the drive letter from the path.</span></span> <span data-ttu-id="12744-139">Если неоднозначность состоит в том, что односимвольное имя является буквой диска или именем файла, Windows предполагает, что это буква диска, если строка, следующая за двоеточием, является допустимым путем, даже если буква диска является недопустимой.</span><span class="sxs-lookup"><span data-stu-id="12744-139">When there is an ambiguity about whether a one-character name is a drive letter or a file name, Windows assumes it is a a drive letter if the string following the colon is a valid path, even if the drive letter is invalid.</span></span>

## <a name="stream-types"></a><span data-ttu-id="12744-140">Типы потоков</span><span class="sxs-lookup"><span data-stu-id="12744-140">Stream Types</span></span>

<span data-ttu-id="12744-141">Ниже приведен список типов потоков NTFS, которые также называются кодами типов атрибутов.</span><span class="sxs-lookup"><span data-stu-id="12744-141">Following is the list of NTFS stream types, also called attribute type codes.</span></span> <span data-ttu-id="12744-142">Некоторые типы потоков являются внутренними для файловой системы NTFS, и их формат не является документом.</span><span class="sxs-lookup"><span data-stu-id="12744-142">Some of the stream types are internal to NTFS and their format is undocumented.</span></span>



| <span data-ttu-id="12744-143">Тип потока</span><span class="sxs-lookup"><span data-stu-id="12744-143">Stream Type</span></span>                | <span data-ttu-id="12744-144">Описание</span><span class="sxs-lookup"><span data-stu-id="12744-144">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="12744-145">:: $ATTRIBUTE \_ список</span><span class="sxs-lookup"><span data-stu-id="12744-145">::$ATTRIBUTE\_LIST</span></span>         | <span data-ttu-id="12744-146">Содержит список всех атрибутов, составляющих файл, и определяет, где находится каждый атрибут.</span><span class="sxs-lookup"><span data-stu-id="12744-146">Contains a list of all attributes that make up the file and identifies where each attribute is located.</span></span>                                                                                                                                                                                                                                                                                                                                          |
| <span data-ttu-id="12744-147">:: $BITMAP</span><span class="sxs-lookup"><span data-stu-id="12744-147">::$BITMAP</span></span>                  | <span data-ttu-id="12744-148">Битовая карта, используемая индексами для управления свободным местом в сбалансированном дереве для каталога.</span><span class="sxs-lookup"><span data-stu-id="12744-148">A bitmap used by indexes to manage the b-tree free space for a directory.</span></span> <span data-ttu-id="12744-149">Сбалансированное дерево управляется блоками по 4 КБ (независимо от размера кластера) и используется для управления размещением этих блоков.</span><span class="sxs-lookup"><span data-stu-id="12744-149">The b-tree is managed in 4 KB chunks (regardless of cluster size) and this is used to manage the allocation of these chunks.</span></span> <span data-ttu-id="12744-150">Этот тип потока имеется в каждом каталоге.</span><span class="sxs-lookup"><span data-stu-id="12744-150">This stream type is present on every directory.</span></span>                                                                                                                                                                                           |
| <span data-ttu-id="12744-151">:: $DATA</span><span class="sxs-lookup"><span data-stu-id="12744-151">::$DATA</span></span>                    | <span data-ttu-id="12744-152">Поток данных.</span><span class="sxs-lookup"><span data-stu-id="12744-152">Data stream.</span></span> <span data-ttu-id="12744-153">Поток данных по умолчанию не имеет имени.</span><span class="sxs-lookup"><span data-stu-id="12744-153">The default data stream has no name.</span></span> <span data-ttu-id="12744-154">Потоки данных можно перечислить с помощью функций [**финдфирстстреамв**](/windows/desktop/api/fileapi/nf-fileapi-findfirststreamw) и [**финднекстстреамв**](/windows/desktop/api/fileapi/nf-fileapi-findnextstreamw) .</span><span class="sxs-lookup"><span data-stu-id="12744-154">Data streams can be enumerated using the [**FindFirstStreamW**](/windows/desktop/api/fileapi/nf-fileapi-findfirststreamw) and [**FindNextStreamW**](/windows/desktop/api/fileapi/nf-fileapi-findnextstreamw) functions.</span></span>                                                                                                                                                                                                                                                |
| <span data-ttu-id="12744-155">:: $EA</span><span class="sxs-lookup"><span data-stu-id="12744-155">::$EA</span></span>                      | <span data-ttu-id="12744-156">Содержит данные расширенных атрибутов.</span><span class="sxs-lookup"><span data-stu-id="12744-156">Contains Extended Attributes data.</span></span>|
| <span data-ttu-id="12744-157">:: $EA \_ сведения</span><span class="sxs-lookup"><span data-stu-id="12744-157">::$EA\_INFORMATION</span></span>         | <span data-ttu-id="12744-158">Содержит сведения о поддержке расширенных атрибутов.</span><span class="sxs-lookup"><span data-stu-id="12744-158">Contains support information about the Extended Attributes.</span></span>                                                                                                                                                                                                                                                                                                                                                                                      |
| <span data-ttu-id="12744-159">:: $FILE \_ имя</span><span class="sxs-lookup"><span data-stu-id="12744-159">::$FILE\_NAME</span></span>              | <span data-ttu-id="12744-160">Имя файла в символах Юникода.</span><span class="sxs-lookup"><span data-stu-id="12744-160">The name of the file, in Unicode characters.</span></span> <span data-ttu-id="12744-161">Сюда входит краткое имя файла, а также все жесткие связи.</span><span class="sxs-lookup"><span data-stu-id="12744-161">This includes the short name of the file as well as any hard links.</span></span>                                                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="12744-162">:: $INDEXное \_ выделение</span><span class="sxs-lookup"><span data-stu-id="12744-162">::$INDEX\_ALLOCATION</span></span>       | <span data-ttu-id="12744-163">Тип потока каталога.</span><span class="sxs-lookup"><span data-stu-id="12744-163">The stream type of a directory.</span></span> <span data-ttu-id="12744-164">Используется для реализации выделения имен файлов для больших каталогов.</span><span class="sxs-lookup"><span data-stu-id="12744-164">Used to implement filename allocation for large directories.</span></span> <span data-ttu-id="12744-165">Этот поток представляет каталог и содержит все данные каталога.</span><span class="sxs-lookup"><span data-stu-id="12744-165">This stream represents the directory itself and contains all of the data of the directory.</span></span> <span data-ttu-id="12744-166">Изменения в потоках этого типа записываются в журнал изменений NTFS.</span><span class="sxs-lookup"><span data-stu-id="12744-166">Changes to streams of this type are logged to the NTFS change journal.</span></span> <span data-ttu-id="12744-167">Имя потока по умолчанию для \_ типа потока выделения $index — $I 30, то есть "*dirname*", "*dirname*:: $index \_ allocation" и "*dirname*: $I 30: $index \_ выделения" являются эквивалентными.</span><span class="sxs-lookup"><span data-stu-id="12744-167">The default stream name of an $INDEX\_ALLOCATION stream type is $I30 so "*DirName*", "*DirName*::$INDEX\_ALLOCATION", and "*DirName*:$I30:$INDEX\_ALLOCATION" are all equivalent.</span></span> |
| <span data-ttu-id="12744-168">:: $INDEX \_ корневой элемент</span><span class="sxs-lookup"><span data-stu-id="12744-168">::$INDEX\_ROOT</span></span>             | <span data-ttu-id="12744-169">Этот поток представляет корень сбалансированного дерева индекса.</span><span class="sxs-lookup"><span data-stu-id="12744-169">This stream represents root of the b-tree of an index.</span></span> <span data-ttu-id="12744-170">Этот тип потока имеется в каждом каталоге.</span><span class="sxs-lookup"><span data-stu-id="12744-170">This stream type is present on every directory.</span></span>                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="12744-171">:: $LOGGEDный \_ поток служебной программы \_</span><span class="sxs-lookup"><span data-stu-id="12744-171">::$LOGGED\_UTILITY\_STREAM</span></span> | <span data-ttu-id="12744-172">Аналогично:: $DATA, но операции записываются в журнал изменений NTFS.</span><span class="sxs-lookup"><span data-stu-id="12744-172">Similar to ::$DATA but operations are logged to the NTFS change journal.</span></span> <span data-ttu-id="12744-173">Используется системой EFS и [транзакционной NTFS (TxF)](transactional-ntfs-portal.md).</span><span class="sxs-lookup"><span data-stu-id="12744-173">Used by EFS and [Transactional NTFS (TxF)](transactional-ntfs-portal.md).</span></span> <span data-ttu-id="12744-174">Пара ":*StreamName*: $*СТРЕАМТИПЕ*" для EFS — ": $EFS: $LOGGEDный \_ поток служебной программы \_ " и для TxF — ": $TxF \_ data: $Logged \_ служебный \_ поток".</span><span class="sxs-lookup"><span data-stu-id="12744-174">The ":*StreamName*:$*StreamType*" pair for EFS is ":$EFS:$LOGGED\_UTILITY\_STREAM" and for TxF is ":$TXF\_DATA:$LOGGED\_UTILITY\_STREAM".</span></span>                                                                                                                                                    |
| <span data-ttu-id="12744-175">:: \_ идентификатор $Object</span><span class="sxs-lookup"><span data-stu-id="12744-175">::$OBJECT\_ID</span></span>              | <span data-ttu-id="12744-176">16-байтовый идентификатор, используемый для идентификации файла для службы отслеживания ссылок.</span><span class="sxs-lookup"><span data-stu-id="12744-176">An 16-byte ID used to identify the file for the link-tracking service.</span></span>                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="12744-177">:: $REPARSE \_ точка</span><span class="sxs-lookup"><span data-stu-id="12744-177">::$REPARSE\_POINT</span></span>          | <span data-ttu-id="12744-178">Данные [точки повторного анализа](reparse-points.md) .</span><span class="sxs-lookup"><span data-stu-id="12744-178">The [reparse point](reparse-points.md) data.</span></span>|



 

## <a name="related-topics"></a><span data-ttu-id="12744-179">См. также</span><span class="sxs-lookup"><span data-stu-id="12744-179">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="12744-180">Использование потоков</span><span class="sxs-lookup"><span data-stu-id="12744-180">Using Streams</span></span>](using-streams.md)
</dt> </dl>

 

 



