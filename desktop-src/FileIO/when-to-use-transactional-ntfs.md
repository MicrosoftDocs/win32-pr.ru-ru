---
description: Используйте транзакционную NTFS для поддержания целостности данных.
ms.assetid: 886d6075-57e8-47db-aec5-77660d0a53f9
title: Когда следует использовать транзакционную NTFS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 28c0a134a8cb5824337022fedf14fe3db3c6f76c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "105663596"
---
# <a name="when-to-use-transactional-ntfs"></a><span data-ttu-id="fd076-103">Когда следует использовать транзакционную NTFS</span><span class="sxs-lookup"><span data-stu-id="fd076-103">When to Use Transactional NTFS</span></span>

<span data-ttu-id="fd076-104">Приложение может использовать транзакционную NTFS (TxF) для сохранения целостности данных на диске при непредвиденных условиях возникновения ошибки.</span><span class="sxs-lookup"><span data-stu-id="fd076-104">An application can use Transactional NTFS (TxF) to preserve the integrity of data on disk during unexpected error conditions.</span></span> <span data-ttu-id="fd076-105">В общем случае приложение должно использовать TxF, если приложение очищает файлы и использует другие методы для поддержания целостности данных.</span><span class="sxs-lookup"><span data-stu-id="fd076-105">In general, an application should consider using TxF if the application is flushing files and using other techniques to maintain data integrity.</span></span> <span data-ttu-id="fd076-106">TxF может улучшить работу и упростить код обработки ошибок приложения, улучшая восстановление после ошибок и надежность.</span><span class="sxs-lookup"><span data-stu-id="fd076-106">TxF can perform better and simplify the application's error handling code while improving error recovery and reliability.</span></span> <span data-ttu-id="fd076-107">В следующих подразделах этого раздела приведены примеры сценариев использования TxF.</span><span class="sxs-lookup"><span data-stu-id="fd076-107">The following sections in this topic provide examples of scenarios for you to use TxF.</span></span>

## <a name="updating-a-file"></a><span data-ttu-id="fd076-108">Обновление файла</span><span class="sxs-lookup"><span data-stu-id="fd076-108">Updating a File</span></span>

<span data-ttu-id="fd076-109">Обновление файла — это обычная и обычно простая операция.</span><span class="sxs-lookup"><span data-stu-id="fd076-109">The updating of a file is a common and typically simple operation.</span></span> <span data-ttu-id="fd076-110">Однако при сбое системы или приложения, когда приложение обновляет данные на диске, результат может быть разрушительным, так как данные пользователя могут быть повреждены при выполнении операции обновления файлов, которая была частично завершена.</span><span class="sxs-lookup"><span data-stu-id="fd076-110">However, if the system or application fails while an application is updating information on a disk, the result can be catastrophic, because the user data can be corrupted by a file update operation that is partially completed.</span></span> <span data-ttu-id="fd076-111">Надежные приложения часто выполняют сложные последовательности копирования файлов и переименования файлов, чтобы гарантировать, что данные не повреждаются в случае сбоя системы.</span><span class="sxs-lookup"><span data-stu-id="fd076-111">Robust applications often perform complex sequences of file copies and file renames to ensure that data is not corrupted if a system fails.</span></span>

<span data-ttu-id="fd076-112">TxF упрощает для приложения защиту операций обновления файлов от сбоев системы или приложений.</span><span class="sxs-lookup"><span data-stu-id="fd076-112">TxF makes it simple for an application to protect file update operations from system or application failure.</span></span> <span data-ttu-id="fd076-113">Чтобы безопасно обновить файл, приложение открывает файл в режиме транзакции, вносит необходимые обновления, а затем фиксирует транзакцию.</span><span class="sxs-lookup"><span data-stu-id="fd076-113">To update a file safely, the application opens the file in transacted mode, makes the necessary updates, and then commits the transaction.</span></span> <span data-ttu-id="fd076-114">Если во время обновления файла происходит сбой системы или приложения, TxF автоматически восстанавливает файл до начала обновления файла, что позволяет избежать повреждения файлов.</span><span class="sxs-lookup"><span data-stu-id="fd076-114">If the system or application fails during the file update, then TxF automatically restores the file to the state that it had before the file update began, which avoids file corruption.</span></span>

## <a name="multi-file-updates"></a><span data-ttu-id="fd076-115">Обновление нескольких файлов</span><span class="sxs-lookup"><span data-stu-id="fd076-115">Multi-File Updates</span></span>

<span data-ttu-id="fd076-116">TxF является еще более важным, если одна логическая операция влияет на несколько файлов.</span><span class="sxs-lookup"><span data-stu-id="fd076-116">TxF is even more important when a single logical operation affects multiple files.</span></span> <span data-ttu-id="fd076-117">Например, если вы хотите использовать средство для переименования одной из страниц HTML или ASP на веб-сайте, хорошо спроектированное средство также исправит все ссылки для использования нового имени файла.</span><span class="sxs-lookup"><span data-stu-id="fd076-117">For example, if you want to use a tool to rename one of the HTML or ASP pages on a website, a well-designed tool would also fix all links to use the new file name.</span></span> <span data-ttu-id="fd076-118">Однако при выполнении этой операции веб-сайт находится в несогласованном состоянии, а некоторые ссылки по-прежнему ссылаются на старое имя файла.</span><span class="sxs-lookup"><span data-stu-id="fd076-118">However, a failure during this operation leaves the website in an inconsistent state, with some of the links still referring to the old file name.</span></span> <span data-ttu-id="fd076-119">После того как операция переименования файла и операция исправления связи обрабатывают одну транзакцию, TxF гарантирует успешное или неудачное исправление имени файла и ссылки.</span><span class="sxs-lookup"><span data-stu-id="fd076-119">By making the file rename operation and the link fixing operation a single transaction, TxF ensures that the file rename and link fix succeed or fail as a single operation.</span></span>

## <a name="consistent-concurrent-updates"></a><span data-ttu-id="fd076-120">Единообразные одновременные обновления</span><span class="sxs-lookup"><span data-stu-id="fd076-120">Consistent Concurrent Updates</span></span>

<span data-ttu-id="fd076-121">TxF изолирует параллельные транзакции.</span><span class="sxs-lookup"><span data-stu-id="fd076-121">TxF isolates concurrent transactions.</span></span> <span data-ttu-id="fd076-122">Если приложение открывает файл для транзакционного чтения, а другое приложение имеет тот же файл, Открытый для обработки транзакций, TxF изолирует эффекты двух транзакций друг от друга.</span><span class="sxs-lookup"><span data-stu-id="fd076-122">If an application opens a file for a transactional read while another application has the same file open for a transactional update, TxF isolates the effects of the two transactions from one another.</span></span> <span data-ttu-id="fd076-123">Иными словами, средство чтения транзакций всегда просматривает единственную согласованную версию файла, даже если этот файл находится в процессе обновления другой транзакции.</span><span class="sxs-lookup"><span data-stu-id="fd076-123">In other words, the transactional reader always views a single, consistent version of the file, even while that file is in the process of being updated by another transaction.</span></span>

<span data-ttu-id="fd076-124">Приложение может использовать эту функцию, чтобы позволить клиентам просматривать файлы, а другие клиенты выполняют обновления.</span><span class="sxs-lookup"><span data-stu-id="fd076-124">An application can use this functionality to allow customers to view files while other customers make updates.</span></span> <span data-ttu-id="fd076-125">Например, транзакционный веб-сервер может предоставлять единое согласованное представление файлов, а другое средство параллельно обновляет эти файлы.</span><span class="sxs-lookup"><span data-stu-id="fd076-125">For example, a transactional web server can provide a single, consistent view of files while another tool concurrently updates those files.</span></span>

> [!Note]  
> <span data-ttu-id="fd076-126">TxF не поддерживает параллельное обновление несколькими модулями записи в разных транзакциях.</span><span class="sxs-lookup"><span data-stu-id="fd076-126">TxF does not support concurrent updates by multiple writers in different transactions.</span></span> <span data-ttu-id="fd076-127">TxF поддерживает только один модуль записи с несколькими параллельными и последовательными модулями чтения.</span><span class="sxs-lookup"><span data-stu-id="fd076-127">TxF supports only a single writer with multiple concurrent and consistent readers.</span></span>

 

## <a name="coordinating-with-other-transacted-resource-managers"></a><span data-ttu-id="fd076-128">Координация с другими диспетчерами ресурсов транзакций</span><span class="sxs-lookup"><span data-stu-id="fd076-128">Coordinating With Other Transacted Resource Managers</span></span>

<span data-ttu-id="fd076-129">Транзакции, используемые с транзакционными файловыми системами, также могут использоваться с реестром транзакций.</span><span class="sxs-lookup"><span data-stu-id="fd076-129">Transactions used with transacted file systems may also be used with the transacted registry.</span></span> <span data-ttu-id="fd076-130">Обновления файла и реестра координируются с одной транзакцией.</span><span class="sxs-lookup"><span data-stu-id="fd076-130">Updates to the file and the registry are coordinated with a single transaction.</span></span>

<span data-ttu-id="fd076-131">С помощью транзакций [координатор распределенных транзакций](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC) или System. Transactions обновления, ВНОСИМЫЕ в SQL, MSMQ и другие транзакционные ресурсы, можно координировать с помощью транзакционных обновлений файлов.</span><span class="sxs-lookup"><span data-stu-id="fd076-131">By using [Distributed Transaction Coordinator](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC) transactions or System.Transactions, updates made to SQL, MSMQ, and other transactional resources can be coordinated with transacted file updates.</span></span> <span data-ttu-id="fd076-132">Дополнительные сведения см. в разделе DTC [IKernelTransaction](/previous-versions/windows/desktop/aa344210(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="fd076-132">For more information, see DTC's [IKernelTransaction](/previous-versions/windows/desktop/aa344210(v=vs.85)).</span></span>

## <a name="unsupported-scenarios"></a><span data-ttu-id="fd076-133">Неподдерживаемые сценарии</span><span class="sxs-lookup"><span data-stu-id="fd076-133">Unsupported Scenarios</span></span>

<span data-ttu-id="fd076-134">TxF не поддерживает следующие сценарии транзакций:</span><span class="sxs-lookup"><span data-stu-id="fd076-134">TxF does not support the following transaction scenarios:</span></span>

-   <span data-ttu-id="fd076-135">Транзакции на сетевых томах, например в общих файловых ресурсах.</span><span class="sxs-lookup"><span data-stu-id="fd076-135">Transactions on network volumes, for example on file shares.</span></span> <span data-ttu-id="fd076-136">Система TxF не поддерживается протоколами CIFS/SMB.</span><span class="sxs-lookup"><span data-stu-id="fd076-136">TxF is not supported by the CIFS/SMB protocols.</span></span>
-   <span data-ttu-id="fd076-137">Транзакции в любой файловой системе, отличной от NTFS.</span><span class="sxs-lookup"><span data-stu-id="fd076-137">Transactions on any file system other than NTFS.</span></span>
-   <span data-ttu-id="fd076-138">Транзакционные операции с файлами, кэшированными с помощью кэширования на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="fd076-138">Transacted operations against files cached by client-side caching.</span></span>
-   <span data-ttu-id="fd076-139">Доступ к файлам с помощью идентификаторов объектов.</span><span class="sxs-lookup"><span data-stu-id="fd076-139">File access using object IDs.</span></span>
-   <span data-ttu-id="fd076-140">Любой сценарий общего модуля записи.</span><span class="sxs-lookup"><span data-stu-id="fd076-140">Any shared writer scenario.</span></span>
-   <span data-ttu-id="fd076-141">Любая ситуация, когда файл открывается в течение продолжительного периода времени (дни или недели).</span><span class="sxs-lookup"><span data-stu-id="fd076-141">Any situation where a file is opened for an extended period of time (days or weeks).</span></span>

 

 
