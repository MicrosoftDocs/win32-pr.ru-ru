---
description: Функции необработанного шифрования обеспечивают резервное копирование зашифрованных файлов.
ms.assetid: 00f9b00e-305d-4554-8b43-7061228c92c3
title: Резервное копирование и восстановление зашифрованных файлов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4fbc5d1babbbbb92cef9e78f9a0dade702fd63d2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "104080423"
---
# <a name="backup-and-restore-of-encrypted-files"></a><span data-ttu-id="7f4d1-103">Резервное копирование и восстановление зашифрованных файлов</span><span class="sxs-lookup"><span data-stu-id="7f4d1-103">Backup and Restore of Encrypted Files</span></span>

<span data-ttu-id="7f4d1-104">Шифрованная файловая система (EFS) (EFS) фильтрует Открытие зашифрованного файла таким образом, чтобы приложение, которое открыло файл, получило доступ к незашифрованным сведениям, если, конечно, у него есть правильные учетные данные для доступа к файлу и получить ключ, необходимый для расшифровки файла.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-104">The Encrypting File System (EFS) filters the opening of an encrypted file in such a way that the application that opened the file gets access to the unencrypted information, provided of course it has the proper credentials to access the file and get the key necessary to decrypt the file.</span></span> <span data-ttu-id="7f4d1-105">Последующие операции чтения в этом файле будут давать незашифрованный текст.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-105">Subsequent read operations on this file will yield unencrypted text.</span></span> <span data-ttu-id="7f4d1-106">Это очень желательно для обычного доступа к зашифрованным файлам и обеспечивает прозрачность шифрования и расшифровки файлов.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-106">This is very desirable for typical access to encrypted files, and keeps the encryption and decryption of the files transparent.</span></span> <span data-ttu-id="7f4d1-107">Однако это мешает резервному копированию зашифрованных файлов, поскольку при попытке резервного копирования с помощью стандартных вызовов файлового ввода-вывода, таких как [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile)и [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile), файлы с резервным копированием будут иметь версию обычного текста.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-107">However, it hinders backup of encrypted files, because if backup is attempted with the standard file I/O calls like [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile), and [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile), the files backed up will be the plain text version.</span></span>

<span data-ttu-id="7f4d1-108">Для решения этой проблемы предоставляются функции необработанного шифрования.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-108">The raw encryption functions are provided to solve this problem.</span></span> <span data-ttu-id="7f4d1-109">Приложения резервного копирования являются основным предполагаемым пользователем для этих функций.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-109">Backup applications are a primary intended user for these functions.</span></span> <span data-ttu-id="7f4d1-110">Необработанные функции шифрования отличаются от других функций файловой системы тем, что функции Open, Read и Write предоставляют доступ к необработанным зашифрованным потокам данных, а также разрешают чтение и запись $EFS потока.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-110">Raw encryption functions differ from other file system functions in that open, read, and write functions allow access to the raw encrypted data streams and also allow reading/writing of the $EFS stream.</span></span> <span data-ttu-id="7f4d1-111">Таким образом, вызывающему объекту функций необработанного шифрования не требуется доступ к криптографическим ключам, которые расшифровываются файл.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-111">Therefore, the caller of the raw encryption functions does not need access to the cryptographic keys that decrypt the file.</span></span> <span data-ttu-id="7f4d1-112">Следующие интерфейсы API необработанного шифрования доступны для использования с приложениями резервного копирования и восстановления:</span><span class="sxs-lookup"><span data-stu-id="7f4d1-112">The following raw encryption APIs are available for use with backup and restore applications:</span></span> 

| <span data-ttu-id="7f4d1-113">API необработанного шифрования</span><span class="sxs-lookup"><span data-stu-id="7f4d1-113">Raw Encryption API</span></span>                                     | <span data-ttu-id="7f4d1-114">Описание</span><span class="sxs-lookup"><span data-stu-id="7f4d1-114">Description</span></span>                                                                                                                                                                                                                                                                   |
|--------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="7f4d1-115">**опененкриптедфилерав**</span><span class="sxs-lookup"><span data-stu-id="7f4d1-115">**OpenEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-openencryptedfilerawa)   | <span data-ttu-id="7f4d1-116">Откройте зашифрованный файл с доступом к данным в зашифрованном формате.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-116">Open an encrypted file with access to data in encrypted format.</span></span> <span data-ttu-id="7f4d1-117">Если вызывающий объект не имеет доступа к ключу для файла, вызывающему объекту необходимо [себаккуппривилеже](/windows/desktop/SecAuthZ/authorization-constants) экспортировать зашифрованные файлы или сересторепривилеже для импорта зашифрованных файлов.</span><span class="sxs-lookup"><span data-stu-id="7f4d1-117">If the caller does not have access to the key for the file, the caller needs [SeBackupPrivilege](/windows/desktop/SecAuthZ/authorization-constants) to export encrypted files or SeRestorePrivilege to import encrypted files.</span></span> |
| [<span data-ttu-id="7f4d1-118">**клосинкриптедфилерав**</span><span class="sxs-lookup"><span data-stu-id="7f4d1-118">**CloseEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-closeencryptedfileraw) | <span data-ttu-id="7f4d1-119">Закрытие зашифрованного файла, открытого с помощью [ **опененкриптедфилерав**](/windows/desktop/api/WinBase/nf-winbase-openencryptedfilerawa)</span><span class="sxs-lookup"><span data-stu-id="7f4d1-119">Close an encrypted file opened with [**OpenEncryptedFileRaw**](/windows/desktop/api/WinBase/nf-winbase-openencryptedfilerawa)</span></span>                                                                                                                                                                                      |
| [<span data-ttu-id="7f4d1-120">**реаденкриптедфилерав**</span><span class="sxs-lookup"><span data-stu-id="7f4d1-120">**ReadEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-readencryptedfileraw)   | <span data-ttu-id="7f4d1-121">Чтение зашифрованного файла, оставляемого данными в зашифрованном формате</span><span class="sxs-lookup"><span data-stu-id="7f4d1-121">Read an encrypted file leaving its data in encrypted format</span></span>                                                                                                                                                                                                                   |
| [<span data-ttu-id="7f4d1-122">**вритинкриптедфилерав**</span><span class="sxs-lookup"><span data-stu-id="7f4d1-122">**WriteEncryptedFileRaw**</span></span>](/windows/desktop/api/WinBase/nf-winbase-writeencryptedfileraw) | <span data-ttu-id="7f4d1-123">Запись зашифрованного файла, оставляемого данными в зашифрованном формате</span><span class="sxs-lookup"><span data-stu-id="7f4d1-123">Write an encrypted file leaving its data in encrypted format</span></span>                                                                                                                                                                                                                  |
| [<span data-ttu-id="7f4d1-124">**импорткаллбакк**</span><span class="sxs-lookup"><span data-stu-id="7f4d1-124">**ImportCallback**</span></span>](/windows/desktop/api/WinBase/nc-winbase-pfe_import_func)               | <span data-ttu-id="7f4d1-125">Определяемый приложением обратный вызов для использования с [ **вритинкриптедфилерав**](/windows/desktop/api/WinBase/nf-winbase-writeencryptedfileraw)</span><span class="sxs-lookup"><span data-stu-id="7f4d1-125">Application-defined callback for use with [**WriteEncryptedFileRaw**](/windows/desktop/api/WinBase/nf-winbase-writeencryptedfileraw)</span></span>                                                                                                                                                                              |
| [<span data-ttu-id="7f4d1-126">**експорткаллбакк**</span><span class="sxs-lookup"><span data-stu-id="7f4d1-126">**ExportCallback**</span></span>](/windows/desktop/api/WinBase/nc-winbase-pfe_export_func)               | <span data-ttu-id="7f4d1-127">Определяемый приложением обратный вызов для использования с [ **реаденкриптедфилерав**](/windows/desktop/api/WinBase/nf-winbase-readencryptedfileraw)</span><span class="sxs-lookup"><span data-stu-id="7f4d1-127">Application-defined callback for use with [**ReadEncryptedFileRaw**](/windows/desktop/api/WinBase/nf-winbase-readencryptedfileraw)</span></span>                                                                                                                                                                                |



 

 

 
