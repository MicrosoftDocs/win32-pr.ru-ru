---
description: Файл, помеченный как зашифрованный, шифруется файловой системой NTFS с использованием текущего драйвера шифрования.
ms.assetid: 166bfb8c-b97d-4cc7-bf6b-399837cb8ad0
title: Обработка зашифрованных файлов и каталогов
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2718656a28eb678c10076e228e08a2a95cabd1fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999408"
---
# <a name="handling-encrypted-files-and-directories"></a><span data-ttu-id="f2caa-103">Обработка зашифрованных файлов и каталогов</span><span class="sxs-lookup"><span data-stu-id="f2caa-103">Handling Encrypted Files and Directories</span></span>

<span data-ttu-id="f2caa-104">Программист или пользователь может пометить каталог или файл как зашифрованный.</span><span class="sxs-lookup"><span data-stu-id="f2caa-104">A programmer or user may mark a directory or file as encrypted.</span></span> <span data-ttu-id="f2caa-105">Файл, помеченный как зашифрованный, шифруется файловой системой NTFS с использованием текущего драйвера шифрования.</span><span class="sxs-lookup"><span data-stu-id="f2caa-105">A file marked encrypted is encrypted by the NTFS file system by using the current encryption driver.</span></span> <span data-ttu-id="f2caa-106">Если позже файл помечается как не зашифрованный, он расшифровывается и остается в обычном текстовом (небезопасном) состоянии.</span><span class="sxs-lookup"><span data-stu-id="f2caa-106">If at a later date the file is marked as not encrypted, it is decrypted and left in a plain text (unsecured) state.</span></span>

<span data-ttu-id="f2caa-107">Каталоги не шифруются.</span><span class="sxs-lookup"><span data-stu-id="f2caa-107">Directories are not themselves encrypted.</span></span> <span data-ttu-id="f2caa-108">Вместо этого по умолчанию в зашифрованном каталоге все новые файлы в каталоге шифруются при создании.</span><span class="sxs-lookup"><span data-stu-id="f2caa-108">Rather, by default, in an "encrypted" directory all new files in the directory are encrypted at creation.</span></span> <span data-ttu-id="f2caa-109">Пользователь должен специально изменить состояние нового файла на расшифровать, если пользователь не хочет, чтобы он был зашифрован.</span><span class="sxs-lookup"><span data-stu-id="f2caa-109">A user must specifically change the status of a new file to decrypted if the user does not want the file to be encrypted.</span></span> <span data-ttu-id="f2caa-110">Отображается зашифрованный каталог.</span><span class="sxs-lookup"><span data-stu-id="f2caa-110">An encrypted directory is visible.</span></span> <span data-ttu-id="f2caa-111">Чтобы сделать каталог недоступным для других пользователей, используйте стандартные методы управления доступом.</span><span class="sxs-lookup"><span data-stu-id="f2caa-111">To make a directory inaccessible to other users, use the standard methods of access control.</span></span>

<span data-ttu-id="f2caa-112">Функции шифрования не могут использоваться с [API архивации](/windows/desktop/Backup/backup).</span><span class="sxs-lookup"><span data-stu-id="f2caa-112">The encryption functions cannot be used with the [Backup API](/windows/desktop/Backup/backup).</span></span>

<span data-ttu-id="f2caa-113">Чтобы зашифровать новый файл, используйте функцию [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) с флагом **File \_ \_ Encrypted** .</span><span class="sxs-lookup"><span data-stu-id="f2caa-113">To encrypt a new file, use the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_ATTRIBUTE\_ENCRYPTED** flag.</span></span> <span data-ttu-id="f2caa-114">Чтобы зашифровать существующий файл, используйте функцию [**енкриптфиле**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="f2caa-114">To encrypt an existing file, use the [**EncryptFile**](/windows/desktop/api/WinBase/nf-winbase-encryptfilea) function.</span></span> <span data-ttu-id="f2caa-115">Все потоки данных в файле шифруются.</span><span class="sxs-lookup"><span data-stu-id="f2caa-115">All data streams in the file are encrypted.</span></span> <span data-ttu-id="f2caa-116">Если файл уже зашифрован, **енкриптфиле** не выполняет никаких действий, но возвращает ненулевое значение, которое указывает на успешное выполнение.</span><span class="sxs-lookup"><span data-stu-id="f2caa-116">If the file is already encrypted, **EncryptFile** does nothing but returns a nonzero value, which indicates success.</span></span> <span data-ttu-id="f2caa-117">Если файл сжат, **енкриптфиле** распаковывает файл перед его шифрованием.</span><span class="sxs-lookup"><span data-stu-id="f2caa-117">If the file is compressed, **EncryptFile** decompresses the file before encrypting it.</span></span>

<span data-ttu-id="f2caa-118">Чтобы расшифровать зашифрованный файл, используйте функцию [**декриптфиле**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) .</span><span class="sxs-lookup"><span data-stu-id="f2caa-118">To decrypt an encrypted file, use the [**DecryptFile**](/windows/desktop/api/WinBase/nf-winbase-decryptfilea) function.</span></span> <span data-ttu-id="f2caa-119">Если файл не зашифрован, **декриптфиле** не выполняет никаких действий, но возвращает ненулевое значение, указывающее на успешное выполнение.</span><span class="sxs-lookup"><span data-stu-id="f2caa-119">If the file is not encrypted, **DecryptFile** does nothing but returns a nonzero value indicating success.</span></span>

<span data-ttu-id="f2caa-120">Функция [**енкриптиондисабле**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) отключает или включает шифрование указанного каталога и файлов в нем.</span><span class="sxs-lookup"><span data-stu-id="f2caa-120">The [**EncryptionDisable**](/windows/desktop/api/WinEfs/nf-winefs-encryptiondisable) function disables or enables the encryption of the indicated directory and the files in it.</span></span> <span data-ttu-id="f2caa-121">Он не влияет на шифрование подкаталогов ниже указанного каталога.</span><span class="sxs-lookup"><span data-stu-id="f2caa-121">It does not affect the encryption of subdirectories below the indicated directory.</span></span>

<span data-ttu-id="f2caa-122">Чтобы получить состояние шифрования файла, используйте функцию [**филинкриптионстатус**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) .</span><span class="sxs-lookup"><span data-stu-id="f2caa-122">To retrieve the encryption status of a file, use the [**FileEncryptionStatus**](/windows/desktop/api/WinBase/nf-winbase-fileencryptionstatusa) function.</span></span> <span data-ttu-id="f2caa-123">Кроме того, можно вызвать функцию [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) и проверить в возвращаемом значении флаг **\_ \_ зашифрованного атрибута файла** .</span><span class="sxs-lookup"><span data-stu-id="f2caa-123">Alternatively, call the [**GetFileAttributes**](/windows/desktop/api/FileAPI/nf-fileapi-getfileattributesa) function and examine the **FILE\_ATTRIBUTE\_ENCRYPTED** flag in the return value.</span></span>

<span data-ttu-id="f2caa-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) и [**копифиликс**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) пытаются зашифровать файл назначения с помощью ключей, используемых при шифровании исходного файла.</span><span class="sxs-lookup"><span data-stu-id="f2caa-124">[**CopyFile**](/windows/desktop/api/WinBase/nf-winbase-copyfile) and [**CopyFileEx**](/windows/desktop/api/WinBase/nf-winbase-copyfileexa) attempt to encrypt the destination file with the keys used in the encryption of the source file.</span></span> <span data-ttu-id="f2caa-125">Если это невозможно, обе функции пытаются зашифровать файл назначения с помощью ключей по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f2caa-125">If this cannot be done, both functions attempt to encrypt the destination file with default keys.</span></span> <span data-ttu-id="f2caa-126">Если не удается выполнить оба этих метода, **CopyFile** и **копифиликс** завершаются сбоем с ошибкой " **\_ \_ Сбой шифрования ошибки** ".</span><span class="sxs-lookup"><span data-stu-id="f2caa-126">If both of these methods cannot be done, **CopyFile** and **CopyFileEx** fail with an **ERROR\_ENCRYPTION\_FAILED** error.</span></span> <span data-ttu-id="f2caa-127">Если вы хотите, чтобы **копифиликс** выполнил операцию копирования, даже если не удается зашифровать целевой файл, включите в параметр *двкопифлагс* в вызове **копифиликс** флажок **\_ \_ \_ расшифровать \_ конечный** флаг.</span><span class="sxs-lookup"><span data-stu-id="f2caa-127">If you want **CopyFileEx** to complete the copy operation even when the destination file cannot be encrypted, include the **COPY\_FILE\_ALLOW\_DECRYPTED\_DESTINATION** flag in the value of the *dwCopyFlags* parameter in your call to **CopyFileEx**.</span></span>

 

 
