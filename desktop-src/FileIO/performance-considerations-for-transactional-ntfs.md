---
description: Рекомендации по оптимизации транзакций файловой системы.
ms.assetid: 847939ff-5322-4023-8ef7-9d845e80d65c
title: Рекомендации по производительности для транзакционной NTFS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a71f7e100e1ddd8524932a4a259a12092bddcb6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "103999154"
---
# <a name="performance-considerations-for-transactional-ntfs"></a>Рекомендации по производительности для транзакционной NTFS

Транзакционная NTFS (TxF) была тщательно спроектирована для повышения производительности и обычно выполняется лучше, чем для транзакционных альтернатив общего назначения в рамках аналогичных сценариев. Однако транзакции файловой системы имеют больший расход ресурсов, чем операции, не относящиеся к транзакции, и ожидается снижение производительности ввода-вывода по сравнению с операциями ввода-вывода, не являющимися транзакционными. Приложения, критические для производительности, должны выполнять цикл квалификации внедрения технологий, оценивая влияние транзакционной файловой системы на производительность.

## <a name="overview-of-txf-operations"></a>Общие сведения об операциях TxF

TxF использует ведение журнала *отмены* для записи изменений, необходимых для возвращения файловой системы в целостное состояние, которое также называется откатом, если происходит прерывание транзакции. Это ведение журнала отмены создает дополнительные операции ввода-вывода и является источником издержек на производительность TxF по сравнению с операциями файловой системы, которые не являются транзакционными.

Общая сводка о том, как работает TxF, выглядит следующим образом:

-   По мере выполнения транзакции TxF записывает *отменяющие* записи в файл журнала для каждого изменения, внесенного в файловую систему. В случае прерывания эти записи отмены анализируются, чтобы вернуть файловую систему в состояние, в котором она находилась до начала транзакции.
-   Запись отмены *изменений метаданных* описывает изменение только метаданных файловой системы. Некоторые примеры таких элементов: перемещение, переименование, Добавление и изменение атрибутов. Для записей отмены изменений метаданных все сведения, необходимые для отмены изменения, находятся в записи и хранятся в файле журнала.
-   Запись отмены *перезаписи* описывает перезапись части файла. Когда происходит перезапись файла, исходное содержимое файла сохраняется в специальном файле отмены в скрытом каталоге, а запись отмены изменений перезаписи указывает на этот файл. Когда обновления файлов в конечном итоге сбрасываются из кэша на диск, содержимое файла отмены также должно быть очищено, поэтому транзакционная перезапись файла может создать до двух случайных операций ввода-вывода: один для чтения старых данных, а другой для записи в файл отката. Эти дополнительные операции ввода-вывода представляют собой стоимость производительности TxF.
-   Когда происходит фиксация, TxF сначала очищает все сведения об отмене, затем очищает фактические изменения файла, а затем записывает и очищает запись фиксации. Если нет файлов отмены для сброса, то при записи журнала на диск удаляются только дополнительные издержки TxF, относящиеся к нетранзакционным операциям ввода-вывода. Однако сброс журнала приводит к эффективному большим последовательным операциям записи, поэтому затраты на производительность минимальны.
-   Система TxF оптимизирована для фиксации. Ожидается, что большинство транзакций будут выполнены без необходимости отката, поэтому все записи отмены для транзакции должны быть неиспользуемыми. С точки зрения производительности операции фиксации TxF выполняются быстро, а откаты — с большим объемом ресурсов.
-   Откат требует больше ресурсов, чем фиксация. Во время отката все изменения, внесенные в транзакцию, должны быть отменены. Как правило, длительность отката может быть приблизительно такой же, как и для первоначального внесения изменений. Например, если для внесения всех изменений потребуется одна секунда, для ее отмены может потребоваться около 1 секунды. Для очень длинных транзакций откат может повысить производительность. Например, время загрузки системы может быть отложено, если система должна автоматически отменять транзакцию в случае, если система перестает отвечать на запросы и должна выполнить незапланированную перезагрузку.

Сводные выводы о производительности, которые могут быть выведены из предыдущего списка, приведены ниже.

-   Производительность TxF для транзакций, включающих в себя перезапись файлов, может быть значительной.
-   Стоимость производительности TxF для транзакций, включающих только операции с метаданными, может быть относительно низкой, если используются большие транзакции. Большая транзакция имеет большое количество записей отмены для каждой записи фиксации.

## <a name="recommendations-for-best-performance"></a>Рекомендации по лучшей производительности

Выведите издержки TxF за более крупные транзакции. Например, если у вас есть *n* наборов изменений, чтобы сделать так, чтобы каждое изменение имело шаги *m* , и вы можете сделать это как *N* транзакций из *m* шагов каждый или сделать все как одну транзакцию с *м* \* *N* шагами, последний вариант будет более эффективным.

Учитывайте возможное влияние на загрузку очень больших транзакций. Как было сказано ранее, откат может быть медленным и будет задерживать время загрузки, если система должна выполнять автоматический откат в качестве времени загрузки. Чем больше транзакция, тем дольше задержка.

Продерживайте транзакции в большинстве операций с метаданными. Это то, что система TxF оптимизирована для и, в целом, производительность аналогична операции файлового ввода-вывода, не являющейся транзакционной, для транзакций с большими метаданными. Примерами эффективных метаданных могут служить функции TxF [**мовефилетрансактед**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**сетфилеаттрибутестрансактед**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**копифилетрансактед**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**делетефилетрансактед**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda), а также добавленные операции записи (вызовы функции [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) , когда указатель файла находится в конце файла или *EOF*). Примером ресурсоемких операций, не связанных с метаданными, являются вызовы функции **WriteFile** , если указатель файла находится не на EOF.

## <a name="summary-of-txf-performance-expectations"></a>Сводка по ожиданиям производительности TxF

Для обновлений на месте перезапись в раздел файла будет выполняться значительно медленнее, чем в операциях файлового ввода-вывода, а производительность TxF для операций с метаданными файловой системы (например, создание, перемещение и добавление) сравнима с операциями файлового ввода-вывода для больших транзакций.

 

 



