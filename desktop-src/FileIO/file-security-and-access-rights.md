---
description: Поскольку файлы являются защищаемыми объектами, доступ к ним регулируется моделью управления доступом, которая управляет доступом ко всем другим защищаемым объектам в Windows.
ms.assetid: 991d7d94-fae7-406f-b2e3-dee811279366
title: Безопасность файлов и права доступа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b161dd78c7585cf6de2781d7339787a22bde95dc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105662747"
---
# <a name="file-security-and-access-rights"></a><span data-ttu-id="78979-103">Безопасность файлов и права доступа</span><span class="sxs-lookup"><span data-stu-id="78979-103">File Security and Access Rights</span></span>

<span data-ttu-id="78979-104">Поскольку файлы являются [защищаемыми объектами](/windows/desktop/SecAuthZ/securable-objects), доступ к ним регулируется моделью управления доступом, которая управляет доступом ко всем другим защищаемым объектам в Windows.</span><span class="sxs-lookup"><span data-stu-id="78979-104">Because files are [securable objects](/windows/desktop/SecAuthZ/securable-objects), access to them is regulated by the access-control model that governs access to all other securable objects in Windows.</span></span> <span data-ttu-id="78979-105">Подробное описание этой модели см. в разделе [Контроль доступа](/windows/desktop/SecAuthZ/access-control).</span><span class="sxs-lookup"><span data-stu-id="78979-105">For a detailed explanation of this model, see [Access Control](/windows/desktop/SecAuthZ/access-control).</span></span>

<span data-ttu-id="78979-106">При вызове функции [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**CreateDirectory**](/windows/desktop/api/FileAPI/nf-fileapi-createdirectorya)или [**креатедиректорекс**](/windows/desktop/api/WinBase/nf-winbase-createdirectoryexa) можно указать [дескриптор безопасности](/windows/desktop/api/winnt/ns-winnt-security_descriptor) для файла или каталога.</span><span class="sxs-lookup"><span data-stu-id="78979-106">You can specify a [security descriptor](/windows/desktop/api/winnt/ns-winnt-security_descriptor) for a file or directory when you call the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**CreateDirectory**](/windows/desktop/api/FileAPI/nf-fileapi-createdirectorya), or [**CreateDirectoryEx**](/windows/desktop/api/WinBase/nf-winbase-createdirectoryexa) function.</span></span> <span data-ttu-id="78979-107">Если для параметра *лпсекуритяттрибутес* указано **значение NULL** , то файл или каталог получает дескриптор безопасности по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="78979-107">If you specify **NULL** for the *lpSecurityAttributes* parameter, the file or directory gets a default security descriptor.</span></span> <span data-ttu-id="78979-108">Списки управления доступом (ACL) в дескрипторе безопасности по умолчанию для файла или каталога наследуются от родительского каталога.</span><span class="sxs-lookup"><span data-stu-id="78979-108">The access control lists (ACL) in the default security descriptor for a file or directory are inherited from its parent directory.</span></span> <span data-ttu-id="78979-109">Обратите внимание, что дескриптор безопасности по умолчанию назначается только в том случае, если файл или каталог создается вновь, а не при его переименовании или перемещении.</span><span class="sxs-lookup"><span data-stu-id="78979-109">Note that a default security descriptor is assigned only when a file or directory is newly created, and not when it is renamed or moved.</span></span>

<span data-ttu-id="78979-110">Чтобы получить дескриптор безопасности объекта файла или каталога, вызовите функцию [**жетнамедсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-getnamedsecurityinfoa) или [**жетсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) .</span><span class="sxs-lookup"><span data-stu-id="78979-110">To retrieve the security descriptor of a file or directory object, call the [**GetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getnamedsecurityinfoa) or [**GetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) function.</span></span> <span data-ttu-id="78979-111">Чтобы изменить дескриптор безопасности объекта файла или каталога, вызовите функцию [**сетнамедсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-setnamedsecurityinfoa) или [**сетсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) .</span><span class="sxs-lookup"><span data-stu-id="78979-111">To change the security descriptor of a file or directory object, call the [**SetNamedSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setnamedsecurityinfoa) or [**SetSecurityInfo**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) function.</span></span>

<span data-ttu-id="78979-112">Допустимые права доступа к файлам и каталогам включают в себя **Удаление**, **\_ Управление чтением**, **запись \_ DAC**, **запись \_ владельца** и **синхронизацию** [стандартных прав доступа](/windows/desktop/SecAuthZ/standard-access-rights).</span><span class="sxs-lookup"><span data-stu-id="78979-112">The valid access rights for files and directories include the **DELETE**, **READ\_CONTROL**, **WRITE\_DAC**, **WRITE\_OWNER**, and **SYNCHRONIZE** [standard access rights](/windows/desktop/SecAuthZ/standard-access-rights).</span></span> <span data-ttu-id="78979-113">В таблице в [**константах прав доступа к файлу**](file-access-rights-constants.md) перечислены права доступа, относящиеся к файлам и каталогам.</span><span class="sxs-lookup"><span data-stu-id="78979-113">The table in [**File Access Rights Constants**](file-access-rights-constants.md) lists the access rights that are specific to files and directories.</span></span>

<span data-ttu-id="78979-114">Несмотря на то, что право на **синхронизацию** доступа определяется в [стандартном списке прав доступа](/windows/desktop/SecAuthZ/standard-access-rights) , чтобы указать маркер файла в одной из функций ожидания, при использовании асинхронных операций файлового ввода-вывода следует ожидать обработчика событий, содержащегося в правильно настроенной [**перекрывающейся**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) структуре, вместо использования маркера файла с правом **синхронизировать** доступ для синхронизации.</span><span class="sxs-lookup"><span data-stu-id="78979-114">Although the **SYNCHRONIZE** access right is defined within the [standard access rights](/windows/desktop/SecAuthZ/standard-access-rights) list as the right to specify a file handle in one of the wait functions, when using asynchronous file I/O operations you should wait on the event handle contained in a properly configured [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure rather than using the file handle with the **SYNCHRONIZE** access right for synchronization.</span></span>

<span data-ttu-id="78979-115">Ниже перечислены [универсальные права доступа к](/windows/desktop/SecAuthZ/generic-access-rights) файлам и каталогам.</span><span class="sxs-lookup"><span data-stu-id="78979-115">The following are the [generic access rights](/windows/desktop/SecAuthZ/generic-access-rights) for files and directories.</span></span>



<table>
<thead>
<tr class="header">
<th><span data-ttu-id="78979-116">Право доступа</span><span class="sxs-lookup"><span data-stu-id="78979-116">Access right</span></span></th>
<th><span data-ttu-id="78979-117">Описание</span><span class="sxs-lookup"><span data-stu-id="78979-117">Description</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="78979-118"><strong>FILE_GENERIC_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-118"><strong>FILE_GENERIC_EXECUTE</strong></span></span></td>
<td><dl> <span data-ttu-id="78979-119"><strong>FILE_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-119"><strong>FILE_EXECUTE</strong></span></span><br /><span data-ttu-id="78979-120">
<strong>FILE_READ_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="78979-120">
<strong>FILE_READ_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="78979-121">
<strong>STANDARD_RIGHTS_EXECUTE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-121">
<strong>STANDARD_RIGHTS_EXECUTE</strong></span></span><br /><span data-ttu-id="78979-122">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-122">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
<tr class="even">
<td><span data-ttu-id="78979-123"><strong>FILE_GENERIC_READ</strong></span><span class="sxs-lookup"><span data-stu-id="78979-123"><strong>FILE_GENERIC_READ</strong></span></span></td>
<td><dl> <span data-ttu-id="78979-124"><strong>FILE_READ_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="78979-124"><strong>FILE_READ_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="78979-125">
<strong>FILE_READ_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="78979-125">
<strong>FILE_READ_DATA</strong></span></span><br /><span data-ttu-id="78979-126">
<strong>FILE_READ_EA</strong></span><span class="sxs-lookup"><span data-stu-id="78979-126">
<strong>FILE_READ_EA</strong></span></span><br /><span data-ttu-id="78979-127">
<strong>STANDARD_RIGHTS_READ</strong></span><span class="sxs-lookup"><span data-stu-id="78979-127">
<strong>STANDARD_RIGHTS_READ</strong></span></span><br /><span data-ttu-id="78979-128">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-128">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="78979-129"><strong>FILE_GENERIC_WRITE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-129"><strong>FILE_GENERIC_WRITE</strong></span></span></td>
<td><dl> <span data-ttu-id="78979-130"><strong>FILE_APPEND_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="78979-130"><strong>FILE_APPEND_DATA</strong></span></span><br /><span data-ttu-id="78979-131">
<strong>FILE_WRITE_ATTRIBUTES</strong></span><span class="sxs-lookup"><span data-stu-id="78979-131">
<strong>FILE_WRITE_ATTRIBUTES</strong></span></span><br /><span data-ttu-id="78979-132">
<strong>FILE_WRITE_DATA</strong></span><span class="sxs-lookup"><span data-stu-id="78979-132">
<strong>FILE_WRITE_DATA</strong></span></span><br /><span data-ttu-id="78979-133">
<strong>FILE_WRITE_EA</strong></span><span class="sxs-lookup"><span data-stu-id="78979-133">
<strong>FILE_WRITE_EA</strong></span></span><br /><span data-ttu-id="78979-134">
<strong>STANDARD_RIGHTS_WRITE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-134">
<strong>STANDARD_RIGHTS_WRITE</strong></span></span><br /><span data-ttu-id="78979-135">
<strong>SYNCHRONIZE</strong></span><span class="sxs-lookup"><span data-stu-id="78979-135">
<strong>SYNCHRONIZE</strong></span></span><br />
</dl></td>
</tr>
</tbody>
</table>



 

<span data-ttu-id="78979-136">Windows сравнивает запрошенные права доступа и сведения в маркере доступа потока со сведениями в дескрипторе безопасности объекта File или Directory.</span><span class="sxs-lookup"><span data-stu-id="78979-136">Windows compares the requested access rights and the information in the thread's access token with the information in the file or directory object's security descriptor.</span></span> <span data-ttu-id="78979-137">Если при сравнении не запрещается предоставление всех запрошенных прав доступа, в поток возвращается маркер объекта, и предоставляются права доступа.</span><span class="sxs-lookup"><span data-stu-id="78979-137">If the comparison does not prohibit all of the requested access rights from being granted, a handle to the object is returned to the thread and the access rights are granted.</span></span> <span data-ttu-id="78979-138">Дополнительные сведения об этом процессе см. в разделе [взаимодействие между потоками и защищаемые объекты](/windows/desktop/SecAuthZ/interaction-between-threads-and-securable-objects).</span><span class="sxs-lookup"><span data-stu-id="78979-138">For more information about this process, see [Interaction between Threads and Securable Objects](/windows/desktop/SecAuthZ/interaction-between-threads-and-securable-objects).</span></span>

<span data-ttu-id="78979-139">По умолчанию авторизация доступа к файлу или каталогу контролируется исключительно списками управления доступом в дескрипторе безопасности, связанном с этим файлом или каталогом.</span><span class="sxs-lookup"><span data-stu-id="78979-139">By default, authorization for access to a file or directory is controlled strictly by the ACLs in the security descriptor associated with that file or directory.</span></span> <span data-ttu-id="78979-140">В частности, дескриптор безопасности родительского каталога не используется для управления доступом к любому дочернему файлу или каталогу.</span><span class="sxs-lookup"><span data-stu-id="78979-140">In particular, the security descriptor of a parent directory is not used to control access to any child file or directory.</span></span> <span data-ttu-id="78979-141">[Право доступа к](/windows/desktop/SecAuthZ/access-rights-and-access-masks) **файлу \_ обхода** может быть принудительно удалено путем удаления [привилегий](/windows/desktop/SecAuthZ/privileges) обхода **\_ перекрестной \_ проверки** для пользователей.</span><span class="sxs-lookup"><span data-stu-id="78979-141">The **FILE\_TRAVERSE** [access right](/windows/desktop/SecAuthZ/access-rights-and-access-masks) can be enforced by removing the **BYPASS\_TRAVERSE\_CHECKING** [privilege](/windows/desktop/SecAuthZ/privileges) from users.</span></span> <span data-ttu-id="78979-142">Это не рекомендуется в общем случае, так как многие программы неправильно обрабатывают ошибки обхода каталогов.</span><span class="sxs-lookup"><span data-stu-id="78979-142">This is not recommended in the general case, as many programs do not correctly handle directory traversal errors.</span></span> <span data-ttu-id="78979-143">Основное использование право доступа к **файлам \_** в каталогах заключается в том, чтобы обеспечить соответствие определенным стандартам стандарта IEEE и ISO при обеспечении совместимости с системами UNIX.</span><span class="sxs-lookup"><span data-stu-id="78979-143">The primary use for the **FILE\_TRAVERSE** access right on directories is to enable conformance to certain IEEE and ISO POSIX standards when interoperability with Unix systems is a requirement.</span></span>

<span data-ttu-id="78979-144">Модель безопасности Windows позволяет дочернему каталогу наследовать или предотвратить наследование одного или нескольких записей ACE в дескрипторе безопасности родительского каталога.</span><span class="sxs-lookup"><span data-stu-id="78979-144">The Windows security model provides a way for a child directory to inherit, or to be prevented from inheriting, one or more of the ACEs in the parent directory's security descriptor.</span></span> <span data-ttu-id="78979-145">Каждый элемент ACE содержит информацию, определяющую, как она может быть унаследована, и будет ли она оказывать воздействие на наследуемый объект каталога.</span><span class="sxs-lookup"><span data-stu-id="78979-145">Each ACE contains information that determines how it can be inherited, and whether it will have an effect on the inheriting directory object.</span></span> <span data-ttu-id="78979-146">Например, некоторые унаследованные элементы управления доступом к объекту каталога наследуются и называются *действующими записями ACE*.</span><span class="sxs-lookup"><span data-stu-id="78979-146">For example, some inherited ACEs control access to the inherited directory object, and these are called *effective ACEs*.</span></span> <span data-ttu-id="78979-147">Все остальные ACE называются *только наследуемыми элементами управления доступом*.</span><span class="sxs-lookup"><span data-stu-id="78979-147">All other ACEs are called *inherit-only ACEs*.</span></span>

<span data-ttu-id="78979-148">Модель безопасности Windows также обеспечивает автоматическое наследование ACE дочерними объектами в соответствии с [правилами наследования ACE](/windows/desktop/SecAuthZ/ace-inheritance-rules).</span><span class="sxs-lookup"><span data-stu-id="78979-148">The Windows security model also enforces the automatic inheritance of ACEs to child objects according to the [ACE inheritance rules](/windows/desktop/SecAuthZ/ace-inheritance-rules).</span></span> <span data-ttu-id="78979-149">Это автоматическое наследование вместе с информацией о наследовании в каждой записи ACE определяет, как ограничения безопасности передаются вниз по иерархии каталогов.</span><span class="sxs-lookup"><span data-stu-id="78979-149">This automatic inheritance, along with the inheritance information in each ACE, determines how security restrictions are passed down the directory hierarchy.</span></span>

<span data-ttu-id="78979-150">Обратите внимание, что вы не можете использовать ACE, запрещающий доступ, чтобы запретить доступ к файлу только для **универсального \_ чтения** или только для общего доступа на **\_ запись** .</span><span class="sxs-lookup"><span data-stu-id="78979-150">Note that you cannot use an access-denied ACE to deny only **GENERIC\_READ** or only **GENERIC\_WRITE** access to a file.</span></span> <span data-ttu-id="78979-151">Это связано с тем, что для файловых объектов универсальные сопоставления универсальной операции **\_ чтения** или **универсальной \_ записи** включают право на **синхронизацию** доступа.</span><span class="sxs-lookup"><span data-stu-id="78979-151">This is because for file objects, the generic mappings for both **GENERIC\_READ** or **GENERIC\_WRITE** include the **SYNCHRONIZE** access right.</span></span> <span data-ttu-id="78979-152">Если ACE запрещает универсальный доступ на **\_ запись** к доверенному лицу, а доверенное лицо запрашивает универсальный доступ для **\_ чтения** , запрос завершится ошибкой, так как запрос неявно включает **синхронизацию** доступа, который неявно отклоняется элементом ACE, и наоборот.</span><span class="sxs-lookup"><span data-stu-id="78979-152">If an ACE denies **GENERIC\_WRITE** access to a trustee, and the trustee requests **GENERIC\_READ** access, the request will fail because the request implicitly includes **SYNCHRONIZE** access which is implicitly denied by the ACE, and vice versa.</span></span> <span data-ttu-id="78979-153">Вместо использования ACE, запрещенного доступом, используйте ACE, разрешенные доступом, чтобы явно разрешить разрешенные права доступа.</span><span class="sxs-lookup"><span data-stu-id="78979-153">Instead of using access-denied ACEs, use access-allowed ACEs to explicitly allow the permitted access rights.</span></span>

<span data-ttu-id="78979-154">Другим способом управления доступом к объектам хранилища является шифрование.</span><span class="sxs-lookup"><span data-stu-id="78979-154">Another means of managing access to storage objects is encryption.</span></span> <span data-ttu-id="78979-155">Реализация шифрования файловой системы в Windows — это зашифрованная файловая система или EFS.</span><span class="sxs-lookup"><span data-stu-id="78979-155">The implementation of file system encryption in Windows is the Encrypted File System, or EFS.</span></span> <span data-ttu-id="78979-156">EFS шифрует только файлы, а не каталоги.</span><span class="sxs-lookup"><span data-stu-id="78979-156">EFS encrypts only files and not directories.</span></span> <span data-ttu-id="78979-157">Преимущество шифрования заключается в том, что он обеспечивает дополнительную защиту файлов, которые применяются к носителю, а не через файловую систему и стандартную архитектуру управления доступом Windows.</span><span class="sxs-lookup"><span data-stu-id="78979-157">The advantage of encryption is that it provides additional protection to files that is applied on the media and not through the file system and the standard Windows access control architecture.</span></span> <span data-ttu-id="78979-158">Дополнительные сведения о шифровании файлов см. в разделе [Шифрование файлов](file-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="78979-158">For more information on file encryption, see [File Encryption](file-encryption.md).</span></span>

<span data-ttu-id="78979-159">В большинстве случаев возможность чтения и записи параметров безопасности файла или объекта каталога ограничена процессами режима ядра.</span><span class="sxs-lookup"><span data-stu-id="78979-159">In most cases, the ability to read and write the security settings of a file or directory object is restricted to kernel-mode processes.</span></span> <span data-ttu-id="78979-160">Очевидно, что не нужно, чтобы какой либо пользовательский процесс мог изменить владение или ограничение доступа к закрытому файлу или каталогу.</span><span class="sxs-lookup"><span data-stu-id="78979-160">Clearly, you would not want any user process to be able to change the ownership or access restriction on your private file or directory.</span></span> <span data-ttu-id="78979-161">Однако приложение резервного копирования не сможет завершить свое задание резервного копирования файла, если ограничения доступа, которые вы поместили в файл или каталог, не позволяют процессу пользовательского режима приложения прочитать его.</span><span class="sxs-lookup"><span data-stu-id="78979-161">However, a backup application would not be able to complete its job of backing up your file if the access restrictions you have placed on your file or directory does not allow the application's user-mode process to read it.</span></span> <span data-ttu-id="78979-162">Приложения резервного копирования должны иметь возможность переопределить параметры безопасности объектов файлов и каталогов, чтобы обеспечить полную архивацию.</span><span class="sxs-lookup"><span data-stu-id="78979-162">Backup applications must be able to override the security settings of file and directory objects to ensure a complete backup.</span></span> <span data-ttu-id="78979-163">Аналогичным образом, если приложение резервного копирования пытается записать резервную копию файла на диск, а вы явно отклоните права записи для процесса резервного копирования, операция восстановления не может завершиться.</span><span class="sxs-lookup"><span data-stu-id="78979-163">Similarly, if a backup application attempts to write a backup copy of your file over the disk-resident copy, and you explicitly deny write privileges to the backup application process, the restore operation cannot complete.</span></span> <span data-ttu-id="78979-164">В этом случае приложение резервного копирования должно иметь возможность переопределить параметры управления доступом к файлу.</span><span class="sxs-lookup"><span data-stu-id="78979-164">In this case also, the backup application must be able to override the access control settings of your file.</span></span>

<span data-ttu-id="78979-165">Привилегии **SE \_ BACKUP \_ Name** и **SE \_ RESTORE \_ Name** были специально созданы, чтобы обеспечить эту возможность резервного копирования приложений.</span><span class="sxs-lookup"><span data-stu-id="78979-165">The **SE\_BACKUP\_NAME** and **SE\_RESTORE\_NAME** access privileges were specifically created to provide this ability to backup applications.</span></span> <span data-ttu-id="78979-166">Если эти привилегии были предоставлены и включены в маркере доступа процесса приложения резервного копирования, можно вызвать функцию [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) , чтобы открыть файл или каталог для резервного копирования, указав стандартное право доступа на **Чтение \_** в качестве значения параметра *двдесиредакцесс* .</span><span class="sxs-lookup"><span data-stu-id="78979-166">If these privileges have been granted and enabled in the access token of the backup application process, it can then call [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) to open your file or directory for backup, specifying the standard **READ\_CONTROL** access right as the value of the *dwDesiredAccess* parameter.</span></span> <span data-ttu-id="78979-167">Однако для обнаружения вызывающего процесса в качестве процесса резервного копирования вызов функции **CreateFile** должен включать флаг **\_ \_ \_ семантики резервного копирования флага файла** в параметре *двфлагсандаттрибутес* .</span><span class="sxs-lookup"><span data-stu-id="78979-167">However, to identify the calling process as a backup process, the call to **CreateFile** must include the **FILE\_FLAG\_BACKUP\_SEMANTICS** flag in the *dwFlagsAndAttributes* parameter.</span></span> <span data-ttu-id="78979-168">Полный синтаксис вызова функции приведен ниже.</span><span class="sxs-lookup"><span data-stu-id="78979-168">The full syntax of the function call is the following:</span></span>


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           READ_CONTROL,               // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           OPEN_EXISTING,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



<span data-ttu-id="78979-169">Это позволит процессу резервного копирования открыть файл и переопределить стандартную проверку безопасности.</span><span class="sxs-lookup"><span data-stu-id="78979-169">This will allow the backup application process to open your file and override the standard security checking.</span></span> <span data-ttu-id="78979-170">Чтобы восстановить файл, приложение резервного копирования будет использовать следующий синтаксис вызова [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) при открытии файла для написания.</span><span class="sxs-lookup"><span data-stu-id="78979-170">To restore your file, the backup application would use the following [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) call syntax when opening your file to be written.</span></span>


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           WRITE_OWNER | WRITE_DAC,    // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           CREATE_ALWAYS,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



<span data-ttu-id="78979-171">Существуют ситуации, когда приложение резервного копирования должно иметь возможность изменять параметры управления доступом к файлу или каталогу.</span><span class="sxs-lookup"><span data-stu-id="78979-171">There are situations when a backup application must be able to change the access control settings of a file or directory.</span></span> <span data-ttu-id="78979-172">Например, если параметры управления доступом к хранимой на диске копии файла или каталога отличаются от резервной копии.</span><span class="sxs-lookup"><span data-stu-id="78979-172">An example is when the access control settings of the disk-resident copy of a file or directory is different from the backup copy.</span></span> <span data-ttu-id="78979-173">Это может произойти, если эти параметры были изменены после резервного копирования файла или каталога или если они были повреждены.</span><span class="sxs-lookup"><span data-stu-id="78979-173">This would happen if these settings were changed after the file or directory was backed up, or if it was corrupted.</span></span>

<span data-ttu-id="78979-174">Флаг **\_ \_ \_ семантики резервного копирования флагов файлов** , указанный в вызове функции [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) , дает приложению резервного копирования разрешение на чтение параметров управления доступом к файлу или каталогу.</span><span class="sxs-lookup"><span data-stu-id="78979-174">The **FILE\_FLAG\_BACKUP\_SEMANTICS** flag specified in the call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) gives the backup application process permission to read the access-control settings of the file or directory.</span></span> <span data-ttu-id="78979-175">С этим разрешением процесс резервного копирования может вызывать [**жеткернелобжектсекурити**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-getkernelobjectsecurity) и [**сеткернелобжектсекурити**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-setkernelobjectsecurity) для чтения и, помимо сброса параметров управления доступом.</span><span class="sxs-lookup"><span data-stu-id="78979-175">With this permission, the backup application process can then call [**GetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-getkernelobjectsecurity) and [**SetKernelObjectSecurity**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-setkernelobjectsecurity) to read and than reset the access-control settings.</span></span>

<span data-ttu-id="78979-176">Если приложение резервного копирования должно иметь доступ к [параметрам управления доступом](/windows/desktop/SecAuthZ/access-control-lists)на уровне системы, в значении параметра *двдесиредакцесс* , переданном в [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), должен быть указан флаг **\_ \_ безопасности системы Access** .</span><span class="sxs-lookup"><span data-stu-id="78979-176">If a backup application must have access to the system-level [access control settings](/windows/desktop/SecAuthZ/access-control-lists), the **ACCESS\_SYSTEM\_SECURITY** flag must be specified in the *dwDesiredAccess* parameter value passed to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span>

<span data-ttu-id="78979-177">Приложения резервного копирования вызывают [**баккупреад**](/windows/desktop/api/winbase/nf-winbase-backupread) для чтения файлов и каталогов, указанных для операции восстановления, и [**баккупврите**](/windows/desktop/api/winbase/nf-winbase-backupwrite) для их записи.</span><span class="sxs-lookup"><span data-stu-id="78979-177">Backup applications call [**BackupRead**](/windows/desktop/api/winbase/nf-winbase-backupread) to read the files and directories specified for the restore operation, and [**BackupWrite**](/windows/desktop/api/winbase/nf-winbase-backupwrite) to write them.</span></span>

## <a name="related-topics"></a><span data-ttu-id="78979-178">См. также</span><span class="sxs-lookup"><span data-stu-id="78979-178">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="78979-179">стандартные права доступа</span><span class="sxs-lookup"><span data-stu-id="78979-179">standard access rights</span></span>](/windows/desktop/SecAuthZ/standard-access-rights)
</dt> </dl>

 

 
