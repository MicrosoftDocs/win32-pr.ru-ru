---
description: Поскольку файлы являются защищаемыми объектами, доступ к ним регулируется моделью управления доступом, которая управляет доступом ко всем другим защищаемым объектам в Windows.
ms.assetid: 991d7d94-fae7-406f-b2e3-dee811279366
title: Безопасность файлов и права доступа
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b161dd78c7585cf6de2781d7339787a22bde95dc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105662747"
---
# <a name="file-security-and-access-rights"></a>Безопасность файлов и права доступа

Поскольку файлы являются [защищаемыми объектами](/windows/desktop/SecAuthZ/securable-objects), доступ к ним регулируется моделью управления доступом, которая управляет доступом ко всем другим защищаемым объектам в Windows. Подробное описание этой модели см. в разделе [Контроль доступа](/windows/desktop/SecAuthZ/access-control).

При вызове функции [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), [**CreateDirectory**](/windows/desktop/api/FileAPI/nf-fileapi-createdirectorya)или [**креатедиректорекс**](/windows/desktop/api/WinBase/nf-winbase-createdirectoryexa) можно указать [дескриптор безопасности](/windows/desktop/api/winnt/ns-winnt-security_descriptor) для файла или каталога. Если для параметра *лпсекуритяттрибутес* указано **значение NULL** , то файл или каталог получает дескриптор безопасности по умолчанию. Списки управления доступом (ACL) в дескрипторе безопасности по умолчанию для файла или каталога наследуются от родительского каталога. Обратите внимание, что дескриптор безопасности по умолчанию назначается только в том случае, если файл или каталог создается вновь, а не при его переименовании или перемещении.

Чтобы получить дескриптор безопасности объекта файла или каталога, вызовите функцию [**жетнамедсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-getnamedsecurityinfoa) или [**жетсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-getsecurityinfo) . Чтобы изменить дескриптор безопасности объекта файла или каталога, вызовите функцию [**сетнамедсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-setnamedsecurityinfoa) или [**сетсекуритинфо**](/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo) .

Допустимые права доступа к файлам и каталогам включают в себя **Удаление**, **\_ Управление чтением**, **запись \_ DAC**, **запись \_ владельца** и **синхронизацию** [стандартных прав доступа](/windows/desktop/SecAuthZ/standard-access-rights). В таблице в [**константах прав доступа к файлу**](file-access-rights-constants.md) перечислены права доступа, относящиеся к файлам и каталогам.

Несмотря на то, что право на **синхронизацию** доступа определяется в [стандартном списке прав доступа](/windows/desktop/SecAuthZ/standard-access-rights) , чтобы указать маркер файла в одной из функций ожидания, при использовании асинхронных операций файлового ввода-вывода следует ожидать обработчика событий, содержащегося в правильно настроенной [**перекрывающейся**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) структуре, вместо использования маркера файла с правом **синхронизировать** доступ для синхронизации.

Ниже перечислены [универсальные права доступа к](/windows/desktop/SecAuthZ/generic-access-rights) файлам и каталогам.



<table>
<thead>
<tr class="header">
<th>Право доступа</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>FILE_GENERIC_EXECUTE</strong></td>
<td><dl> <strong>FILE_EXECUTE</strong><br />
<strong>FILE_READ_ATTRIBUTES</strong><br />
<strong>STANDARD_RIGHTS_EXECUTE</strong><br />
<strong>SYNCHRONIZE</strong><br />
</dl></td>
</tr>
<tr class="even">
<td><strong>FILE_GENERIC_READ</strong></td>
<td><dl> <strong>FILE_READ_ATTRIBUTES</strong><br />
<strong>FILE_READ_DATA</strong><br />
<strong>FILE_READ_EA</strong><br />
<strong>STANDARD_RIGHTS_READ</strong><br />
<strong>SYNCHRONIZE</strong><br />
</dl></td>
</tr>
<tr class="odd">
<td><strong>FILE_GENERIC_WRITE</strong></td>
<td><dl> <strong>FILE_APPEND_DATA</strong><br />
<strong>FILE_WRITE_ATTRIBUTES</strong><br />
<strong>FILE_WRITE_DATA</strong><br />
<strong>FILE_WRITE_EA</strong><br />
<strong>STANDARD_RIGHTS_WRITE</strong><br />
<strong>SYNCHRONIZE</strong><br />
</dl></td>
</tr>
</tbody>
</table>



 

Windows сравнивает запрошенные права доступа и сведения в маркере доступа потока со сведениями в дескрипторе безопасности объекта File или Directory. Если при сравнении не запрещается предоставление всех запрошенных прав доступа, в поток возвращается маркер объекта, и предоставляются права доступа. Дополнительные сведения об этом процессе см. в разделе [взаимодействие между потоками и защищаемые объекты](/windows/desktop/SecAuthZ/interaction-between-threads-and-securable-objects).

По умолчанию авторизация доступа к файлу или каталогу контролируется исключительно списками управления доступом в дескрипторе безопасности, связанном с этим файлом или каталогом. В частности, дескриптор безопасности родительского каталога не используется для управления доступом к любому дочернему файлу или каталогу. [Право доступа к](/windows/desktop/SecAuthZ/access-rights-and-access-masks) **файлу \_ обхода** может быть принудительно удалено путем удаления [привилегий](/windows/desktop/SecAuthZ/privileges) обхода **\_ перекрестной \_ проверки** для пользователей. Это не рекомендуется в общем случае, так как многие программы неправильно обрабатывают ошибки обхода каталогов. Основное использование право доступа к **файлам \_** в каталогах заключается в том, чтобы обеспечить соответствие определенным стандартам стандарта IEEE и ISO при обеспечении совместимости с системами UNIX.

Модель безопасности Windows позволяет дочернему каталогу наследовать или предотвратить наследование одного или нескольких записей ACE в дескрипторе безопасности родительского каталога. Каждый элемент ACE содержит информацию, определяющую, как она может быть унаследована, и будет ли она оказывать воздействие на наследуемый объект каталога. Например, некоторые унаследованные элементы управления доступом к объекту каталога наследуются и называются *действующими записями ACE*. Все остальные ACE называются *только наследуемыми элементами управления доступом*.

Модель безопасности Windows также обеспечивает автоматическое наследование ACE дочерними объектами в соответствии с [правилами наследования ACE](/windows/desktop/SecAuthZ/ace-inheritance-rules). Это автоматическое наследование вместе с информацией о наследовании в каждой записи ACE определяет, как ограничения безопасности передаются вниз по иерархии каталогов.

Обратите внимание, что вы не можете использовать ACE, запрещающий доступ, чтобы запретить доступ к файлу только для **универсального \_ чтения** или только для общего доступа на **\_ запись** . Это связано с тем, что для файловых объектов универсальные сопоставления универсальной операции **\_ чтения** или **универсальной \_ записи** включают право на **синхронизацию** доступа. Если ACE запрещает универсальный доступ на **\_ запись** к доверенному лицу, а доверенное лицо запрашивает универсальный доступ для **\_ чтения** , запрос завершится ошибкой, так как запрос неявно включает **синхронизацию** доступа, который неявно отклоняется элементом ACE, и наоборот. Вместо использования ACE, запрещенного доступом, используйте ACE, разрешенные доступом, чтобы явно разрешить разрешенные права доступа.

Другим способом управления доступом к объектам хранилища является шифрование. Реализация шифрования файловой системы в Windows — это зашифрованная файловая система или EFS. EFS шифрует только файлы, а не каталоги. Преимущество шифрования заключается в том, что он обеспечивает дополнительную защиту файлов, которые применяются к носителю, а не через файловую систему и стандартную архитектуру управления доступом Windows. Дополнительные сведения о шифровании файлов см. в разделе [Шифрование файлов](file-encryption.md).

В большинстве случаев возможность чтения и записи параметров безопасности файла или объекта каталога ограничена процессами режима ядра. Очевидно, что не нужно, чтобы какой либо пользовательский процесс мог изменить владение или ограничение доступа к закрытому файлу или каталогу. Однако приложение резервного копирования не сможет завершить свое задание резервного копирования файла, если ограничения доступа, которые вы поместили в файл или каталог, не позволяют процессу пользовательского режима приложения прочитать его. Приложения резервного копирования должны иметь возможность переопределить параметры безопасности объектов файлов и каталогов, чтобы обеспечить полную архивацию. Аналогичным образом, если приложение резервного копирования пытается записать резервную копию файла на диск, а вы явно отклоните права записи для процесса резервного копирования, операция восстановления не может завершиться. В этом случае приложение резервного копирования должно иметь возможность переопределить параметры управления доступом к файлу.

Привилегии **SE \_ BACKUP \_ Name** и **SE \_ RESTORE \_ Name** были специально созданы, чтобы обеспечить эту возможность резервного копирования приложений. Если эти привилегии были предоставлены и включены в маркере доступа процесса приложения резервного копирования, можно вызвать функцию [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) , чтобы открыть файл или каталог для резервного копирования, указав стандартное право доступа на **Чтение \_** в качестве значения параметра *двдесиредакцесс* . Однако для обнаружения вызывающего процесса в качестве процесса резервного копирования вызов функции **CreateFile** должен включать флаг **\_ \_ \_ семантики резервного копирования флага файла** в параметре *двфлагсандаттрибутес* . Полный синтаксис вызова функции приведен ниже.


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           READ_CONTROL,               // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           OPEN_EXISTING,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



Это позволит процессу резервного копирования открыть файл и переопределить стандартную проверку безопасности. Чтобы восстановить файл, приложение резервного копирования будет использовать следующий синтаксис вызова [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) при открытии файла для написания.


```C++
HANDLE hFile = CreateFile( fileName,                   // lpFileName
                           WRITE_OWNER | WRITE_DAC,    // dwDesiredAccess
                           0,                          // dwShareMode
                           NULL,                       // lpSecurityAttributes
                           CREATE_ALWAYS,              // dwCreationDisposition
                           FILE_FLAG_BACKUP_SEMANTICS, // dwFlagsAndAttributes
                           NULL );                     // hTemplateFile
```



Существуют ситуации, когда приложение резервного копирования должно иметь возможность изменять параметры управления доступом к файлу или каталогу. Например, если параметры управления доступом к хранимой на диске копии файла или каталога отличаются от резервной копии. Это может произойти, если эти параметры были изменены после резервного копирования файла или каталога или если они были повреждены.

Флаг **\_ \_ \_ семантики резервного копирования флагов файлов** , указанный в вызове функции [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) , дает приложению резервного копирования разрешение на чтение параметров управления доступом к файлу или каталогу. С этим разрешением процесс резервного копирования может вызывать [**жеткернелобжектсекурити**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-getkernelobjectsecurity) и [**сеткернелобжектсекурити**](/windows/desktop/api/securitybaseapi/nf-securitybaseapi-setkernelobjectsecurity) для чтения и, помимо сброса параметров управления доступом.

Если приложение резервного копирования должно иметь доступ к [параметрам управления доступом](/windows/desktop/SecAuthZ/access-control-lists)на уровне системы, в значении параметра *двдесиредакцесс* , переданном в [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), должен быть указан флаг **\_ \_ безопасности системы Access** .

Приложения резервного копирования вызывают [**баккупреад**](/windows/desktop/api/winbase/nf-winbase-backupread) для чтения файлов и каталогов, указанных для операции восстановления, и [**баккупврите**](/windows/desktop/api/winbase/nf-winbase-backupwrite) для их записи.

## <a name="related-topics"></a>См. также

<dl> <dt>

[стандартные права доступа](/windows/desktop/SecAuthZ/standard-access-rights)
</dt> </dl>

 

 
