---
description: Файловая система NTFS связывает неподписанный 64-разрядный идентификатор с каждым журналом изменений.
ms.assetid: 5ae79460-b69a-4901-a417-1d5358dcba29
title: Использование идентификатора журнала изменений
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 692acf98403e45b6bdafd3cd4791a64dd1beb532
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "105683115"
---
# <a name="using-the-change-journal-identifier"></a><span data-ttu-id="ed570-103">Использование идентификатора журнала изменений</span><span class="sxs-lookup"><span data-stu-id="ed570-103">Using the Change Journal Identifier</span></span>

<span data-ttu-id="ed570-104">Файловая система NTFS связывает неподписанный 64-разрядный идентификатор с каждым журналом изменений.</span><span class="sxs-lookup"><span data-stu-id="ed570-104">The NTFS file system associates an unsigned 64-bit identifier with each change journal.</span></span> <span data-ttu-id="ed570-105">При создании журнала он отмечается этим идентификатором.</span><span class="sxs-lookup"><span data-stu-id="ed570-105">The journal is stamped with this identifier when it is created.</span></span> <span data-ttu-id="ed570-106">Файловая система помечает журнал новым идентификатором, в котором существующие записи последовательного номера обновлений (USN) либо могут быть непригодными для использования.</span><span class="sxs-lookup"><span data-stu-id="ed570-106">The file system stamps the journal with a new identifier where the existing update sequence number (USN) records either are or may be unusable.</span></span>

<span data-ttu-id="ed570-107">Например, файловая система NTFS отмечает журнал изменений новым идентификатором при перемещении тома из одной версии NTFS в другую, а затем обратно.</span><span class="sxs-lookup"><span data-stu-id="ed570-107">For example, the NTFS file system restamps a change journal with a new identifier when a volume is moved from one version of NTFS to another and then back.</span></span> <span data-ttu-id="ed570-108">Такое перемещение может произойти в среде с двойной загрузкой или при работе со съемными носителями.</span><span class="sxs-lookup"><span data-stu-id="ed570-108">Such a move can happen in a dual-boot environment or when working with removable media.</span></span>

<span data-ttu-id="ed570-109">Чтобы получить идентификатор текущего журнала изменений на указанном томе, используйте код управления [**\_ \_ \_ журнала USN фсктл Query**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="ed570-109">To obtain the identifier of the current change journal on a specified volume, use the [**FSCTL\_QUERY\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) control code.</span></span> <span data-ttu-id="ed570-110">Для выполнения этого и всех других операций с журналом изменений необходимо иметь права системного администратора.</span><span class="sxs-lookup"><span data-stu-id="ed570-110">To perform this and all other change journal operations, you must have system administrator privileges.</span></span> <span data-ttu-id="ed570-111">То есть необходимо быть членом группы администраторов.</span><span class="sxs-lookup"><span data-stu-id="ed570-111">That is, you must be a member of the Administrators group.</span></span>

<span data-ttu-id="ed570-112">Когда администратор удаляет и повторно создает журнал изменений, например, когда текущее значение USN приближается к максимально возможному значению USN, значения USN начинают с нуля.</span><span class="sxs-lookup"><span data-stu-id="ed570-112">When an administrator deletes and re-creates the change journal, for example when the current USN value approaches the maximum possible USN value, the USN values begin again from zero.</span></span> <span data-ttu-id="ed570-113">Когда файловая система NTFS помечает журнал с новым идентификатором вместо повторного создания журнала, он не сбрасывает USN в ноль, но продолжится с текущего USN.</span><span class="sxs-lookup"><span data-stu-id="ed570-113">When the NTFS file system stamps a journal with a new identifier rather than re-creating the journal, it does not reset the USN to zero but continues from the current USN.</span></span> <span data-ttu-id="ed570-114">В любом случае все существующие Usnы будут меньше, чем все будущие USN.</span><span class="sxs-lookup"><span data-stu-id="ed570-114">In either case, all existing USNs are less than any future USNs.</span></span>

<span data-ttu-id="ed570-115">Если вам нужны сведения о конкретном наборе записей, используйте код [**управления \_ \_ \_ журнала USN фсктл Query**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) , чтобы получить идентификатор журнала изменений.</span><span class="sxs-lookup"><span data-stu-id="ed570-115">When you need information on a specific set of records, use the [**FSCTL\_QUERY\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_query_usn_journal) control code to obtain the change journal identifier.</span></span> <span data-ttu-id="ed570-116">Затем используйте контрольный код [**фсктл \_ Read \_ USN \_**](/windows/win32/api/winioctl/ni-winioctl-fsctl_read_usn_journal) для чтения интересующих записей журнала.</span><span class="sxs-lookup"><span data-stu-id="ed570-116">Then use the [**FSCTL\_READ\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_read_usn_journal) control code to read the journal records of interest.</span></span> <span data-ttu-id="ed570-117">Файловая система NTFS возвращает только те записи, которые действительны для журнала, указанного идентификатором.</span><span class="sxs-lookup"><span data-stu-id="ed570-117">The NTFS file system only returns records that are valid for the journal specified by the identifier.</span></span>

<span data-ttu-id="ed570-118">Приложению требуются записи "USN" и идентификатор для чтения журнала.</span><span class="sxs-lookup"><span data-stu-id="ed570-118">Your application needs both the records' USNs and the identifier to read the journal.</span></span> <span data-ttu-id="ed570-119">Это требование обеспечивает проверку целостности для случаев, когда приложение должно игнорировать существующие записи в файле и записи, записанные в предыдущих экземплярах журнала для того же тома.</span><span class="sxs-lookup"><span data-stu-id="ed570-119">This requirement provides an integrity check for cases where your application should ignore the existing records in the file and where records were written in previous instances of the journal for the same volume.</span></span>

<span data-ttu-id="ed570-120">Чтобы получить интересующие вас записи, необходимо начать с самой старой записи (то есть с наименьшим USN) и выполнить сканирование вперед до тех пор, пока не будет найдена первая интересующая запись.</span><span class="sxs-lookup"><span data-stu-id="ed570-120">To obtain the records in which you are interested, you must start at the oldest record (that is, with the lowest USN) and scan forward until you locate the first record of interest.</span></span>

 

 
